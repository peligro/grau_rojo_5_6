<?php
/***************procesos especiales******************/
//print_r($datos);    
    //valores de procesos especiales (Folia y cuno)
     $tesp1=$fotomecanica->folia1_proceso_seletec;
     $tesp2=$fotomecanica->folia2_proceso_seletec;
     $tesp3=$fotomecanica->folia3_proceso_seletec;
     $tesp4=$fotomecanica->cuno1_proceso_seletec;
     $tesp5=$fotomecanica->cuno2_proceso_seletec;
     
      $fv1=$fotomecanica->procesos_especiales_folia_valor;
      $fv2=$fotomecanica->procesos_especiales_folia_2_valor;
      $fv3=$fotomecanica->procesos_especiales_folia_3_valor;
      $cv1=$fotomecanica->procesos_especiales_cuno_valor;
      $cv2=$fotomecanica->procesos_especiales_cuno_2_valor;
    
    //inicializo variable cantidad de procesos especiales
    $procesosespeciales=0;
    
    //contabilizo variable cantidad de procesos especiales
    if($tesp1!=0){ $procesosespeciales++; } //echo "procesos especiales:".$procesosespeciales;
    if($tesp2!=0){ $procesosespeciales++; } //echo "procesos especiales:".$procesosespeciales;
    if($tesp3!=0){ $procesosespeciales++; } //echo "procesos especiales:".$procesosespeciales;
    if($tesp4!=0){ $procesosespeciales++; } //echo "procesos especiales:".$procesosespeciales;
    if($tesp5!=0){ $procesosespeciales++; } //echo "procesos especiales:".$procesosespeciales;
    
    //Lleno los arrays de procesos especiales
    $folia1=$this->procesosespeciales_model->getDetalleProcesosPorId($fotomecanica->folia1_proceso_seletec);
    $folia2=$this->procesosespeciales_model->getDetalleProcesosPorId($fotomecanica->folia2_proceso_seletec);
    $folia3=$this->procesosespeciales_model->getDetalleProcesosPorId($fotomecanica->folia3_proceso_seletec);
    $cuno1=$this->procesosespeciales_model->getDetalleProcesosPorId($fotomecanica->cuno1_proceso_seletec);
    $cuno2=$this->procesosespeciales_model->getDetalleProcesosPorId($fotomecanica->cuno2_proceso_seletec);
    
    //Lleno los arrays de costos fijos
    $cffolia1=$this->procesosespeciales_model->getDetalleProcesosPorId($fotomecanica->folia1_molde_selected);
    $cffolia2=$this->procesosespeciales_model->getDetalleProcesosPorId($fotomecanica->folia2_molde_selected);
    $cffolia3=$this->procesosespeciales_model->getDetalleProcesosPorId($fotomecanica->folia3_molde_selected);
    $cfcuno1=$this->procesosespeciales_model->getDetalleProcesosPorId($fotomecanica->cuno1_molde_selected);
    $cfcuno2=$this->procesosespeciales_model->getDetalleProcesosPorId($fotomecanica->cuno2_molde_selected); 
              
    //Totalizo el monto de procesos especiales
    $totaltrabajosespeciales=$folia1->valor_venta+$folia2->valor_venta+$folia3->valor_venta+$cuno1->valor_venta+$cuno2->valor_venta;
    
    
if ($datos->cantidad_1 == "" || $datos->cantidad_1 === 0) {
    $datoscantidad1 = 1;
} else {
    $datoscantidad1 = $datos->cantidad_1;
}
if ($datos->cantidad_2 == "" || $datos->cantidad_2 === 0) {
    $datoscantidad2 = 1;
} else {
    $datoscantidad2 = $datos->cantidad_2;
}
if ($datos->cantidad_3 == "" || $datos->cantidad_3 === 0) {
    $datoscantidad3 = 1;
} else {
    $datoscantidad3 = $datos->cantidad_3;
}
if ($datos->cantidad_4 == "" || $datos->cantidad_4 === 0) {
    $datoscantidad4 = 1;
} else {
    $datoscantidad4 = $datos->cantidad_4;
}

$trazadosing = $this->trazados_model->getTrazadosPorId($datos->trazado);

//print_r($trazadosing);
//**************Funcion despacho***************************

function calcularDespacho($uno, $dos, $retiro, $materialidad, $fuerasantiago, $distancia) {
    switch ($distancia) {
        case 1:
            $monto=15000;
            break;
        case 2:
            $monto=24000;
            break;
        case 3:
            $monto=30000;
            break;
        case 4:
            $monto=45000;
            break;

        default:
            break;
    }
    
    if ($materialidad == 'Microcorrugado' || $materialidad == 'Corrugado') {
        $palets = round(($uno + $dos) / 250);
        if ($palets < 5) {
            $palets = 5;
        }
        if ($retiro == 'SI') {
            $costodespacho = $palets * 1500;
        } else {
            $costodespacho = $palets * 7500;
        }
    } else {
        if ($materialidad == 'Cartulina-cartulina' || $materialidad == 'Sólo Cartulina') {
            $palets = round(($uno + $dos) / 500);
            if ($palets < 5) {
                $palets = 5;
            }
            if ($retiro == 'SI') {
                $costodespacho = $palets * 1500;
            } else {
                $costodespacho = $palets * 7500;
            }
        }
    }
    
    if($fuerasantiago=='SI'){
        $complemento= $palets*$monto;
    }else{
        $complemento= 0;
    }
    
    $costodespacho=$costodespacho+$complemento;
    return array($costodespacho, $palets);
}


$mdt=$ing->materialidad_datos_tecnicos;
$retiro=$datos->retira_cliente;
$fuerasantiago=$datos->despacho_fuera_de_santiago;
$distancia=$datos->distancia;

//echo "<h1>" . $distancia . "</h1>";
//*********************************************************
//echo "total trabajosespeciales".$totaltrabajosespeciales."<br>";
   echo "<br>";
    /****************************************************/
        

    $tamano1=$ing->tamano_a_imprimir_1;
    $tamano2=$ing->tamano_a_imprimir_2;
 
    if($tamano1==60 and $tamano2>100)
    {
        $maquina="Máquina Roland 800";
    }elseif($tamano1==70 and $tamano2>120)
    {
        $maquina="Máquina Roland 800";
    }elseif($tamano1==80 and $tamano2>89)
    {
        $maquina="Máquina Roland 800";
    }elseif($tamano1==90 and $tamano2>89)
    {
        $maquina="Máquina Roland 800";
        
    }elseif($tamano1>90 and $tamano2>60)
    {
        $maquina="Máquina Roland 800";
    }else
    {
        $maquina="Máquina Roland 800";
    }
    /**	
       * validaciones mermas
       * */
       
       if($fotomecanica->colores>3)
        {
            if($maquina=="Máquina Roland 800")
            {
                if($datos->vb_maquina == 'SI' || $datos->acepta_excedentes == 'NO')
                {
                    $color1=0;
                    $color2= $fotomecanica->colores*150;				
                }else{			
                    $color1=0;
                    $color2= $fotomecanica->colores*100;
                }
            }else
            {
                if($datos->vb_maquina == 'SI' || $datos->acepta_excedentes == 'NO')
                {
                    $color1=0;
                    $color2= $fotomecanica->colores*150;				
                }else{			
                $color1=0;
                $color2= $fotomecanica->colores*100;
                }
            }
        }else
        {
            if($fotomecanica->colores == 0)
            {
              $color1=0;
              $color2=0;
            }elseif($fotomecanica->colores >= 1 and $fotomecanica->colores <= 3)
            {	
              if($maquina=="Máquina Roland 800")
              {
                 $color1= 400;
                 $color2=0;
              }else
              {
                      //ultra
                 $color1= 300;
                 $color2=0;
              }
            }
        }
         
         $canTotal=number_format($datoscantidad1/5000,0,"","");//6000 1
         //echo $canTotal;exit;
         if (($datoscantidad1>0) and ($ing->unidades_por_pliego>0))
            $cantidad_1=$datoscantidad1/$ing->unidades_por_pliego;
         else 
             $cantidad_1=0;
         //echo $cantidad_1;exit;
         if (($datoscantidad2>0) and ($ing->unidades_por_pliego>0))
            $cantidad_2=$datoscantidad2/$ing->unidades_por_pliego;
         else 
             $cantidad_2=0;
         //echo $cantidad_1;exit;
         if (($datoscantidad3>0) and ($ing->unidades_por_pliego>0))
            $cantidad_3=$datoscantidad3/$ing->unidades_por_pliego;
         else 
             $cantidad_3=0;
         //echo $cantidad_1;exit;
         if (($datoscantidad4>0) and ($ing->unidades_por_pliego>0))
            $cantidad_4=$datoscantidad4/$ing->unidades_por_pliego;
         else 
             $cantidad_4=0;
         
        
         //echo $ing->unidades_por_pliego;exit;
         
         if($cantidad_1>5000)
         {
            $vecescan1 = ($cantidad_1) / 5000;
            if($vecescan1 >1)
            {
               $can1= 30 * $vecescan1;
            }else{
               $can1=30;
            }
            if($vecescan1 >1)
            {
                //$entero=number_format(($cantidad_1/5000)+0.5,0,'','');
                $can2= 50 * $vecescan1;
            }else
            {
                $can2=50;
            }
         }else
         {
            $can1=0;
            $can2=0;
         }
       //  echo $can1;exit();
        //cantidad para merma 2
         if($cantidad_2>5000)
         {
            $vecescan2 = ($cantidad_2) / 5000;
            if($vecescan2 >1)
            {
               $can3= 30 * $vecescan2;
            }else{
               $can3=30;
            }
            if($vecescan2 >1)
            {
                //$entero=number_format(($cantidad_1/5000)+0.5,0,'','');
                $can4= 50 * $vecescan2;
            }else
            {
                $can4=50;
            }
         }else
         {
            $can3=0;
            $can4=0;
         }
        //cantidad para merma 3
         if($cantidad_3>5000)
         {
            $vecescan3 = ($cantidad_3) / 5000;
            if($vecescan3 >1)
            {
               $can5= 30 * $vecescan3;
            }else{
               $can5=30;
            }
            if($vecescan3 >1)
            {
                //$entero=number_format(($cantidad_1/5000)+0.5,0,'','');
                $can6= 50 * $vecescan3;
            }else
            {
                $can6=50;
            }
         }else
         {
            $can5=0;
            $can6=0;
         }
        //cantidad para merma 4
         if($cantidad_4>5000)
         {
            $vecescan4 = ($cantidad_4) / 5000;
            if($vecescan4 >1)
            {
               $can7= 30 * $vecescan4;
            }else{
               $can7=30;
            }
            if($vecescan4 >1)
            {
                //$entero=number_format(($cantidad_1/5000)+0.5,0,'','');
                $can8= 50 * $vecescan4;
            }else
            {
                $can8=50;
            }
         }else
         {
            $can7=0;
            $can8=0;
         }
        
        
        $barniz=substr($fotomecanica->acabado_impresion_1,0,6);
        //echo $barniz;exit;
       // echo $datoscantidad1;exit;
         if(($fotomecanica->fot_lleva_barniz!='') && ($fotomecanica->fot_lleva_barniz!='Nada'))
         {
            $cantidadBarniz=$datoscantidad1-1000;
            
            if($cantidadBarniz<1000)
            {
                if($maquina=="Máquina Roland 800")
                {
                    //$bar1=150;
                    $bar1=100;
                    $bar2=0;
                }else
                {
                    $bar1=100;
                    $bar2=0;
                }
            }else
            {
			
               //echo $datoscantidad1/$ing->unidades_por_pliego;exit;
               $enteroBarniz=($datoscantidad1/$ing->unidades_por_pliego);
		//echo $enteroBarniz;exit();
               if($enteroBarniz < 1000)
			   {
				//$bar1=150;
				$bar1=100;
                                $bar2=0;   
			   }else
			   {
               //$enteroBarniz=(((number_format($enteroBarniz,0,'','')/1000)+1)-2)*10;
               $enteroBarniz=number_format((((($enteroBarniz/1000)+1)-2)*10),0,'','');
               $bar1=100;
               //$bar2=$enteroBarniz;
               $bar2=number_format(((($datoscantidad1/$ing->unidades_por_pliego)-1000)/1000*1),0,'','');
			   
               
                           }
            }

         }else
         {
                $bar1=0;
                $bar2=0;
                }
         
        
         
         //calculo dos para barniz de merma
         if(($fotomecanica->fot_lleva_barniz!='') && ($fotomecanica->fot_lleva_barniz!='Nada'))
         {
            $cantidadBarniz2=$datoscantidad2-1000;
            if($cantidadBarniz2<1000)
            {
                if($maquina=="Máquina Roland 800")
                {
                    $bar3=100;
                    $bar4=0;
                }else
                {
                    $bar3=100;
                    $bar4=0;
                }
            }else
            {
			
            $enteroBarniz2 = ($datoscantidad2 / $ing->unidades_por_pliego);
        if ($enteroBarniz2 < 1000) {
            //$bar1=150;
            $bar3 = 100;
            $bar4 = 0;
        } else {
            $enteroBarniz2 = (((number_format($enteroBarniz2, 0, '', '') / 1000) + 1) - 2);

            $bar3 = 100;
            $bar4 = $enteroBarniz2;
        }
        }
            
            
         }else
         {
                $bar3=0;
                $bar4=0;
         }
         //calculo tres para barniz de merma
         if(($fotomecanica->fot_lleva_barniz!='') && ($fotomecanica->fot_lleva_barniz!='Nada'))
         {
            $cantidadBarniz3=$datoscantidad3-1000;
            if($cantidadBarniz3<1000)
            {
                if($maquina=="Máquina Roland 800")
                {
                    //$bar1=150;
                    $bar5=100;
                    $bar6=0;
                }else
                {
                    $bar5=100;
                    $bar6=0;
                }
            }else
            {

               $enteroBarniz3=($datoscantidad3/$ing->unidades_por_pliego);
		//echo $enteroBarniz;exit();
               if($enteroBarniz3 < 1000)
			   {
				//$bar1=150;
				$bar5=100;
                                $bar6=0;   
			   }else
			   {
               $enteroBarniz3=(((number_format($enteroBarniz3,0,'','')/1000)+1)-2)*10;

               $bar5=100;
               //$bar6=$enteroBarniz3;
               $bar6=number_format(((($datoscantidad3/$ing->unidades_por_pliego)-1000)/1000*1),0,'','');
			   }
            }
            
            
         }else
         {
                $bar5=0;
                $bar6=0;
         }
         //calculo cuatro para barniz de merma
                  if(($fotomecanica->fot_lleva_barniz!='') && ($fotomecanica->fot_lleva_barniz!='Nada'))
         {
            $cantidadBarniz4=$datoscantidad4-1000;
            if($cantidadBarniz4<1000)
            {
                if($maquina=="Máquina Roland 800")
                {
                    //$bar1=150;
                    $bar7=100;
                    $bar8=0;
                }else
                {
                    $bar7=100;
                    $bar8=0;
                }
            }else
            {

               $enteroBarniz4=($datoscantidad4/$ing->unidades_por_pliego);

               if($enteroBarniz4 < 1000)
			   {
				//$bar1=150;
				$bar7=100;
                                $bar8=0;   
			   }else
			   {
               $enteroBarniz4=(((number_format($enteroBarniz4,0,'','')/1000)+1)-2)*10;

               $bar7=100;
               //$bar8=$enteroBarniz4;
               $bar8=number_format(((($datoscantidad4/$ing->unidades_por_pliego)-1000)/1000*1),0,'','');
			   }
            }
            
            
         }else
         {
                $bar7=0;
                $bar8=0;
         }
		 

		
		
		
        if($datos->procesos_especiales_folia=="SI")
        {
            $folia=25;
        }else
        {
            $folia=0;
        }
 
        $acabado_nombre4=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_4);
        $acabado_nombre5=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_5);
        $acabado_nombre6=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_6);
		
		
	if(strstr($acabado_nombre4->caracteristicas,"LACA") != false)
        {
            $laca=25;
        }

	if(strstr($acabado_nombre5->caracteristicas,"LACA") != false)
        {
            $laca=25;
        }
		
	if(strstr($acabado_nombre6->caracteristicas,"LACA") != false)
        {
            $laca=25;
        }
		
        if($laca == null)
        {
                $laca=0;
        }
		
		
	if(strstr($acabado_nombre4->caracteristicas,"TERMOLAMINADO") != false)
        {
            $termolaminado=50;
			
        } 
		
	if(strstr($acabado_nombre5->caracteristicas,"TERMOLAMINADO") != false)
        {
            $termolaminado=50;
			
        }
		
         if(strstr($acabado_nombre6->caracteristicas,"TERMOLAMINADO") != false)
        {
            $termolaminado=50;
			
        }
		
		
		
		if($acabado_nombre4->tipo == 'Externo' and $acabado_nombre4->id != 17)
        {
	
            $numeros_de_acabados=1;			
        }else
        {
        } 
		
		if($acabado_nombre5->tipo == 'Externo' and $acabado_nombre5->id != 17)
        {
	
            $numeros_de_acabados=2;		
        }else
        {
        } 
		
         if($acabado_nombre6->tipo == 'Externo' and $acabado_nombre6->id != 17)
        {

            $numeros_de_acabados=3;	
        }else
        {
        } 
		
		 if($numeros_de_acabados >= 2)
        {
            $termolaminado=0;
        }
		
        if($fotomecanica->acabado_impresion_4 != "17" || $fotomecanica->acabado_impresion_5 != "17" || $fotomecanica->acabado_impresion_6 != "17") {

    if ($fotomecanica->acabado_impresion_4 != "No lleva" || $fotomecanica->acabado_impresion_5 != "No lleva" || $fotomecanica->acabado_impresion_6 != "No lleva") {

        if ($fotomecanica->acabado_impresion_4 != "" || $fotomecanica->acabado_impresion_5 != "" || $fotomecanica->acabado_impresion_6 != "") {

            $externo = 50;
        } else {

            $externo = 0;
        }
    }
}


//rutina para acabados internos agregado por ehndz
        $var1=0;
        $var2=0;
        $var3=0;
        if (($fotomecanica->acabado_impresion_1!='') && ($fotomecanica->acabado_impresion_1!=16))	
            $var1=1;
	if (($fotomecanica->acabado_impresion_2!='')  && ($fotomecanica->acabado_impresion_2!=16))      
            $var2=1;
	if (($fotomecanica->acabado_impresion_3!='')  && ($fotomecanica->acabado_impresion_3!=16))      
            $var3=1;
        $totalTrabajosInternos=$var1+$var2+$var3; 
        if($totalTrabajosInternos>0){
            $totalTrabajosInternos;
        }else{
            $totalTrabajosInternos="No";
        }
        //fin de rutina para acabados internos agregados por ehndz
        //rutina para acabados internos agregado por ehndz
        $var1=0;
        $var2=0;
        $var3=0;
        if (($fotomecanica->acabado_impresion_4!='') && ($fotomecanica->acabado_impresion_4!=17))	
            $var1=1;
	if (($fotomecanica->acabado_impresion_5!='')  && ($fotomecanica->acabado_impresion_5!=17))      
            $var2=1;
	if (($fotomecanica->acabado_impresion_6!='')  && ($fotomecanica->acabado_impresion_6!=17))      
            $var3=1;
        $totalTrabajosExternos=$var1+$var2+$var3; 
        if($totalTrabajosExternos>0){
            $totalTrabajosExternos;
        }else{
            $totalTrabajosExternos="No";
        }
        //fin de rutina para acabados internos agregados por ehndz
        
		
       // echo $ing->materialidad_datos_tecnicos;exit;
        if($ing->materialidad_datos_tecnicos=="Onda a la Vista")
        {
             $canTotal2=number_format($datoscantidad1/1000,0,"","");
          // echo $canTotal2;exit;
            if($canTotal2>=1)
            {
                $micromicro=30*$canTotal2;
            }else
            {
                $micromicro=0;
            }
        }else
        {
            $micromicro=0;
        }
         if($ing->materialidad_datos_tecnicos=="Cartulina-cartulina")
        {
             $canTotal2=number_format($datoscantidad1/1000,0,"","");
             $cartulina=30;
        }else
        {
             $cartulina=0;
        }
        if($ing->materialidad_datos_tecnicos=="Sólo Cartulina")
        {
           $emplacado=0;
           $emplacado_fijo=0;
           $emplacado_merma = $mermaEmplacadoArray->precio;
        }else
        {
             $mermaEmplacadoArray=$this->variables_cotizador_model->getVariablesCotizadorPorId(35);
             $emplacado= $cantidad_1; /*Valor x dividido por Unidad por pliego*/

                $emplacado= $emplacado / 1000; /*Resultado de emplacado dividido por 1000*/                                       

                $emplacado= ($emplacado * 1000)+ 0.5; /*Emplacado multiplicado por 1000 y el resultado de la multiplicacion se suman 0.5*/                                  

                $emplacado= $emplacado/ 1000; /*emplacado dividido por 1000*/                   

                $emplacado = $emplacado +0.499; /*emplacado mas 0.499: Resultado emplacado es en decimales*/                                                               

                $Entero = number_format($emplacado,0,'',''); /* Guardar entero del emplacado*/                         

                $emplacado_fijo = 50; /*Multiplicar entero del emplacado por 15*/
                $emplacado = $Entero * $mermaEmplacadoArray->precio; /*Multiplicar entero del emplacado por 15*/
                $emplacado_merma = $mermaEmplacadoArray->precio;
         
        }
        
        //emplacado 2
        if($ing->materialidad_datos_tecnicos=="Sólo Cartulina")
        {
           $emplacado2=0;
           $emplacado_fijo2 = 0;
           $emplacado_merma = $mermaEmplacadoArray->precio;
        }else
        {
             $mermaEmplacadoArray=$this->variables_cotizador_model->getVariablesCotizadorPorId(35);
             $emplacado2= $cantidad_2; /*Valor x dividido por Unidad por pliego*/

                $emplacado2= $emplacado2 / 1000; /*Resultado de emplacado dividido por 1000*/                                       

                $emplacado2= ($emplacado2 * 1000)+ 0.5; /*Emplacado multiplicado por 1000 y el resultado de la multiplicacion se suman 0.5*/                                  

            $emplacado2= $emplacado2/ 1000; /*emplacado dividido por 1000*/                   

                $emplacado2 = $emplacado2 +0.499; /*emplacado mas 0.499: Resultado emplacado es en decimales*/                                                               

                $Entero = number_format($emplacado2,0,'',''); /* Guardar entero del emplacado*/                         
                
                $emplacado_fijo2 = 50;
                $emplacado2 = $Entero * $mermaEmplacadoArray->precio; /*Multiplicar entero del emplacado por 15*/
                $emplacado_merma = $mermaEmplacadoArray->precio;
           
        }
        
        if($fotomecanica->estan_los_moldes=="NO LLEVA" || $fotomecanica->estan_los_moldes=="CLIENTE LO APORTA" || $fotomecanica->materialidad_datos_tecnicos == 'Sólo Cartulina')
        {
            $troquelado=0;
            $troquelado_fijo=0;
            $troquelado_merma=$mermaTroqueladoArray->precio;
        }else
        {

            $mermaTroqueladoArray=$this->variables_cotizador_model->getVariablesCotizadorPorId(36);
            if (($datoscantidad1>0) && ($ing->unidades_por_pliego>0))
                $troquelado=$datoscantidad1/$ing->unidades_por_pliego;
            else 
                $troquelado=0;
                $troquelado= $troquelado / 1000; /*Resultado de emplacado dividido por 1000*/                                                              
                $troquelado= ($troquelado * 1000)+ 0.5; /*Emplacado multiplicado por 1000 y el resultado de la multiplicacion se suman 0.5*/                          
                $troquelado= $troquelado/ 1000; /*emplacado dividido por 1000*/                      
                $troquelado = $troquelado +0.499; /*emplacado mas 0.499: Resultado emplacado es en decimales*/                                                               
                $EnteroTroquelado = number_format($troquelado,0,'',''); /* Guardar entero del emplacado*/                          
                $troquelado = $EnteroTroquelado * $mermaTroqueladoArray->precio; /*Multiplicar entero del emplacado por 15*/
                $troquelado_fijo = 40;
                $troquelado_merma=$mermaTroqueladoArray->precio;
        }
        //emplacado 3
        if($ing->materialidad_datos_tecnicos=="Sólo Cartulina")
        {
           $emplacado3=0;
           $emplacado_fijo3=0;
           $emplacado_merma = $mermaEmplacadoArray->precio;
        }else
        {
             $mermaEmplacadoArray=$this->variables_cotizador_model->getVariablesCotizadorPorId(35);
             $emplacado3= $cantidad_3; /*Valor x dividido por Unidad por pliego*/

                $emplacado3= $emplacado3 / 1000; /*Resultado de emplacado dividido por 1000*/                                       

                $emplacado3= ($emplacado3 * 1000)+ 0.5; /*Emplacado multiplicado por 1000 y el resultado de la multiplicacion se suman 0.5*/                                  

            $emplacado3= $emplacado3/ 1000; /*emplacado dividido por 1000*/                   

                $emplacado3 = $emplacado3 +0.499; /*emplacado mas 0.499: Resultado emplacado es en decimales*/                                                               

                $Entero = number_format($emplacado3,0,'',''); /* Guardar entero del emplacado*/                         

                $emplacado_fijo3 = 50; /*Multiplicar entero del emplacado por 15*/
                $emplacado3 = $Entero * $mermaEmplacadoArray->precio; /*Multiplicar entero del emplacado por 15*/
                $emplacado_merma = $mermaEmplacadoArray->precio;
           
        }
        //emplacado 4
        if($ing->materialidad_datos_tecnicos=="Sólo Cartulina")
        {
           $emplacado_fijo4=0;
           $emplacado4=0;
           $emplacado_merma = $mermaEmplacadoArray->precio;
        }else
        {
             $mermaEmplacadoArray=$this->variables_cotizador_model->getVariablesCotizadorPorId(35);
             $emplacado4= $cantidad_4; /*Valor x dividido por Unidad por pliego*/

                $emplacado4= $emplacado4 / 1000; /*Resultado de emplacado dividido por 1000*/                                       

                $emplacado4= ($emplacado4 * 1000)+ 0.5; /*Emplacado multiplicado por 1000 y el resultado de la multiplicacion se suman 0.5*/                                  

            $emplacado4= $emplacado4/ 1000; /*emplacado dividido por 1000*/                   

                $emplacado4 = $emplacado4 +0.499; /*emplacado mas 0.499: Resultado emplacado es en decimales*/                                                               

                $Entero = number_format($emplacado4,0,'',''); /* Guardar entero del emplacado*/                         

                $emplacado_fijo4 = 50; /*Multiplicar entero del emplacado por 15*/
                $emplacado4 = $Entero * $mermaEmplacadoArray->precio; /*Multiplicar entero del emplacado por 15*/
                $emplacado_merma = $mermaEmplacadoArray->precio;
           
        }
        
        if($fotomecanica->estan_los_moldes=="NO LLEVA" or $fotomecanica->estan_los_moldes=="CLIENTE LO APORTA" or $fotomecanica->materialidad_datos_tecnicos == 'Sólo Cartulina')
        {
            $troquelado=0;
            $troquelado_fijo=0;
            $troquelado_merma=$mermaTroqueladoArray->precio;
        }else
        {

            $mermaTroqueladoArray=$this->variables_cotizador_model->getVariablesCotizadorPorId(36);
            if (($datoscantidad1>0) and ($ing->unidades_por_pliego>0))
                $troquelado=$datoscantidad1/$ing->unidades_por_pliego;
            else 
                $troquelado=0;
                $troquelado= $troquelado / 1000; /*Resultado de emplacado dividido por 1000*/                                                              
                $troquelado= ($troquelado * 1000)+ 0.5; /*Emplacado multiplicado por 1000 y el resultado de la multiplicacion se suman 0.5*/                          
                $troquelado= $troquelado/ 1000; /*emplacado dividido por 1000*/                      
                $troquelado = $troquelado +0.499; /*emplacado mas 0.499: Resultado emplacado es en decimales*/                                                               
                $EnteroTroquelado = number_format($troquelado,0,'',''); /* Guardar entero del emplacado*/                          
                $troquelado_fijo=40; /*Multiplicar entero del emplacado por 15*/
                $troquelado = $EnteroTroquelado * $mermaTroqueladoArray->precio; /*Multiplicar entero del emplacado por 15*/
                $troquelado_merma=$mermaTroqueladoArray->precio;
        }
        
        //troquelado dos
        if($fotomecanica->estan_los_moldes=="NO LLEVA" || $fotomecanica->estan_los_moldes=="CLIENTE LO APORTA" || $fotomecanica->materialidad_datos_tecnicos == 'Sólo Cartulina')
        {
            $troquelado=0;
            $troquelado_fijo=0;
            $troquelado_merma=$mermaTroqueladoArray->precio;
        }else
        {
            $mermaTroqueladoArray=$this->variables_cotizador_model->getVariablesCotizadorPorId(36);
            if (($datoscantidad2>0) and ($ing->unidades_por_pliego>0))
                $troquelado2=$datoscantidad2/$ing->unidades_por_pliego;
            else
                $troquelado2=0;
                $troquelado2=$datoscantidad2/$ing->unidades_por_pliego;
                $troquelado2= $troquelado2 / 1000; /*Resultado de emplacado dividido por 1000*/                                                              
                $troquelado2= ($troquelado2 * 1000)+ 0.5; /*Emplacado multiplicado por 1000 y el resultado de la multiplicacion se suman 0.5*/                          
                $troquelado2= $troquelado2/ 1000; /*emplacado dividido por 1000*/                      
                $troquelado2 = $troquelado2 +0.499; /*emplacado mas 0.499: Resultado emplacado es en decimales*/                                                               
                $EnteroTroquelado2 = number_format($troquelado2,0,'',''); /* Guardar entero del emplacado*/                          
                $troquelado_fijo2 = 40; /*Multiplicar entero del emplacado por 15*/
                $troquelado2 = $EnteroTroquelado2 * $mermaTroqueladoArray->precio; /*Multiplicar entero del emplacado por 15*/
                $troquelado_merma=$mermaTroqueladoArray->precio;
        
            }
        //troquelado tres
        if($fotomecanica->estan_los_moldes=="NO LLEVA" || $fotomecanica->estan_los_moldes=="CLIENTE LO APORTA" || $fotomecanica->materialidad_datos_tecnicos == 'Sólo Cartulina')
        {
            $troquelado3=0;
            $troquelado_fijo3=0;
            $troquelado_merma=$mermaTroqueladoArray->precio;
        }else
        {

            $mermaTroqueladoArray=$this->variables_cotizador_model->getVariablesCotizadorPorId(36);
            if (($datoscantidad3>0) and ($ing->unidades_por_pliego>0))
                $troquelado3=$datoscantidad3/$ing->unidades_por_pliego;
            else
                $troquelado3=0;
                $troquelado3= $troquelado3 / 1000; /*Resultado de emplacado dividido por 1000*/                                                              
                $troquelado3= ($troquelado3 * 1000)+ 0.5; /*Emplacado multiplicado por 1000 y el resultado de la multiplicacion se suman 0.5*/                          
                $troquelado3= $troquelado3/ 1000; /*emplacado dividido por 1000*/                      
                $troquelado3 = $troquelado3 +0.499; /*emplacado mas 0.499: Resultado emplacado es en decimales*/                                                               
                $EnteroTroquelado3 = number_format($troquelado3,0,'',''); /* Guardar entero del emplacado*/                          
                $troquelado_fijo3 = 40; /*Multiplicar entero del emplacado por 15*/
                $troquelado3 = $EnteroTroquelado3 * $mermaTroqueladoArray->precio; /*Multiplicar entero del emplacado por 15*/
                $troquelado_merma=$mermaTroqueladoArray->precio;
                
        }
        //troquelado cuatro
        if($fotomecanica->estan_los_moldes=="NO LLEVA" || $fotomecanica->estan_los_moldes=="CLIENTE LO APORTA" || $fotomecanica->materialidad_datos_tecnicos == 'Sólo Cartulina')
        { 
            $troquelado4=0;
            $troquelado_fijo4=0;
            $troquelado_merma=$mermaTroqueladoArray->precio;
        }else
        {

            $mermaTroqueladoArray=$this->variables_cotizador_model->getVariablesCotizadorPorId(36);
            if (($datoscantidad4>0) && ($ing->unidades_por_pliego>0))
                $troquelado4=$datoscantidad4/$ing->unidades_por_pliego;
            else 
                $troquelado4=0;
                $troquelado4= $troquelado4 / 1000; /*Resultado de emplacado dividido por 1000*/                                                              
                $troquelado4= ($troquelado4 * 1000)+ 0.5; /*Emplacado multiplicado por 1000 y el resultado de la multiplicacion se suman 0.5*/                          
                $troquelado4= $troquelado4/ 1000; /*emplacado dividido por 1000*/                      
                $troquelado4 = $troquelado4 +0.499; /*emplacado mas 0.499: Resultado emplacado es en decimales*/                                                               
                $EnteroTroquelado4 = number_format($troquelado4,0,'',''); /* Guardar entero del emplacado*/                          
                $troquelado_fijo4 = 40; /*Multiplicar entero del emplacado por 15*/
                $troquelado4 = $EnteroTroquelado4 * $mermaTroqueladoArray->precio; /*Multiplicar entero del emplacado por 15*/
                $troquelado_merma=$mermaTroqueladoArray->precio;
        }
        if($totalTrabajosInternos=='No lleva'){$totalTrabajosInternos=0;}else{$totalTrabajosInternos=$totalTrabajosInternos*50;}
        if($totalTrabajosExternos=='No lleva'){$totalTrabajosExternos=0;}else{$totalTrabajosExternos=$totalTrabajosExternos*50;}
        
        $sum=$color1+$color2+$can1+$bar1+$bar2+$externo+$micromicro+$cartulina+$emplacado+$troquelado+$emplacado_fijo+$troquelado_fijo;
        $sum2=$color1+$color2+$can3+$bar3+$bar4+$externo+$micromicro+$cartulina+$emplacado2+$troquelado2+$emplacado_fijo2+$troquelado_fijo2;
        $sum3=$color1+$color2+$can5+$bar5+$bar6+$externo+$micromicro+$cartulina+$emplacado3+$troquelado3+$emplacado_fijo3+$troquelado_fijo3;
        $sum4=$color1+$color2+$can7+$bar7+$bar8+$externo+$micromicro+$cartulina+$emplacado4+$troquelado4+$emplacado_fijo4+$troquelado_fijo4;
//        echo "<h1>a".$color1."</h1>";
//        echo "<h1>b".$color2."</h1>";
//        echo "<h1>d".$can7."</h1>";
//        echo "<h1>e".$bar7."</h1>";
//        echo "<h1>f".$bar8."</h1>";
//        echo "<h1>g".$externo."</h1>";
//        echo "<h1>h".$micromicro."</h1>";
//        echo "<h1>i".$cartulina."</h1>";
//        echo "<h1>j".$emplacado4."</h1>";
//        echo "<h1>k".$troquelado4."</h1>";
//        echo "<h1>l".$emplacado_fijo4."</h1>";
//        echo "<h1>m".$troquelado_fijo4."</h1>";
 //       echo $fotomecanica->estan_los_moldes;//exit();
        //echo $barniz2;exit();
        if($fotomecanica->fot_lleva_barniz=='Laca UV'){
        $costosporlacado=(35000+(52*($datoscantidad1/$ing->unidades_por_pliego)));
        $costosporlacado2=(35000+(52*($datoscantidad2/$ing->unidades_por_pliego)));
        $costosporlacado3=(35000+(52*($datoscantidad3/$ing->unidades_por_pliego)));
        $costosporlacado4=(35000+(52*($datoscantidad4/$ing->unidades_por_pliego)));
        }else{
        $costosporlacado=0;
        $costosporlacado2=0;
        $costosporlacado3=0;
        $costosporlacado4=0;
        }
        
        //echo sizeof($hoja);exit();
//        if(sizeof($hoja)>=1)
//        {
//            $arreglo55=array
//                (
//                    "total_merma"=>$sum,
//                );
//                $this->db->where('id', $hoja->id);
//                $this->db->update("hoja_de_costos_datos",$arreglo55);
//        }
        
        if(sizeof($hoja)>=1)
        {
            $arreglofecha=array
                (
                    "fecha_act"=>date("Y-m-d"),
                );
                $this->db->where('id', $hoja->id);
                $this->db->update("hoja_de_costos_datos",$arreglofecha);
        }
       /**
        * fin validaciones mermas
        * */ 
       if (($datoscantidad1>0) && ($ing->unidades_por_pliego>0))
       {    
       $tiraje=$datoscantidad1/$ing->unidades_por_pliego;
       }else{ 
       $tiraje=0;
       }
       
       if($tiraje<4000)
       {
         $tiraje2="Menos de 4.000";
         $factor_rangos=$this->variables_cotizador_model->getVariablesCotizadorPorId(17);
         $factor_rango=$factor_rangos->precio;
       }elseif($tiraje>4000 && $tiraje<10000)
       {
         $tiraje2="4.001 a 10.000";
         $factor_rangos=$this->variables_cotizador_model->getVariablesCotizadorPorId(18);
         $factor_rango=$factor_rangos->precio;
       }else
       {
        $tiraje2="Más de 10.000";
        $factor_rangos=$this->variables_cotizador_model->getVariablesCotizadorPorId(19);
        $factor_rango=$factor_rangos->precio;
       }
       
       
       if (($datoscantidad2>0) && ($ing->unidades_por_pliego>0))
       {    
       $tiraje_dos=$datoscantidad2/$ing->unidades_por_pliego;
       }else{ 
       $tiraje_dos=0;
       }
       
       if($tiraje_dos<4000)
       {
         $tiraje3="Menos de 4.000";
         $factor_rangos2=$this->variables_cotizador_model->getVariablesCotizadorPorId(17);
         $factor_rango2=$factor_rangos2->precio;
       }elseif($tiraje_dos>4000 && $tiraje_dos<10000)
       {
         $tiraje3="4.001 a 10.000";
         $factor_rangos2=$this->variables_cotizador_model->getVariablesCotizadorPorId(18);
         $factor_rango2=$factor_rangos2->precio;
       }else
       {
        $tiraje3="Más de 10.000";
        $factor_rangos2=$this->variables_cotizador_model->getVariablesCotizadorPorId(19);
        $factor_rango2=$factor_rangos2->precio;
       }
       
       if (($datoscantidad3>0) && ($ing->unidades_por_pliego>0))
       {    
       $tiraje_tres=$datoscantidad3/$ing->unidades_por_pliego;
       }else{ 
       $tiraje_tres=0;
       }
       
       if($tiraje_tres<4000)
       {
         $tiraje4="Menos de 4.000";
         $factor_rangos3=$this->variables_cotizador_model->getVariablesCotizadorPorId(17);
         $factor_rango3=$factor_rangos3->precio;
       }elseif($tiraje_tres>4000 && $tiraje_tres<10000)
       {
         $tiraje4="4.001 a 10.000";
         $factor_rangos3=$this->variables_cotizador_model->getVariablesCotizadorPorId(18);
         $factor_rango3=$factor_rangos3->precio;
       }else
       {
        $tiraje4="Más de 10.000";
        $factor_rangos3=$this->variables_cotizador_model->getVariablesCotizadorPorId(19);
        $factor_rango3=$factor_rangos3->precio;
       }
      
       if (($datoscantidad4>0) && ($ing->unidades_por_pliego>0))
       {    
       $tiraje_cuatro=$datoscantidad4/$ing->unidades_por_pliego;
       }else{ 
       $tiraje_cuatro=0;
       }
       
       if($tiraje_cuatro<4000)
       {
         $tiraje5="Menos de 4.000";
         $factor_rangos4=$this->variables_cotizador_model->getVariablesCotizadorPorId(17);
         $factor_rango4=$factor_rangos4->precio;
       }elseif($tiraje_cuatro>4000 && $tiraje_cuatro<10000)
       {
         $tiraje5="4.001 a 10.000";
         $factor_rangos4=$this->variables_cotizador_model->getVariablesCotizadorPorId(18);
         $factor_rango4=$factor_rangos4->precio;
       }else
       {
        $tiraje4="Más de 10.000";
        $factor_rangos4=$this->variables_cotizador_model->getVariablesCotizadorPorId(19);
        $factor_rango4=$factor_rangos4->precio;
       }
       
       
     //  echo "<h1>FACTOR" . $factor_rango4 . "</h1>";
       

        if($fotomecanica->fot_lleva_barniz=='Nada' || $fotomecanica->fot_lleva_barniz=='')
        {
            $barniz3=0;
        }else
        {
            $barniz3=1;
        }
        //echo $barniz3;exit;
        if($maquina=="Máquina Roland 800")
        {
            $recargoPlanchaArray=$this->variables_cotizador_model->getVariablesCotizadorPorId(26);
            $recargoPlancha=$recargoPlanchaArray->precio;
            $valorParaPlanchaMetal=1;
        }else
        {
            $recargoPlancha=0;
            $valorParaPlanchaMetal=0;
        }
        //echo $valorParaPlanchaMetal;exit;
        $arte=$this->variables_cotizador_model->getVariablesCotizadorPorId(1);
        $cantidadArte=$fotomecanica->colores*$arte->precio;

        $plancha_metal=$this->variables_cotizador_model->getVariablesCotizadorPorId(2);

        $cantidadPlantaMetal=(($fotomecanica->colores*$plancha_metal->precio)+($plancha_metal->precio*$barniz3))+(($fotomecanica->colores*$plancha_metal->precio)+($plancha_metal->precio*$barniz3))*$recargoPlancha/100*$valorParaPlanchaMetal;
        

        $copiado=$this->variables_cotizador_model->getVariablesCotizadorPorId(3);
        $cantidadCopiapo=(($fotomecanica->colores*$copiado->precio)+($copiado->precio*$barniz3))+(($fotomecanica->colores*$copiado->precio)+($copiado->precio*$barniz3))*$recargoPlancha/100*$valorParaPlanchaMetal;
        
        $peliculasPreImpresion=$this->variables_cotizador_model->getVariablesCotizadorPorId(4);
        $peliculasVariable=$this->variables_cotizador_model->getVariablesCotizadorPorId(28);
        $cantidadPeliculas=$ing->tamano_a_imprimir_1*$ing->tamano_a_imprimir_2*$fotomecanica->colores*$peliculasVariable->precio;
        $montajePreImpresion=$this->variables_cotizador_model->getVariablesCotizadorPorId(5);
        $cantidadMontaje=$montajePreImpresion->precio*$fotomecanica->colores;
        
        if($datos->impresion_hacer_cromalin=='SI')
        {
           $cromalinVariable=$this->variables_cotizador_model->getVariablesCotizadorPorId(22);
           $cromalin=$cromalinVariable->precio;
           $coloresCromalin=1;
        }else
        {
           $cromalin=0;
           $coloresCromalin=0;
        }
                             
									
        if($fotomecanica->condicion_del_producto == 'Nuevo') //nuevo 
        {
            $coloresArte= $barniz3 + $fotomecanica->colores;
            $coloresPlanchaMetal= $fotomecanica->colores+$barniz3;
            $coloresCopiado=$fotomecanica->colores+$barniz3;
            $coloresPeliculas=$barniz3 +$fotomecanica->colores;
            $coloresMontaje=$barniz3 +$fotomecanica->colores;
        }
					
        if($fotomecanica->condicion_del_producto == 'Repetición Sin Cambios') //
        {
            $coloresArte= 0;
            $coloresPlanchaMetal= $fotomecanica->colores+$barniz3;
            $coloresCopiado=$fotomecanica->colores;
            $coloresPeliculas=0;
            $coloresMontaje=0;
            $cantidadArte = 0;
            $cantidadPeliculas = 0;
            $cantidadMontaje = 0;
            $cromalin= 0;
        }					
        if($fotomecanica->condicion_del_producto == 'Repetición Con Cambios') //
        {
            //ver cambio de peliculas con fotomecanicas y validar
            $coloresArte= 0;
            $coloresPlanchaMetal= $fotomecanica->colores+$barniz3;
            $coloresCopiado=$fotomecanica->colores;
            //$coloresPeliculas=0;
            //$coloresMontaje=0;
            $cantidadArte = 0;
            if($fotomecanica->tiene_color_modificado=='SI'){
            $coloresMontaje=$fotomecanica->numero_color_modificado;
            $coloresPeliculas=$fotomecanica->numero_color_modificado;
            $cantidadPeliculas=$ing->tamano_a_imprimir_1*$ing->tamano_a_imprimir_2*$fotomecanica->numero_color_modificado*$peliculasVariable->precio;
            $cantidadMontaje=$montajePreImpresion->precio*$fotomecanica->numero_color_modificado;
            //echo "<h1>" . $ing->tamano_a_imprimir_1.' '.$ing->tamano_a_imprimir_2.' '.$fotomecanica->numero_color_modificado.' '.$peliculasVariable->precio . "</h1>";
            }else{  
            $coloresMontaje=0;
            $coloresPeliculas=0;
            $cantidadPeliculas = 0;
            $cantidadMontaje = 0;
            }
        }
        if($fotomecanica->condicion_del_producto == 'Producto Genérico') //
        {
            $coloresArte= 0;
            $coloresPlanchaMetal= 0;
            $coloresCopiado=0;
            $coloresPeliculas=0;
            $coloresMontaje=0;
        }
	
                             $costoVenta=$this->variables_cotizador_model->getVariablesCotizadorPorId(15);
                             $costoAdministracion=$this->variables_cotizador_model->getVariablesCotizadorPorId(16);
                             if ($fotomecanica->condicion_del_producto=='Repetición Sin Cambios')
                                $totalPreImpresion=$cantidadArte+$cantidadPlantaMetal+$cantidadCopiapo+$cantidadPeliculas;
                             else
                                $totalPreImpresion=$cantidadArte+$cantidadPlantaMetal+$cantidadCopiapo+$cantidadPeliculas+$cantidadMontaje+$cromalin;
                                                           
                             ?>
<!DOCTYPE html>
<html>
    <head>
        <title>..:: Control de Gestión - Empresas Grau ::..</title>
	<meta charset="utf-8" />
      	<link rel="shortcut icon" href="<?php echo base_url()?>public/backend/img/favicon.ico" />
        <meta name="language" content="Spanish" />
        <meta name="copyright" content="www.cesarcancino.com" />
        <meta name="designer" content="César Cancino Zapata" />
        <meta name="author" content="www.cesarcancino.com" />      
        <link type="text/css" rel="stylesheet" href="<?php echo base_url()?>bootstrap/bootstrap.css" />
        <link type="text/css" rel="stylesheet" href="<?php echo base_url()?>bootstrap/estilos.css" />
        <link type="text/css" rel="stylesheet" href="<?php echo base_url()?>public/backend/fancybox/jquery.fancybox.css" />
        <link type="text/css" rel="stylesheet" href="<?php echo base_url()?>public/frontend/css/prism.css" />
        <link type="text/css" rel="stylesheet" href="<?php echo base_url()?>public/frontend/css/chosen.css" />
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script type="text/javascript" src="<?php echo base_url()?>public/backend/fancybox/jquery.fancybox.js"></script>
        <script type="text/javascript" src="<?php echo base_url();?>public/frontend/js/funciones.js"></script>
        <script type="text/javascript">var ruta='<?php echo base_url();?>';</script>
        <script type="text/javascript">
        $(document).ready(function() {
        	$(".fancybox").fancybox({
        		openEffect	: 'none',
        		closeEffect	: 'none'
        	});
            
        });
        </script>
        <style>
/*            body {
  background: rgb(204,204,204); 
}
.container{
    width: 21cm;
  height: 29.7cm; 
}*/
page {
  background: white;
  display: block;
  margin: 0 auto;
  margin-bottom: 0.5cm;
  box-shadow: 0 0 0.5cm rgba(0,0,0,0.5);
}
page[size="A4"] {  
  width: 21cm;
  height: 29.7cm; 
  
}
page[size="A4"][layout="portrait"] {
  width: 29.7cm;
  height: 21cm;  
}
@media print {
  body, page {
    margin: 0;
    box-shadow: 0;
  }
}

.ir-arriba {
	/*display:none;*/
	padding:20px;
	background:#024959;
	font-size:20px;
	color:#fff;
	cursor:pointer;
	position: fixed;
	bottom:20px;
	right:20px;
}
.ir-arriba2 {
	/*display:none;*/
	padding:20px;
	background:#024959;
	font-size:20px;
	color:#fff;
	cursor:pointer;
	position: fixed;
	top:20px;
	right:20px;
}

#grupos{
    width: 800px;
    float: right;
    margin-top:305px;
}
#grupos table{
    font-size: 11px;
    width: 580px;
}

#grupos table tr td{
    padding: 3px;
}

#grupos .title{
    text-align:center; color:white; font-weight: bold; background-color: #004c68;
}
        </style>
    </head>
    <body>
        <?php 
        $existegrupo=$this->grupos_model->getExisteGrupo($id);
        $numero_en_grupo = 0;
        if(sizeof($existegrupo)>0){
            if($existegrupo->idc_01!="" || $existegrupo->idc_01!=null){
                $numero_en_grupo = $numero_en_grupo +1;
                $cotgrupo1=$this->cotizaciones_model->getHojaDeCostosPorIdCotizacionMatriz($existegrupo->idc_01);
                if(sizeof($cotgrupo1)>0){
                    $detallecotgrupo1 = "<tr>";
                    $detallecotgrupo1.= "<td align='center'>$cotgrupo1->id_cotizacion</td>";
                    $detallecotgrupo1.= "<td>$cotgrupo1->producto | C1:$cotgrupo1->cantidad_1,P1:$cotgrupo1->valor_empresa | C2:$cotgrupo1->cantidad_2,P2:$cotgrupo1->valor_empresa_2 | C3:$cotgrupo1->cantidad_3,P3:$cotgrupo1->valor_empresa_3 | C4:$cotgrupo1->cantidad_4,P4:$cotgrupo1->valor_empresa_4</td>";
                    $detallecotgrupo1.= "<td>$cotgrupo1->fecha</td>";
                    $detallecotgrupo1.= "<tr>";
                }else{
                    $detallecotgrupo1.= "<tr><td align='center'>$existegrupo->idc_01 </td><td colspan='2' align='center' align='center'>La cotizacion Nro: $existegrupo->idc_01 aun no tiene Hoja de Costos</td><tr>";
                }
            }
            
            if($existegrupo->idc_02!="" || $existegrupo->idc_02!=null){
                $numero_en_grupo = $numero_en_grupo +1;
                $cotgrupo2=$this->cotizaciones_model->getHojaDeCostosPorIdCotizacionMatriz($existegrupo->idc_02);
                if(sizeof($cotgrupo2)>0){
                    $detallecotgrupo2 = "<tr>";
                    $detallecotgrupo2.= "<td align='center'>$cotgrupo2->id_cotizacion</td>";
                    $detallecotgrupo2.= "<td>$cotgrupo2->producto | C1:$cotgrupo2->cantidad_1,P1:$cotgrupo2->valor_empresa | C2:$cotgrupo2->cantidad_2,P2:$cotgrupo2->valor_empresa_2 | C3:$cotgrupo2->cantidad_3,P3:$cotgrupo2->valor_empresa_3 | C4:$cotgrupo2->cantidad_4,P4:$cotgrupo2->valor_empresa_4</td>";
                    $detallecotgrupo2.= "<td>$cotgrupo2->fecha</td>";
                    $detallecotgrupo2.= "<tr>";
                }else{
                    $detallecotgrupo2.= "<tr><td align='center'>$existegrupo->idc_02 </td><td colspan='2' align='center'>La cotizacion Nro: $existegrupo->idc_02 aun no tiene Hoja de Costos</td><tr>";
                }
            }
            if($existegrupo->idc_03!="" || $existegrupo->idc_03!=null){
                $numero_en_grupo = $numero_en_grupo +1;
                $cotgrupo3=$this->cotizaciones_model->getHojaDeCostosPorIdCotizacionMatriz($existegrupo->idc_03);
                if(sizeof($cotgrupo3)>0){
                    $detallecotgrupo3 = "<tr>";
                    $detallecotgrupo3.= "<td align='center'>$cotgrupo3->id_cotizacion</td>";
                    $detallecotgrupo3.= "<td>$cotgrupo3->producto | C1:$cotgrupo3->cantidad_1,P1:$cotgrupo3->valor_empresa | C2:$cotgrupo3->cantidad_2,P2:$cotgrupo3->valor_empresa_2 | C3:$cotgrupo3->cantidad_3,P3:$cotgrupo3->valor_empresa_3 | C4:$cotgrupo3->cantidad_4,P4:$cotgrupo3->valor_empresa_4</td>";
                    $detallecotgrupo3.= "<td>$cotgrupo3->fecha</td>";
                    $detallecotgrupo3.= "<tr>";
                }else{
                    $detallecotgrupo3.= "<tr><td align='center'>$existegrupo->idc_03 </td><td colspan='2' align='center'>La cotizacion Nro: $existegrupo->idc_03 aun no tiene Hoja de Costos</td><tr>";
                }
            }
            if($existegrupo->idc_04!="" || $existegrupo->idc_04!=null){
                $numero_en_grupo = $numero_en_grupo +1;
                $cotgrupo4=$this->cotizaciones_model->getHojaDeCostosPorIdCotizacionMatriz($existegrupo->idc_04);
                if(sizeof($cotgrupo4)>0){
                    $detallecotgrupo4 = "<tr>";
                    $detallecotgrupo4.= "<td align='center'>$cotgrupo4->id_cotizacion</td>";
                    $detallecotgrupo4.= "<td>$cotgrupo4->producto | C1:$cotgrupo4->cantidad_1,P1:$cotgrupo4->valor_empresa | C2:$cotgrupo4->cantidad_2,P2:$cotgrupo4->valor_empresa_2 | C3:$cotgrupo4->cantidad_3,P3:$cotgrupo4->valor_empresa_3 | C4:$cotgrupo4->cantidad_4,P4:$cotgrupo4->valor_empresa_4</td>";
                    $detallecotgrupo4.= "<td>$cotgrupo4->fecha</td>";
                    $detallecotgrupo4.= "<tr>";
                }else{
                    $detallecotgrupo4.= "<tr><td align='center'>$existegrupo->idc_04 </td><td colspan='2' align='center'>La cotizacion Nro: $existegrupo->idc_04 aun no tiene Hoja de Costos</td><tr>";
                }
            }
            if($existegrupo->idc_05!="" || $existegrupo->idc_05!=null){
                $numero_en_grupo = $numero_en_grupo +1;
                $cotgrupo5=$this->cotizaciones_model->getHojaDeCostosPorIdCotizacionMatriz($existegrupo->idc_05);
                if(sizeof($cotgrupo5)>0){
                    $detallecotgrupo5 = "<tr>";
                    $detallecotgrupo5.= "<td align='center'>$cotgrupo5->id_cotizacion</td>";
                    $detallecotgrupo5.= "<td>$cotgrupo5->producto | C1:$cotgrupo5->cantidad_1,P1:$cotgrupo5->valor_empresa | C2:$cotgrupo5->cantidad_2,P2:$cotgrupo5->valor_empresa_2 | C3:$cotgrupo5->cantidad_3,P3:$cotgrupo5->valor_empresa_3 | C4:$cotgrupo5->cantidad_4,P4:$cotgrupo5->valor_empresa_4</td>";
                    $detallecotgrupo5.= "<td>$cotgrupo5->fecha</td>";
                    $detallecotgrupo5.= "<tr>";
                }else{
                    $detallecotgrupo5.= "<tr><td align='center'>$existegrupo->idc_05 </td><td colspan='2' align='center'>La cotizacion Nro: $existegrupo->idc_05 aun no tiene Hoja de Costos</td><tr>";
                }
            }
            if($existegrupo->idc_06!="" || $existegrupo->idc_06!=null){
                $numero_en_grupo = $numero_en_grupo +1;
                $cotgrupo6=$this->cotizaciones_model->getHojaDeCostosPorIdCotizacionMatriz($existegrupo->idc_06);
                if(sizeof($cotgrupo6)>0){
                    $detallecotgrupo6 = "<tr>";
                    $detallecotgrupo6.= "<td align='center'>$cotgrupo6->id_cotizacion</td>";
                    $detallecotgrupo6.= "<td>$cotgrupo6->producto | C1:$cotgrupo6->cantidad_1,P1:$cotgrupo6->valor_empresa | C2:$cotgrupo6->cantidad_2,P2:$cotgrupo6->valor_empresa_2 | C3:$cotgrupo6->cantidad_3,P3:$cotgrupo6->valor_empresa_3 | C4:$cotgrupo6->cantidad_4,P4:$cotgrupo6->valor_empresa_4</td>";
                    $detallecotgrupo6.= "<td>$cotgrupo6->fecha</td>";
                    $detallecotgrupo6.= "<tr>";
                }else{
                    $detallecotgrupo6.= "<tr><td align='center'>$existegrupo->idc_06 </td><td colspan='2' align='center'>La cotizacion Nro: $existegrupo->idc_06 aun no tiene Hoja de Costos</td><tr>";
                }
            }
            if($existegrupo->idc_07!="" || $existegrupo->idc_07!=null){
                $numero_en_grupo = $numero_en_grupo +1;
                $cotgrupo7=$this->cotizaciones_model->getHojaDeCostosPorIdCotizacionMatriz($existegrupo->idc_07);
                if(sizeof($cotgrupo7)>0){
                    $detallecotgrupo7 = "<tr>";
                    $detallecotgrupo7.= "<td align='center'>$cotgrupo7->id_cotizacion</td>";
                    $detallecotgrupo7.= "<td>$cotgrupo7->producto | C1:$cotgrupo7->cantidad_1,P1:$cotgrupo7->valor_empresa | C2:$cotgrupo7->cantidad_2,P2:$cotgrupo7->valor_empresa_2 | C3:$cotgrupo7->cantidad_3,P3:$cotgrupo7->valor_empresa_3 | C4:$cotgrupo7->cantidad_4,P4:$cotgrupo7->valor_empresa_4</td>";
                    $detallecotgrupo7.= "<td>$cotgrupo7->fecha</td>";
                    $detallecotgrupo7.= "<tr>";
                }else{
                    $detallecotgrupo7.= "<tr><td align='center'>$existegrupo->idc_07 </td><td colspan='2' align='center'>La cotizacion Nro: $existegrupo->idc_07 aun no tiene Hoja de Costos</td><tr>";
                }
            }
            if($existegrupo->idc_08!="" || $existegrupo->idc_08!=null){
                $numero_en_grupo = $numero_en_grupo +1;
                $cotgrupo8=$this->cotizaciones_model->getHojaDeCostosPorIdCotizacionMatriz($existegrupo->idc_08);
                if(sizeof($cotgrupo8)>0){
                    $detallecotgrupo8 = "<tr>";
                    $detallecotgrupo8.= "<td align='center'>$cotgrupo8->id_cotizacion</td>";
                    $detallecotgrupo8.= "<td>$cotgrupo8->producto | C1:$cotgrupo8->cantidad_1,P1:$cotgrupo8->valor_empresa | C2:$cotgrupo8->cantidad_2,P2:$cotgrupo8->valor_empresa_2 | C3:$cotgrupo8->cantidad_3,P3:$cotgrupo8->valor_empresa_3 | C4:$cotgrupo8->cantidad_4,P4:$cotgrupo8->valor_empresa_4</td>";
                    $detallecotgrupo8.= "<td>$cotgrupo8->fecha</td>";
                    $detallecotgrupo8.= "<tr>";
                }else{
                    $detallecotgrupo8.= "<tr><td align='center'>$existegrupo->idc_08 </td><td colspan='2' align='center'>La cotizacion Nro: $existegrupo->idc_08 aun no tiene Hoja de Costos</td><tr>";
                }
            }
            if($existegrupo->idc_09!="" || $existegrupo->idc_09!=null){
                $numero_en_grupo = $numero_en_grupo +1;
                $cotgrupo9=$this->cotizaciones_model->getHojaDeCostosPorIdCotizacionMatriz($existegrupo->idc_09);
                if(sizeof($cotgrupo9)>0){
                    $detallecotgrupo9 = "<tr>";
                    $detallecotgrupo9.= "<td align='center'>$cotgrupo9->id_cotizacion</td>";
                    $detallecotgrupo9.= "<td>$cotgrupo9->producto | C1:$cotgrupo9->cantidad_1,P1:$cotgrupo9->valor_empresa | C2:$cotgrupo9->cantidad_2,P2:$cotgrupo9->valor_empresa_2 | C3:$cotgrupo9->cantidad_3,P3:$cotgrupo9->valor_empresa_3 | C4:$cotgrupo9->cantidad_4,P4:$cotgrupo9->valor_empresa_4</td>";
                    $detallecotgrupo9.= "<td>$cotgrupo9->fecha</td>";
                    $detallecotgrupo9.= "<tr>";
                }else{
                    $detallecotgrupo9.= "<tr><td align='center'>$existegrupo->idc_09 </td><td colspan='2' align='center'>La cotizacion Nro: $existegrupo->idc_09 aun no tiene Hoja de Costos</td><tr>";
                }
            }
            if($existegrupo->idc_10!="" || $existegrupo->idc_10!=null){
                $numero_en_grupo = $numero_en_grupo +1;
                $cotgrupo10=$this->cotizaciones_model->getHojaDeCostosPorIdCotizacionMatriz($existegrupo->idc_10);
                if(sizeof($cotgrupo10)>0){
                    $detallecotgrupo10 = "<tr>";
                    $detallecotgrupo10.= "<td align='center'>$cotgrupo10->id_cotizacion</td>";
                    $detallecotgrupo10.= "<td>$cotgrupo10->producto | C1:$cotgrupo10->cantidad_1,P1:$cotgrupo10->valor_empresa | C2:$cotgrupo10->cantidad_2,P2:$cotgrupo10->valor_empresa_2 | C3:$cotgrupo10->cantidad_3,P3:$cotgrupo10->valor_empresa_3 | C4:$cotgrupo10->cantidad_4,P4:$cotgrupo10->valor_empresa_4</td>";
                    $detallecotgrupo10.= "<td>$cotgrupo10->fecha</td>";
                    $detallecotgrupo10.= "<tr>";
                }else{
                    $detallecotgrupo10.= "<tr><td align='center'>$existegrupo->idc_010 </td><td colspan='2' align='center'>La cotizacion Nro: $existegrupo->idc_010 aun no tiene Hoja de Costos</td><tr>";
                }
            }
        }  
        
        ?>
        <?php if(sizeof($existegrupo)>0) { ?>
        <div id="grupos">
            <table border='1'>
                <tr>
                    <td colspan="3" class="title">Esta cotizacion pertenece a un grupo</td>
                </tr>
                <tr>
                    <td style="width:500px;" colspan="2"><b>Nombre de Grupo:</b> <?php echo $existegrupo->grupo; ?></td>
                    <td><b>Cantidad:</b> <?php echo $numero_en_grupo;  ?></td>
                </tr>
                <tr>
                    <td class="title" colspan="3" >Productos</td>
                </tr>
                <tr>
                    <td colspan="" style="text-align:center"><b>Nro</b></td>
                    <td colspan="" style="text-align:center"><b>Detalle de Cotizacion</b></td>
                    <td colspan="" style="text-align:center" ><b>Fecha</b></td>
                </tr>
                    <?php if($detallecotgrupo1!=""){echo $detallecotgrupo1; } ?>
                    <?php if($detallecotgrupo2!=""){echo $detallecotgrupo2; } ?>
                    <?php if($detallecotgrupo3!=""){echo $detallecotgrupo3; } ?>
                    <?php if($detallecotgrupo4!=""){echo $detallecotgrupo4; } ?>
                    <?php if($detallecotgrupo5!=""){echo $detallecotgrupo5; } ?>
                    <?php if($detallecotgrupo6!=""){echo $detallecotgrupo6; } ?>
                    <?php if($detallecotgrupo7!=""){echo $detallecotgrupo7; } ?>
                    <?php if($detallecotgrupo8!=""){echo $detallecotgrupo8; } ?>
                    <?php if($detallecotgrupo9!=""){echo $detallecotgrupo9; } ?>
                    <?php if($detallecotgrupo10!=""){echo $detallecotgrupo10; } ?>
            </table>
        </div>
        <?php } ?>
    <form name="form" id="form" method="post" action="<?php echo base_url();?>hoja/save"> 
     <div class="container fuente">
    
            <header>
            
            <ol class="breadcrumb">
              <li><a href="<?php echo base_url()?>cotizaciones/index/<?php echo $pagina?>">Cotizaciones</a></li>
              <li><a href="<?php echo base_url()?>cotizaciones/search_cot/<?php echo $id?>">Volver&gt;&gt;</a></li>
              <li class="active">Hoja de Costos <?php if(sizeof($hoja)>0){echo '<strong>(Guardada el '.fecha($hoja->fecha).')</strong>';}?></li>
            </ol>
                 <?php if ( $this->session->flashdata('ControllerMessage') != '' ) : ?>
            <div class="alert alert-success"><?php echo $this->session->flashdata('ControllerMessage'); ?></div>
            <?php endif; ?>
            <table style="width: 300px;font-size: 14px;text-align: center;border: 1px solid; background-color: #339900; color:white;">
                        <?php if ($hoja->impreso == 1){
                         
                           echo "<tr><td style='padding:5px'>Esta hoja de costos no puede ser modificada debido a que ya fue impresa.</td></tr>";
                         
                        } ?>
                    </table><br />
                <div>
                <h1><span id="titulo">Cartonajes Grau LTDA.</span> &nbsp;&nbsp;&nbsp; Hoja de Costos <?php if(sizeof($hoja)>0){echo '<span style="font-size: 13px;"><strong>(Guardada el '.fecha($hoja->fecha).')</strong><span>';}?>
                <?php if($hoja->codigo_duplicado!=""){echo '<span style="font-size: 13px;border:1px solid;"><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Duplicado '.$hoja->codigo_duplicado.'</strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>';}?>
                </h1>
                </div>
            <span class="ir-arriba2 icon-arrow-up">↓</span>
                <!--separador 20-->
                    <div class="separador_20"></div>
                    <!--/separador 20-->
                <div id="numero_de_costo">
                Número de Costo : <?php echo $id?> || Orden de Producción : <?php echo $orden->id_antiguo?> Número de Costo Antigua : <?php echo $datos->ot_antigua?>
                </div>
                <!--separador 20-->
                    <div class="separador_20"></div>
                    <!--/separador 20-->
                <div id="datos_basicos">
                    <!--tabla HTML-->
                    <table>
                        <?php if ($datos->ot_antigua!='') { ?>
                        <tr>
                            <td class="celda_1"><strong>NºC. Antigua<span class="derecha"> : </strong></span></td>
                            <td class="celda_2"><strong> <?php echo $datos->ot_antigua?></strong></td>
                            <td class="celda_3">&nbsp;</td>
                            <td class="celda_4"></td>
                            <td class="celda_5"></td>
                        </tr>                        
                        <?php } ?>                        
                        <tr>
                            <td class="celda_1">Fecha <span class="derecha">:</span></td>
                            <td class="celda_2"><?php echo fecha($datos->fecha)?></td>
                            <td class="celda_3">&nbsp;</td>
                            <td class="celda_4">Costeo <span class="derecha">:</span></td>
                            <td class="celda_5"><?php echo $user->nombre?></td>
                        </tr>
                        <tr>
                            <td class="celda_1">Nombre <span class="derecha">:</span></td>
                            <td class="celda_2"><?php echo $cli->razon_social?></td>
                            <td class="celda_3">&nbsp;</td>
                            <td class="celda_4">E-Mail <span class="derecha">:</span></td>
                            <td class="celda_5"><?php echo $cli->correo?></td>
                        </tr>
                        <tr>
                            <td class="celda_1">Dirección <span class="derecha">:</span></td>
                            <td class="celda_2"><?php echo $cli->direccion?></td>
                            <td class="celda_3">&nbsp;</td>
                            <td class="celda_4">RUT <span class="derecha">:</span></td>
                            <td class="celda_5"><?php echo esRut($cli->rut)?></td>
                        </tr>
                        <tr>
                            <td class="celda_1">Teléfono <span class="derecha">:</span></td>
                            <td class="celda_2"><?php echo $cli->telefono?></td>
                            <td class="celda_3">&nbsp;</td>
                            <td class="celda_4">Ciudad <span class="derecha">:</span></td>
                            <td class="celda_5"><?php echo $cli->ciudad?></td>
                        </tr>
                        <tr>
                            <td class="celda_1">Vendedor <span class="derecha">:</span></td>
                            <td class="celda_2"><?php echo $vendedor->nombre?><?php echo "<a href='".base_url()."hoja/cambio_vendedor/".$id."/".$pagina."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>"; ?></td>
                            <td class="celda_3">&nbsp;</td>
                            <td class="celda_4">Comuna <span class="derecha">:</span></td>
                            <td class="celda_5"><?php echo $cli->comuna?></td>
                        </tr>
                        <tr>
                            <td class="celda_1">&nbsp;</td>
                            <td class="celda_2">&nbsp;</td>
                            <td class="celda_3">&nbsp;</td>
                            <td class="celda_4">AT <span class="derecha">:</span></td>
                            <td class="celda_5"><?php echo $cli->contacto?></td>
                        </tr>
                    </table></div>

                    <div class="separador_20"></div>
                    <?php
                                        $materialidad_1=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_placa1);
                                        $materialidad_2=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_onda2);
                                        $materialidad_3=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_liner3);
//                                        $materialidad_1=$this->materiales_model->getMaterialesPorNombre($fotomecanica->id_mat_placa1);
//                                        $materialidad_2=$this->materiales_model->getMaterialesPorNombre($fotomecanica->id_mat_onda2);
//                                        $materialidad_3=$this->materiales_model->getMaterialesPorNombre($fotomecanica->id_mat_liner3);
                                        
                                        
                                        ?>
                    <div class="row">
                    <div style="float: left">
                        <table id="tabla_produccion" border="1" style="width: 15cm">
                                        
                                        <th colspan="4" align="center"><b>Descripcion del Trabajo</b></th>
                                        <tr>
                                            <td colspan="4"><b>Nombre Producto: </b><?php echo $ing->producto ?></td>
                                        </tr>
                                        <tr>
                                            <td><b>Cala Caucho: </b><?php echo $fotomecanica->fot_cala_caucho?></td>
                                            <td><b>En placa: </b><?php echo $fotomecanica->materialidad_1?> (<?php echo "Id: ".$fotomecanica->id_mat_placa1; ?>)</td>
                                            <td><b>Impreso a: </b><?php echo $fotomecanica->colores ?> colores</td>
                                            <td><b>Reverso: </b><?php echo $materialidad_1->reverso?></td>
                                        </tr>
                                        <tr>
                                            <td><b>Reverso Liner: </b><?php echo $materialidad_1->reverso ?></td>
                                            <td><b>Barniz: </b><?php echo $fotomecanica->fot_lleva_barniz ?></td>
                                            <td><b>Onda: </b><?php echo $fotomecanica->materialidad_2 ?> (<?php echo "Id: ".$fotomecanica->id_mat_onda2; ?>)</td>
                                            <td><b>Tamaño: </b><?php echo "$tamano1 X $tamano2 cm"; ?></td>
                                        </tr>
                                        <tr>
                                            <td><b>Reserva Barniz: </b><?php echo $fotomecanica->fot_reserva_barniz ?></td>
                                            <td><b>Reverso Onda: </b><?php echo $materialidad_2->reverso ?></td>
                                            <td><b>Liner: </b><?php echo $fotomecanica->materialidad_3 ?> (<?php echo "Id: ".$fotomecanica->id_mat_liner3; ?>)</td>
                                            <td></td>
                                        </tr>
                                    </table><br>
                    </div>

                    </div>
         
                    <div>
                        
                    <?php
                    $materialidad_1=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_placa1);
                    $materialidad_2=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_onda2);
                    $materialidad_3=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_liner3);
                                        
                   ?>
                    </div>
                    <div class="separador_10"></div>
                    <div id="maquina">
                        <?php if($fotomecanica->tiene_color_modificado=='SI'){$colorModificado = "<strong><h6>Numero de Colores Modificados: ".$fotomecanica->numero_color_modificado."</h6></strong>";} ?>
                        <?php echo '<strong><h6>Estado del producto: '.$fotomecanica->condicion_del_producto.'</h6></strong>'.$colorModificado;?>
                    </div>
                    <!--separador 20-->
                    <div class="separador_20"></div>
                    <!--/separador 20-->
                    <div>
                    <hr class="hr_punteada" />
                    Ancho : <?php echo $tamano1?> Cm, Largo : <?php echo $tamano2?> Cm, UNIDAD/PLIEGO : <?php echo $ing->unidades_por_pliego?>, COLORES : <?php echo $fotomecanica->colores?> 
                    <!--<a href="<?php //echo base_url()?>hoja/colores_fotomecanica/<?php //echo $id?>/<?php //echo $pagina?>" class="fancybox fancybox.ajax"><img src="<?php //echo base_url()?>public/frontend/images/edit.png" class="img_16" />-->
                    <?php if($hoja->impreso!=1){echo "<a href='".base_url()."hoja/colores_fotomecanica/".$id."/".$pagina."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";} ?>
                    </a>, PIEZAS TOTALES EN EL PLIEGO(Para Desgajado) : <?php echo $ing->piezas_totales_en_el_pliego?>, TERMINACIÓN : <?php $acabado_1=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_1);echo $acabado_1->caracteristicas?>, Barniz: <?php echo $fotomecanica->fot_lleva_barniz?>  
                    <!--<a href="<?php //echo base_url()?>hoja/datos_fotomecanica/<?php //echo $id?>/<?php //echo $pagina?>" class="fancybox fancybox.ajax"><img src="<?php //echo base_url()?>public/frontend/images/edit.png" class="img_16" /></a>-->
                    <?php if($hoja->impreso!=1){echo "<a href='".base_url()."hoja/datos_fotomecanica/".$id."/".$pagina."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";}else{echo "<a href='".base_url()."hoja2/datos_fotomecanica/".$id."/".$pagina."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";} ?>
                    , Trabajo_Externo: <?php if($externo==0 && $procesosespeciales<=0){echo 'NO';}else{echo 'SI';}?>
                    <hr class="hr_punteada" />
                    </div>
                    <div id="cantidad">
                    <!--Valor por : <?php //echo number_format($datoscantidad1,0,"",".")?> <a href="<?php// echo base_url()?>hoja/cantidad/<?php //echo $id?>/<?php// echo $pagina?>" class="fancybox fancybox.ajax"><img src="<?php// echo base_url()?>public/frontend/images/edit.png" class="img_16" /></a>-->
                    <h5>Valor por : <?php echo number_format($datoscantidad1,0,"",".")?> <?php if($hoja->impreso!=1){echo "<a href='".base_url()."hoja/cantidad/".$id."/".$pagina."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";}else{echo "<a href='".base_url()."hoja2/cantidad/".$id."/".$pagina."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";} ?></h5>
                    </div>
                  
                    <!--separador 20-->
                    <div class="separador_20"></div>
                    <!--/separador 20-->
                    <div>
                        <!--materialidad-->
                       
                        <table>
                            <tr>
                                <td class="celda_5 izquierda">
                                <?php
                                 switch($fotomecanica->materialidad_datos_tecnicos)
                                  {
                                    case 'Indefinido':
                                        $materialidad_1=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_placa1);
                                        $materialidad_2=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_onda2);
                                        $materialidad_3=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_liner3);
//                                        $materialidad_1=$this->materiales_model->getMaterialesPorNombre($fotomecanica->id_mat_placa1);
//                                        $materialidad_2=$this->materiales_model->getMaterialesPorNombre($fotomecanica->id_mat_onda2);
//                                        $materialidad_3=$this->materiales_model->getMaterialesPorNombre($fotomecanica->id_mat_liner3);
                                        $materialidad_4="No Aplica";
                                        $variable_cotizador=$this->variables_cotizador_model->getVariablesCotizadorPorId(24);
                                        $variable_cotizador2=$this->variables_cotizador_model->getVariablesCotizadorPorId(40);
                                        $base_imprenta=$this->variables_cotizador_model->getVariablesCotizadorPorId(6);
                                        $formula=$materialidad_1->gramaje+($materialidad_1->gramaje*($variable_cotizador->precio/100))+$materialidad_3->gramaje;
                                        if ($materialidad_2->precio>0) $materialidad_precio2=($materialidad_2->precio/1000); else $materialidad_precio2=0;
                                        if ($materialidad_3->precio>0) $materialidad_precio3=($materialidad_3->precio/1000); else $materialidad_precio3=0;
                                        if ($materialidad_2->gramaje>0) $materialidad_gramaje2=($materialidad_2->gramaje/1000); else $materialidad_gramaje2=0;
                                        $costo_kilo=0;
//                                        echo "costo_kilo=(((".$materialidad_2->gramaje."*(".$materialidad_2->precio."/1000)+((".$materialidad_2->gramaje."*(".$variable_cotizador->precio."/100)*".$materialidad_2->precio."/1000))+".$materialidad_3->gramaje."*".$materialidad_3->precio."/1000)/(".$materialidad_2->gramaje."+(".$materialidad_2->gramaje."*(".$variable_cotizador->precio."/100))+".$materialidad_3->gramaje.")))*1000";           
                                        if ($materialidad_2->gramaje>0)
                                            $costo_kilo=((($materialidad_2->gramaje*($materialidad_2->precio/1000)+(($materialidad_2->gramaje*($variable_cotizador->precio/100)*$materialidad_2->precio/1000))+$materialidad_3->gramaje*$materialidad_3->precio/1000)/($materialidad_2->gramaje+($materialidad_2->gramaje*($variable_cotizador->precio/100))+$materialidad_3->gramaje)))*1000;           
					else 	
                                            $costo_kilo=0;
//                                        echo $materialidad_3->tipo."======".$materialidad_3->reverso;
										
                                        if($materialidad_3->tipo == 14 and  $materialidad_3->reverso == 'Blanca')//valdivia
                                        {
//                                                echo "1==============";
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(44);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;
                                        }

                                        elseif($materialidad_3->tipo == 15 and  $materialidad_3->reverso == 'Blanca')//maule
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(45);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;                                                 
                                        }
                                        elseif($materialidad_3->tipo == 1 and  $materialidad_3->reverso == 'Blanca') //Cartulina Importada
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(43);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;                                                 
                                        }
                                        elseif($materialidad_3->tipo == 5 and  $materialidad_3->reverso == 'Blanco') // papel reverso blanco
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(42);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;                                                 
                                        }
                                        elseif($materialidad_3->tipo == 3 and  $materialidad_3->reverso == 'Blanco') // papel reverso blanco
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(42);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;                                                 
                                        }
                                        elseif($materialidad_3->tipo == 4 and  $materialidad_3->reverso == 'Café') // papel reverso cafe
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(41);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;                                                 
                                        }
                                        else
                                        $costo_kilo_obtenido=140;
                                        $costo_kilo=$costo_kilo+$costo_kilo_obtenido;
                                        if(($fotomecanica->fot_lleva_barniz=='Nada')||($fotomecanica->fot_lleva_barniz==''))
                                        {
                                            $barniz2=0;
                                        }else
                                        {
                                            $barniz2=1;
                                        }

                                        if($maquina=="Máquina Roland 800")
                                         {
                                            $tira1=((($datoscantidad1/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio )*($fotomecanica->colores+$barniz2);
                                            $recargo800Array=$this->variables_cotizador_model->getVariablesCotizadorPorId(34);
                                            $tira2=((($datoscantidad1/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio)*($fotomecanica->colores+$barniz2)*(1*$recargo800Array->precio/100);
                                            //echo $recargo800Array->precio."<br>".$tira1."<br>".$tira2;exit;
                                             
                                         }else
                                         {
                                            $tiraje=((($datoscantidad1/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio )*($fotomecanica->colores+$barniz2);  
                                         
                                            
                                         }   
                                        echo "<h1>" . $tira1 . "</h1>";
                                         echo "<h1>" . $tira2 . "</h1>";
                                        if ($materialidad_2->gramaje>0)
                                            $GramosMetroCuadrado=$materialidad_2->gramaje+($materialidad_2->gramaje*($variable_cotizador->precio/100))+$materialidad_3->gramaje;
					else 	
                                            $GramosMetroCuadrado=0;                                         
                                        $recargoGramosDeAlmidon=$this->variables_cotizador_model->getVariablesCotizadorPorId(30);
                                        $GramosMetroCuadrado=$GramosMetroCuadrado+$recargoGramosDeAlmidon->precio;
                                        if(sizeof($hoja)>=1)
                                        {
                                            $arreglo54=array
                                                (
                                                    "gramos_metro_cuadrado"=>$GramosMetroCuadrado,
                                                );
                                                $this->db->where('id', $hoja->id);
                                                $this->db->update("hoja_de_costos_datos",$arreglo54);
                                                       
                                        }
                                        if ($materialidad_2->gramaje>0)
                                            $costoMonotapaPorMetro2=$materialidad_2->gramaje*($materialidad_2->precio/1000)+(($materialidad_2->gramaje*($variable_cotizador->precio/100)*$materialidad_2->precio/1000)+$materialidad_3->gramaje*$materialidad_3->precio/1000);
					else 	
                                            $costoMonotapaPorMetro2=0;     
//                            
                                       switch($fotomecanica->estan_los_moldes)
                                       {
                                          case 'NO':
                                            $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Nuevo</strong>)";
                                          break;
                                          case 'MOLDE GENERICO':
                                            if ($orden->id_molde!='')  
                                                $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            else
                                                $molde=$this->moldes_model->getMoldesPorId($datos->numero_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Antiguo</strong>)";
                                          break;
                                          case 'MOLDE REGISTRADOS DEL CLIENTE':
                                            if ($orden->id_molde!='')  
                                                $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            else
                                                $molde=$this->moldes_model->getMoldesPorId($datos->numero_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Antiguo</strong>)";
                                          break;                                          
                                          case 'NO LLEVA':
                                            $moldeNombre="<strong>NO ESTA MOLDE, PRODUCTO NO FABRICADO ANTERIORMENTE</strong>";
                                          break;
                                          case 'CLIENTE LO APORTA':
                                            $moldeNombre="<strong>CLIENTE LO APORTA</strong>";
                                          break;
                                       }
                                       
                                        $tapaNombre=$materialidad_1->nombre;
                                        $tapaGramaje=$materialidad_1->gramaje;
                                        $tapaFecha=$materialidad_1->fecha_ultima_actualizacion;
                                        $tapaPrecio=$materialidad_1->precio;
                                        $ondaNombre=$materialidad_2->nombre;
                                        if ($materialidad_2->gramaje>0)
                                            $ondaGramaje=$materialidad_2->gramaje;
					else 	
                                        $ondaGramaje=0;                                           
                                        $ondaFecha=$materialidad_2->fecha_ultima_actualizacion;
                                        $ondaPrecio=$materialidad_2->precio;
                                        $linerNombre=$materialidad_3->nombre;
                                        $linerGramaje=$materialidad_3->gramaje;
                                        $linerFecha=$materialidad_3->fecha_ultima_actualizacion;
                                        $linerPrecio=$materialidad_3->precio;
                                       ?>
                                       <!--<a href="<?php //echo base_url()?>hoja/materialidad/<?php //echo $id?>/<?php //echo $pagina?>" class="fancybox fancybox.ajax"><img src="<?php //echo base_url()?>public/frontend/images/edit.png" class="img_16" /></a>-->
                                       <?php if($hoja->impreso!=1){echo "<a href='".base_url()."hoja/materialidad/".$id."/".$pagina."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";}else{echo "<a href='".base_url()."hoja2/materialidad/".$id."/".$pagina."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";} ?>
                                       <br />
                                        <span>Datos técnicos: </span> Indefinido (Migrado al Sistema)
                                        <br />
					<?php $tapa = $this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_placa1) ?>
                                        <span>Tapa: </span> <?php echo $tapa->materiales_tipo?> (<?php echo "Id: ".$fotomecanica->id_mat_placa1; ?>)/ <strong>Gramaje:</strong> <?php echo $materialidad_1->gramaje?> / <strong>Precio:</strong> <?php echo $materialidad_1->precio?> / <strong>Reverso:</strong> <?php echo $materialidad_1->reverso?>
                                        <br />
					<?php $monda = $this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_onda2) ?>
                                        <span>Onda: </span> <?php echo $monda->materiales_tipo ?> (<?php echo "Id: ".$fotomecanica->id_mat_onda2; ?>)/ <strong>Gramaje:</strong> <?php echo $materialidad_2->gramaje?> / <strong>Precio:</strong> <?php echo $materialidad_2->precio?> / <strong>Reverso:</strong> <?php echo $materialidad_2->reverso?>
                                        <br />
					<?php $mliner = $this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_liner3) ?>
                                        <span>Liner: </span> <?php echo $mliner->materiales_tipo ?>  (<?php echo "Id: ".$fotomecanica->id_mat_liner3; ?>)/ <strong>Gramaje:</strong> <?php echo $materialidad_3->gramaje?> / <strong>Precio:</strong> <?php echo $materialidad_3->precio?>  / <strong>Reverso:</strong> <?php echo $materialidad_3->reverso?>
                                        <br />
                                        <!-- GR/ONDA <?php //echo $formula?>
                                        <br /> -->
                                        COSTO MONOTAPA POR KILO: <?php echo number_format($costo_kilo,0,'','.')?> &nbsp; GRAMOS ONDA M2 <?php echo $GramosMetroCuadrado?> &nbsp; COSTO MONOTAPA POR M2 <?php echo $costoMonotapaPorMetro2?>
                                        <br />
                                        IMPRESIÓN : <?php echo $fotomecanica->impresion?> 
                                        <!--<a href="<?php //echo base_url()?>hoja/impresion/<?php// echo $id?>/<?php //echo $pagina?>" class="fancybox fancybox.ajax"><img src="<?php //echo base_url()?>public/frontend/images/edit.png" class="img_16" /></a>-->
                                        <?php if($hoja->impreso!=1){echo "<a href='".base_url()."hoja/impresion/".$id."/".$pagina."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";}else{echo "<a href='".base_url()."hoja2/materialidad/".$id."/".$pagina."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";} ?>
                                        <br />
                                        <?php // print_r($forma_pago); ?>
                                        Forma de Pago : <?php echo $forma_pago->forma_pago; ?> <a href="<?php echo base_url()?>hoja/forma_pago/<?php echo $id?>/<?php echo $pagina?>" class="fancybox fancybox.ajax"><img src="<?php echo base_url()?>public/frontend/images/edit.png" class="img_16" /></a>
                                        <br />
                                        <br />
                                        Molde : <?php echo $moldeNombre?>  <?php if($trazadosing->numero!=""){echo $trazadosing->numero;}?> <!--
<a href="<?php echo base_url()?>hoja/moldes/<?php echo $id?>/<?php echo $pagina?>" class="fancybox fancybox.ajax"><img src="<?php echo base_url()?>public/frontend/images/edit.png" class="img_16" /></a>
-->
                                        <?php
                                    break;
                                    case 'Microcorrugado':
                                        $materialidad_1=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_placa1);
                                        $materialidad_2=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_onda2);
                                        $materialidad_3=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_liner3);
//                                        $materialidad_1=$this->materiales_model->getMaterialesPorNombre($fotomecanica->id_mat_placa1);
////                                        print_r($materialidad_1);
//                                        $materialidad_2=$this->materiales_model->getMaterialesPorNombre($fotomecanica->id_mat_onda2);
//                                        $materialidad_3=$this->materiales_model->getMaterialesPorNombre($fotomecanica->id_mat_liner3);
                                        $materialidad_4="No Aplica";
                                        $variable_cotizador=$this->variables_cotizador_model->getVariablesCotizadorPorId(24);
                                        $variable_cotizador2=$this->variables_cotizador_model->getVariablesCotizadorPorId(40);
                                        $base_imprenta=$this->variables_cotizador_model->getVariablesCotizadorPorId(6);
                                        //print_r($base_imprenta);exit();
                                        $formula=$materialidad_1->gramaje+($materialidad_1->gramaje*($variable_cotizador->precio/100))+$materialidad_3->gramaje;
                                        if ($materialidad_2->precio>0) $materialidad_precio2=($materialidad_2->precio/1000); else $materialidad_precio2=0;
                                        if ($materialidad_3->precio>0) $materialidad_precio3=($materialidad_3->precio/1000); else $materialidad_precio3=0;
                                        if ($materialidad_2->gramaje>0) $materialidad_gramaje2=($materialidad_2->gramaje/1000); else $materialidad_gramaje2=0;
                                        $costo_kilo=0;
                                        if (($materialidad_2->gramaje>0) && ($materialidad_3->gramaje>0) && ($materialidad_2->precio>0)){
                                            $costo_kilo=((($materialidad_2->gramaje*($materialidad_2->precio/1000)+(($materialidad_2->gramaje*($variable_cotizador->precio/100)*$materialidad_2->precio/1000))+$materialidad_3->gramaje*$materialidad_3->precio/1000)/($materialidad_2->gramaje+($materialidad_2->gramaje*($variable_cotizador->precio/100))+$materialidad_3->gramaje)))*1000;           		                                         
                                        }else{ 	
                                            $costo_kilo=0;
                                        }			
                                        if($materialidad_3->tipo == 14 and  $materialidad_3->reverso == 'Blanca')//valdivia
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(44);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;
                                        }
                                        elseif($materialidad_3->tipo == 15 and  $materialidad_3->reverso == 'Blanca')//maule
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(45);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;                                                 
                                        }
                                        elseif($materialidad_3->tipo == 1 and  $materialidad_3->reverso == 'Blanca') //Cartulina Importada
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(43);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;                                                 
                                        }
                                        elseif($materialidad_3->tipo == 5 and  $materialidad_3->reverso == 'Blanco') // papel reverso blanco
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(42);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;                                                 
                                        }
                                        elseif($materialidad_3->tipo == 3 and  $materialidad_3->reverso == 'Blanco') // papel reverso blanco
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(42);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;                                                 
                                        }
                                        elseif($materialidad_3->tipo == 4 and  $materialidad_3->reverso == 'Café') // papel reverso cafe
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(41);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;                                                 
                                        }
                                        else{
                                        $costo_kilo_obtenido=140;
                                        }
                                        
                                        $costo_kilo=$costo_kilo+$costo_kilo_obtenido;
                                        
                                        if($fotomecanica->fot_lleva_barniz=='' || $fotomecanica->fot_lleva_barniz=='Nada')
                                        {
                                            $barniz2=0;
                                        }else
                                        {
                                            $barniz2=1;
                                        }
                                        
                                        if($maquina=="Máquina Roland 800")
                                         {
                                            $tira1=((($datoscantidad1/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio )*($fotomecanica->colores+$barniz2);
                                            $recargo800Array=$this->variables_cotizador_model->getVariablesCotizadorPorId(34);
                                            $tira2=((($datoscantidad1/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio)*($fotomecanica->colores+$barniz2)*(1*$recargo800Array->precio/100);
                                            $tiraje=$tira1+$tira2;
                                            
//                                       
                                         }else
                                         {
                                            $tiraje=((($datoscantidad1/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio )*($fotomecanica->colores+$barniz2);  
                                         }   
                                         
                                         echo "<h1>" . $tira1 . "</h1>";
                                         echo "<h1>" . $tira2 . "</h1>";
                                        if ($materialidad_2->gramaje>0)
                                        {    
                                            $GramosMetroCuadrado=$materialidad_2->gramaje+($materialidad_2->gramaje*($variable_cotizador->precio/100))+$materialidad_3->gramaje;
//                                           
                                        }    
					else 	
                                            $GramosMetroCuadrado=0;                                         
                                        $recargoGramosDeAlmidon=$this->variables_cotizador_model->getVariablesCotizadorPorId(30);

                                        $GramosMetroCuadrado=$GramosMetroCuadrado+$recargoGramosDeAlmidon->precio;
                                        if(sizeof($hoja)>=1)
                                        {
                                            $arreglo54=array
                                                (
                                                    "gramos_metro_cuadrado"=>$GramosMetroCuadrado,
                                                );
                                                $this->db->where('id', $hoja->id);
                                                $this->db->update("hoja_de_costos_datos",$arreglo54);
                                               // echo $this->db->last_query();
                                        }
                                        if ($materialidad_2->gramaje>0){
                                            $costoMonotapaPorMetro2=$materialidad_2->gramaje*($materialidad_2->precio/1000)+(($materialidad_2->gramaje*($variable_cotizador->precio/100)*$materialidad_2->precio/1000)+$materialidad_3->gramaje*$materialidad_3->precio/1000);
                                        }
					else 	
                                            $costoMonotapaPorMetro2=0;                                           
                                       switch($fotomecanica->estan_los_moldes)
                                       {
                                          case 'NO':
                                            $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Nuevo</strong>)";
                                          break;
                                          case 'MOLDE GENERICO':
                                            if ($orden->id_molde!='')  
                                                $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            else
                                                $molde=$this->moldes_model->getMoldesPorId($datos->numero_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Antiguo</strong>)";
                                          break;
                                          case 'MOLDE REGISTRADOS DEL CLIENTE':
                                            if ($orden->id_molde!='')  
                                                $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            else
                                                $molde=$this->moldes_model->getMoldesPorId($datos->numero_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Antiguo</strong>)";
                                          break;   
                                          case 'NO LLEVA':
                                            $moldeNombre="<strong>NO ESTA MOLDE, PRODUCTO NO FABRICADO ANTERIORMENTE</strong>";
                                          break;
                                          case 'CLIENTE LO APORTA':
                                            $moldeNombre="<strong>CLIENTE LO APORTA</strong>";
                                          break;
                                       }
                                        $tapaNombre=$materialidad_1->nombre;
                                        $tapaGramaje=$materialidad_1->gramaje;
                                        $tapaFecha=$materialidad_1->fecha_ultima_actualizacion;
                                        $tapaPrecio=$materialidad_1->precio;
                                        $ondaNombre=$materialidad_2->nombre;
                                        if ($materialidad_2->gramaje>0)
                                            $ondaGramaje=$materialidad_2->gramaje;
					else 	
                                            $ondaGramaje=0;                                           
                                        $ondaFecha=$materialidad_2->fecha_ultima_actualizacion;
                                        $ondaPrecio=$materialidad_2->precio;
                                        $linerNombre=$materialidad_3->nombre;
                                        $linerGramaje=$materialidad_3->gramaje;
                                        $linerFecha=$materialidad_3->fecha_ultima_actualizacion;
                                        $linerPrecio=$materialidad_3->precio;
//                                        print_r($materialidad_1);
                                       ?>
                                       <!--<a href="<?php //echo base_url()?>hoja/materialidad/<?php// echo $id?>/<?php// echo $pagina?>" class="fancybox fancybox.ajax"><img src="<?php //echo base_url()?>public/frontend/images/edit.png" class="img_16" /></a>-->
                                       <?php if($hoja->impreso!=1){echo "<a href='".base_url()."hoja/materialidad/".$id."/".$pagina."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";}else{echo "<a href='".base_url()."hoja2/materialidad/".$id."/".$pagina."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";} ?>
                                       <br />
                                        <span>Datos técnicos: </span> MicroCorrugado (Migrado al Sistema)
                                        <br />
					<?php $tapa = $this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_placa1) ?>
                                        <span>Tapa: </span> <?php echo $tapa->materiales_tipo?>  (<?php echo "Id: ".$fotomecanica->id_mat_placa1; ?>)/ <strong>Gramaje:</strong> <?php echo $materialidad_1->gramaje?> / <strong>Precio:</strong> <?php echo $materialidad_1->precio?> / <strong>Reverso:</strong> <?php echo $materialidad_1->reverso?>
                                        <br />
					<?php $monda = $this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_onda2) ?>
                                        <span>Onda: </span> <?php echo $monda->materiales_tipo ?>  (<?php echo "Id: ".$fotomecanica->id_mat_onda2; ?>)/ <strong>Gramaje:</strong> <?php echo $materialidad_2->gramaje?> / <strong>Precio:</strong> <?php echo $materialidad_2->precio?> / <strong>Reverso:</strong> <?php echo $materialidad_2->reverso?>
                                        <br />
					<?php $mliner = $this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_liner3) ?>
                                        <span>Liner: </span> <?php echo $mliner->materiales_tipo ?>  (<?php echo "Id: ".$fotomecanica->id_mat_liner3; ?>)/ <strong>Gramaje:</strong> <?php echo $materialidad_3->gramaje?> / <strong>Precio:</strong> <?php echo $materialidad_3->precio?>  / <strong>Reverso:</strong> <?php echo $materialidad_3->reverso?>
                                        <br />
                                        <!-- GR/ONDA <?php //echo $formula?>
                                        <br /> -->
                                        COSTO MONOTAPA POR KILO: <?php echo number_format($costo_kilo,0,'','.')?> &nbsp; GRAMOS ONDA M2 <?php echo $GramosMetroCuadrado?> &nbsp; COSTO MONOTAPA POR M2 <?php echo $costoMonotapaPorMetro2?>
                                        <br />
                                        IMPRESIÓN : <?php echo $fotomecanica->impresion?> 
                                        <!--<a href="<?php //echo base_url()?>hoja/impresion/<?php// echo $id?>/<?php //echo $pagina?>" class="fancybox fancybox.ajax"><img src="<?php //echo base_url()?>public/frontend/images/edit.png" class="img_16" /></a>-->
                                        <?php if($hoja->impreso!=1){echo "<a href='".base_url()."hoja/impresion/".$id."/".$pagina."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";}else{echo "<a href='".base_url()."hoja2/impresion/".$id."/".$pagina."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";} ?>
                                        <br />
                                        <?php // print_r($forma_pago); ?>
                                        Forma de Pago : <?php echo $forma_pago->forma_pago; ?> 
                                        <!--<a href="<?php //echo base_url()?>hoja/forma_pago/<?php //echo $id?>/<?php //echo $pagina?>" class="fancybox fancybox.ajax"><img src="<?php //echo base_url()?>public/frontend/images/edit.png" class="img_16" /></a>-->
                                        <?php if($hoja->impreso!=1){echo "<a href='".base_url()."hoja/forma_pago/".$id."/".$pagina."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";}else{echo "<a href='".base_url()."hoja2/forma_pago/".$id."/".$pagina."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";} ?>
                                        <br />
                                        <br />
                                        Molde : <?php echo $moldeNombre?>  <?php if($trazadosing->numero!=""){echo $trazadosing->numero;}?> <!--
<a href="<?php // echo base_url()?>hoja/moldes/<?php // echo $id?>/<?php // echo $pagina?>" class="fancybox fancybox.ajax"><img src="<?php // echo base_url()?>public/frontend/images/edit.png" class="img_16" /></a>
-->
                                        <?php
                                    break;                                    
//                                  
//                                       ?>
                                       <!--<a href="//<?php //echo base_url()?>hoja/materialidad/<?php //echo $id?>/<?php //echo $pagina?>" class="fancybox fancybox.ajax"><img src="<?php //echo base_url()?>public/frontend/images/edit.png" class="img_16" /></a>-->
                                       <?php if($hoja->impreso!=1){echo "<a href='".base_url()."hoja/materialidad/".$id."/".$pagina."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";}else{echo "<a href='".base_url()."hoja2/materialidad/".$id."/".$pagina."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";} ?>
                                        <br />
                                        <span>Datos técnicos: </span> Microcorrugado
                                        <br />
					//<?php $tapa = $this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_placa1) ?>
                                        <span>Tapa: </span> //<?php echo $tapa->materiales_tipo?>  (<?php echo "Id: ".$fotomecanica->id_mat_placa1; ?>)/ <strong>Gramaje:</strong> <?php echo $materialidad_1->gramaje?> / <strong>Precio:</strong> <?php echo $materialidad_1->precio?> / <strong>Reverso:</strong> <?php echo $materialidad_1->reverso?>
                                        <br />
					//<?php $monda = $this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_onda2) ?>
                                        <span>Onda: </span> //<?php echo $monda->materiales_tipo ?>  (<?php echo "Id: ".$fotomecanica->id_mat_onda2; ?>)/ <strong>Gramaje:</strong> <?php echo $materialidad_2->gramaje?> / <strong>Precio:</strong> <?php echo $materialidad_2->precio?> / <strong>Reverso:</strong> <?php echo $materialidad_2->reverso?>
                                        <br />
					//<?php $mliner = $this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_liner3) ?>
                                        <span>Liner: </span> //<?php echo $mliner->materiales_tipo ?>  (<?php echo "Id: ".$fotomecanica->id_mat_liner3; ?>)/ <strong>Gramaje:</strong> <?php echo $materialidad_3->gramaje?> / <strong>Precio:</strong> <?php echo $materialidad_3->precio?>  / <strong>Reverso:</strong> <?php echo $materialidad_3->reverso?>
                                        <br />
                                        <!-- GR/ONDA //<?php //echo $formula?>
                                        <br /> -->
                                        COSTO MONOTAPA POR KILO: //<?php echo number_format($costo_kilo,0,'','.')?> &nbsp; GRAMOS ONDA M2 <?php echo $GramosMetroCuadrado?> &nbsp; COSTO MONOTAPA POR M2 <?php echo $costoMonotapaPorMetro2?>
                                        <br />
                                        IMPRESIÓN : //<?php echo $fotomecanica->impresion?> 
                                        <!--<a href="<?php //echo base_url()?>hoja/impresion/<?php //echo $id?>/<?php //echo $pagina?>" class="fancybox fancybox.ajax"><img src="<?php //echo base_url()?>public/frontend/images/edit.png" class="img_16" /></a>-->
                                        <?php if($hoja->impreso!=1){echo "<a href='".base_url()."hoja/impresion/".$id."/".$pagina."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";}else{echo "<a href='".base_url()."hoja2/impresion/".$id."/".$pagina."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";} ?>
                                        <br />
                                        Forma de Pago : //<?php echo $forma_pago->forma_pago?> 
                                        <!--<a href="<?php //echo base_url()?>hoja/forma_pago/<?php //echo $id?>/<?php //echo $pagina?>" class="fancybox fancybox.ajax"><img src="<?php //echo base_url()?>public/frontend/images/edit.png" class="img_16" /></a>-->
                                        <?php if($hoja->impreso!=1){echo "<a href='".base_url()."hoja/forma_pago/".$id."/".$pagina."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";}else{echo "<a href='".base_url()."hoja2/forma_pago/".$id."/".$pagina."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";} ?>
                                        <br />
                                        <br />
                                        Molde : //<?php echo $moldeNombre?>  <?php if($trazadosing->numero!=""){echo $trazadosing->numero;}?> <!--
<a href="//<?php // echo base_url()?>hoja/moldes/<?php // echo $id?>/<?php // echo $pagina?>" class="fancybox fancybox.ajax"><img src="<?php // echo base_url()?>public/frontend/images/edit.png" class="img_16" /></a>
-->
                                        <?php
//                                    break;
                                    case 'Corrugado'://la misma
                                        $materialidad_1=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_placa1);
                                        $materialidad_2=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_onda2);
                                        $materialidad_3=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_liner3);
                                        $materialidad_4="No Aplica";
                                        $variable_cotizador=$this->variables_cotizador_model->getVariablesCotizadorPorId(24);
                                        $variable_cotizador2=$this->variables_cotizador_model->getVariablesCotizadorPorId(40);
                                        $base_imprenta=$this->variables_cotizador_model->getVariablesCotizadorPorId(6);
                                        $formula=$materialidad_1->gramaje+($materialidad_1->gramaje*($variable_cotizador->precio/100))+$materialidad_3->gramaje;
                                        //echo $materialidad_2->gramaje."sss";exit;
                                        echo $materialidad_3->tipo;
                                        
                                        if (($materialidad_2->precio>0) && ($materialidad_3->gramaje>0) && ($materialidad_3->precio>0)){
                                           $costo_kilo=((($materialidad_2->gramaje*($materialidad_2->precio/1000)+(($materialidad_2->gramaje*($variable_cotizador->precio/100)*$materialidad_2->precio/1000))+$materialidad_3->gramaje*$materialidad_3->precio/1000)/($materialidad_2->gramaje+($materialidad_2->gramaje*($variable_cotizador->precio/100))+$materialidad_3->gramaje)))*1000;           
                                        }else{ 
                                        $costo_kilo=0;                                        }
                                        if($materialidad_3->tipo == 14 &&  $materialidad_3->reverso == 'Blanca')//valdivia
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(44);
                                        }
                                        if($materialidad_3->tipo == 15 &&  $materialidad_3->reverso == 'Blanca')//maule
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(45);
                                        }
                                        if($materialidad_3->tipo == 1 &&  $materialidad_3->reverso == 'Blanca') //Cartulina Importada
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(43);
                                        }
                                        if($materialidad_3->tipo == 5 &&  $materialidad_3->reverso == 'Blanco') // papel reverso blanco
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(42);
                                        }
                                        if($materialidad_3->tipo == 3 &&  $materialidad_3->reverso == 'Blanco') // papel reverso blanco/ white top
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(42);
                                        }
                                        if($materialidad_3->tipo == 4 && ($materialidad_3->reverso == 'Café' || $materialidad_3->reverso == 'Cafe')) // papel reverso cafe
                                        {
                                              $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(41);
                                        }
                                       
                                        $costo_kilo=$costo_kilo+$recargoCostoKilo->precio;
                                        
                                        if($fotomecanica->fot_lleva_barniz=='Nada' || $fotomecanica->fot_lleva_barniz=='')
                                        {
                                            $barniz2=0;
                                        }else
                                        {
                                            $barniz2=1;
                                        }
                                  
                                        if($maquina=="Máquina Roland 800")
                                         {
                                            $tira1=((($datoscantidad1/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio )*($fotomecanica->colores+$barniz2);
                                            $recargo800Array=$this->variables_cotizador_model->getVariablesCotizadorPorId(34);
                                            $tira2=((($datoscantidad1/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio)*($fotomecanica->colores+$barniz2)*(1*$recargo800Array->precio/100);
                                            $tiraje=$tira1+$tira2;

                                         }else
                                         {
                                            $tiraje=((($datoscantidad1/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio )*($fotomecanica->colores+$barniz2);  
                                          
                                         }    
                                        if  (($materialidad_2->gramaje>0) and ($materialidad_3->gramaje>0)) 
                                            $GramosMetroCuadrado=$materialidad_2->gramaje+($materialidad_2->gramaje*($variable_cotizador->precio/100))+$materialidad_3->gramaje;
                                        else
                                            $GramosMetroCuadrado=0;
                                        $recargoGramosDeAlmidon=$this->variables_cotizador_model->getVariablesCotizadorPorId(30);
                                        $GramosMetroCuadrado=$GramosMetroCuadrado+$recargoGramosDeAlmidon->precio;
										
					if(sizeof($hoja)>=1)
                                        {
                                            $arreglo54=array
                                                (
                                                    "gramos_metro_cuadrado"=>$GramosMetroCuadrado,
                                                );
                                                $this->db->where('id', $hoja->id);
                                                $this->db->update("hoja_de_costos_datos",$arreglo54);
                                        }
                                        if (($materialidad_2->gramaje>0) and ($materialidad_3->gramaje>0) and ($materialidad_2->precio>0))
                                            $costoMonotapaPorMetro2=$materialidad_2->gramaje*($materialidad_2->precio/1000)+(($materialidad_2->gramaje*($variable_cotizador->precio/100)*$materialidad_2->precio/1000)+$materialidad_3->gramaje*$materialidad_3->precio/1000);
                                        else
                                            $costoMonotapaPorMetro2=0;

                                       
                                       switch($fotomecanica->estan_los_moldes)
                                       {
                                          case 'NO':
                                            $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Nuevo</strong>)";
                                          break;
                                          case 'MOLDE GENERICO':
                                            if ($orden->id_molde!='')  
                                                $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            else
                                                $molde=$this->moldes_model->getMoldesPorId($datos->numero_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Antiguo</strong>)";
                                          break;
                                          case 'MOLDE REGISTRADOS DEL CLIENTE':
                                            if ($orden->id_molde!='')  
                                                $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            else
                                                $molde=$this->moldes_model->getMoldesPorId($datos->numero_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Antiguo</strong>)";
                                          break;                                          
                                          case 'NO LLEVA':
                                            $moldeNombre="<strong>NO ESTA MOLDE, PRODUCTO NO FABRICADO ANTERIORMENTE</strong>";
                                          break;
                                          case 'CLIENTE LO APORTA':
                                            $moldeNombre="<strong>CLIENTE LO APORTA</strong>";
                                          break;
                                       }                                       
                                       
                                       
                                       
                                        $tapaNombre=$materialidad_1->nombre;
                                        $tapaGramaje=$materialidad_1->gramaje;
                                        $tapaFecha=$materialidad_1->fecha_ultima_actualizacion;
                                        $tapaPrecio=$materialidad_1->precio;
                                        $ondaNombre=$materialidad_2->nombre;
                                        $ondaGramaje=$materialidad_2->gramaje;
                                        $ondaFecha=$materialidad_2->fecha_ultima_actualizacion;
                                        $ondaPrecio=$materialidad_2->precio;
                                        $linerNombre=$materialidad_3->nombre;
                                        $linerGramaje=$materialidad_3->gramaje;
                                        $linerFecha=$materialidad_3->fecha_ultima_actualizacion;
                                        $linerPrecio=$materialidad_3->precio;                      
                                        ?>
					<!--<a href="<?php// echo base_url()?>hoja/materialidad/<?php //echo $id?>/<?php //echo $pagina?>" class="fancybox fancybox.ajax"><img src="<?php //echo base_url()?>public/frontend/images/edit.png" class="img_16" /></a>-->
                                        <?php if($hoja->impreso!=1){echo "<a href='".base_url()."hoja/materialidad/".$id."/".$pagina."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";}else{echo "<a href='".base_url()."hoja2/materialidad/".$id."/".$pagina."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";} ?>
                                        <br />
                                        <span>Datos técnicos: </span> Corrugado
                                        <br />
                                        <span>Tapa: </span> <?php echo $fotomecanica->materialidad_1?>  (<?php echo "Id: ".$fotomecanica->id_mat_placa1; ?>)/ <strong>Gramaje:</strong> <?php echo $materialidad_1->gramaje?> / <strong>Precio:</strong> <?php echo $materialidad_1->precio?> / <strong>Reverso:</strong> <?php echo $materialidad_1->reverso?>
                                        <br />
                                        <?php $monda = $this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_onda2) ?>
                                        <span>Onda: </span> <?php echo  $monda->materiales_tipo ?>  (<?php echo "Id: ".$fotomecanica->id_mat_onda2; ?>)/ <strong>Gramaje:</strong> <?php echo $materialidad_2->gramaje?> / <strong>Precio:</strong> <?php echo $materialidad_2->precio?> / <strong>Reverso:</strong> <?php echo $materialidad_2->reverso?>
                                        <br />
                                        <?php $mliner = $this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_liner3) ?>
                                        <span>Liner: </span> <?php echo $mliner->materiales_tipo ?>  (<?php echo "Id: ".$fotomecanica->id_mat_liner3; ?>)/ <strong>Gramaje:</strong> <?php echo $materialidad_3->gramaje?> / <strong>Precio:</strong> <?php echo $materialidad_3->precio?> / <strong>Reverso:</strong> <?php echo $materialidad_3->reverso?>
                                        <br />
                                       <!-- GR/ONDA <?php //echo $formula?>
                                        <br /> -->
                                        COSTO MONOTAPA POR KILO: <?php echo number_format($costo_kilo,0,'','.')?> &nbsp; GRAMOS ONDA M2 <?php echo $GramosMetroCuadrado?> &nbsp; COSTO MONOTAPA POR M2 <?php echo $costoMonotapaPorMetro2?>
                                        <br />
                                        IMPRESIÓN : <?php echo $fotomecanica->impresion?>
                                        <br >
                                        Molde : <?php echo $moldeNombre?>  <?php if($trazadosing->numero!=""){echo $trazadosing->numero;}?>
                                        <?php
                                    break;
                                    case 'Cartulina-cartulina': //Cartulina cartulina
                                        $materialidad_1=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_placa1);
                                        $materialidad_2=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_onda2);
                                        $materialidad_3=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_liner3);
                                        //$materialidad_3="No Aplica";;
                                        $materialidad_4="No Aplica";
                                        $variable_cotizador=$this->variables_cotizador_model->getVariablesCotizadorPorId(24);
                                        $variable_cotizador2=$this->variables_cotizador_model->getVariablesCotizadorPorId(40);
                                        $base_imprenta=$this->variables_cotizador_model->getVariablesCotizadorPorId(6);
                                        if (($materialidad_2->precio>0) and ($materialidad_2->gramaje>0) and ($variable_cotizador->precio>0))
                                            $costo_kilo=((($materialidad_2->gramaje*($materialidad_2->precio/1000)+(($materialidad_2->gramaje*($variable_cotizador->precio/100)*$materialidad_2->precio/1000))+0*0/1000)/($materialidad_2->gramaje+($materialidad_2->gramaje*($variable_cotizador->precio/100))+0)))*1000;     
                                        else 
                                            $costo_kilo=0;
                                        $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(40);
                                        $costo_kilo=$costo_kilo+$recargoCostoKilo->precio;
                                        if($fotomecanica->fot_lleva_barniz=='' || $fotomecanica->fot_lleva_barniz=='Nada')
                                        {
                                            $barniz2=0;
                                        }else
                                        {
                                            $barniz2=1;
                                        }

                                        if($maquina=="Máquina Roland 800")
                                         {
                                        $tira1=((($datoscantidad1/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio )*($fotomecanica->colores+$barniz2);
                                            $recargo800Array=$this->variables_cotizador_model->getVariablesCotizadorPorId(34);
                                        $tira2=((($datoscantidad1/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio)*($fotomecanica->colores+$barniz2)*(1*$recargo800Array->precio/100);
                                            $tiraje=$tira1+$tira2;
                                            
                                         }else
                                         {
                                            $tiraje=((($datoscantidad1/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio )*($fotomecanica->colores+$barniz2);  
                                          
                                         }    
                                        if  ($materialidad_2->gramaje>0) 
                                            $GramosMetroCuadrado=$materialidad_2->gramaje+($materialidad_2->gramaje*($variable_cotizador->precio/100))+0;
                                        else 
                                            $GramosMetroCuadrado=0;
                                        $recargoGramosDeAlmidon=$this->variables_cotizador_model->getVariablesCotizadorPorId(30);
                                        $GramosMetroCuadrado=$GramosMetroCuadrado+$recargoGramosDeAlmidon->precio;
                                        if  ($materialidad_2->gramaje>0) 
                                            $costoMonotapaPorMetro2=$materialidad_2->gramaje*($materialidad_2->precio/1000)+(($materialidad_2->gramaje*($variable_cotizador->precio/100)*$materialidad_2->precio/1000)+0*0/1000);
                                        else 
                                            $costoMonotapaPorMetro2=0;
                                         
                                        
                                       switch($fotomecanica->estan_los_moldes)
                                       {
                                          case 'NO':
                                            $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Nuevo</strong>)";
                                          break;
                                          case 'MOLDE GENERICO':
                                            if ($orden->id_molde!='')  
                                                $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            else
                                                $molde=$this->moldes_model->getMoldesPorId($datos->numero_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Antiguo</strong>)";
                                          break;
                                          case 'MOLDE REGISTRADOS DEL CLIENTE':
                                            if ($orden->id_molde!='')  
                                                $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            else
                                                $molde=$this->moldes_model->getMoldesPorId($datos->numero_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Antiguo</strong>)";
                                          break;                                          
                                          case 'NO LLEVA':
                                            $moldeNombre="<strong>NO ESTA MOLDE, PRODUCTO NO FABRICADO ANTERIORMENTE</strong>";
                                          break;
                                          case 'CLIENTE LO APORTA':
                                            $moldeNombre="<strong>CLIENTE LO APORTA</strong>";
                                          break;
                                       }                                        

                                        $tapaNombre=$materialidad_1->nombre;
                                        $tapaGramaje=$materialidad_1->gramaje;
                                        $tapaFecha=$materialidad_1->fecha_ultima_actualizacion;
                                        $tapaPrecio=$materialidad_1->precio;
										
                                        $tapaNombre2=$materialidad_2->nombre;
                                        $tapaGramaje2=$materialidad_2->gramaje;
                                        $tapaFecha2=$materialidad_2->fecha_ultima_actualizacion;
                                        $tapaPrecio2=$materialidad_2->precio;
                                        
                                        $tapaNombre3=$materialidad_3->nombre;
                                        $tapaGramaje3=$materialidad_3->gramaje;
                                        $tapaFecha3=$materialidad_3->fecha_ultima_actualizacion;
                                        $tapaPrecio3=$materialidad_3->precio;
                     
                                        ?>
                                        <span><strong>Datos técnicos: </strong> </span> Cartulina - Cartulina
                                        <br />
                                        <span><strong>Tapa: </strong> </span> <?php echo $fotomecanica->materialidad_1?>  (<?php echo "Id: ".$fotomecanica->id_mat_placa1; ?>)/ <strong>Gramaje:</strong> <?php echo $materialidad_1->gramaje?> / <strong>Precio:</strong> <?php echo $materialidad_1->precio?> / <strong>Reverso:</strong> <?php echo $materialidad_1->reverso?>
                                        <br />
                                        
                                        <span><strong>Tapa (Respaldo): </strong> </span> <?php echo $fotomecanica->materialidad_3?>  (<?php echo "Id: ".$fotomecanica->id_mat_liner3; ?>)/ <strong>Gramaje:</strong> <?php echo $materialidad_3->gramaje?> / <strong>Precio:</strong> <?php echo $materialidad_3->precio?> / <strong>Reverso:</strong> <?php echo $materialidad_3->reverso?>
                                        <!--<br />
                                        <?php //$mliner = $this->materiales_model->getMaterialesPorNombre($fotomecanica->id_mat_liner3) ?>
                                        <span>Liner: </span> <?php //echo $mliner->materiales_tipo ?> / <strong>Gramaje:</strong> <?php //echo $materialidad_3->gramaje?> / <strong>Precio:</strong> <?php //echo $materialidad_3->precio?>
                                        <br />
                                        GR/ONDA <?php echo $formula?> -->
                                        <br />
                                        IMPRESIÓN : <?php echo $fotomecanica->impresion?>
                                        <br >
                                        Molde : <?php echo $moldeNombre?>  <?php if($trazadosing->numero!=""){echo $trazadosing->numero;}?>
                                        <?php
                                        
                                    break;
                                    case 'Sólo Cartulina':
									
					$materialidad_1=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_placa1);
                                        $variable_cotizador=$this->variables_cotizador_model->getVariablesCotizadorPorId(24);
                                        $variable_cotizador2=$this->variables_cotizador_model->getVariablesCotizadorPorId(40);
                                        $base_imprenta=$this->variables_cotizador_model->getVariablesCotizadorPorId(6);
                                      
                                        $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(40);
                                        $costo_kilo=0;
                                        if($fotomecanica->fot_lleva_barniz=='' || $fotomecanica->fot_lleva_barniz=='Nada')
                                        {
                                            $barniz2=0;
                                        }else
                                        {
                                            $barniz2=1;
                                        }
                                        
                                        if($maquina=="Máquina Roland 800")
                                         {
                                            $tira1=((($datoscantidad1/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio )*($fotomecanica->colores+$barniz2);
                                            $recargo800Array=$this->variables_cotizador_model->getVariablesCotizadorPorId(34);
                                            $tira2=((($datoscantidad1/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio)*($fotomecanica->colores+$barniz2)*(1*$recargo800Array->precio/100);
                                            $tiraje=$tira1+$tira2;
  
                                         }else
                                         {
                                            $tiraje=((($datoscantidad1/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio )*($fotomecanica->colores+$barniz2);  
                                          
                                         }    
                                        if  ($materialidad_2->gramaje>0) 
                                            $GramosMetroCuadrado=$materialidad_2->gramaje+($materialidad_2->gramaje*($variable_cotizador->precio/100))+0;
                                        else 
                                            $GramosMetroCuadrado=0;
                                        $recargoGramosDeAlmidon=$this->variables_cotizador_model->getVariablesCotizadorPorId(30);
                                        
                                        $GramosMetroCuadrado=$GramosMetroCuadrado+$recargoGramosDeAlmidon->precio;
                                        if  ($materialidad_2->gramaje>0) 
                                            $costoMonotapaPorMetro2=$materialidad_2->gramaje*($materialidad_2->precio/1000)+(($materialidad_2->gramaje*($variable_cotizador->precio/100)*$materialidad_2->precio/1000)+0*0/1000);
                                        else 
                                            $costoMonotapaPorMetro2=0; 
                                                                             
                                       switch($fotomecanica->estan_los_moldes)
                                       {
                                          case 'NO':
                                            $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Nuevo</strong>)";
                                          break;
                                          case 'MOLDE GENERICO':
                                            if ($orden->id_molde!='')  
                                                $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            else
                                                $molde=$this->moldes_model->getMoldesPorId($datos->numero_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Antiguo</strong>)";
                                          break;
                                          case 'MOLDE REGISTRADOS DEL CLIENTE':
                                            if ($orden->id_molde!='')  
                                                $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            else
                                                $molde=$this->moldes_model->getMoldesPorId($datos->numero_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Antiguo</strong>)";
                                          break;                                          
                                          case 'NO LLEVA':
                                            $moldeNombre="<strong>NO ESTA MOLDE, PRODUCTO NO FABRICADO ANTERIORMENTE</strong>";
                                          break;
                                          case 'CLIENTE LO APORTA':
                                            $moldeNombre="<strong>CLIENTE LO APORTA</strong>";
                                          break;
                                       }                                        
                                        $tapaNombre=$materialidad_1->nombre;
                                        $tapaGramaje=$materialidad_1->gramaje;
                                        $tapaFecha=$materialidad_1->fecha_ultima_actualizacion;
                                        $tapaPrecio=$materialidad_1->precio;
										
                                        $tapaNombre2=$materialidad_2->nombre;
                                        $tapaGramaje2=$materialidad_2->gramaje;
                                        $tapaFecha2=$materialidad_2->fecha_ultima_actualizacion;
                                        $tapaPrecio2=$materialidad_2->precio;
                     
                                        ?>
                                        <span><strong>Datos técnicos: </strong> </span> Sólo Cartulina
                                        <br />
                                        <span><strong>Tapa: </strong> </span> <?php echo $fotomecanica->materialidad_1?>  (<?php echo "Id: ".$fotomecanica->id_mat_placa1; ?>)/ <strong>Gramaje:</strong> <?php echo $materialidad_1->gramaje?> / <strong>Precio:</strong> <?php echo $materialidad_1->precio?> / <strong>Reverso:</strong> <?php echo $materialidad_1->reverso?>
                                        <br />
                                        <span><strong>Tapa (Respaldo): </strong> </span> <?php echo $fotomecanica->materialidad_2?>  (<?php echo "Id: ".$fotomecanica->id_mat_onda2; ?>)/ <strong>Gramaje:</strong> <?php echo $materialidad_2->gramaje?> / <strong>Precio:</strong> <?php echo $materialidad_2->precio?> / <strong>Reverso:</strong> <?php echo $materialidad_2->reverso?>
                                        <!--<br />
                                        <?php //$mliner = $this->materiales_model->getMaterialesPorNombre($fotomecanica->id_mat_liner3) ?>
                                        <span>Liner: </span> <?php //echo $mliner->materiales_tipo ?> / <strong>Gramaje:</strong> <?php //echo $materialidad_3->gramaje?> / <strong>Precio:</strong> <?php //echo $materialidad_3->precio?>
                                        <br />
                                        GR/ONDA <?php echo $formula?> -->
                                        <br />
                                        IMPRESIÓN : <?php echo $fotomecanica->impresion?>
                                        <br >
                                        Molde : <?php echo $moldeNombre?>  <?php if($trazadosing->numero!=""){echo $trazadosing->numero;}?>
                                        <?php	
                                    break;
                                    case 'Se solicita proposición':
                                        
                                    break;
                                  }  
                                ?>
                 </td>
                <td class="celda_5 valign_top">
                    <!--trabajos externos-->
                    <table border="1">
                            <tr>
                                <td class="celda_5" colspan="10"><strong>&nbsp;&nbsp;Trabajos Externos</strong></td>
                                <td class="celda_5" >&nbsp;Unidad de Uso&nbsp;</td>                                                
                                <td class="celda_5" >&nbsp;Cantidad&nbsp;</td>
                                <td class="celda_5" >&nbsp;Ancho&nbsp;</td>
                                <td class="celda_5" >&nbsp;Largo&nbsp;</td>
                                <td class="celda_5" >&nbsp;M2&nbsp;</td>
                                <td class="celda_5" >&nbsp;V. Unit.M2&nbsp;</td>												
                                <td class="celda_5" >&nbsp;C. Unit&nbsp;</td>
                                <td class="celda_5" >&nbsp;Unid.P&nbsp;</td>
                                <td class="celda_5" >&nbsp;Total&nbsp;</td>                                                
                            </tr>
                                         
               <?php
                                $cantidad_4=0;
                                $externos_produccion=0;
                             //    exit($fotomecanica->acabado_impresion_4."hollaaa");
				if($fotomecanica->acabado_impresion_4=="1700")
                                {
                                    $acabado_4="";
                                    $acabado_4Valor="";
                                    $acabado_4MedidaMasValorVenta="";
                                    $acabado_4Unitario="";
                                    $acabado_4UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_4Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_4);
                                    $acabado_4=$acabado_4Array->caracteristicas; // Nombre acabado
                                    $acabado_4UnidadVentaNombre=$acabado_4Array->unv; //Nombre unidad de venta
                                    $acabado_4Valor=$acabado_4Array->valor_venta; // ej: 52
                                    $acabado_4MedidaMasValorVenta=($tamano1*$tamano2*$acabado_4Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_4CostoFijo=$acabado_4Array->costo_fijo;	
								
                                   // echo "<h1>" . $acabado_4Array->unidad_de_venta . "</h1>";
                                    if ($acabado_4Array->unidad_de_venta == '1') //Metros
                                    {
                                        $costo_unitario4=$acabado_4MedidaMasValorVenta;
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad1);
                                        $cantidad_4=$datoscantidad1;
                                    }
                                    elseif ($acabado_4Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $costo_unitario4=$acabado_4Valor;
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }  
                                    elseif ($acabado_4Array->unidad_de_venta == '3') //tONELADA
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad1);
                                    }                                    
                                    elseif ($acabado_4Array->unidad_de_venta == '4') //caja de carton
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad1);
                                    }                                            
                                    elseif ($acabado_4Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($datoscantidad1*$acabado_4Valor);
                                        $cantidad_4=$datoscantidad1;
                                    }       
                                    elseif ($acabado_4Array->unidad_de_venta == '6') //cm2
                                    {
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $costo_unitario4=$acabado_4Valor;     
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }   
                                    elseif ($acabado_4Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario4=$acabado_4MedidaMasValorVenta/$ing->unidades_por_pliego;
                                        $precio_total_4=($acabado_4MedidaMasValorVenta/$ing->unidades_por_pliego)*$datoscantidad1;
                                        $cantidad_4=$datoscantidad1;
                                    }
                                    elseif ($acabado_4Array->unidad_de_venta == '8') //cms
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad1);
                                    }           
                                    elseif ($acabado_4Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }     
                                    elseif ($acabado_4Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($acabado_4Valor*$datoscantidad1);
                                        $cantidad_4=$datoscantidad1;                                        
                                    }
                                    
                                }
                                
                                if($fotomecanica->acabado_impresion_5=="1700")
                                {
                                    $acabado_5="";
                                    $acabado_5Valor="";
                                    $acabado_5MedidaMasValorVenta="";
                                    $acabado_5Unitario="";
                                    $acabado_5UnidadVentaNombre="";
                                }else
                                {                                    
                                    $acabado_5Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_5);
                                    $acabado_5=$acabado_5Array->caracteristicas;
                                    $acabado_5UnidadVentaNombre=$acabado_5Array->unv; //Nombre unidad de venta
                                    $acabado_5Valor=$acabado_5Array->valor_venta; // ej: 52
                                    $acabado_5MedidaMasValorVenta=($tamano1*$tamano2*$acabado_5Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_5CostoFijo=$acabado_5Array->costo_fijo;		
                                  if ($acabado_5Array->unidad_de_venta == '1') //mt2
                                    {
                                        $costo_unitario5=$acabado_5MedidaMasValorVenta;
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad1);                                      
                                        $cantidad_5=$datoscantidad1;
                                    }
                                    elseif ($acabado_5Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $costo_unitario5=$acabado_5Valor; 
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }    
                                    elseif ($acabado_5Array->unidad_de_venta == '3') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad1);
                                    }                                    
                                    elseif ($acabado_5Array->unidad_de_venta == '4') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad1);
                                    }                                            
                                    elseif ($acabado_5Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($datoscantidad1*$acabado_5Valor);
                                        $cantidad_5=$datoscantidad1;
                                    }       
                                    elseif ($acabado_5Array->unidad_de_venta == '6') //mt2
                                    {
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $costo_unitario5=$acabado_5Valor;
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }   
                                    elseif ($acabado_5Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario5=$acabado_5MedidaMasValorVenta/$ing->unidades_por_pliego;
                                        $precio_total_5=($acabado_5MedidaMasValorVenta/$ing->unidades_por_pliego)*$datoscantidad1;
                                        $cantidad_5=$datoscantidad1;
                                    }
                                    elseif ($acabado_5Array->unidad_de_venta == '8') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad1);
                                    }           
                                    elseif ($acabado_5Array->unidad_de_venta == '9') //Monto Fijo 
                                    { 
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        //$precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $precio_total_5=$acabado_5Valor;
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }   
                                    elseif ($acabado_5Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($acabado_5Valor*$datoscantidad1);
                                        $cantidad_5=$datoscantidad1;
                                    }                                      
                                }    
                                
                                if($fotomecanica->acabado_impresion_6=="1700")
                                {
                                    $acabado_6="";
                                    $acabado_6Valor="";
                                    $acabado_6MedidaMasValorVenta="";
                                    $acabado_6Unitario="";
                                    $acabado_6UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_6Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_6);
                                    $acabado_6=$acabado_6Array->caracteristicas;
                                    $acabado_6UnidadVentaNombre=$acabado_6Array->unv; //Nombre unidad de venta
                                    $acabado_6Valor=$acabado_6Array->valor_venta; // ej: 52
                                    $acabado_6MedidaMasValorVenta=($tamano1*$tamano2*$acabado_6Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_6CostoFijo=$acabado_6Array->costo_fijo;		
                                    //echo "<h1>" . $acabado_6MedidaMasValorVenta . "</h1>";exit();
                                    if ($acabado_6Array->unidad_de_venta == '1') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad1);
                                    }
                                    elseif ($acabado_6Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $costo_unitario6=$acabado_6Valor; 
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    }  
                                    elseif ($acabado_6Array->unidad_de_venta == '3') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad1);
                                    }                                    
                                    elseif ($acabado_6Array->unidad_de_venta == '4') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad1);
                                    }                                            
                                    elseif ($acabado_6Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($datoscantidad1*$acabado_6Valor);
                                        $cantidad_6=$datoscantidad1;
                                    }       
                                    elseif ($acabado_6Array->unidad_de_venta == '6') //mt2
                                    {
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $costo_unitario6=$acabado_6Valor;
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    }   
                                    elseif ($acabado_6Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario6=$acabado_6MedidaMasValorVenta/$ing->unidades_por_pliego;
                                        $precio_total_6=($acabado_6MedidaMasValorVenta/$ing->unidades_por_pliego)*$datoscantidad1;
                                        $cantidad_6=$datoscantidad1;
                                    }
                                    elseif ($acabado_6Array->unidad_de_venta == '8') //cms
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad1);
                                    }           
                                    elseif ($acabado_6Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    } 
                                    elseif ($acabado_6Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($acabado_6Valor*$datoscantidad1);
                                        $cantidad_6=$datoscantidad1;
                                    }                                      

                                } 
                    
               ?>
               <?php if($procesosespeciales>0 && $tesp1 != 0){ ?>
               <tr>
                    <td class="celda_5" colspan="10">&nbsp;&nbsp;<?php echo str_replace("�", "ñ", ucwords(strtolower($folia1->caracteristicas)));?>&nbsp;</td>
                    <td class="celda_5">&nbsp;<?php echo $folia1->unv ?>&nbsp;</td>
                    <td class="celda_5">&nbsp;<?php  echo $datoscantidad1; ?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php  echo $folia1->ancho; ?>&nbsp;</td>
                    <td class="celda_5">&nbsp;<?php  echo $folia1->largo; ?>&nbsp;</td>
                    <td class="celda_5">&nbsp;&nbsp;</td>												
                    <td class="celda_3">&nbsp;<?php  echo $folia1->valor_venta; ?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php  if(str_replace("�", "ñ", ucwords(strtolower($folia1->caracteristicas)))=="Folia (golpe)"){echo $folia1->valor_venta/$ing->unidades_por_pliego; }else{echo $folia1->valor_venta; } ?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php echo $ing->unidades_por_pliego ?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php  if($folia1->unidad_de_venta==5){$costo1=($folia1->valor_venta/$ing->unidades_por_pliego)*$datoscantidad1;}else{if($folia1->unidad_de_venta==9){$costo1=$folia1->valor_venta;}else{$costo1=$folia1->valor_venta*$datoscantidad1;}} echo number_format($costo1,0,'','.');  ?>&nbsp;</td></tr>
                
               <?php } ?>        
               <?php if($procesosespeciales>0 && sizeof($cffolia1) > 0){ ?>
               <tr>
                    <td class="celda_5" colspan="10">&nbsp;&nbsp;<?php echo str_replace("�", "ñ", ucwords(strtolower($cffolia1->caracteristicas)));?>&nbsp;</td>
                    <td class="celda_5">&nbsp;<?php echo $cffolia1->unv ?>&nbsp;</td>
                    <td class="celda_5">&nbsp;<?php  echo $datoscantidad1; ?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php  echo $cffolia1->ancho; ?>&nbsp;</td>
                    <td class="celda_5">&nbsp;<?php  echo $cffolia1->largo; ?>&nbsp;</td>
                    <td class="celda_5">&nbsp;&nbsp;</td>												
                    <td class="celda_3">&nbsp;<?php  echo $cffolia1->valor_venta; ?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php  if(str_replace("�", "ñ", ucwords(strtolower($cffolia1->caracteristicas)))=="Folia (golpe)"){echo $cffolia1->valor_venta/$ing->unidades_por_pliego; }else{if(str_replace("�", "ñ", ucwords(strtolower($cffolia1->caracteristicas)))=="Cuno Pasada"){echo $cffolia1->valor_venta/$ing->unidades_por_pliego; }else{echo $cffolia1->valor_venta;}} ?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php echo $ing->unidades_por_pliego ?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php  if($cffolia1->unidad_de_venta==5){$costo11=($cffolia1->valor_venta/$ing->unidades_por_pliego)*$datoscantidad1;}else{if($cffolia1->unidad_de_venta==9){$costo11=$cffolia1->valor_venta;}else{$costo11=$cffolia1->valor_venta*$datoscantidad1;}} echo number_format($costo11,0,'','.');  ?>&nbsp;</td></tr>
                
               <?php } ?>        
               <?php if($procesosespeciales>0 && $tesp2 != 0){ ?>
               <tr>
                    <td class="celda_5" colspan="10">&nbsp;&nbsp;<?php echo str_replace("�", "ñ", ucwords(strtolower($folia2->caracteristicas)));?>&nbsp;</td>
                    <td class="celda_5">&nbsp;<?php echo $folia2->unv ?>&nbsp;</td>
                    <td class="celda_5">&nbsp;<?php  echo $datoscantidad1; ?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php  echo $folia2->ancho; ?>&nbsp;</td>
                    <td class="celda_5">&nbsp;<?php  echo $folia2->largo; ?>&nbsp;</td>
                    <td class="celda_5">&nbsp;&nbsp;</td>												
                    <td class="celda_3">&nbsp;<?php  echo $folia2->valor_venta; ?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php  if(str_replace("�", "ñ", ucwords(strtolower($folia2->caracteristicas)))=="Folia (golpe)"){echo $folia2->valor_venta/$ing->unidades_por_pliego; }else{echo $folia2->valor_venta; } ?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php echo $ing->unidades_por_pliego?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php  if($folia1->unidad_de_venta==5){$costo2=($folia2->valor_venta/$ing->unidades_por_pliego)*$datoscantidad1;}else{if($folia2->unidad_de_venta==9){$costo2=$folia2->valor_venta;}else{$costo2=$folia2->valor_venta*$datoscantidad1;}}  ?>&nbsp;</td></tr>
               <?php } ?>
               <?php if($procesosespeciales>0 && sizeof($cffolia2) > 0){ ?>
               <tr>
                    <td class="celda_5" colspan="10">&nbsp;&nbsp;<?php echo str_replace("�", "ñ", ucwords(strtolower($cffolia2->caracteristicas)));?>&nbsp;</td>
                    <td class="celda_5">&nbsp;<?php echo $cffolia2->unv ?>&nbsp;</td>
                    <td class="celda_5">&nbsp;<?php  echo $datoscantidad1; ?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php  echo $cffolia2->ancho; ?>&nbsp;</td>
                    <td class="celda_5">&nbsp;<?php  echo $cffolia2->largo; ?>&nbsp;</td>
                    <td class="celda_5">&nbsp;&nbsp;</td>												
                    <td class="celda_3">&nbsp;<?php  echo $cffolia2->valor_venta; ?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php  if(str_replace("�", "ñ", ucwords(strtolower($cffolia2->caracteristicas)))=="Folia (golpe)"){echo $cffolia2->valor_venta/$ing->unidades_por_pliego; }else{if(str_replace("�", "ñ", ucwords(strtolower($cffolia2->caracteristicas)))=="Cuno Pasada"){echo $cffolia2->valor_venta/$ing->unidades_por_pliego; }else{echo $cffolia2->valor_venta;}} ?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php echo $ing->unidades_por_pliego ?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php  if($cffolia2->unidad_de_venta==5){$costo12=($cffolia2->valor_venta/$ing->unidades_por_pliego)*$datoscantidad1;}else{if($cffolia2->unidad_de_venta==9){$costo12=$cffolia2->valor_venta;}else{$costo12=$cffolia2->valor_venta*$datoscantidad1;}} echo number_format($costo12,0,'','.');  ?>&nbsp;</td></tr>
                
               <?php } ?>     
               <?php if($procesosespeciales>0 && $tesp3 != 0){ ?>
               <tr>
                    <td class="celda_5" colspan="10">&nbsp;&nbsp;<?php echo str_replace("�", "ñ", ucwords(strtolower($folia3->caracteristicas)));?>&nbsp;</td>
                    <td class="celda_5">&nbsp;<?php echo $folia3->unv ?>&nbsp;</td>
                    <td class="celda_5">&nbsp;<?php  echo $datoscantidad1; ?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php  echo $folia3->ancho; ?>&nbsp;</td>
                    <td class="celda_5">&nbsp;<?php  echo $folia3->largo; ?>&nbsp;</td>
                    <td class="celda_5">&nbsp;&nbsp;</td>												
                    <td class="celda_3">&nbsp;<?php  echo $folia3->valor_venta; ?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php  if(str_replace("�", "ñ", ucwords(strtolower($folia3->caracteristicas)))=="Folia (golpe)"){echo $folia3->valor_venta/$ing->unidades_por_pliego; }else{echo $folia3->valor_venta; } ?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php echo $ing->unidades_por_pliego?>&nbsp;</td>                   
                    <td class="celda_3">&nbsp;<?php  if($folia3->unidad_de_venta==5){$costo3=($folia3->valor_venta/$ing->unidades_por_pliego)*$datoscantidad1;}else{if($folia3->unidad_de_venta==9){$costo3=$folia3->valor_venta;}else{$costo3=$folia3->valor_venta*$datoscantidad1;}}  ?>&nbsp;</td></tr>
               <?php } ?>
               <?php if($procesosespeciales>0 && sizeof($cffolia3) > 0){ ?>
               <tr>
                    <td class="celda_5" colspan="10">&nbsp;&nbsp;<?php echo str_replace("�", "ñ", ucwords(strtolower($cffolia3->caracteristicas)));?>&nbsp;</td>
                    <td class="celda_5">&nbsp;<?php echo $cffolia3->unv ?>&nbsp;</td>
                    <td class="celda_5">&nbsp;<?php  echo $datoscantidad1; ?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php  echo $cffolia3->ancho; ?>&nbsp;</td>
                    <td class="celda_5">&nbsp;<?php  echo $cffolia3->largo; ?>&nbsp;</td>
                    <td class="celda_5">&nbsp;&nbsp;</td>												
                    <td class="celda_3">&nbsp;<?php  echo $cffolia3->valor_venta; ?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php  if(str_replace("�", "ñ", ucwords(strtolower($cffolia3->caracteristicas)))=="Folia (golpe)"){echo $cffolia3->valor_venta/$ing->unidades_por_pliego; }else{if(str_replace("�", "ñ", ucwords(strtolower($cffolia3->caracteristicas)))=="Cuno Pasada"){echo $cffolia3->valor_venta/$ing->unidades_por_pliego; }else{echo $cffolia3->valor_venta;}} ?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php echo $ing->unidades_por_pliego ?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php  if($cffolia3->unidad_de_venta==5){$costo13=($cffolia3->valor_venta/$ing->unidades_por_pliego)*$datoscantidad1;}else{if($cffolia3->unidad_de_venta==9){$costo13=$cffolia3->valor_venta;}else{$costo13=$cffolia3->valor_venta*$datoscantidad1;}} echo number_format($costo13,0,'','.');  ?>&nbsp;</td></tr>
                
               <?php } ?> 
               <?php if($procesosespeciales>0 && $tesp4 != 0){ ?>
               <tr>
                    <td class="celda_5" colspan="10">&nbsp;&nbsp;<?php echo str_replace("�", "ñ", ucwords(strtolower($cuno1->caracteristicas)));?>&nbsp;</td>
                    <td class="celda_5">&nbsp;<?php echo $cuno1->unv ?>&nbsp;</td>
                    <td class="celda_5">&nbsp;<?php echo $datoscantidad1; ?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php  echo $cuno1->ancho; ?>&nbsp;</td>
                    <td class="celda_5">&nbsp;<?php  echo $cuno1->largo; ?>&nbsp;</td>
                    <td class="celda_5">&nbsp;&nbsp;</td>												
                    <td class="celda_3">&nbsp;<?php  echo $cuno1->valor_venta; ?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php  if(str_replace("�", "ñ", ucwords(strtolower($cuno1->caracteristicas)))=="Folia (golpe)"){echo $cuno1->valor_venta/$ing->unidades_por_pliego; }else{echo $cuno1->valor_venta; } ?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php echo $ing->unidades_por_pliego?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php  if($cuno1->unidad_de_venta==5){$costo4=($cuno1->valor_venta/$ing->unidades_por_pliego)*$datoscantidad1;}else{if($cuno1->unidad_de_venta==9){$costo4=$cuno1->valor_venta;}else{$costo4=$cuno1->valor_venta*$datoscantidad1;}}  ?>&nbsp;</td></tr>
               <?php } ?>        
               <?php if($procesosespeciales>0 && sizeof($cfcuno1) > 0){ ?>
               <tr>
                    <td class="celda_5" colspan="10">&nbsp;&nbsp;<?php echo str_replace("�", "ñ", ucwords(strtolower($cfcuno1->caracteristicas)));?>&nbsp;</td>
                    <td class="celda_5">&nbsp;<?php echo $cfcuno1->unv ?>&nbsp;</td>
                    <td class="celda_5">&nbsp;<?php  echo $datoscantidad1; ?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php  echo $cfcuno1->ancho; ?>&nbsp;</td>
                    <td class="celda_5">&nbsp;<?php  echo $cfcuno1->largo; ?>&nbsp;</td>
                    <td class="celda_5">&nbsp;&nbsp;</td>												
                    <td class="celda_3">&nbsp;<?php  echo $cfcuno1->valor_venta; ?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php  if(str_replace("�", "ñ", ucwords(strtolower($cfcuno1->caracteristicas)))=="Folia (golpe)"){echo $cfcuno1->valor_venta/$ing->unidades_por_pliego; }else{if(str_replace("�", "ñ", ucwords(strtolower($cfcuno1->caracteristicas)))=="Cuno Pasada"){echo $cfcuno1->valor_venta/$ing->unidades_por_pliego; }else{echo $cfcuno1->valor_venta;}} ?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php echo $ing->unidades_por_pliego ?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php  if($cfcuno1->unidad_de_venta==5){$costo14=($cfcuno1->valor_venta/$ing->unidades_por_pliego)*$datoscantidad1;}else{if($cfcuno1->unidad_de_venta==9){$costo14=$cfcuno1->valor_venta;}else{$costo14=$cfcuno1->valor_venta*$datoscantidad1;}} echo number_format($costo14,0,'','.');  ?>&nbsp;</td></tr>
                
               <?php } ?> 
               <?php if($procesosespeciales>0 && $tesp5 != 0){ ?>
               <tr>
                    <td class="celda_5" colspan="10">&nbsp;&nbsp;<?php echo str_replace("�", "ñ", ucwords(strtolower($cuno2->caracteristicas)));?>&nbsp;</td>
                    <td class="celda_5">&nbsp;<?php echo $cuno2->unv ?>&nbsp;</td>
                    <td class="celda_5">&nbsp;<?php echo $datoscantidad1; ?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php  echo $cuno2->ancho; ?>&nbsp;</td>
                    <td class="celda_5">&nbsp;<?php  echo $cuno2->largo; ?>&nbsp;</td>
                    <td class="celda_5">&nbsp;&nbsp;</td>												
                    <td class="celda_3">&nbsp;<?php  echo $cuno2->valor_venta; ?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php  echo $cuno2->valor_venta; ?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php echo $ing->unidades_por_pliego?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php  if($cuno2->unidad_de_venta==5){$costo5=($cuno2->valor_venta/$ing->unidades_por_pliego)*$datoscantidad1;}else{if($cuno2->unidad_de_venta==9){$costo5=$cuno2->valor_venta;}else{$costo5=$cuno2->valor_venta*$datoscantidad1;}}  ?>&nbsp;</td></tr>
               <?php } ?>        
               <?php if($procesosespeciales>0 && sizeof($cfcuno2) > 0){ ?>
               <tr>
                    <td class="celda_5" colspan="10">&nbsp;&nbsp;<?php echo str_replace("�", "ñ", ucwords(strtolower($cfcuno2->caracteristicas)));?>&nbsp;</td>
                    <td class="celda_5">&nbsp;<?php echo $cfcuno2->unv ?>&nbsp;</td>
                    <td class="celda_5">&nbsp;<?php  echo $datoscantidad1; ?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php  echo $cfcuno2->ancho; ?>&nbsp;</td>
                    <td class="celda_5">&nbsp;<?php  echo $cfcuno2->largo; ?>&nbsp;</td>
                    <td class="celda_5">&nbsp;&nbsp;</td>												
                    <td class="celda_3">&nbsp;<?php  echo $cfcuno2->valor_venta; ?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php  if(str_replace("�", "ñ", ucwords(strtolower($cfcuno2->caracteristicas)))=="Folia (golpe)"){echo $cfcuno2->valor_venta/$ing->unidades_por_pliego; }else{if(str_replace("�", "ñ", ucwords(strtolower($cfcuno2->caracteristicas)))=="Cuno Pasada"){echo $cfcuno2->valor_venta/$ing->unidades_por_pliego; }else{echo $cfcuno2->valor_venta;}} ?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php echo $ing->unidades_por_pliego ?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php  if($cfcuno2->unidad_de_venta==5){$costo15=($cfcuno2->valor_venta/$ing->unidades_por_pliego)*$datoscantidad1;}else{if($cfcuno2->unidad_de_venta==9){$costo15=$cfcuno2->valor_venta;}else{$costo15=$cfcuno2->valor_venta*$datoscantidad1;}} echo number_format($costo15,0,'','.');  ?>&nbsp;</td></tr>
                
               <?php } ?>        
               <tr>
                    <td class="celda_5" colspan="10">&nbsp;&nbsp;<?php echo str_replace("�", "ñ", ucwords(strtolower($acabado_4)));?>&nbsp;</td>
                    <td class="celda_5">&nbsp;<?php echo $acabado_4UnidadVentaNombre?>&nbsp;</td>
                    <td class="celda_5">&nbsp;<?php  if ($cantidad_4!="") echo $cantidad_4; ?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php  if ($acabado_4UnidadVentaNombre!="") echo $tamano1; else echo ""; ?>&nbsp;</td>
                    <td class="celda_5">&nbsp;<?php  if ($acabado_4UnidadVentaNombre!="") echo $tamano2; else echo ""; ?>&nbsp;</td>
                    <td class="celda_5">&nbsp;<?php  if ($acabado_4UnidadVentaNombre!="") echo (($tamano1*$tamano2)/10000); else echo ""; ?>&nbsp;</td>												
                    <td class="celda_3">&nbsp;<?php  if ($acabado_4Valor>0) echo number_format($acabado_4Valor,0,'','.'); else echo ""; ?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php  if ($costo_unitario4>0){ echo number_format($costo_unitario4,0,'','.'); }else{ echo "";} ?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php echo $ing->unidades_por_pliego?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php  if ($precio_total_4>0) echo number_format($precio_total_4,0,'','.'); else echo ""; ?>&nbsp;</td>
                </tr>
                <tr>
                    <td class="celda_5" colspan="10">&nbsp;&nbsp;<?php echo ucwords(strtolower($acabado_5));?>&nbsp;</td>
                    <td class="celda_5">&nbsp;<?php echo $acabado_5UnidadVentaNombre?>&nbsp;</td>
                    <td class="celda_5">&nbsp;<?php  if ($cantidad_5!="") echo $cantidad_5; ?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php  if ($acabado_5UnidadVentaNombre!="") echo $tamano1; else echo ""; ?>&nbsp;</td>
                    <td class="celda_5">&nbsp;<?php  if ($acabado_5UnidadVentaNombre!="") echo $tamano2; else echo ""; ?>&nbsp;</td>
                    <td class="celda_5">&nbsp;<?php  if ($acabado_5UnidadVentaNombre!="") echo (($tamano1*$tamano2)/10000); else echo ""; ?>&nbsp;</td>												
                    <td class="celda_3">&nbsp;<?php  if ($acabado_5Valor>0) echo number_format($acabado_5Valor,0,'','.'); else echo ""; ?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php  if ($costo_unitario5>0) echo number_format($costo_unitario5,0,'','.'); else echo ""; ?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php echo $ing->unidades_por_pliego?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php  if ($precio_total_5>0) echo number_format($precio_total_5,0,'','.'); else echo ""; ?>&nbsp;</td>
                </tr>
                <tr>
                    <td class="celda_5" colspan="10">&nbsp;&nbsp;<?php echo ucwords(strtolower($acabado_6));?>&nbsp;</td>
                    <td class="celda_5">&nbsp;<?php echo $acabado_6UnidadVentaNombre?>&nbsp;</td>
                    <td class="celda_5">&nbsp;<?php  if ($cantidad_6!="") echo $cantidad_6; ?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php  if ($acabado_6UnidadVentaNombre!="") echo $tamano1; else echo ""; ?>&nbsp;</td>
                    <td class="celda_5">&nbsp;<?php  if ($acabado_6UnidadVentaNombre!="") echo $tamano2; else echo ""; ?>&nbsp;</td>
                    <td class="celda_5">&nbsp;<?php  if ($acabado_6UnidadVentaNombre!="") echo (($tamano1*$tamano2)/10000); else echo ""; ?>&nbsp;</td>												
                    <td class="celda_3">&nbsp;<?php  if ($acabado_6Valor>0) echo number_format($acabado_6Valor,0,'','.'); else echo ""; ?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php  if ($costo_unitario6>0){ echo number_format($costo_unitario6,0,'','.'); }else{ echo "";} ?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php echo $ing->unidades_por_pliego?>&nbsp;</td>
                    <td class="celda_3">&nbsp;<?php  if ($precio_total_6>0) echo number_format($precio_total_6,0,'','.'); else echo ""; ?>&nbsp;</td>
                </tr>
                <tr>
                    <td class="celda_5" colspan="18"><strong>&nbsp;&nbsp;Total Precio de Trabajos Externos</strong></td>
                    <td>&nbsp;&nbsp;<?php if($hoja->valor_externo!=0){ $externos_produccion=$externos_produccion+$hoja->valor_externo+$costo1+$costo2+$costo3+$costo4+$costo5+$costoa1+$costoa2+$costoa3+$costoa4+$costoa5+$costo11+$costo12+$costo13+$costo14+$costo15; echo number_format($hoja->valor_externo,0,'','.');}else{  $externos_produccion=$precio_total_4+$precio_total_5+$precio_total_6+$costo1+$costo2+$costo3+$costo4+$costo5+$costoa1+$costoa2+$costoa3+$costoa4+$costoa5+$costo11+$costo12+$costo13+$costo14+$costo15; echo number_format($externos_produccion,0,'','.');} ?>&nbsp;&nbsp;
                    <?php if($hoja->impreso!=1){echo "<a href='".base_url()."hoja/trabajos_externos/".$id."/4' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";}else{echo "<a href='".base_url()."hoja2/trabajos_externos/".$id."/4' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";}?> 
                    <input type="hidden" name="valor_externo" value="<?php if($hoja->valor_externo!=0){ echo number_format($hoja->valor_externo,0,'','.');}else{ echo number_format($externos_produccion,0,'','.');} ?>" /></td>
                    <!--<a href="<?php //echo base_url()?>hoja/trabajos_externos/<?php //echo $id?>/4" class="fancybox fancybox.ajax"><img src="<?php //echo base_url()?>public/frontend/images/edit.png" class="img_16" /></a>-->
                </tr>                   
                <tr>
                    <td class="celda_5" colspan="10"><strong>&nbsp;&nbsp;Piezas Adicionales</strong></td>
                    <td class="celda_5">&nbsp;</td>
                    <td class="celda_5">&nbsp;</td>
                    <td class="celda_5">&nbsp;</td>
                    <td class="celda_5">&nbsp;</td>
                    <td class="celda_5">&nbsp;</td>												
                    <td class="celda_5">&nbsp;</td>
                    <td class="celda_5">&nbsp;</td>											
                    <td class="celda_5">&nbsp;</td>
                    <td class="celda_5">&nbsp;</td>
                </tr>
                <?php

                if($ing->piezas_adicionales == 'NO LLEVA')
                {
                    $piezaAdacionalNom1 ="No Lleva";
                    $piezaAdacionalValor1="&nbsp;";
                    $piezaAdacionalTotal1="&nbsp;";
                    $piezaAdacionalEmpresa1="&nbsp;";
                }else
                {
                    $piezasAdicionales = $this->piezas_adicionales_model->getPiezasAdicionalesPorNombreHojaCosto($ing->piezas_adicionales);
                    $piezaUnidadVentaNombre1=$piezasAdicionales->unv; //Nombre unidad de venta
                    $piezaAdacionalNom1 = $piezasAdicionales->piezas_adicionales;
                    $piezaAdacionalValor1= $piezasAdicionales->valor_venta;
                    $piezaAdacionalTotal1 = $datoscantidad1 * $piezaAdacionalValor1;
                    $piezaAdacionalEmpresa1= $hoja->piezas_adicionales1;
                }
                if($ing->piezas_adicionales2 == 'NO LLEVA')
                {
                    $piezaAdacionalNom2 ="No Lleva";
                    $piezaAdacionalValor2="&nbsp;";
                    $piezaAdacionalTotal2="&nbsp;";
                    $piezaAdacionalEmpresa2="&nbsp;";
                }else
                {
                    $piezasAdicionales = $this->piezas_adicionales_model->getPiezasAdicionalesPorNombreHojaCosto($ing->piezas_adicionales2);
                    $piezaUnidadVentaNombre2=$piezasAdicionales->unv; //Nombre unidad de venta                                    
                    $piezaAdacionalNom2 = $piezasAdicionales->piezas_adicionales;
                    $piezaAdacionalValor2= $piezasAdicionales->valor_venta;
                    $piezaAdacionalTotal2= $datoscantidad1 * $piezaAdacionalValor2;
                    $piezaAdacionalEmpresa2= $hoja->piezas_adicionales2;
                }
                if($ing->piezas_adicionales3 == 'NO LLEVA')
                {
                    $piezaAdacionalNom3 ="No Lleva";
                    $piezaAdacionalValor3="&nbsp;";
                    $piezaAdacionalTotal3="&nbsp;";
                    $piezaAdacionalEmpresa3="&nbsp;";
                }else
                {
                    $piezasAdicionales = $this->piezas_adicionales_model->getPiezasAdicionalesPorNombreHojaCosto($ing->piezas_adicionales3);
                    $piezaUnidadVentaNombre3=$piezasAdicionales->unv; //Nombre unidad de venta                                    
                    $piezaAdacionalNom3 = $piezasAdicionales->piezas_adicionales;
                    $piezaAdacionalValor3 =  $piezasAdicionales->valor_venta;
                    $piezaAdacionalTotal3= $datoscantidad1 * $piezaAdacionalValor3;;
                    $piezaAdacionalEmpresa3= $hoja->piezas_adicionales3;
                }
                ?>
                <tr>
                <td class="celda_5" colspan="10">&nbsp;&nbsp;<?php echo ucwords(strtolower($piezaAdacionalNom1));?>&nbsp;</td>
                <td class="celda_5" >&nbsp;<?php echo $piezaUnidadVentaNombre1 ;?>&nbsp;</td>
                <td class="celda_5">&nbsp;<?php  if ($piezaUnidadVentaNombre1!="") echo $datoscantidad1; else echo ""; ?>&nbsp;</td>
                <td class="celda_5">&nbsp;</td>
                <td class="celda_5">&nbsp;</td>												
                <td class="celda_5">&nbsp;</td>
                <td class="celda_5">&nbsp;</td>												
                <td class="celda_5">&nbsp;<?php  if ($piezaUnidadVentaNombre1!="") echo $piezaAdacionalValor1; else echo ""; ?>&nbsp;</td>					
                <td class="celda_3">&nbsp;&nbsp;</td>
                <td class="celda_3">&nbsp;&nbsp;<?php echo number_format($piezaAdacionalTotal1,0,'','.');  ?>&nbsp;&nbsp;</td>
            </tr>
            <tr>
                <td class="celda_5" colspan="10">&nbsp;&nbsp;<?php echo ucwords(strtolower($piezaAdacionalNom2));?>&nbsp;</td>
                <td class="celda_5" >&nbsp;<?php echo $piezaUnidadVentaNombre2 ;?>&nbsp;</td>                                                
                <td class="celda_5">&nbsp;<?php  if ($piezaUnidadVentaNombre2!="") echo $datoscantidad1; else echo ""; ?>&nbsp;</td>
                <td class="celda_5">&nbsp;</td>
                <td class="celda_5">&nbsp;</td>
                <td class="celda_5">&nbsp;</td>
                <td class="celda_5">&nbsp;</td>												
                <td class="celda_5">&nbsp;<?php  if ($piezaUnidadVentaNombre2!="") echo $piezaAdacionalValor2; else echo ""; ?>&nbsp;</td>					
                <td class="celda_3">&nbsp;&nbsp;</td>
                <td class="celda_3">&nbsp;&nbsp;<?php echo number_format($piezaAdacionalTotal2,0,'','.');  ?>&nbsp;&nbsp;</td>
            </tr>
            <tr>
                <td class="celda_5" colspan="10">&nbsp;&nbsp;<?php echo ucwords(strtolower($piezaAdacionalNom3));?>&nbsp;</td>
                <td class="celda_5" >&nbsp;<?php echo $piezaUnidadVentaNombre3 ;?>&nbsp;</td>                                                
                <td class="celda_5">&nbsp;<?php  if ($piezaUnidadVentaNombre3!="") echo $datoscantidad1; else echo ""; ?>&nbsp;</td>
                <td class="celda_5">&nbsp;</td>
                <td class="celda_5">&nbsp;</td>												
                <td class="celda_5">&nbsp;</td>
                <td class="celda_5">&nbsp;</td>												
                <td class="celda_5">&nbsp;<?php  if ($piezaUnidadVentaNombre3!="") echo $piezaAdacionalValor3; else echo ""; ?>&nbsp;</td>					
                <td class="celda_3">&nbsp;&nbsp;</td>
                <td class="celda_3">&nbsp;&nbsp;<?php echo number_format($piezaAdacionalTotal3,0,'','.');  ?>&nbsp;&nbsp;</td>

                                                                                                      
            </tr>
                <tr>
                    <td class="celda_5" colspan="18"><strong>&nbsp;&nbsp;Total Precio de Piezas Adicionales</strong></td>
                    <td>&nbsp;&nbsp;<?php if($hoja->valor_piezas!=0){ $piezas_produccion=$piezas_produccion+$hoja->valor_piezas;  echo number_format($hoja->valor_piezas,0,'','.');}else{  $piezas_produccion=$piezaAdacionalTotal1+$piezaAdacionalTotal2+$piezaAdacionalTotal3; echo number_format($piezas_produccion,0,'','.');} ?>&nbsp;&nbsp;
                    <!--<a href="<?php //echo base_url()?>hoja/trabajos_externos/<?php// echo $id?>/5" class="fancybox fancybox.ajax"><img src="<?php //echo base_url()?>public/frontend/images/edit.png" class="img_16" /></a>-->
                    <?php if($hoja->impreso!=1){echo "<a href='".base_url()."hoja/trabajos_externos/".$id."/5' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";}else{echo "<a href='".base_url()."hoja2/trabajos_externos/".$id."/5' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";}?> 
                    <input type="hidden" name="valor_piezas" value="<?php if($hoja->valor_piezas!=0){ echo number_format($hoja->valor_piezas,0,'','.');}else{ echo number_format($piezas_produccion,0,'','.');} ?>" /></td>
                </tr>      
                <tr>
                    <td class="celda_5" colspan="18"><strong>&nbsp;&nbsp;Total Externos</strong></td>
                    <td class="celda_5" >&nbsp;<?php $externos_produccion=$externos_produccion+$piezas_produccion; echo number_format(($externos_produccion),0,'','.');  ?>&nbsp;</td>
                    <!--<td class="celda_5" >&nbsp;<?php //$externos_produccion=$externos_produccion+$piezas_produccion; echo number_format(($externos_produccion),0,'','.');  ?>&nbsp;</td>-->
                </tr>                  
											
		
											
                </table>
                                    <!--/trabajos externos-->
                                </td>
                            </tr>
                        </table>
                        <!--/materialidad-->
                    </div>
                    <div class="separador_10"></div>
                    <div>
                        <table id="tabla_detalle">
                            <tr>
                                <td class="celda_3">MAT.PRIMAS</td>
                                <td class="celda_3">CANT/PLIEGO</td>
                                <td class="celda_3">VALOR $</td>
                                <td class="celda_3">PRODUCCIÓN</td>
                                <td class="celda_3">UNITARIO</td>
                                <td class="celda_3">VALOR $</td>
                            </tr>
                            <tr>
                                <td colspan="6"><hr class="hr_punteada" /></td>
                            </tr>
                        <?php
                            if (($datoscantidad1>0) && ($ing->unidades_por_pliego>0)){
                                $costoPlacaKilo=($datoscantidad1/$ing->unidades_por_pliego)+$sum;
                            }else{ 
                            $costoPlacaKilo=0;
                            }
                           
                            $valorPlacaKilo=($costoPlacaKilo*$tamano1*$tamano2*$tapaGramaje)/10000000;
                            $totalPlacaKilo=$valorPlacaKilo*$tapaPrecio;
                            
                             if(sizeof($hoja)>=1 and $hoja->fecha)
                            {
                                $arreglo5=array
                                (
                                    "placa_kilo"=>$costoPlacaKilo,
                                    "total_pliegos"=>$valorPlacaKilo,
                                );
                              
                                $this->db->where('id', $hoja->id);
                                $this->db->update("hoja_de_costos_datos",$arreglo5);
                               // echo $this->db->last_query();
                            }
			    if(sizeof($hoja)>=1)
                            {
                                $arreglokilo1=array
                                (
                                    "kilos_placa"=>$valorPlacaKilo,
                                 
                                );
                                $this->db->where('id', $hoja->id);
                                $this->db->update("hoja_de_costos_datos",$arreglokilo1);
                               // echo $this->db->last_query();
                            }
                        ?>
                        <?php 
                        if($ing->tamano_a_imprimir_1 < 102 && $ing->tamano_a_imprimir_2 < 72){
                            $mostrarboton = 1;
                        }else{
                            $mostrarboton = 0;
                        }
                        ?>
                        <?php 
                        $ancho=72;
                        $largo=102;
                        
                        if($tamano1<$tamano2){
                            $anchomenor = $tamano1; 
                            $anchomayor = $tamano2; 
                        }else{
                            $anchomayor = $tamano1; 
                            $anchomenor = $tamano2; 
                        }
//                        echo "<h1>Ancho menor: $anchomenor</h1>";
//                        echo "<h1>Ancho mayor: $anchomayor</h1>";
                        if(($anchomenor <= $ancho) && ($anchomayor <= $largo)){
                            $condicionado="Se Puede Imprimir afuera";
                        }else{
                            $condicionado="No Puede Imprimir afuera";
                        }
                        ?>
                        <tr>
                                <td class="celda_3">TAPA KILO<?php echo number_format($valorPlacaKilo,0,'','.');/*echo $sum;*/?></td>
                                <td class="celda_3"><?php echo number_format($costoPlacaKilo,0,'','.')?></td>
                                <td class="celda_3"><?php echo number_format($totalPlacaKilo,0,'','.')?></td>
                                <td class="celda_3 valign_top padding_left_10" colspan="3" rowspan="30">
                                    <!--producción--><?php //echo "<h1>" . $mostrarboton . "</h1>"; //my code is here  ?>
                                    <table id="tabla_produccion" style="width: 550px">
                                        <tr>
                                            <td class="celda_33">TIRAJE</td>
                                            <td class="celda_33"><?php echo $factor_rango?></td>
                                            <td class="celda_33"><?php if($mostrarboton != 1){echo number_format($tiraje,0,'','.');}else{if($hoja->tiraje1!=""){$tiraje=$hoja->tiraje1; echo number_format($hoja->tiraje1,0,'','.');}else{echo number_format($tiraje,0,'','.');}}?>
                                            <?php if($hoja->impreso!=1 && $mostrarboton == 1){echo $condicionado; echo "<a href='".base_url()."hoja/tiraje1/".$id."/4' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";}else{if($hoja->impreso!=1){echo $condicionado;}else{echo $condicionado;echo "<a href='".base_url()."hoja2/tiraje1/".$id."/4' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";}} ?>
                                            </td>
                                            <!--<td class="celda_33"><?php// echo $hoja->tiraje1."-Dato prueba" ?></td>-->
                                        </tr>
                                  <?php
                                  $variableComplemento=$this->variables_cotizador_model->getVariablesCotizadorPorId(32);
                                        $valorTiraje=$variableComplemento->precio-$tiraje;
										
                                        if($valorTiraje>0)
                                        {
                                            if($fotomecanica->colores == 0)
                                            {
                                              $complemento=0;
                                            }else{
                                              $complemento=$valorTiraje;	
                                            }
                                            
											
                                        }else
                                        {
                                            $complemento=0;
                                        }
                                        
                                        
                                  ?>  
					<?php if($hoja->valor_externo!=0){ $externos_produccion=$externos_produccion+$hoja->valor_externo+$costo1+$costo2+$costo3+$costo4+$costo5+$costoa1+$costoa2+$costoa3+$costoa4+$costoa5+$costo11+$costo12+$costo13+$costo14+$costo15; }else{  $externos_produccion=$precio_total_4+$precio_total_5+$precio_total_6+$costo1+$costo2+$costo3+$costo4+$costo5+$costoa1+$costoa2+$costoa3+$costoa4+$costoa5+$costo11+$costo12+$costo13+$costo14+$costo15; } ?>			  

								  
                    <tr>
                                            <td class="celda_33">COMPLEMENTO</td>
                                            <td class="celda_33">&nbsp;</td>
                                            <td class="celda_33"><?php echo number_format($complemento,0,'','.')?></td>
                                        </tr>
                                        <tr>
                                            <td class="celda_33">EXTERNOS</td>
                                            <td class="celda_33">&nbsp;</td>

                                            <td class="celda_33"><?php echo number_format($externos_produccion,0,'','.');?></td>
                                        </tr>
                                        <tr>
                                            <td class="celda_33">COSTOS POR LACADO</td>
                                            <td class="celda_33">&nbsp;</td>

                                            <td class="celda_33"><?php echo number_format($costosporlacado,0,'','.');?></td>
                                        </tr>
                    <?php
                        if($maquina=="Máquina Roland 800")
                        {
                           if (($datoscantidad1>0) && ($ing->unidades_por_pliego>0)){
                                $costoOndaKilo=((($datoscantidad1/$ing->unidades_por_pliego)*1.04)+100)+4;
                           }else{ 
                                $costoOndaKilo=0;                            
                           }
                        }else
                        {
                           if (($datoscantidad1>0) && ($ing->unidades_por_pliego>0)){
                                $costoOndaKilo=((($datoscantidad1/$ing->unidades_por_pliego)*1.04)+100)+4;
                           }else{ 
                                $costoOndaKilo=0;                               
                           }
                        }
                        
                        if($fotomecanica->materialidad_datos_tecnicos == 'Sólo Cartulina')
                        {
                                $costoOndaKilo=0;
                                $valorOndaKilo=0;
                                $totalOndaKilo=0;
                                $valorCorte=0;
                                $costoOndaKilo3=0;
                                $valorOndaKilo3=0;
                                $totalOndaKilo3=0;
                                $valorCorte3=0;

                        }else{
                            $valorOndaKilo=($costoOndaKilo*$tamano1*$tamano2*$GramosMetroCuadrado)/10000000;
                            $totalOndaKilo=$valorOndaKilo*$costo_kilo;
                            $valorCorte=$costoOndaKilo*4.5;
			}
                        
                        $costoOndaKilo1=((($datoscantidad1/$ing->unidades_por_pliego)*1.04)+100)+4;
                        $costoOndaKilo2=(($datoscantidad1/$ing->unidades_por_pliego)+$emplacado+$troquelado);
                        
                        if($costoOndaKilo1>$costoOndaKilo2){
                            $costoOndaKilo=$costoOndaKilo1;
                        }
                        if($costoOndaKilo1<$costoOndaKilo2){
                            $costoOndaKilo=$costoOndaKilo2;
                        }
                        
                    ?>
                    <tr>
                            <td class="celda_33">CORTE</td>
                            <td class="celda_33">4.5</td>
                            <td class="celda_33"><?php echo number_format($valorCorte,0,'','.')?></td>
                    </tr>
                    <?php
                        $variableEmplacado=$this->variables_cotizador_model->getVariablesCotizadorPorId(8);
                        $valorEmplacadado=($variableEmplacado->precio*$tamano1*$tamano2)/10000;
                        if($fotomecanica->materialidad_datos_tecnicos == 'Sólo Cartulina'){
                        $totalEmplacado=0;}else{
                        $totalEmplacado=$valorEmplacadado*$costoOndaKilo;}
                    ?>
                    <tr>
                        <td class="celda_33">EMPLACADO</td>
                        <td class="celda_33"><?php echo $valorEmplacadado?></td>
                        <td class="celda_33"><?php echo number_format($totalEmplacado,0,'','.')?></td>
                    </tr>
                    <?php
                    
                        if($fotomecanica->estan_los_moldes == 'NO LLEVA')
                        {
                            $variableMontajeMoldeTroquel=0;
                            $totalMontajeMolde=0;
                        }else
                        {
                            $variableRecargoMontaje=$this->variables_cotizador_model->getVariablesCotizadorPorId(31);
                            $variableMontajeMoldeTroquel=$this->variables_cotizador_model->getVariablesCotizadorPorId(10);
                            $totalMontajeMolde=$variableMontajeMoldeTroquel->precio*1.5;	
                        }                    

//                       
                    ?>
                    <tr>
                                            <td class="celda_33">MONTAJE MOLDE</td>
                                            <td class="celda_33"><?php echo number_format($variableMontajeMoldeTroquel->precio,0,'','.')?></td>
                                            <td class="celda_33"><?php echo number_format($totalMontajeMolde,0,'','.')?></td>
                                        </tr>
                    <?php
						if($fotomecanica->estan_los_moldes == 'NO LLEVA')
						{
                                                    $variableTroquelado=0;
                                                    $totalTroquelado=0;
						}else
						{
                                                    $variableTroquelado=$this->variables_cotizador_model->getVariablesCotizadorPorId(11);
                                                    $totalTroquelado=($costoOndaKilo*$variableTroquelado->precio)*1.5;	
						}                    
//					
                    ?>
                    <tr>
                                            <td class="celda_33">TROQUELADO</td>
                                            <td class="celda_33"><?php echo $variableTroquelado->precio?></td>
                                            <td class="celda_33"><?php echo number_format($totalTroquelado,0,'','.')?></td>
                    </tr>
                    <?php
                                        $variableDesgajado=$this->variables_cotizador_model->getVariablesCotizadorPorId(12);
                                        if($fotomecanica->estan_los_moldes == 'NO LLEVA'){
                                        $totalDesgajado=0;
                                        }else{
                                        $totalDesgajado=$ing->piezas_totales_en_el_pliego*$variableDesgajado->precio*1.5*$costoOndaKilo;
                                        }
                    ?>                                
                    <tr>                
                                            <td class="celda_33">DESGAJADO</td>
                                            <td class="celda_33"><?php echo $variableDesgajado->precio?></td>
                                            <td class="celda_33"><?php echo number_format($totalDesgajado,0,'','.')?></td>
                    </tr>
                     <tr>
                                            <td class="celda_33">PEGADO</td>
                                        <?php
                                           $variablePegado=$this->variables_cotizador_model->getVariablesCotizadorPorId(21);
                                           if(sizeof($hoja)==0) { 
                                               if ($datos->pegado_migrado==null || $datos->pegado_migrado=='' || $datos->pegado_migrado==0){
                                                   if($presupuesto->costo_pegado>=1){
                                                       $pegado_migrado=$presupuesto->costo_pegado;
                                                   }else{
                                                       $pegado_migrado=30; 
                                                   }
                                                }else{ 
                                                    $pegado_migrado=$datos->pegado_migrado;
                                                }
                                           }else{                                               
                                                    $pegado_migrado=$hoja->pegado;
                                           }
                                           
                                           $totalPegado=$datoscantidad1*$pegado_migrado*$variablePegado->precio;
                                           
                                           //$totalPegadoTres=$datoscantidad3*$pegado_migrado*$variablePegado->precio;
                                        
                                        ?>    
                                            
                                        <?php if(sizeof($hoja)==0) { ?>
                                           <td class="celda_33"><?php echo $pegado_migrado; ?><a href="<?php echo base_url()?>hoja/pegado/<?php echo $id?>/<?php echo $pagina?>" class="fancybox fancybox.ajax"><img src="<?php echo base_url()?>public/frontend/images/edit.png" class="img_16" /></a><input type="hidden" name="pegado" placeholder="Descripcion técnica" value="<?php echo $pegado_migrado?>" /></td> 
                                        <?php }else{ ?>
                                           <td class="celda_33"><?php echo $hoja->pegado; ?>
                                           <!--<a href="<?php //echo base_url()?>hoja/pegado/<?php //echo $id?>/<?php //echo $pagina?>" class="fancybox fancybox.ajax"><img src="<?php //echo base_url()?>public/frontend/images/edit.png" class="img_16" /></a>-->
                                           <?php if($hoja->impreso!=1){echo "<a href='".base_url()."hoja/pegado/".$id."/".$pagina."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";}else{echo "<a href='".base_url()."hoja2/pegado/".$id."/".$pagina."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";} ?>
                                           <input type="hidden" name="pegado" placeholder="Descripcion técnica" value="<?php echo $hoja->pegado ?>" /></td> 
                                        <?php } ?>
                                                                                 
                                                <td class="celda_33"> <?php if($totalPegado>150000 && $totalPegado<=235000){echo number_format(150000,0,'','.');}else{
                                                    if($totalPegado<150000){echo number_format($totalPegado,0,'','.');}else{
                                                        if($totalPegado>235000){
                                                           $totalPegado=$datoscantidad1*$pegado_migrado*1.45;
                                                           echo number_format($totalPegado,0,'','.');
                                                        }
                                                    }
                                                }?>
                                                    <?php if ($datos->pegado_migrado==null){?> <strong> (Pegado de Cotizacion = 0 )</strong><?php } ?> </td> 
                                                <!--<td class="celda_33"><?php //echo number_format($totalPegado,0,'','.')?></td>-->
                     </tr>
                     <?php
					 if(sizeof($hoja->pegado)>=1)
					 {
                                            $divisionPegado=$hoja->pegado/2;
                                            $totalDespacho=$divisionPegado*$datoscantidad1;
					 }
					 else
					 {
                                                $divisionPegado=$pegado_migrado/2;
                                                $totalDespacho=$divisionPegado*$datoscantidad1;
                                         }
                                                                                      
         				 
					 
                     
                     ?>
<!--                     <tr>
                                            <td class="celda_33">DESPACHO</td>
                                            <td class="celda_33"><?php //echo $divisionPegado?></td>
                                            <td class="celda_33"><?php //echo number_format($totalDespacho,0,'','.')?></td>
                     </tr>-->
                     <?php
					 
					 	//$des = calcularDespacho($costoPlacaKilo, $costoOndaKilo, $retiro, $mdt, $fuerasantiago, $distancia);
                                                                //$des = calcularDespacho($costoPlacaKilo, $costoPlacaKilo2, $retiro, $mdt, $fuerasantiago, $distancia);
                                                                if($fotomecanica->materialidad_datos_tecnicos == 'Cartulina-cartulina')
								{
                                                                $costoPlacaKilo2 = ($datoscantidad1/$ing->unidades_por_pliego);

                                                                $cuatro_por_ciento = ($costoPlacaKilo2 / 100)* 4;
							
                                                                //if($costoPlacaKilo2 >= 1 and $costoPlacaKilo2 <= 100)
                                                                if($cuatro_por_ciento >= 1 and $cuatro_por_ciento <= 100)
                                                                {
                                                                        if($fotomecanica->colores==0){
                                                                        $agregado_a_apliegos = 25;
                                                                        }else{    
                                                                        $agregado_a_apliegos = 100;
                                                                        }
                                                                }

                                                                if($cuatro_por_ciento > 100)
                                                                {
                                                                        $agregado_a_apliegos = $cuatro_por_ciento;
                                                                }
                                                                $costoPlacaKilo2 = $costoPlacaKilo2 + $agregado_a_apliegos;
                                                                $valorPlacaKilo2 = ($costoPlacaKilo2*$tamano1*$tamano2*$tapaGramaje3)/10000000;
 							
                                                                }
                                                                if($fotomecanica->materialidad_datos_tecnicos == 'Cartulina-cartulina')
								{
                                                                $costoPlacaKilo2 = ($datoscantidad1/$ing->unidades_por_pliego);
                                                                $cuatro_por_ciento = ($costoPlacaKilo2 / 100)* 4;
							
                                                                if($cuatro_por_ciento >= 1 and $cuatro_por_ciento <= 100)
                                                                {
                                                                        if($fotomecanica->colores==0){
                                                                        $agregado_a_apliegos = 25;
                                                                        }else{    
                                                                        $agregado_a_apliegos = 100;
                                                                        }
                                                                }

                                                                if($cuatro_por_ciento > 100)
                                                                {
                                                                        $agregado_a_apliegos = $cuatro_por_ciento;
                                                                }
                                                                $costoPlacaKilo2 = $costoPlacaKilo2 + $agregado_a_apliegos;
                                                         
                                                                }

//                                                   echo "<h1>AAAA" . $valorPlacaKilo . "</h1>";           
//                                                   echo "<h1>AAAA" . $valorOndaKilo . "</h1>";           
                                                if($mdt=='Cartulina-cartulina' || $mdt=='Sólo Cartulina'){
                                                    $des = calcularDespacho($valorPlacaKilo, $valorPlacaKilo2, $retiro, $mdt, $fuerasantiago, $distancia);  
                                                }else{
                                                    $des = calcularDespacho($valorPlacaKilo, $valorOndaKilo, $retiro, $mdt, $fuerasantiago, $distancia);
                                                }
                                              
					 //%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
					 
                    if($fotomecanica->condicion_del_producto == 'Nuevo') //nuevo 
                    {
                        if($fotomecanica->estan_los_moldes == 'NO')
			{
				$variableTroquel=$this->variables_cotizador_model->getVariablesCotizadorPorId(9);
                                $moldeTroquel=$variableTroquel->precio;
                        }
                        elseif($fotomecanica->estan_los_moldes == 'NO LLEVA')
                        {
                            $moldeTroquel=0;
                        }elseif($fotomecanica->estan_los_moldes == 'CLIENTE LO APORTA')
                        {
                            $moldeTroquel=0;
                        }elseif($fotomecanica->estan_los_moldes == 'MOLDE GENERICO'){
                            if($fotomecanica->numero_molde == 11 || $fotomecanica->numero_molde == 12 || $fotomecanica->numero_molde == 13 || $fotomecanica->numero_molde == 14 || $fotomecanica->numero_molde == 15){
                            $variableTroquel=$this->variables_cotizador_model->getVariablesCotizadorPorId(9);
                            $moldeTroquel=$variableTroquel->precio;
                            }else{
                                $moldeTroquel=0;
                            }
                        }
                    }
                    if($fotomecanica->condicion_del_producto == 'Repetición Sin Cambios') //
                    {

                    if($fotomecanica->estan_los_moldes == 'NO LLEVA')
                    {
                            $variableTroquel=$this->variables_cotizador_model->getVariablesCotizadorPorId(9);

                            $moldeTroquel=0;
                    }
                    }					
                    if($fotomecanica->condicion_del_producto == 'Repetición con Cambios') //
                    {
			$moldeTroquel=0;
                    }
                    if($fotomecanica->condicion_del_producto == 'Producto Genérico') //
                    {
			$moldeTroquel=0;
                    }
            						   
                     ?>
                     <?php if($hoja->molde_troquel>0){$moldeTroquel=$hoja->molde_troquel;echo $moldeTroquel;}else{echo $moldeTroquel;} ?>
                     <tr>
                                            <td class="celda_33">MOLDE TROQUEL<?php if($hoja->impreso!=1){echo "<a href='".base_url()."hoja/molde_troquel/".$id."/".$pagina."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";}else{echo "<a href='".base_url()."hoja2/molde_troquel/".$id."/".$pagina."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";} ?></td>
                                            <td class="celda_33">&nbsp;</td>
                                            <td class="celda_33"><?php echo number_format($moldeTroquel,0,'','.');?></td>

                     </tr>
					 <?php
                     $variableEmplacado = $this->variables_cotizador_model->getVariablesCotizadorPorId(39);
                     if ($fotomecanica->fot_lleva_barniz == 'SI' && $fotomecanica->fot_reserva_barniz == 'SI') {
                         $otrosCaucho = $variableEmplacado->precio;
                     } else {
                         $otrosCaucho = 0;
                     }
                     if ($fotomecanica->fot_cala_caucho == 'Si') {
                         $otrosCaucho = 50000;
                     } else {
                         $otrosCaucho = 0;
                     }
                     ?>
					 <tr>
                                            <td class="celda_33">CAUCHO CALADO</td>
                                            <td class="celda_33">&nbsp;</td>
                                            <td class="celda_33"><?php echo number_format($otrosCaucho,0,'','.');?></td>
                                            
                       
                     </tr>
					 <?php
					 if($piezaAdacionalEmpresa1 != 0)
					 {
						$TotalPiezasAdicionales = $TotalPiezasAdicionales + $piezaAdacionalEmpresa1;

					 }
					 else
					 {
						 	$TotalPiezasAdicionales = $TotalPiezasAdicionales + $piezaAdacionalTotal1;
						 
					 }
					 
					  if($piezaAdacionalEmpresa2 != 0)
					 {
						$TotalPiezasAdicionales = $TotalPiezasAdicionales + $piezaAdacionalEmpresa2;

					 }
					else
					 {
						 $TotalPiezasAdicionales = $TotalPiezasAdicionales + $piezaAdacionalTotal2;
						 
					 }
					 
					 
					  if( $piezaAdacionalEmpresa3 != 0)
					 {
						$TotalPiezasAdicionales = $TotalPiezasAdicionales + $piezaAdacionalEmpresa3;

					 }
					else
					 {
						 $TotalPiezasAdicionales = $TotalPiezasAdicionales + $piezaAdacionalTotal3;
						 
					 }
					 
					// $TotalPiezasAdicionales = $piezaAdacionalTotal1 + $piezaAdacionalTotal2 + $piezaAdacionalTotal3;
					 ?>
                                         <?php $vvm = $this->variables_cotizador_model->getVariablesCotizadorPorNombre('Visto Bueno en Maquina');?>
					 <tr>
                                            <td class="celda_33">PIEZAS ADICIONALES</td>
                                            <td class="celda_33">&nbsp;</td>
                                            <td class="celda_33"><?php echo number_format($TotalPiezasAdicionales,0,'','.');?></td>
                                        </tr>
					<tr>
                                            <td class="celda_33">VISTO BUENO EN MAQUINA</td>
<!--                                            SI ES SI EN COTIZACION-->
                                            <td class="celda_33">&nbsp;</td>
                                            <td class="celda_33"><?php if($hoja->valor_bv_maquina == ''){ if ($datos->vb_maquina=="SI") $valor_bv_maquina=$vvm->precio; else $valor_bv_maquina=0; echo number_format($valor_bv_maquina,0,'','.');}else{echo number_format($hoja->valor_bv_maquina,0,'','.'); $valor_bv_maquina=$hoja->valor_bv_maquina;}?>
                                            <!--<a href="<?php //echo base_url()?>hoja/valores_extras/<?php //echo $id?>/2" class="fancybox fancybox.ajax"><img src="<?php //echo base_url()?>public/frontend/images/edit.png" class="img_16" /></a>-->
                                            <?php if($hoja->impreso!=1){echo "<a href='".base_url()."hoja/valores_extras/".$id."/2' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";}else{echo "<a href='".base_url()."hoja2/valores_extras/".$id."/2' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";} ?>
                                            <input type="hidden" name="valor_bv_maquina" placeholder="Descripcion técnica" value="<?php echo $hoja->valor_bv_maquina?>" /></td>
                                        </tr>         
					 <tr>
                                            <td class="celda_33">NO ACEPTA EXCEDENTES</td>
<!--                                            SI ES SI EN COTIZACION-->
                                            <td class="celda_33">&nbsp;</td>
                                            <td class="celda_33"><?php if($hoja->valor_acepeta_exce == ''){ if ($datos->acepta_excedentes=="SI") $valor_acepeta_exce=0; else $valor_acepeta_exce=100000; echo number_format($valor_acepeta_exce,0,'','.');}else{echo number_format($hoja->valor_acepeta_exce,0,'','.'); $valor_acepeta_exce=$hoja->valor_acepeta_exce;}?>
                                                <!--<a href="<?php //echo base_url()?>hoja/valores_extras/<?php echo $id?>/3" class="fancybox fancybox.ajax"><img src="<?php echo base_url()?>public/frontend/images/edit.png" class="img_16" /></a>-->
                                                <?php if($hoja->impreso!=1){echo "<a href='".base_url()."hoja/valores_extras/".$id."/3' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";}else{echo "<a href='".base_url()."hoja2/valores_extras/".$id."/3' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";} ?>
                                                <input type="hidden" name="valor_acepeta_exce" placeholder="Descripcion técnica" value="<?php echo $hoja->valor_acepeta_exce?>" /></td>
                                        </tr>
                                        <tr>
                                            <td class="celda_33">DETALLE DESPACHO (<?php if($datos->retira_cliente=="" || $datos->retira_cliente=="NO"){
                                                echo "Nuestra cuenta";
                                            }else{echo "Cuenta del cliente";} ?>)<?php if($hoja->impreso!=1){echo "<a href='".base_url()."hoja/despacho/".$id."/".$pagina."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";}else{echo "<a href='".base_url()."hoja2/despacho/".$id."/".$pagina."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";} ?></td>
                                            <td class="celda_33"><?php echo $des[1]; ?> Palets</td>
                                            <td class="celda_33"><?php echo $des[0]; ?>
                                            </td>
                                            <!--<td class="celda_33"><?php// echo $hoja->tiraje1."-Dato prueba" ?></td>-->
                                        </tr>

                                            <td class="celda_33" colspan="3"><hr class="hr_punteada" /></td>
                     </tr>
                     <?php
                     //$totalProduccion=$costosporlacado+$complemento+$valorCorte+$totalEmplacado+$totalMontajeMolde+$totalTroquelado+$totalPegado+$totalDespacho+$tiraje+$moldeTroquel+$totalDesgajado+$externos_produccion+$otrosCaucho + $TotalPiezasAdicionales + $valor_extra + $valor_bv_maquina + $valor_acepeta_exce;
                     $totalProduccion=$costosporlacado+$complemento+$valorCorte+$totalEmplacado+$totalMontajeMolde+$totalTroquelado+$totalPegado+$des[0]+$tiraje+$moldeTroquel+$totalDesgajado+$externos_produccion+$otrosCaucho + $TotalPiezasAdicionales + $valor_extra + $valor_bv_maquina + $valor_acepeta_exce;
//                     echo "<h1>a$costosporlacado</h1>";
//                        echo "<h1>b$complemento</h1>";
//                        echo "<h1>c$valorCorte</h1>";
//                        echo "<h1>d$totalEmplacado</h1>";
//                        echo "<h1>e$totalMontajeMolde</h1>";
//                        echo "<h1>f$totalTroquelado</h1>";
//                        echo "<h1>g$totalPegado</h1>";
//                        echo "<h1>h$totalDespacho</h1>";
//                        echo "<h1>i$tiraje</h1>";
//                        echo "<h1>j$moldeTroquel</h1>";
//                        echo "<h1>k$totalDesgajado</h1>";
//                        echo "<h1>l$externos_produccion</h1>";
//                        echo "<h1>m$otrosCaucho</h1>";
//                        echo "<h1>n$TotalPiezasAdicionales</h1>";
//                        echo "<h1>o$valor_extra</h1>";
//                        echo "<h1>p$valor_bv_maquina</h1>";
//                        echo "<h1>q$valor_acepeta_exce</h1>";
                     
                     
                     ?>
                     <tr>
                                            <td class="celda_33">TOTAL PRODUCCIÓN</td>
                                            <td class="celda_33">&nbsp;</td>
                                            <td class="celda_33"><?php echo number_format($totalProduccion,0,'','.')?></td>
                                        </tr>
                                        <tr>
                                            <td class="celda_33" colspan="3">&nbsp;</td>
                                        </tr>
                                        <tr>
                                            <td class="celda_33"><span class="subrayado">COSTOS VARIOS</span></td>
                                            <td class="celda_33">&nbsp;</td>
                                            <td class="celda_33">&nbsp;</td>
                     </tr>

                     <?php

                                                                
								if($fotomecanica->materialidad_datos_tecnicos == 'Cartulina-cartulina')
								{
                                                                $costoPlacaKilo2 = ($datoscantidad1/$ing->unidades_por_pliego);

                                                                $cuatro_por_ciento = ($costoPlacaKilo2 / 100)* 4;
							
                                                                //if($costoPlacaKilo2 >= 1 and $costoPlacaKilo2 <= 100)
                                                                if($cuatro_por_ciento >= 1 and $cuatro_por_ciento <= 100)
                                                                {
                                                                        if($fotomecanica->colores==0){
                                                                        $agregado_a_apliegos = 25;}else{    
                                                                        $agregado_a_apliegos = 100;
                                                                        }
                                                                }

                                                                if($cuatro_por_ciento > 100)
                                                                {
                                                                        $agregado_a_apliegos = $cuatro_por_ciento;
                                                                }
                                                                $costoPlacaKilo2 = $costoPlacaKilo2 + $agregado_a_apliegos;
                                                                $valorPlacaKilo2 = ($costoPlacaKilo2*$tamano1*$tamano2*$tapaGramaje3)/10000000;
                                                                //$valorPlacaKilo2 = number_format($valorPlacaKilo2,0,'','.');
                                                                
                                                                $totalPlacaKilo2 = $valorPlacaKilo2*$tapaPrecio3;
							
                                                                ?>
                      <?php
                       $corte = $totalPlacaKilo*7/100;
                       $merma = $totalPlacaKilo2*10/100;
                      //$costoVentaValor=(($corte+$merma+$totalOndaKilo+$totalPlacaKilo+$totalPreImpresion+$totalProduccion)*$costoVenta->precio)/100;
                      //  $costoVentaValor=$corte+$merma+$totalProduccion+$totalPreImpresion+$totalMerma;
                      $costoVentaValor=(($totalPlacaKilo+$corte+$totalPlacaKilo2+$merma+$totalProduccion+$totalPreImpresion)*0.17)/2;
                     
                     ?>
                     <tr>
                                            <td class="celda_33">COSTO VENTA</td>
                                            <td class="celda_33">&nbsp;</td>
                                            <td class="celda_33"><?php echo number_format($costoVentaValor,0,'','.')?></td>
                     </tr>
                                                                <td class="celda_3"><?php  number_format($valorPlacaKilo2,0,'','.');?></td>
                                                                <td class="celda_3"><?php  number_format($costoPlacaKilo2,0,'','.')?></td>
                                                                <td class="celda_3"><?php  number_format($totalPlacaKilo2,0,'','.')?></td>
                                                                <?php $totalMerma=$totalPlacaKilo2;		
								}
								else
								{
                                                                ?>
                                                                 <?php $totalMerma=$totalOndaKilo;
                       $corte = $totalPlacaKilo*7/100;
                       $merma = $totalMerma*10/100;
                      $costoVentaValor=(($corte+$merma+$totalOndaKilo+$totalPlacaKilo+$totalPreImpresion+$totalProduccion)*$costoVenta->precio)/100;

                     ?>
                     <tr>
                                            <td class="celda_33">COSTO VENTA</td>
                                            <td class="celda_33">&nbsp;</td>
                                            <td class="celda_33"><?php echo number_format($costoVentaValor,0,'','.')?></td>
                     </tr>
                                                                <td class="celda_3"><?php //echo number_format($valorOndaKilo,0,'','.');?></td>
                                                                <td class="celda_3"><?php //echo number_format($costoOndaKilo,0,'','.')?></td>
                                                                <td class="celda_3"><?php //echo number_format($totalOndaKilo,0,'','.')?></td>
                                                                <?php $totalMerma=$totalOndaKilo;
								}
                                                                ?>
                     <?php
                     $corte = $totalPlacaKilo*7/100;
                     $merma = $totalMerma*10/100;
                     
                     if($fotomecanica->materialidad_datos_tecnicos == 'Cartulina-cartulina')
								{
									$totalMateriaPrima= $totalPlacaKilo+$totalPlacaKilo2+$porcentajeTotalMerma+$porcentajeTotalCorte;
								}else
								{
									$totalMateriaPrima= $totalOndaKilo+$totalPlacaKilo+$porcentajeTotalMerma+$porcentajeTotalCorte;	
								}
                      //$costoAdministracionValor=(($merma+$corte+$totalOndaKilo+$totalPlacaKilo+$totalPreImpresion+$totalProduccion)*$costoAdministracion->precio)/100;
                      //$costoVentaValor=(($merma+$corte+$totalOndaKilo+$totalPlacaKilo+$totalPreImpresion+$totalProduccion)*$costoAdministracion->precio)/100;
                      $costoAdministracionValor=(($totalMateriaPrima+$corte+$merma+$totalProduccion+$totalPreImpresion)*0.17)/2; 
                      //$costoAdministracionValor=(($totalPlacaKilo+$corte+$totalPlacaKilo2+$merma+$totalProduccion+$totalPreImpresion)*0.17)/2;                     
                       
                     ?>
                     <tr>
                                            <td class="celda_33">COSTO ADMINISTRACIÓN</td>
                                            <td class="celda_33">&nbsp;</td>
                                            <td class="celda_33"><?php echo number_format($costoAdministracionValor,0,'','.')?></td>
                                        </tr>
					 <tr>
                                            <td class="celda_33">COSTO ADICIONAL POR UNIDAD</td>
                                            <td class="celda_33"><?php if($hoja->valor_extra == ''){ $valor_extra=$datos->varios_migrado; echo number_format($valor_extra,0,'','.');}else{echo number_format($hoja->valor_extra,0,'','.'); $valor_extra=$hoja->valor_extra;}?>
                                            <!--<a href="<?php //echo base_url()?>hoja/valores_extras/<?php //echo $id?>/1" class="fancybox fancybox.ajax"><img src="<?php //echo base_url()?>public/frontend/images/edit.png" class="img_16" /></a>-->
                                            <?php if($hoja->impreso!=1){echo "<a href='".base_url()."hoja/valores_extras/".$id."/1' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";}else{echo "<a href='".base_url()."hoja2/valores_extras/".$id."/1' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";} ?>
                                            <input type="hidden"  id="valor_extra" name="valor_extra" value="<?php echo $valor_extra; ?>" /></td>
                                            <td class="celda_33"><?php echo number_format($hoja->valor_extra*$datoscantidad1,0,'','.') ?></td>
                                        </tr>                           
                     <?php
                      $totalcostoadicional = $hoja->valor_extra*$datoscantidad1;                 
                      $totalCostosVarios=$totalcostoadicional+$costoAdministracionValor+$costoVentaValor+$hoja->costo_adicional+$valor_extra;
//                      echo "<h1>-----------------</h1>";
//                      echo "<h1>a$costoAdministracionValor</h1>";
//                      echo "<h1>b$costoVentaValor</h1>";
//                      echo "<h1>c$hoja->costo_adicional</h1>";
//                      echo "<h1>d$valor_extra</h1>";
                     ?>
                     <tr>
                                            <td class="celda_33">TOTAL COSTOS VARIOS</td>
                                            <td class="celda_33">&nbsp;</td>
                                            <td class="celda_33"><?php echo number_format($totalCostosVarios,0,'','.')?></td>
                                        </tr>
                                    </table>
                                    <!--/producción-->
                                </td>
                            </tr>

                            </tr>
                            <?php
                            if(sizeof($hoja)>=1)
                            {
                                $arreglo6=array
                                (
                                    "onda_kilo"=>$costoOndaKilo,
                                );
                                $this->db->where('id', $hoja->id);
                                $this->db->update("hoja_de_costos_datos",$arreglo6);
                                  //     echo $this->db->last_query();
                            }
							
							
							
                            ?>
                            <tr>  
                            <td class="celda_3">CORTE:7 %</td>
                            <td class="celda_3"><?php //echo number_format($costoPlacaKilo2,0,'','.')?></td>
                            <td class="celda_3"><?php $porcentajeTotalCorte =$totalPlacaKilo*7/100; echo number_format((($totalPlacaKilo*7)/(100)),0,'','.')?></td>
                            </tr>
                            <tr>
					  <?php

                                                                
								if($fotomecanica->materialidad_datos_tecnicos == 'Cartulina-cartulina')
								{
                                                                $costoPlacaKilo2 = ($datoscantidad1/$ing->unidades_por_pliego);

                                                                $cuatro_por_ciento = ($costoPlacaKilo2 / 100)* 4;
							
                                                                //if($costoPlacaKilo2 >= 1 and $costoPlacaKilo2 <= 100)
                                                                if($cuatro_por_ciento >= 1 and $cuatro_por_ciento <= 100)
                                                                {
                                                                        if($fotomecanica->colores==0){
                                                                        $agregado_a_apliegos = 25;
                                                                        }else{    
                                                                        $agregado_a_apliegos = 100;
                                                                        }
                                                                }

                                                                if($cuatro_por_ciento > 100)
                                                                {
                                                                        $agregado_a_apliegos = $cuatro_por_ciento;
                                                                }
                                                                $costoPlacaKilo2 = $costoPlacaKilo2 + $agregado_a_apliegos;
                                                                $valorPlacaKilo2 = ($costoPlacaKilo2*$tamano1*$tamano2*$tapaGramaje3)/10000000;
                                                                //$valorPlacaKilo2 = number_format($valorPlacaKilo2,0,'','.');
                                                                
                                                                $totalPlacaKilo2 = $valorPlacaKilo2*$tapaPrecio3;
							
                                                                ?>
                                                                <td class="celda_3">TAPA KILO (RESPALDO):<?php echo number_format($valorPlacaKilo2,0,'','.');?></td>
                                                                <td class="celda_3"><?php echo number_format($costoPlacaKilo2,0,'','.')?></td>
                                                                <td class="celda_3"><?php echo number_format($totalPlacaKilo2,0,'','.')?></td>
                                                                <?php $totalMerma=$totalPlacaKilo2;		
                                                                   
                                                                
                                                                }
								else
								{
                                                                   
                                                                   
                                                                ?>		
                                                                <td class="celda_3">ONDA KILO <?php echo number_format($valorOndaKilo,0,'','.');?></td>
                                                                <td class="celda_3"><?php echo number_format($costoOndaKilo,0,'','.')?></td>
                                                                <td class="celda_3"><?php echo number_format($totalOndaKilo,0,'','.')?></td>
                                                                <?php $totalMerma=$totalOndaKilo;
								}
                                                                
                                                                ?>
                                                                
                             <?php
                     $corte = $totalPlacaKilo*7/100;
                     $merma = $totalMerma*10/100;
//                      echo "<h1>--------deta---------</h1>";
//                      echo "<h1>ondakilo$totalOndaKilo</h1>";
//                      echo "<h1>placakilo$totalPlacaKilo</h1>";
//                      echo "<h1>preimpre$totalPreImpresion</h1>";
//                      echo "<h1>prod$totalProduccion</h1>";
//                      echo "<h1>cost$costoAdministracion->precio</h1>";
//                      echo "<h1>$totalMateriaPrima</h1>";
//                      echo "<h1>$corte</h1>";
//                      echo "<h1>$merma</h1>";
                      $costoAdministracionValor=(($merma+$corte+$totalOndaKilo+$totalPlacaKilo+$totalPreImpresion+$totalProduccion)*$costoAdministracion->precio)/100;
                      //echo "<h1>$costoAdministracionValor</h1>";
                             
                             ?>                                   
                            </tr>
                            <tr>
                            <td class="celda_3">MERMA:10 %</td>
                            <td class="celda_3"><?php //echo number_format($costoPlacaKilo2,0,'','.')?></td>
                            <td class="celda_3"><?php $porcentajeTotalMerma =$totalMerma*10/100; echo number_format((($totalMerma*10)/(100)),0,'','.')?></td>
                            </tr>
                            <tr>
                                <td class="celda_3">VARIOS</td>
                                <td class="celda_3">0</td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <?php
							if($fotomecanica->materialidad_datos_tecnicos == 'Cartulina-cartulina')
								{
									$totalMateriaPrima= $totalPlacaKilo+$totalPlacaKilo2+$porcentajeTotalMerma+$porcentajeTotalCorte;
								}else
								{
									$totalMateriaPrima= $totalOndaKilo+$totalPlacaKilo+$porcentajeTotalMerma+$porcentajeTotalCorte;	
								}
                            
                            ?>
                      <tr>
                                <td class="celda_3"><span class="subrayado_top">TOTAL MATERIA PRIMA</span></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"><?php echo number_format($totalMateriaPrima,0,'','.')?></td>
                            </tr>
                            <tr>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                      <tr>
                                <td class="celda_3">PRE-IMPRESIÓN</td>
                                <td class="celda_3">CANTIDAD</td>
                                <td class="celda_3">VALOR $</td>
                            </tr>
                            <tr>
                                <td colspan="3"><hr class="hr_punteada" /></td>
                            </tr>
                            <tr>
                                <!--<td class="celda_3">ARTE <?php //echo $coloresArte?></td>-->
                                <td class="celda_3">ARTE <?php echo $coloresArte?></td>
                                <td class="celda_3"><?php echo number_format($arte->precio,0,'','.')?></td>
                                <td class="celda_3"><?php echo number_format($cantidadArte,0,'','.')?></td>
                            </tr>
                            <tr>
                                <td class="celda_3">PLANCHAMETAL <?php echo $coloresPlanchaMetal?></td>
                                <td class="celda_3"><?php echo number_format($plancha_metal->precio,0,'','.')?></td>
                                <td class="celda_3"><?php echo number_format($cantidadPlantaMetal,0,'','.')?></td>
                            </tr>
                            <tr>
                                <td class="celda_3">COPIADO <?php echo $coloresCopiado?></td>
                                <td class="celda_3"><?php echo number_format($copiado->precio,0,'','.')?></td>
                                <td class="celda_3"><?php echo number_format($cantidadCopiapo,0,'','.')?></td>
                            </tr>
                            <tr>
                                <td class="celda_3">PELÍCULAS <?php echo $coloresPeliculas?></td>
                                <td class="celda_3"><?php if($fotomecanica->condicion_del_producto=='Repetición Sin Cambios'){echo '0';}else{echo number_format($peliculasPreImpresion->precio,0,'','.');}?></td>
                                <td class="celda_3"><?php echo number_format($cantidadPeliculas,0,'','.')?></td>
                            </tr>
                            <tr>
                                <td class="celda_3">MONTAJE <?php echo $coloresMontaje;?></td>
                                <td class="celda_3"><?php if($fotomecanica->condicion_del_producto=='Repetición Sin Cambios'){echo '0';}else{echo number_format($montajePreImpresion->precio,0,'','.');}?></td>
                                <?php if ($fotomecanica->condicion_del_producto=='Repetición Sin Cambios') { ?>
                                <td class="celda_3"><?php echo number_format(0,0,'','.')?></td>
                                <?php } else { ?>
                                <td class="celda_3"><?php echo number_format($cantidadMontaje,0,'','.')?></td>
                                <?php } ?>                                
                            </tr>
                            <tr>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3">CROMALÍN<?php echo $coloresCromalin?></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"><?php echo number_format($cromalin,0,'','.')?></td>
                            </tr>
                            <tr>
                                <td colspan="3"><hr class="hr_punteada" /></td>
                            </tr>
                            <tr>
                                <td class="celda_3">TOTAL PRE-IMPRESIÓN</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"><?php echo number_format($totalPreImpresion,0,'','.')?></td>
                            </tr>
                        </table>
                         <table id="tabla_detalle">
                            <tr>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td colspan="6"><hr class="hr_punteada" /></td>
                            </tr>
                         <?php
                        
                        if($fotomecanica->materialidad_datos_tecnicos == 'Cartulina-cartulina')
								{
									$totalMateriaPrima= $totalPlacaKilo+$totalPlacaKilo2+$porcentajeTotalMerma+$porcentajeTotalCorte;
								}else
								{
									$totalMateriaPrima= $totalOndaKilo+$totalPlacaKilo+$porcentajeTotalMerma+$porcentajeTotalCorte;	
								}
                        
                         ?>
                         <tr>
                                <td class="celda_3">TOTAL MATERIA PRIMA</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"><?php echo number_format($totalMateriaPrima,0,'','.')?></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3">TOTAL PRE-IMPRESIÓN</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"><?php echo number_format($totalPreImpresion,0,'','.')?></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3">TOTAL PRODUCCIÓN</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"><?php echo number_format($totalProduccion,0,'','.')?></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td colspan="5">-------------------------------------------------------------------------------------------------------------------</td>
                            </tr>
                            <tr>
                                <td class="celda_3">SUB TOTAL</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"><?php echo number_format(($totalProduccion+$totalPreImpresion+$totalMateriaPrima),0,'','.')?></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                         <?php
                         
                          
                           
                           
                           $totalTotal=$totalMateriaPrima+$totalPreImpresion+$totalProduccion+$totalCostosVarios;                                               
                           $totalValorUnitario=$totalTotal/$datoscantidad1;

                          
                          if ($hoja->margen!="") {
                            $valorFinal=(($totalValorUnitario/(100-$hoja->margen))/100)*10000;
                          
                          }else{ 
                              if($datos->margen_migrado!=0 || $datos->margen_migrado!=null){
                                  $valorFinal=(($totalValorUnitario/(100-$datos->margen_migrado))/100)*10000;
                                  $valorFinal2xxx = $this->cotizaciones_model->CantidadPorXXX($id,$datoscantidad2,2);
                                  $valorFinal3xxx = $this->cotizaciones_model->CantidadPorXXX($id,$datoscantidad3,3);
                                  $valorFinal4xxx = $this->cotizaciones_model->CantidadPorXXX($id,$datoscantidad4,4);
                                  
                              }else{
                                  $valorFinal=(($totalValorUnitario/(100-15))/100)*10000;
                                  $valorFinal2xxx = $this->cotizaciones_model->CantidadPorXXX($id,$datoscantidad2,2);
                                  $valorFinal3xxx = $this->cotizaciones_model->CantidadPorXXX($id,$datoscantidad3,3);
                                  $valorFinal4xxx = $this->cotizaciones_model->CantidadPorXXX($id,$datoscantidad4,4);
                              }

                          }
                         ?>
                          <tr>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"><span class="subrayado"><h5>VALOR POR</h5></span></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"><h5><?php echo number_format($datoscantidad1,0,'','.')?></h5></td>
                            </tr>                                
                          <tr>
                                <td class="celda_3">SUBTOTAL TOTAL</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"><?php echo number_format($totalProduccion+$totalPreImpresion+$totalMateriaPrima,0,'','.')?></td>
                                <td class="celda_3"></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"><?php// echo number_format($valorFinal,0,'','.')?></td>
                            </tr>
                            <?php 
                            $subtotal = $totalProduccion+$totalPreImpresion+$totalMateriaPrima;
                            $totalcostosvariosact=(($totalProduccion+$totalPreImpresion+$totalMateriaPrima)*17)/100;?>
                          <tr>
                                <td class="celda_3">TOTAL COSTOS VARIOS</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"><?php 
                                //echo number_format($totalCostosVarios,0,'','.');
                                echo number_format($totalcostosvariosact,0,'','.');
                                ?></td>
                                <td class="celda_3"><span class="subrayado">VALOR FINAL</span></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"><?php echo number_format($valorFinal,0,'','.')?></td>
                            </tr>
                        
                <?php       
                            $vcostoFinanciero=$this->variables_cotizador_model->getVariablesCotizadorPorId(33);
                            $recargoPorCantidadJusta=$this->variables_cotizador_model->getVariablesCotizadorPorId(37);
										
                            $valorFinanciado=$valorFinal*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
                            echo "<input type='hidden' value='".$valorFinanciado."' name='vf1' id='vf1'/>";
                            
                            $valorFinanciado2=$valorFinal2xxx*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
                            $valorFinanciado3=$valorFinal3xxx*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
                            $valorFinanciado4=$valorFinal4xxx*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
                          //  echo "<h1>$valorFinal2xxx</h1>";
							
                            if($datos->acepta_excedentes=='NO')
                            {
                                $valorFinanciado=(((100+$recargoPorCantidadJusta->precio)/100)*$valorFinanciado);
                                $valorFinanciado2=(((100+$recargoPorCantidadJusta->precio)/100)*$valorFinanciado2);
                                $valorFinanciado3=(((100+$recargoPorCantidadJusta->precio)/100)*$valorFinanciado3);
                                $valorFinanciado4=(((100+$recargoPorCantidadJusta->precio)/100)*$valorFinanciado4);
                            }
                            
                            if($datoscantidad2==0){
                                $datoscantidad2 = 1;
                            }else{
                                $datoscantidad2 = $datoscantidad2;
                            }
                            if($datoscantidad3==0){
                                $datoscantidad3 = 1;
                            }else{
                                $datoscantidad3 = $datoscantidad3;
                            }
                            if($datoscantidad4==0){
                                $datoscantidad4 = 1;
                            }else{
                                $datoscantidad4 = $datoscantidad4;
                            }
                            $var2 = (((($totalProduccion2+$totalDefi1+$totalPreImpresion)*0.085)+(($totalProduccion2+$totalDefi1+$totalPreImpresion)*0.085)+($totalProduccion2+$totalDefi1+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad2;
                            $var3 = (((($totalProduccion3+$totalDefi2+$totalPreImpresion)*0.085)+(($totalProduccion3+$totalDefi2+$totalPreImpresion)*0.085)+($totalProduccion3+$totalDefi2+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad3;
                            $var4 = (((($totalProduccion4+$totalDefi3+$totalPreImpresion)*0.085)+(($totalProduccion4+$totalDefi3+$totalPreImpresion)*0.085)+($totalProduccion4+$totalDefi3+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad4;
			    $cf2= $var2*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
			    $cf3= $var3*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
			    $cf4= $var4*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
			    $valorFinanciado2= $var2*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
			    $valorFinanciado3= $var3*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
			    $valorFinanciado4= $var4*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
                            
                            
                ?>
							<tr>
                                <td colspan="3"><hr class="hr_punteada" /></td>
                                <td class="celda_3">VALOR FINANCIADO <?php echo $forma_pago->forma_pago?> (<?php echo $forma_pago->dias?>)</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"><?php echo number_format($valorFinanciado,0,'','.')?> <input type="hidden" name="valor_financiado" value="<?php echo $valorFinanciado?>" /> </td>
								
                            </tr>
                            <?php
                           
                                if(sizeof($hoja)==0)
                                {
                                    if(($fotomecanica->materialidad_datos_tecnicos=="Indefinido") || ($fotomecanica->materialidad_datos_tecnicos=="Microcorrugado") || ($fotomecanica->materialidad_datos_tecnicos=="Corrugado")  || ($fotomecanica->materialidad_datos_tecnicos=="Cartulina-cartulina"))
                                    {        
                                        $valorEmpresa=$datos->precio_migrado;
                                    }
                                    else {
                                        $valorEmpresa=$valorFinanciado;
                                    }                                    
                                }else
                                {
                                    
                                    if(($fotomecanica->materialidad_datos_tecnicos=="Indefinido") || ($fotomecanica->materialidad_datos_tecnicos=="Microcorrugado") || ($fotomecanica->materialidad_datos_tecnicos=="Corrugado")  || ($fotomecanica->materialidad_datos_tecnicos=="Cartulina-cartulina"))
                                    {        
                                        $valorEmpresa=$datos->precio_migrado;
                                        if($valorEmpresa==0){
                                            $valorEmpresa = $valorFinanciado;
                                        }else{
                                            $valorEmpresa = $datos->precio_migrado;
                                            
                                        }
                                    }
                                    else {
                                        $valorEmpresa=$valorFinanciado;
                                    }      
                                }
                          
                               
                            ?>
                            <tr>
                                <td class="celda_3">TOTAL</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"><?php echo number_format($totalTotal, 0, '', '.') ?></td>
                                <td class="celda_3"><h5>VALOR EMPRESA</h5></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"><h5><?php
                                    if (sizeof($hoja) == 0) {
                                        if ($valorEmpresa == 0) {
                                            echo number_format($valorFinanciado, 0, '', '.');
                                            $valorEmpresa = $valorFinanciado;
                                        } else {
                                            echo number_format($valorEmpresa, 0, '', '.');
                                            $valorEmpresa = $valorEmpresa;
                                        }
                                    } else {
                                        if($hoja->valor_empresa==0 || $hoja->valor_empresa==""){
                                            echo number_format($valorFinanciado, 0, '', '.');
                                            $valorEmpresa = $valorFinanciado;
                                        }else{
                                            echo number_format($hoja->valor_empresa, 0, '', '.');
                                            $valorEmpresa = $hoja->valor_empresa;
                                        }
                                    }
                                   echo "<input type='hidden' value='".$valorEmpresa."' name='ve1' id='ve1'/>";
                                    ?>
                                    <!--<a href="<?php// echo base_url() ?>hoja/valor_empresa/<?php //echo $id ?>/<?php //echo $pagina ?>/<?php// echo $valorFinanciado; ?>" class="fancybox fancybox.ajax"><img src="<?php //echo base_url() ?>public/frontend/images/edit.png" class="img_16" /></a>-->
                                    <?php if($hoja->impreso!=1){echo "<a href='".base_url()."hoja/valor_empresa/".$id."/".$pagina."/".$valorFinanciado."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";}else{echo "<a href='".base_url()."hoja2/valor_empresa/".$id."/".$pagina."/".$valorFinanciado."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";} ?>
                                    <input type="hidden" name="valor_empresa" value="<?php
                                    if (sizeof($hoja) == 0) {
                                        if ($valorEmpresa == 0 || $valorEmpresa == null){   
                                            echo number_format($valorFinanciado, 0, '', '.');
                                            $valorEmpresa = $valorFinanciado;
                                        } else {
                                            echo number_format($valorEmpresa, 0, '', '.');
                                        }
                                    } else {
                                       echo $hoja->valor_empresa;
                                    }
                                    ?>" /></h5></td>
                            </tr>
                            <tr>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">DÍAS DE ENTREGA</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"><?php if (sizeof($hoja) == 0) {
                                echo '20';
                            } else {
                                echo $hoja->dias_de_entrega;
                            } ?>
                            <!--<a href="<?php //echo base_url() ?>hoja/dias/<?php// echo $id ?>/<?php //echo $pagina ?>" class="fancybox fancybox.ajax"><img src="<?php// echo base_url() ?>public/frontend/images/edit.png" class="img_16" /></a>-->
                            <?php if($hoja->impreso!=1){echo "<a href='".base_url()."hoja/dias/".$id."/".$pagina."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";}else{echo "<a href='".base_url()."hoja2/dias/".$id."/".$pagina."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";} ?>
                            <input type="hidden" name="dias_de_entrega" value="<?php echo $hoja->dias_de_entrega ?>" /></td>
                            </tr>
                            <tr>
                                <td class="celda_3">VALOR UNITARIO</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"><?php echo number_format($totalValorUnitario,0,'','.')?></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3">MARGEN</td>
                                        <?php
                                        if(sizeof($hoja)==0) { ?>
                                        <td class="celda_3"><?php if($datos->margen_migrado!=0 || $datos->margen_migrado!= null){echo $datos->margen_migrado;}else{echo "15";} ?> <a href="<?php echo base_url()?>hoja/margen/<?php echo $id?>/<?php echo $pagina?>" class="fancybox fancybox.ajax"><img src="<?php echo base_url()?>public/frontend/images/edit.png" class="img_16" /></a><input type="hidden" name="margen" value="<?php if($datos->margen_migrado!=0 || $datos->margen_migrado!= null){echo $datos->margen_migrado;}else{echo "15";} ?>" /></td>
					  <?php } else { ?>
                                        <td class="celda_3"><?php if($hoja->margen == null){echo '15';}else{echo $hoja->margen;}?> 
                                            <!--<a href="<?php //echo base_url()?>hoja/margen/<?php //echo $id?>/<?php //echo $pagina?>" class="fancybox fancybox.ajax"><img src="<?php //echo base_url()?>public/frontend/images/edit.png" class="img_16" /></a>-->
                                            <?php if($hoja->impreso!=1){echo "<a href='".base_url()."hoja/margen/".$id."/".$pagina."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";}else{echo "<a href='".base_url()."hoja2/margen/".$id."/".$pagina."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";} ?>
                                            <input type="hidden" name="margen" value="<?php echo $hoja->margen?>" /></td>
					<?php }  ?>                                     
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                        </table>
                        <div class="separador_20">&nbsp;</div>
                        <?php
                       
                       if(sizeof($hoja)==0) { 
                        $variablePegado=$this->variables_cotizador_model->getVariablesCotizadorPorId(21);
                        $totalPegado=$datoscantidad2*$pegado_migrado*$variablePegado->precio;                                               
                        $totalPegado2=$datoscantidad3*$pegado_migrado*$variablePegado->precio;                                               
                        $totalPegado3=$datoscantidad4*$pegado_migrado*$variablePegado->precio;                                               
                         } else { 
                        $variablePegado=$this->variables_cotizador_model->getVariablesCotizadorPorId(21);
                        $totalPegado=$datoscantidad2*$hoja->pegado*$variablePegado->precio;                                              
                        $totalPegado2=$datoscantidad3*$hoja->pegado*$variablePegado->precio;                                              
                        $totalPegado3=$datoscantidad4*$hoja->pegado*$variablePegado->precio;                                              
                        }
                        
                         if(sizeof($hoja->pegado)>=1)
                         {
                            $divisionPegado=$hoja->pegado/2;
                            $totalDespacho2=$divisionPegado*$datoscantidad2;
                         }
                         else
                         {
                            $divisionPegado=$pegado_migrado/2;
                            $totalDespacho2=$divisionPegado*$datoscantidad2;
                           // echo $totalDespacho2;
                         }
                                         
                        if(sizeof($hoja->pegado)>=1)
                         {
                            $divisionPegado=$hoja->pegado/2;
                            $totalDespacho3=$divisionPegado*$datoscantidad3;
                         }
                         else
                         {
                             if ($datos->pegado_migrado=='')
                                $divisionPegado=$presupuesto->costo_pegado/2;
                             else
                                $divisionPegado=$datos->pegado_migrado/2;
                             $totalDespacho3=$divisionPegado*$datoscantidad3;	 
                         }
                        if(sizeof($hoja->pegado)>=1)
                         {
                            $divisionPegado=$hoja->pegado/2;
                            $totalDespacho4=$divisionPegado*$datoscantidad4;
                         }
                         else
                         {
                             if ($datos->pegado_migrado=='')
                                $divisionPegado=$presupuesto->costo_pegado/2;
                             else
                                $divisionPegado=$datos->pegado_migrado/2;
                             $totalDespacho4=$divisionPegado*$datoscantidad4;	 
                         }
                         
                         //*******************************************
                        $externos_produccion=0;
				if($fotomecanica->acabado_impresion_4=="17")
                                {
                                    $acabado_4="";
                                    $acabado_4Valor="";
                                    $acabado_4MedidaMasValorVenta="";
                                    $acabado_4Unitario="";
                                    $acabado_4UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_4Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_4);
                                    $acabado_4=$acabado_4Array->caracteristicas; // Nombre acabado
                                    $acabado_4UnidadVentaNombre=$acabado_4Array->unv; //Nombre unidad de venta
                                    $acabado_4Valor=$acabado_4Array->valor_venta; // ej: 52
                                    $acabado_4MedidaMasValorVenta=($tamano1*$tamano2*$acabado_4Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_4CostoFijo=$acabado_4Array->costo_fijo;	
                                    
                                    if ($acabado_4Array->unidad_de_venta == '1') //Metros
                                    {
                                        $costo_unitario4=$acabado_4MedidaMasValorVenta;
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad3);
                                        $cantidad_4=$datoscantidad3;
                                    }
                                    elseif ($acabado_4Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $costo_unitario4=$acabado_4Valor;
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }  
                                    elseif ($acabado_4Array->unidad_de_venta == '3') //tONELADA
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad3);
                                    }                                    
                                    elseif ($acabado_4Array->unidad_de_venta == '4') //caja de carton
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad3);
                                    }                                            
                                    elseif ($acabado_4Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($datoscantidad3*$acabado_4Valor);
                                        $cantidad_4=$datoscantidad3;
                                    }       
                                    elseif ($acabado_4Array->unidad_de_venta == '6') //cm2
                                    {
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $costo_unitario4=$acabado_4Valor;     
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }   
                                    elseif ($acabado_4Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario4=$acabado_4MedidaMasValorVenta;
                                        $precio_total_4=$acabado_4MedidaMasValorVenta*$datoscantidad3;
                                        $cantidad_4=$datoscantidad3;
                                    }
                                    elseif ($acabado_4Array->unidad_de_venta == '8') //cms
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad3);
                                    }           
                                    elseif ($acabado_4Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }     
                                    elseif ($acabado_4Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($acabado_4Valor*$datoscantidad3);
                                        $cantidad_4=$datoscantidad3;                                        
                                    }                                      
                                }
								
                                if($fotomecanica->acabado_impresion_5=="17")
                                {
                                    $acabado_5="";
                                    $acabado_5Valor="";
                                    $acabado_5MedidaMasValorVenta="";
                                    $acabado_5Unitario="";
                                    $acabado_5UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_5Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_5);
                                    $acabado_5=$acabado_5Array->caracteristicas;
                                    $acabado_5UnidadVentaNombre=$acabado_5Array->unv; //Nombre unidad de venta
                                    $acabado_5Valor=$acabado_5Array->valor_venta; // ej: 52
                                    $acabado_5MedidaMasValorVenta=($tamano1*$tamano2*$acabado_5Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_5CostoFijo=$acabado_5Array->costo_fijo;		
                                  if ($acabado_5Array->unidad_de_venta == '1') //mt2
                                    {
                                        $costo_unitario5=$acabado_5MedidaMasValorVenta;
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad3);                                      
                                        $cantidad_5=$datoscantidad3;
                                    }
                                    elseif ($acabado_5Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $costo_unitario5=$acabado_5Valor; 
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }    
                                    elseif ($acabado_5Array->unidad_de_venta == '3') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad3);
                                    }                                    
                                    elseif ($acabado_5Array->unidad_de_venta == '4') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad3);
                                    }                                            
                                    elseif ($acabado_5Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($datoscantidad3*$acabado_5Valor);
                                        $cantidad_5=$datoscantidad3;
                                    }       
                                    elseif ($acabado_5Array->unidad_de_venta == '6') //mt2
                                    {
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $costo_unitario5=$acabado_5Valor;
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }   
                                    elseif ($acabado_5Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario5=$acabado_5MedidaMasValorVenta;
                                        $precio_total_5=$acabado_5MedidaMasValorVenta*$datoscantidad3;
                                        $cantidad_5=$datoscantidad3;
                                    }
                                    elseif ($acabado_5Array->unidad_de_venta == '8') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad3);
                                    }           
                                    elseif ($acabado_5Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }   
                                    elseif ($acabado_5Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($acabado_5Valor*$datoscantidad3);
                                        $cantidad_5=$datoscantidad3;
                                    }                                      
                                }    
                                if($fotomecanica->acabado_impresion_6=="17")
                                {
                                    $acabado_6="";
                                    $acabado_6Valor="";
                                    $acabado_6MedidaMasValorVenta="";
                                    $acabado_6Unitario="";
                                    $acabado_6UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_6Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_6);
                                    $acabado_6=$acabado_6Array->caracteristicas;
                                    $acabado_6UnidadVentaNombre=$acabado_6Array->unv; //Nombre unidad de venta
                                    $acabado_6Valor=$acabado_6Array->valor_venta; // ej: 52
                                    $acabado_6MedidaMasValorVenta=($tamano1*$tamano2*$acabado_6Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_6CostoFijo=$acabado_6Array->costo_fijo;		
                                    if ($acabado_6Array->unidad_de_venta == '1') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad3);
                                    }
                                    elseif ($acabado_6Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $costo_unitario6=$acabado_6Valor; 
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    }  
                                    elseif ($acabado_6Array->unidad_de_venta == '3') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad3);
                                    }                                    
                                    elseif ($acabado_6Array->unidad_de_venta == '4') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad3);
                                    }                                            
                                    elseif ($acabado_6Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($datoscantidad3*$acabado_5Valor);
                                        $cantidad_6=$datoscantidad3;
                                    }       
                                    elseif ($acabado_6Array->unidad_de_venta == '6') //mt2
                                    {
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $costo_unitario6=$acabado_6Valor;
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    }   
                                    elseif ($acabado_6Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario6=$acabado_6MedidaMasValorVenta;
                                        $precio_total_6=$acabado_6MedidaMasValorVenta*$datoscantidad3;
                                        $cantidad_6=$datoscantidad3;
                                    }
                                    elseif ($acabado_6Array->unidad_de_venta == '8') //cms
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad3);
                                    }           
                                    elseif ($acabado_6Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    } 
                                    elseif ($acabado_6Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($acabado_6Valor*$datoscantidad3);
                                        $cantidad_6=$datoscantidad3;
                                    }                                      
									

                                }            
                        //*******************************************
              $externos_produccion3=$precio_total_4+$precio_total_5+$precio_total_6;
                        $externos_produccion=0;
				if($fotomecanica->acabado_impresion_4=="17")
                                {
                                    $acabado_4="";
                                    $acabado_4Valor="";
                                    $acabado_4MedidaMasValorVenta="";
                                    $acabado_4Unitario="";
                                    $acabado_4UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_4Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_4);
                                    $acabado_4=$acabado_4Array->caracteristicas; // Nombre acabado
                                    $acabado_4UnidadVentaNombre=$acabado_4Array->unv; //Nombre unidad de venta
                                    $acabado_4Valor=$acabado_4Array->valor_venta; // ej: 52
                                    $acabado_4MedidaMasValorVenta=($tamano1*$tamano2*$acabado_4Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_4CostoFijo=$acabado_4Array->costo_fijo;	
                                    
                                    if ($acabado_4Array->unidad_de_venta == '1') //Metros
                                    {
                                        $costo_unitario4=$acabado_4MedidaMasValorVenta;
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad4);
                                        $cantidad_4=$datoscantidad4;
                                    }
                                    elseif ($acabado_4Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $costo_unitario4=$acabado_4Valor;
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }  
                                    elseif ($acabado_4Array->unidad_de_venta == '3') //tONELADA
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad4);
                                    }                                    
                                    elseif ($acabado_4Array->unidad_de_venta == '4') //caja de carton
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad4);
                                    }                                            
                                    elseif ($acabado_4Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($datoscantidad3*$acabado_4Valor);
                                        $cantidad_4=$datoscantidad4;
                                    }       
                                    elseif ($acabado_4Array->unidad_de_venta == '6') //cm2
                                    {
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $costo_unitario4=$acabado_4Valor;     
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }   
                                    elseif ($acabado_4Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario4=$acabado_4MedidaMasValorVenta;
                                        $precio_total_4=$acabado_4MedidaMasValorVenta*$datoscantidad4;
                                        $cantidad_4=$datoscantidad4;
                                    }
                                    elseif ($acabado_4Array->unidad_de_venta == '8') //cms
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad4);
                                    }           
                                    elseif ($acabado_4Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }     
                                    elseif ($acabado_4Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($acabado_4Valor*$datoscantidad4);
                                        $cantidad_4=$datoscantidad4;                                        
                                    }                                      
                                }
								
                                if($fotomecanica->acabado_impresion_5=="17")
                                {
                                    $acabado_5="";
                                    $acabado_5Valor="";
                                    $acabado_5MedidaMasValorVenta="";
                                    $acabado_5Unitario="";
                                    $acabado_5UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_5Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_5);
                                    $acabado_5=$acabado_5Array->caracteristicas;
                                    $acabado_5UnidadVentaNombre=$acabado_5Array->unv; //Nombre unidad de venta
                                    $acabado_5Valor=$acabado_5Array->valor_venta; // ej: 52
                                    $acabado_5MedidaMasValorVenta=($tamano1*$tamano2*$acabado_5Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_5CostoFijo=$acabado_5Array->costo_fijo;		
                                  if ($acabado_5Array->unidad_de_venta == '1') //mt2
                                    {
                                        $costo_unitario5=$acabado_5MedidaMasValorVenta;
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad4);                                      
                                        $cantidad_5=$datoscantidad4;
                                    }
                                    elseif ($acabado_5Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $costo_unitario5=$acabado_5Valor; 
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }    
                                    elseif ($acabado_5Array->unidad_de_venta == '3') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad4);
                                    }                                    
                                    elseif ($acabado_5Array->unidad_de_venta == '4') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad4);
                                    }                                            
                                    elseif ($acabado_5Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($datoscantidad4*$acabado_5Valor);
                                        $cantidad_5=$datoscantidad4;
                                    }       
                                    elseif ($acabado_5Array->unidad_de_venta == '6') //mt2
                                    {
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $costo_unitario5=$acabado_5Valor;
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }   
                                    elseif ($acabado_5Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario5=$acabado_5MedidaMasValorVenta;
                                        $precio_total_5=$acabado_5MedidaMasValorVenta*$datoscantidad4;
                                        $cantidad_5=$datoscantidad4;
                                    }
                                    elseif ($acabado_5Array->unidad_de_venta == '8') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad4);
                                    }           
                                    elseif ($acabado_5Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }   
                                    elseif ($acabado_5Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($acabado_5Valor*$datoscantidad4);
                                        $cantidad_5=$datoscantidad4;
                                    }                                      
                                }    
                                if($fotomecanica->acabado_impresion_6=="17")
                                {
                                    $acabado_6="";
                                    $acabado_6Valor="";
                                    $acabado_6MedidaMasValorVenta="";
                                    $acabado_6Unitario="";
                                    $acabado_6UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_6Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_6);
                                    $acabado_6=$acabado_6Array->caracteristicas;
                                    $acabado_6UnidadVentaNombre=$acabado_6Array->unv; //Nombre unidad de venta
                                    $acabado_6Valor=$acabado_6Array->valor_venta; // ej: 52
                                    $acabado_6MedidaMasValorVenta=($tamano1*$tamano2*$acabado_6Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_6CostoFijo=$acabado_6Array->costo_fijo;		
                                    if ($acabado_6Array->unidad_de_venta == '1') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad4);
                                    }
                                    elseif ($acabado_6Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $costo_unitario6=$acabado_6Valor; 
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    }  
                                    elseif ($acabado_6Array->unidad_de_venta == '3') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad4);
                                    }                                    
                                    elseif ($acabado_6Array->unidad_de_venta == '4') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad4);
                                    }                                            
                                    elseif ($acabado_6Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($datoscantidad4*$acabado_5Valor);
                                        $cantidad_6=$datoscantidad4;
                                    }       
                                    elseif ($acabado_6Array->unidad_de_venta == '6') //mt2
                                    {
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $costo_unitario6=$acabado_6Valor;
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    }   
                                    elseif ($acabado_6Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario6=$acabado_6MedidaMasValorVenta;
                                        $precio_total_6=$acabado_6MedidaMasValorVenta*$datoscantidad4;
                                        $cantidad_6=$datoscantidad4;
                                    }
                                    elseif ($acabado_6Array->unidad_de_venta == '8') //cms
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad4);
                                    }           
                                    elseif ($acabado_6Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    } 
                                    elseif ($acabado_6Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($acabado_6Valor*$datoscantidad4);
                                        $cantidad_6=$datoscantidad4;
                                    }                                      
									

                                }            
                        //*******************************************
              $externos_produccion4=$precio_total_4+$precio_total_5+$precio_total_6;
                         //*******************************************
                        $externos_produccion=0;
				if($fotomecanica->acabado_impresion_4=="17")
                                {
                                    $acabado_4="";
                                    $acabado_4Valor="";
                                    $acabado_4MedidaMasValorVenta="";
                                    $acabado_4Unitario="";
                                    $acabado_4UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_4Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_4);
                                    $acabado_4=$acabado_4Array->caracteristicas; // Nombre acabado
                                    $acabado_4UnidadVentaNombre=$acabado_4Array->unv; //Nombre unidad de venta
                                    $acabado_4Valor=$acabado_4Array->valor_venta; // ej: 52
                                    $acabado_4MedidaMasValorVenta=($tamano1*$tamano2*$acabado_4Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_4CostoFijo=$acabado_4Array->costo_fijo;	
                                    
                                    if ($acabado_4Array->unidad_de_venta == '1') //Metros
                                    {
                                        $costo_unitario4=$acabado_4MedidaMasValorVenta;
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad2);
                                        $cantidad_4=$datoscantidad2;
                                    }
                                    elseif ($acabado_4Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $costo_unitario4=$acabado_4Valor;
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }  
                                    elseif ($acabado_4Array->unidad_de_venta == '3') //tONELADA
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad2);
                                    }                                    
                                    elseif ($acabado_4Array->unidad_de_venta == '4') //caja de carton
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad2);
                                    }                                            
                                    elseif ($acabado_4Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($datoscantidad2*$acabado_4Valor);
                                        $cantidad_4=$datoscantidad2;
                                    }       
                                    elseif ($acabado_4Array->unidad_de_venta == '6') //cm2
                                    {
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $costo_unitario4=$acabado_4Valor;     
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }   
                                    elseif ($acabado_4Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario4=$acabado_4MedidaMasValorVenta;
                                        $precio_total_4=$acabado_4MedidaMasValorVenta*$datoscantidad2;
                                        $cantidad_4=$datoscantidad2;
                                    }
                                    elseif ($acabado_4Array->unidad_de_venta == '8') //cms
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad2);
                                    }           
                                    elseif ($acabado_4Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }     
                                    elseif ($acabado_4Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($acabado_4Valor*$datoscantidad2);
                                        $cantidad_4=$datoscantidad2;                                        
                                    }                                      
                                }
								
                                if($fotomecanica->acabado_impresion_5=="17")
                                {
                                    $acabado_5="";
                                    $acabado_5Valor="";
                                    $acabado_5MedidaMasValorVenta="";
                                    $acabado_5Unitario="";
                                    $acabado_5UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_5Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_5);
                                    $acabado_5=$acabado_5Array->caracteristicas;
                                    $acabado_5UnidadVentaNombre=$acabado_5Array->unv; //Nombre unidad de venta
                                    $acabado_5Valor=$acabado_5Array->valor_venta; // ej: 52
                                    $acabado_5MedidaMasValorVenta=($tamano1*$tamano2*$acabado_5Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_5CostoFijo=$acabado_5Array->costo_fijo;		
                                  if ($acabado_5Array->unidad_de_venta == '1') //mt2
                                    {
                                        $costo_unitario5=$acabado_5MedidaMasValorVenta;
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad2);                                      
                                        $cantidad_5=$datoscantidad2;
                                    }
                                    elseif ($acabado_5Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $costo_unitario5=$acabado_5Valor; 
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }    
                                    elseif ($acabado_5Array->unidad_de_venta == '3') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad2);
                                    }                                    
                                    elseif ($acabado_5Array->unidad_de_venta == '4') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad2);
                                    }                                            
                                    elseif ($acabado_5Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($datoscantidad2*$acabado_5Valor);
                                        $cantidad_5=$datoscantidad2;
                                    }       
                                    elseif ($acabado_5Array->unidad_de_venta == '6') //mt2
                                    {
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $costo_unitario5=$acabado_5Valor;
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }   
                                    elseif ($acabado_5Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario5=$acabado_5MedidaMasValorVenta;
                                        $precio_total_5=$acabado_5MedidaMasValorVenta*$datoscantidad2;
                                        $cantidad_5=$datoscantidad2;
                                    }
                                    elseif ($acabado_5Array->unidad_de_venta == '8') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad2);
                                    }           
                                    elseif ($acabado_5Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }   
                                    elseif ($acabado_5Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($acabado_5Valor*$datoscantidad2);
                                        $cantidad_5=$datoscantidad2;
                                    }                                      
                                }    
                                if($fotomecanica->acabado_impresion_6=="17")
                                {
                                    $acabado_6="";
                                    $acabado_6Valor="";
                                    $acabado_6MedidaMasValorVenta="";
                                    $acabado_6Unitario="";
                                    $acabado_6UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_6Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_6);
                                    $acabado_6=$acabado_6Array->caracteristicas;
                                    $acabado_6UnidadVentaNombre=$acabado_6Array->unv; //Nombre unidad de venta
                                    $acabado_6Valor=$acabado_6Array->valor_venta; // ej: 52
                                    $acabado_6MedidaMasValorVenta=($tamano1*$tamano2*$acabado_6Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_6CostoFijo=$acabado_6Array->costo_fijo;		
                                    if ($acabado_6Array->unidad_de_venta == '1') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad2);
                                    }
                                    elseif ($acabado_6Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $costo_unitario6=$acabado_6Valor; 
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    }  
                                    elseif ($acabado_6Array->unidad_de_venta == '3') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad2);
                                    }                                    
                                    elseif ($acabado_6Array->unidad_de_venta == '4') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad2);
                                    }                                            
                                    elseif ($acabado_6Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($datoscantidad2*$acabado_5Valor);
                                        $cantidad_6=$datoscantidad2;
                                    }       
                                    elseif ($acabado_6Array->unidad_de_venta == '6') //mt2
                                    {
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $costo_unitario6=$acabado_6Valor;
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    }   
                                    elseif ($acabado_6Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario6=$acabado_6MedidaMasValorVenta;
                                        $precio_total_6=$acabado_6MedidaMasValorVenta*$datoscantidad2;
                                        $cantidad_6=$datoscantidad2;
                                    }
                                    elseif ($acabado_6Array->unidad_de_venta == '8') //cms
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad2);
                                    }           
                                    elseif ($acabado_6Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    } 
                                    elseif ($acabado_6Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($acabado_6Valor*$datoscantidad2);
                                        $cantidad_6=$datoscantidad2;
                                    }                                      
									

                                }            
                        //*******************************************
                                
              $externos_produccion2=$precio_total_4+$precio_total_5+$precio_total_6;
//             echo "-----merma>>>>>".$sum2;                               
//             echo "-----factor>>>>>".$factor_rango;                               
//             echo "-----baseimprenta>>>>>".$base_imprenta->precio;                               
//             echo "-----barniz>>>>>".$barniz2;                               
//             echo "-----recargo>>>>>".$recargo800Array->precio;                               
            $tira3=((($datoscantidad2/$ing->unidades_por_pliego)+$sum2)*$factor_rango2+$base_imprenta->precio )*($fotomecanica->colores+$barniz2)."<br>";
            $tira4=((($datoscantidad2/$ing->unidades_por_pliego)+$sum2)*$factor_rango2+$base_imprenta->precio)*($fotomecanica->colores+$barniz2)*(1*$recargo800Array->precio/100);
            $tirajetotal2=$tira3+$tira4;
            
            $tira5=((($datoscantidad3/$ing->unidades_por_pliego)+$sum3)*$factor_rango3+$base_imprenta->precio )*($fotomecanica->colores+$barniz2)."<br>";
            $tira6=((($datoscantidad3/$ing->unidades_por_pliego)+$sum3)*$factor_rango3+$base_imprenta->precio)*($fotomecanica->colores+$barniz2)*(1*$recargo800Array->precio/100);
            $tirajetotal3=$tira5+$tira6."<br>";
            
            $tira7=((($datoscantidad4/$ing->unidades_por_pliego)+$sum4)*$factor_rango4+$base_imprenta->precio )*($fotomecanica->colores+$barniz2)."<br>";
            $tira8=((($datoscantidad4/$ing->unidades_por_pliego)+$sum4)*$factor_rango4+$base_imprenta->precio)*($fotomecanica->colores+$barniz2)*(1*$recargo800Array->precio/100);
            $tirajetotal4=$tira7+$tira8."<br>";
            
            //echo "<h1>TIRAJE" . $tirajetotal4 . "</h1>";
            //exit();
            //valor corte para los 4
            $valorCorte2=(((($datoscantidad2/$ing->unidades_por_pliego)*1.04)+104)*4.5);
            $valorCorte3=(((($datoscantidad3/$ing->unidades_por_pliego)*1.04)+104)*4.5);
            $valorCorte4=(((($datoscantidad4/$ing->unidades_por_pliego)*1.04)+104)*4.5);
            
           $costoOnda2=(((($datoscantidad2/$ing->unidades_por_pliego)*1.04)+104))."<br>";
           $costoOnda3=(((($datoscantidad3/$ing->unidades_por_pliego)*1.04)+104))."<br>";
           $costoOnda4=(((($datoscantidad4/$ing->unidades_por_pliego)*1.04)+104))."<br>";
           
            if($fotomecanica->estan_los_moldes == 'NO LLEVA')
	    {
            $variableTroquelado=0;
            $totalTroquelado=0;
            }else
            {
            $variableTroquelado=$this->variables_cotizador_model->getVariablesCotizadorPorId(11);
            $totalTroquelado2=($costoOnda2*$variableTroquelado->precio)*1.5;	
            }     
            if($fotomecanica->estan_los_moldes == 'NO LLEVA')
	    {
            $variableTroquelado=0;
            $totalTroquelado=0;
            }else
            {
            $variableTroquelado=$this->variables_cotizador_model->getVariablesCotizadorPorId(11);
            $totalTroquelado3=($costoOnda3*$variableTroquelado->precio)*1.5;	
            }     
            if($fotomecanica->estan_los_moldes == 'NO LLEVA')
	    {
            $variableTroquelado=0;
            $totalTroquelado=0;
            }else
            {
            $variableTroquelado=$this->variables_cotizador_model->getVariablesCotizadorPorId(11);
            $totalTroquelado4=($costoOnda4*$variableTroquelado->precio)*1.5;	
            }     
           // valor del emplacado 
           $variableEmplacado=$this->variables_cotizador_model->getVariablesCotizadorPorId(8);
           $valorEmplacadado=($variableEmplacado->precio*$tamano1*$tamano2)/10000;
           $totalEmplacado2=$valorEmplacadado*$costoOnda2."<br>";
           $totalEmplacado3=$valorEmplacadado*$costoOnda3."<br>";
           $totalEmplacado4=$valorEmplacadado*$costoOnda4."<br>";
           
                            $dos=($datoscantidad2/$ing->unidades_por_pliego)+$sum2."<br />";
                            $tres=($datoscantidad3/$ing->unidades_por_pliego)+$sum3."<br />";
                            $cuatro=($datoscantidad4/$ing->unidades_por_pliego)+$sum4."<br />";
                          
                            $valorPlacaKilo2=(($dos*$tamano1*$tamano2*$tapaGramaje)/10000000)."<br />";
                            $valorPlacaKilo3=(($tres*$tamano1*$tamano2*$tapaGramaje)/10000000)."<br />";
                            $valorPlacaKilo4=(($cuatro*$tamano1*$tamano2*$tapaGramaje)/10000000)."<br />";
                            
                            $totalPlacaKilo2=$valorPlacaKilo2*$materialidad_1->precio."<br />";
                            $totalPlacaKilo3=$valorPlacaKilo3*$materialidad_1->precio."<br />";
                            $totalPlacaKilo4=$valorPlacaKilo4*$materialidad_1->precio."<br />";
                            
                            //$v2= number_format((($datoscantidad2/$ing->unidades_por_pliego)*1.04)+104,0,'','.');
                            $v2= number_format((($datoscantidad2/$ing->unidades_por_pliego)*1.04)+104,0,'','.');
                            $v3= number_format((($datoscantidad3/$ing->unidades_por_pliego)*1.04)+104,0,'','.');
                            $v4= number_format((($datoscantidad4/$ing->unidades_por_pliego)*1.04)+104,0,'','.');
                            
                            $OndaKilo2=number_format((($v2*$tamano1*$tamano2*$GramosMetroCuadrado)/10000),0,'','.')."<br />";
                            $OndaKilo3=number_format((($v3*$tamano1*$tamano2*$GramosMetroCuadrado)/10000),0,'','.')."<br />";
                            $OndaKilo4=number_format((($v4*$tamano1*$tamano2*$GramosMetroCuadrado)/10000),0,'','.')."<br />";
                            
                            $vt2=number_format(((($v2*$tamano1*$tamano2*$GramosMetroCuadrado)/10000)*$costo_kilo),0,'','.');
                            $vt3=number_format(((($v3*$tamano1*$tamano2*$GramosMetroCuadrado)/10000)*$costo_kilo),0,'','.')."<br />";
                            $vt4=number_format(((($v4*$tamano1*$tamano2*$GramosMetroCuadrado)/10000)*$costo_kilo),0,'','.')."<br />";
                            //echo number_format($totalPlacaKilo2,0,'','.')."<br>";
                            
                            $totalDefi1=$totalPlacaKilo2+((($v2*$tamano1*$tamano2*$GramosMetroCuadrado)/10000)*$costo_kilo);
                            $totalDefi2=$totalPlacaKilo3+((($v3*$tamano1*$tamano2*$GramosMetroCuadrado)/10000)*$costo_kilo);
                            $totalDefi3=$totalPlacaKilo4+((($v4*$tamano1*$tamano2*$GramosMetroCuadrado)/10000)*$costo_kilo);

                            
                            $variableDesgajado=$this->variables_cotizador_model->getVariablesCotizadorPorId(12);
                            $totalDesgajado2=$ing->piezas_totales_en_el_pliego*$variableDesgajado->precio*1.5*$costoOnda2;
                            $totalDesgajado3=$ing->piezas_totales_en_el_pliego*$variableDesgajado->precio*1.5*$costoOnda3;
                            $totalDesgajado4=$ing->piezas_totales_en_el_pliego*$variableDesgajado->precio*1.5*$costoOnda4;
                            $TotalPiezasAdicionales2=$datoscantidad2*$piezaAdacionalValor1;
                            $TotalPiezasAdicionales3=$datoscantidad3*$piezaAdacionalValor1;
                            $TotalPiezasAdicionales4=$datoscantidad4*$piezaAdacionalValor1;
                            
                            
                             if($fotomecanica->materialidad_datos_tecnicos == 'Sólo Cartulina')
                        {
                                $costoOndaKilo3=0;
                                $valorOndaKilo3=0;
                                $totalOndaKilo3=0;
                                $valorCorte4=0;
                                $valorCorte3=0;
                                $valorCorte2=0;
                                $totalEmplacado2=0;
                                $totalEmplacado3=0;
                                $totalEmplacado4=0;

                        }
                           
                             if(sizeof($hoja)==0) { 
                              if($datos->margen_migrado==0){
                                 $margen=15; 
                              }else{
                                 $margen= $datos->margen_migrado;
                              }
				 } else {if($hoja->margen == null){$margen=15;}
                                 else{
                                 $margen=$hoja->margen;}
			         }  
                            //  echo "<h1>margen</h1>".$margen;
                            //cambios en formula de tiraje
                            if($mostrarboton=='1' && $hoja->tiraje2!=""){$tirajetotal2=$hoja->tiraje2;}
                            if($mostrarboton=='1' && $hoja->tiraje3!=""){$tirajetotal3=$hoja->tiraje3;}
                            if($mostrarboton=='1' && $hoja->tiraje4!=""){$tirajetotal4=$hoja->tiraje4;}
                            
                            //cambios en formula de pegado
                            if($totalPegado>150000 && $totalPegado<=235000){$totalPegado=150000;}else{
                                                    if($totalPegado<150000){$totalPegado=$totalPegado;}else{
                                                        if($totalPegado>235000){
                                                           $totalPegado=$datoscantidad2*$pegado_migrado*1.45;
                                                           echo number_format($totalPegado,0,'','.');
                                                        }
                                                    }
                                                }
                                               
                            if($totalPegado2>150000 && $totalPegado2<=235000){$totalPegado2=150000;}else{
                                                    if($totalPegado2<150000){$totalPegado2=$totalPegado2;}else{
                                                        if($totalPegado2>235000){
                                                           $totalPegado2=$datoscantidad3*$pegado_migrado*1.45;
                                                           echo number_format($totalPegado2,0,'','.');
                                                        }
                                                    }
                                                }
                                          
                            if($totalPegado3>150000 && $totalPegado3<=235000){$totalPegado3=150000;}else{
                                                    if($totalPegado3<150000){$totalPegado3=$totalPegado3;}else{
                                                        if($totalPegado3>235000){
                                                           $totalPegado3=$datoscantidad4*$pegado_migrado*1.45;
                                                           echo number_format($totalPegado3,0,'','.');
                                                        }
                                                    }
                                                }
                            
//                            if($mdt=='Cartulina-cartulina' || $mdt=='Sólo Cartulina'){
//                                                    $des = calcularDespacho($costoPlacaKilo, $costoPlacaKilo2, $retiro, $mdt, $fuerasantiago, $distancia);  
//                                                }else{
//                                                    $des = calcularDespacho($costoPlacaKilo, $costoOndaKilo, $retiro, $mdt, $fuerasantiago, $distancia);
//                                                }
                                                
                                                              
                                                if($mdt=='Cartulina-cartulina' || $mdt=='Sólo Cartulina'){
                                                    $des = calcularDespacho($valorPlacaKilo, $valorPlacaKilo2, $retiro, $mdt, $fuerasantiago, $distancia);  
                                                }else{
                                                    $des = calcularDespacho($valorPlacaKilo, $valorOndaKilo, $retiro, $mdt, $fuerasantiago, $distancia);
                                                }                    
                                                
                            $totalProduccion2=$costosporlacado2+$complemento+$valorCorte2+$totalEmplacado2+$totalMontajeMolde+$totalTroquelado2+$totalPegado+$totalDespacho2+$tirajetotal2+$moldeTroquel+$totalDesgajado2+$externos_produccion2+$otrosCaucho + $TotalPiezasAdicionales2 + $valor_extra + $valor_bv_maquina + $valor_acepeta_exce."<br>";
                            $totalProduccion3=$costosporlacado3+$complemento+$valorCorte3+$totalEmplacado3+$totalMontajeMolde+$totalTroquelado3+$totalPegado2+$totalDespacho3+$tirajetotal3+$moldeTroquel+$totalDesgajado3+$externos_produccion3+$otrosCaucho + $TotalPiezasAdicionales3 + $valor_extra + $valor_bv_maquina + $valor_acepeta_exce."<br>";
                            $totalProduccion4=$costosporlacado4+$complemento+$valorCorte4+$totalEmplacado4+$totalMontajeMolde+$totalTroquelado4+$totalPegado3+$totalDespacho4+$tirajetotal4+$moldeTroquel+$totalDesgajado4+$externos_produccion4+$otrosCaucho + $TotalPiezasAdicionales4 + $valor_extra + $valor_bv_maquina + $valor_acepeta_exce."<br>";
//                        echo "<h1>$totalProduccion4</h1>";
//                        echo "<h1>a$costosporlacado4</h1>";
//                        echo "<h1>b$complemento</h1>";
//                        echo "<h1>c$valorCorte4</h1>";
//                        echo "<h1>d$totalEmplacado4</h1>";
//                        echo "<h1>e$totalMontajeMolde</h1>";
//                        echo "<h1>f$totalTroquelado4</h1>";
//                        echo "<h1>g$totalPegado3</h1>";
//                        echo "<h1>h$totalDespacho4</h1>";
//                        echo "<h1>i$tirajetotal4</h1>";
//                        echo "<h1>j$moldeTroquel</h1>";
//                        echo "<h1>k$totalDesgajado4</h1>";
//                        echo "<h1>l$externos_produccion4</h1>";
//                        echo "<h1>m$otrosCaucho</h1>";
//                        echo "<h1>n$TotalPiezasAdicionales4</h1>";
//                        echo "<h1>o$valor_extra</h1>";
//                        echo "<h1>p$valor_bv_maquina</h1>";
//                        echo "<h1>q$valor_acepeta_exce</h1>";

                            ?>
                       <br />
                        <table id="tabla_detalle">
                            
<!--                            <tr>
                                <td class="celda_3">CANTIDAD 2</td>
                                <td class="celda_3"><?php //if($datoscantidad2 == 1){ echo 0;}else{echo number_format($datoscantidad2,0,"",".");}?> <a href="<?php //echo base_url()?>hoja/cantidad2/<?php// echo $id?>/2" class="fancybox fancybox.ajax"><img src="<?php //echo base_url()?>public/frontend/images/edit.png" class="img_16" /></a></td>
                                <td class="celda_3">CANTIDAD 3</td>
                                <td class="celda_3"><?php //if($datoscantidad3 == 1){ echo 0;}else{echo number_format($datoscantidad3,0,"",".");}?> <a href="<?php //echo base_url()?>hoja/cantidad2/<?php //echo $id?>/3" class="fancybox fancybox.ajax"><img src="<?php //echo base_url()?>public/frontend/images/edit.png" class="img_16" /></a></td>
                                <td class="celda_3">CANTIDAD 4</td>
                                <td class="celda_3"><?php //if($datoscantidad4 == 1){ echo 0;}else{echo number_format($datoscantidad4,0,"",".");}?> <a href="<?php //echo base_url()?>hoja/cantidad2/<?php //echo $id?>/4" class="fancybox fancybox.ajax"><img src="<?php //echo base_url()?>public/frontend/images/edit.png" class="img_16" /></a></td>
                            </tr>-->
						
							
<!--                            <tr>
                                <td class="celda_3">VALOR FINAL</td>
                                <td class="celda_3"><?php //if($datoscantidad2 == 1){ echo 0;}else{
                               // echo number_format(((((($totalProduccion2+$totalDefi1+$totalPreImpresion)*0.085)+(($totalProduccion2+$totalDefi1+$totalPreImpresion)*0.085)+($totalProduccion2+$totalDefi1+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad2),0,'','.');}?></td>
                                <td class="celda_3">VALOR FINAL</td>
                                <td class="celda_3"><?php //if($datoscantidad3 == 1){ echo 0;}else{
                                //echo number_format(((((($totalProduccion3+$totalDefi2+$totalPreImpresion)*0.085)+(($totalProduccion3+$totalDefi2+$totalPreImpresion)*0.085)+($totalProduccion3+$totalDefi2+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad3),0,'','.');}?></td>
                                <td class="celda_3">VALOR FINAL</td>
                                <td class="celda_3"><?php// if($datoscantidad4 == 1){ echo 0;}else{
                               // echo number_format(((((($totalProduccion4+$totalDefi3+$totalPreImpresion)*0.085)+(($totalProduccion4+$totalDefi3+$totalPreImpresion)*0.085)+($totalProduccion4+$totalDefi3+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad4),0,'','.');}?></td>
                            </tr>-->
                            <?php
				if(sizeof($hoja)==0)
                                {
                                    $valorEmpresa2=number_format($valorFinanciado2,0,'','.');
                                    $valorEmpresa3=number_format($valorFinanciado3,0,'','.');
                                    $valorEmpresa4=number_format($valorFinanciado4,0,'','.');
                                }else
                                {
                                    $valorEmpresa2=$hoja->valor_empresa_2;
                                    $valorEmpresa3=$hoja->valor_empresa_3;
                                    $valorEmpresa4=$hoja->valor_empresa_4;
                                }
								

								if($hoja->valor_empresa_2 == 0)
                                {
                                    $valorEmpresa_2=$valorFinanciado2;  
									
									$arregloVEmpresa=array
									(
										"valor_empresa_2"=>$valorEmpresa_2,
									);
									
									$this->db->where('id', $hoja->id);
									$this->db->update("hoja_de_costos_datos",$arregloVEmpresa);
                                }
								
								if($hoja->valor_empresa_3 ==0)
                                {                                    
                                    $valorEmpresa_3=$valorFinanciado3;  
									
									$arregloVEmpresa=array
									(
										"valor_empresa_3"=>$valorEmpresa_3,
									);
									
									$this->db->where('id', $hoja->id);
									$this->db->update("hoja_de_costos_datos",$arregloVEmpresa);                                  
                                }
								
								if($hoja->valor_empresa_4 ==0)
                                {
                                    $valorEmpresa_4=$valorFinanciado4;  
									
									$arregloVEmpresa=array
									(
										"valor_empresa_4"=>$valorEmpresa_4,
									);
									
									$this->db->where('id', $hoja->id);
									$this->db->update("hoja_de_costos_datos",$arregloVEmpresa);   
                                }
								
								
                            ?>
                            
							<?php
                                                         if ($datoscantidad2 == 0) {
                                                            $datoscantidad2 = 1;
                                                        } else {
                                                            $datoscantidad2 = $datoscantidad2;
                                                        }
                                                        if ($datoscantidad3 == 0) {
                                                            $datoscantidad3 = 1;
                                                        } else {
                                                            $datoscantidad3 = $datoscantidad3;
                                                        }
                                                        if ($datoscantidad4 == 0) {
                                                            $datoscantidad4 = 1;
                                                        } else {
                                                            $datoscantidad4 = $datoscantidad4;
                                                        }

                                                        $var2 = (((($totalProduccion2+$totalDefi1+$totalPreImpresion)*0.085)+(($totalProduccion2+$totalDefi1+$totalPreImpresion)*0.085)+($totalProduccion2+$totalDefi1+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad2;
                                                        $var3 = (((($totalProduccion3+$totalDefi2+$totalPreImpresion)*0.085)+(($totalProduccion3+$totalDefi2+$totalPreImpresion)*0.085)+($totalProduccion3+$totalDefi2+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad3;
                                                        $var4 = (((($totalProduccion4+$totalDefi3+$totalPreImpresion)*0.085)+(($totalProduccion4+$totalDefi3+$totalPreImpresion)*0.085)+($totalProduccion4+$totalDefi3+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad4;
							$cf2= $var2*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
							$cf3= $var3*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
							$cf4= $var4*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
							?>
							
<!--                            <tr>
                                <td class="celda_3">VALOR FINANCIERO 2</td>
                                <td class="celda_3">
                                <?php //echo number_format((((($vcostoFinanciero->precio/30)*30)+100)/100)*((((($totalProduccion2+$totalDefi1+$totalPreImpresion)*0.085)+(($totalProduccion2+$totalDefi1+$totalPreImpresion)*0.085)+($totalProduccion2+$totalDefi1+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad2),0,'','.') ?>
                                <?php //echo number_format($cf2,0,'','.') ?>
                                </td>
                                <td class="celda_3">VALOR FINANCIERO 3</td>
                                <td class="celda_3">
                                <?php //echo number_format((((($vcostoFinanciero->precio/30)*30)+100)/100)*((((($totalProduccion3+$totalDefi2+$totalPreImpresion)*0.085)+(($totalProduccion3+$totalDefi2+$totalPreImpresion)*0.085)+($totalProduccion3+$totalDefi2+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad3),0,'','.') ?>
                                <?php //echo number_format($cf3,0,'','.') ?>
                                </td>
                                <td class="celda_3">VALOR FINANCIERO 4</td>
                                <td class="celda_3">
                                <?php //echo number_format((((($vcostoFinanciero->precio/30)*30)+100)/100)*((((($totalProduccion4+$totalDefi3+$totalPreImpresion)*0.085)+(($totalProduccion4+$totalDefi3+$totalPreImpresion)*0.085)+($totalProduccion4+$totalDefi3+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad4),0,'','.') ?>
                                <?php //echo number_format($cf4,0,'','.') ?>
                                </td>
                            </tr>-->
                            <?php
                             if ($datoscantidad2 == 0) {
                                                            $datoscantidad2 = 1;
                                                        } else {
                                                            $datoscantidad2 = $datoscantidad2;
                                                        }
                                                        if ($datoscantidad3 == 0) {
                                                            $datoscantidad3 = 1;
                                                        } else {
                                                            $datoscantidad3 = $datoscantidad3;
                                                        }
                                                        if ($datoscantidad4 == 0) {
                                                            $datoscantidad4 = 1;
                                                        } else {
                                                            $datoscantidad4 = $datoscantidad4;
                                                        }
                            $vfinanciero2=number_format((((($vcostoFinanciero->precio/30)*30)+100)/100)*((((($totalProduccion2+$totalDefi1+$totalPreImpresion)*0.085)+(($totalProduccion2+$totalDefi1+$totalPreImpresion)*0.085)+($totalProduccion2+$totalDefi1+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad2),0,'','.');
                            $vfinanciero3=number_format((((($vcostoFinanciero->precio/30)*30)+100)/100)*((((($totalProduccion3+$totalDefi2+$totalPreImpresion)*0.085)+(($totalProduccion3+$totalDefi2+$totalPreImpresion)*0.085)+($totalProduccion3+$totalDefi2+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad3),0,'','.');
                            $vfinanciero4=number_format((((($vcostoFinanciero->precio/30)*30)+100)/100)*((((($totalProduccion4+$totalDefi3+$totalPreImpresion)*0.085)+(($totalProduccion4+$totalDefi3+$totalPreImpresion)*0.085)+($totalProduccion4+$totalDefi3+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad4),0,'','.');
                            
                            ?>
<!--                            <tr>
                                <td class="celda_3">VALOR EMPRESA 2</td>
                                <td class="celda_3"><?php //if(sizeof($hoja)==0){if($datoscantidad2 == 1){echo 0;}else{if( $valorEmpresa2 == 0){echo number_format($valorFinanciado2,0,'','.');}else{echo $vfinanciero2;}}}else{echo number_format($hoja->valor_empresa_2,0,'','.');}?> <a href="<?php// echo base_url()?>hoja/valor_empresa_2/<?php //echo $id?>/2" class="fancybox fancybox.ajax"><img src="<?php //echo base_url()?>public/frontend/images/edit.png" class="img_16" /></a></td>
                                <td class="celda_3">VALOR EMPRESA 3</td>
                                <td class="celda_3"><?php// if(sizeof($hoja)==0){if($datoscantidad3 == 1){echo 0;}else{if( $valorEmpresa3 == 0){echo number_format($valorFinanciado3,0,'','.');}else{echo $vfinanciero3;}}}else{echo number_format($hoja->valor_empresa_3,0,'','.');}?> <a href="<?php //echo base_url()?>hoja/valor_empresa_2/<?php //echo $id?>/3" class="fancybox fancybox.ajax"><img src="<?php //echo base_url()?>public/frontend/images/edit.png" class="img_16" /></a></td>
                                <td class="celda_3">VALOR EMPRESA 4</td>
                                <td class="celda_3"><?php //if(sizeof($hoja)==0){if($datoscantidad4 == 1){echo 0;}else{if( $valorEmpresa4 == 0){echo number_format($valorFinanciado4,0,'','.');}else{echo $vfinanciero4;}}}else{echo number_format($hoja->valor_empresa_4,0,'','.');}?> <a href="<?php //echo base_url()?>hoja/valor_empresa_2/<?php //echo $id?>/4" class="fancybox fancybox.ajax"><img src="<?php //echo base_url()?>public/frontend/images/edit.png" class="img_16" /></a></td>
								 
                            </tr>-->
                            <input type="hidden" name="valor_empresa_22" value="<?php if($datoscantidad2 == 1){
                                echo 0;
                            }
                            else{
                                    if( $valorEmpresa2 == 0){
                                        echo str_replace ( ".", "",$valorFinanciado2);
                                    }else{
                                        //echo str_replace ( ".", "",$vfinanciero2);
                                        echo str_replace ( ".", "",$valorEmpresa2);
                                    }
                                }?>" />
                            <input type="hidden" name="valor_empresa_3" value="<?php if($datoscantidad3 == 1){
                                echo 0;
                            }
                            else{
                                    if( $valorEmpresa3 == 0){
                                        echo str_replace ( ".", "",$valorFinanciado3);
                                    }else{
                                        //echo str_replace ( ".", "",$vfinanciero3);
                                        echo str_replace ( ".", "",$valorEmpresa3);
                                    }
                                }?>" />
                            <input type="hidden" name="valor_empresa_4" value="<?php if($datoscantidad4 == 1){
                                echo 0;
                            }
                            else{
                                    if( $valorEmpresa4 == 0){
                                        echo str_replace ( ".", "",$valorFinanciado4);
                                    }else{
                                        //echo str_replace ( ".", "",$vfinanciero4);
                                        echo str_replace ( ".", "",$valorEmpresa4);
                                    }
                                }?>" />
<!--                            <input type="hidden" name="valor_empresa_2" value="<?php// echo str_replace ( '.', '', $valorEmpresa2);?>" />
                            <input type="hidden" name="valor_empresa_3" value="<?php// echo str_replace ( '.', '', $valorEmpresa3);?>" />
                            <input type="hidden" name="valor_empresa_4" value="<?php// echo str_replace ( '.', '', $valorEmpresa4);?>" />-->
                        </table>
                        <div class="separador_10">&nbsp;</div>
                        <table id="tabla_detalle">
						
                            <tr>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3">MATERIAL</td>
                                <td class="celda_3">GRAMAJE</td>
                                <td class="celda_3">TOTAL PLIEGOS</td>
                                <td class="celda_3"></td>
                                <td class="celda_3">TOTAL KILOS</td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3"><?php echo $fotomecanica->materialidad_datos_tecnicos;?></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"></td>
                                <td class="celda_3"></td>
                                <td class="celda_3"></td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
							<?php 
                            if($fotomecanica->materialidad_datos_tecnicos == 'Cartulina-cartulina')
                                    {
							?>				
											
							<tr>
                                <td class="celda_3">TAPA</td>
                                <td class="celda_3"><?php echo $tapaNombre?> (<?php echo number_format($tapaPrecio,0,'','.')?>)</td>
                                <td class="celda_3"><?php echo number_format($costoPlacaKilo,0,'','.') ?></td>
                                <td class="celda_3"></td>
                                <td class="celda_3"><?php echo number_format($valorPlacaKilo,0,'','.');?></td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3">Tapa (Respaldo)</td>
                                <td class="celda_3"><?php echo $tapaNombre2?> (<?php echo number_format($tapaPrecio2,0,'','.')?>)</td>
                                <td class="celda_3"><?php echo number_format($costoPlacaKilo2,0,'','.') ?></td>
                                <td class="celda_3"></td>
                                <td class="celda_3"><?php echo number_format($valorPlacaKilo2,0,'','.');?></td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3"></td>
                                <td class="celda_3"></td>
                                <td class="celda_3"></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"></td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>				
											
							<?php				
				}else{

                                    if($fotomecanica->materialidad_datos_tecnicos == 'Corrugado')
                                    {

                                        $variable_cotizador=$this->variables_cotizador_model->getVariablesCotizadorPorId(25);
                                    }
                                    if($fotomecanica->materialidad_datos_tecnicos == 'Microcorrugado'){
                                    
                                        $variable_cotizador=$this->variables_cotizador_model->getVariablesCotizadorPorId(24);	
                                    }			
                                    if($fotomecanica->materialidad_datos_tecnicos == 'Indefinido'){

                                        $variable_cotizador=$this->variables_cotizador_model->getVariablesCotizadorPorId(24);	
                                    }	                                    
//                                    exit($fotomecanica->materialidad_datos_tecnicos."aquiii");       
                                    if (($datoscantidad1>0) and ($ing->unidades_por_pliego>0))
                                        $cantidad_cajas = ($datoscantidad1 / $ing->unidades_por_pliego) + 104;                                    
                                    else $cantidad_cajas = 104;                                    
                                   

                                    $kilosOnda =  ($tamano1 * $tamano2 * $ondaGramaje * $cantidad_cajas * (($variable_cotizador->precio * 10 + 1000)/1000)) / 10000000;
                                    
                                    $kilosLiner =  ($tamano1 * $tamano2 * $linerGramaje * $cantidad_cajas ) / 10000000;				
//                                    echo $kilosLiner ."=  (".$tamano1." * ".$tamano2." * ".$linerGramaje." * ".$cantidad_cajas." ) / 10000000";
    
                                    if(sizeof($hoja)>=1)
                                    {
                                        $arreglokilo2=array
                                        (
                                            "kilos_onda"=>$kilosOnda,
                                        );
                               
                                        $this->db->where('id', $hoja->id);
                                        $this->db->update("hoja_de_costos_datos",$arreglokilo2);
                                      

                                        $arreglokilo3=array
                                        (
                                            "kilos_liner"=>$kilosLiner,
                                        );
                                        $this->db->where('id', $hoja->id);
                                        $this->db->update("hoja_de_costos_datos",$arreglokilo3);
//                                        echo $hoja->id."---jaime----";
//                                        exit(print_r($arreglokilo2));                                           
                                    }
                                    ?>				
										
										
										
							<tr>
                                <td class="celda_3">TAPA</td>
                                <td class="celda_3"><?php echo $tapaNombre?> (<?php echo number_format($tapaPrecio,0,'','.')?>)</td>
                                <td class="celda_3">pliego_tapa</td>
                                <td class="celda_3"></td>
                                <td class="celda_3"><?php echo number_format($valorPlacaKilo,0,'','.');?></td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3">ONDA</td>
                                <td class="celda_3"><?php echo $ondaNombre?> (<?php echo number_format($ondaPrecio,0,'','.')?>)</td>
                                <td class="celda_3">pliego_ondas</td>
                                <td class="celda_3"></td>
                                <td class="celda_3"><?php echo number_format($kilosOnda,0,'','.');?></td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3">LINER</td>
                                <td class="celda_3"><?php echo $linerNombre?> (<?php echo number_format($linerPrecio,0,'','.')?>)</td>
                                <td class="celda_3">pliego_liner</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"><?php echo number_format($kilosLiner,0,'','.');?></td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>	
							<?php				
										}
							?>
                          
							<?php
									if($fotomecanica->materialidad_datos_tecnicos == 'Cartulina-cartulina')
										{
							?>	
							<tr>
                                <td class="celda_3">FECHA TAPA: <?php echo fecha_con_slash($tapaFecha)?></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3">FECHA Tapa (Respaldo): <?php echo fecha_con_slash($tapaFecha2)?></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3"></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"></td>
                                <td class="celda_3"></td>
                            </tr>

							<?php
										}else{
							?>											
                            <tr>
                                <td class="celda_3">FECHA TAPA: <?php echo fecha_con_slash($tapaFecha)?></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3">FECHA ONDA: <?php echo fecha_con_slash($ondaFecha)?></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3">FECHA LINER: <?php echo fecha_con_slash($linerFecha)?></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">240</td>
                                <td class="celda_3">449.71</td>
                            </tr>
							
						<?php
						}
                                                
                                                //***************ehndz********************
                                                
                                                 if($totalTrabajosInternos=='No'){$totalTrabajosInternos=0;}else{$totalTrabajosInternos=$totalTrabajosInternos*50;}
                                                 if($totalTrabajosExternos=='No'){$totalTrabajosExternos="No";}else{$cantidadTrabajosExternos=$totalTrabajosExternos/50;}
                                                 //***************ehndz********************
                                                 //echo "<h1>".$totalTrabajosExternos."</h1>";exit();
						?>		
                        </table>    
                        <div class="separador_20"></div>
                        <table id="tabla_detalle">
                            <tr>
                                <td class="celda_2">

                                </td>
                                <td class="celda_1">&nbsp;</td>
                                <td class="celda_60 valign_top" rowspan="5">
                                    <!--mermas-->                          
                                    <table id="tabla_produccion">
                                        <tr>
                                            <td colspan="4">Tabla de Patrón de MERMAS Microonda TIPO E + Tapa por <?php echo $datoscantidad1; ?> = <?php echo ($datoscantidad1 / $ing->unidades_por_pliego); ?> Pliegos -- Total Colores <?php echo ($fotomecanica->colores); ?> Barniz: <?php echo ($fotomecanica->fot_lleva_barniz); ?>
                                            Trabajos Externos: <?php echo $cantidadTrabajosExternos; ?></td>
                                        </tr>
                                        <tr>
                                            <td>Imprenta</td>
                                            <!--<td>Ultra</td>-->
                                            <td>Roland:800</td>
                                            <td>Roland:800</td>
                                            <td>&nbsp;</td>
                                            <td>&nbsp;</td>
                                        </tr>
                                        <tr>
                                            <td>Color 1-2-3</td>
                                            <td>400</td>
                                            <td>400</td>
                                            <td>&nbsp;</td>
                                            <td><?php echo $color1?></td>
                                        </tr>
                                        <tr>
                                            <td>Color &gt; 3</td>
                                            <td><?php if($datos->vb_maquina == 'SI' or $datos->acepta_excedentes == 'NO'){echo '150';}else{echo '100';}?></td>
                                            <td><?php if($datos->vb_maquina == 'SI' or $datos->acepta_excedentes == 'NO'){echo '150';}else{echo '100';}?></td>
                                            <td>* Color</td>
                                            <td><?php echo $color2?></td>
                                        </tr>
                                        <tr>
                                            <td>Cantidad</td>
                                            <td>30</td>
                                            <td>30</td>
                                            <td>Cantidad &gt; 5.000 * c/5.000</td>
                                            <td><?php echo $can1?></td>
                                        </tr>
<!--                                        <tr>
                                            <td>&nbsp;</td>
                                            <td>050</td>
                                            <td>050</td>
                                            <td>Cantidad &gt; 5.000 * c/5.000</td>
                                            <td><?php// echo $can2?></td>
                                        </tr>-->
                                        <tr>
                                            <td>Barniz</td>
                                            <td>100</td>
                                            <td>100</td>
                                            <td>Primeros 1.000</td>
                                            <td><?php echo $bar1 ?></td>
                                        </tr>
                                        <tr>
                                            <td>&nbsp;</td>
                                            <td>01</td>
                                            <td>01</td>
                                            <td>por cada 1.000 extra</td>
                                            <td><?php echo $bar2?></td>
                                        </tr>
                                        <tr>
                                            <td>Trabajo externo</td>
                                            <td>050</td>
                                            <td>050</td>
                                            <td>una sola vez</td>					
                                            <td><?php echo $externo?></td>
                                        </tr>
                                        <tr>
                                            <td>Micro/Micro</td>
                                            <td>030</td>
                                            <td>030</td>
                                            <td>una sola vez</td>
                                            <td><?php echo $micromicro?></td>
                                        </tr>
                                        <tr>
                                            <td>Cart/Cart</td>
                                            <td>030</td>
                                            <td>030</td>
                                            <td>una sola vez</td>
                                            <td><?php echo $cartulina?></td>
                                        </tr>
                                        <tr>
                                            <td>Tamaños Normales</td>
                                            <td>&nbsp;</td>
                                            <td>&nbsp;</td>
                                            <td>&nbsp;</td>
                                            <td>&nbsp;</td>
                                        </tr>
                                        <tr>
                                            <td>Emplacado</td>
                                            <td>50</td>
                                            <td>50</td>
                                            <td>primeros 1.000</td>
                                            <td><?php echo $emplacado_fijo?></td>
                                        </tr>
                                        <tr>
                                            <td></td>
                                            <td><?php echo $emplacado_merma?></td>
                                            <td><?php echo $emplacado_merma?></td>
                                            <td>por cada 1000</td>
                                            <td><?php echo $emplacado?></td>
                                        </tr>
                                        <tr>
                                            <td>Troquelado</td>
                                            <td>40</td>
                                            <td>40</td>
                                            <td>Los primeros 1.000</td>
                                            <td><?php echo $troquelado_fijo ?></td>
                                        </tr>
                                        <tr>
                                            <td></td>
                                            <td><?php echo $troquelado_merma ?></td>
                                            <td><?php echo $troquelado_merma ?></td>
                                            <td>por cada 1.000</td>
                                            <td><?php echo $troquelado?></td>
                                        </tr>
                                        <tr>
                                            <td colspan="5"><hr class="hr_punteada_corto" /></td>
                                        </tr>
                                        <tr>
                                            <td>&nbsp;</td>
                                            <td>&nbsp;</td>
                                            <td>&nbsp;</td>
                                            <td>&nbsp;</td>
                                            <td><?php echo number_format($sum,0,'','.')?></td>
                                        </tr>
                                    </table>
                                    <?php
                                    if (sizeof($hoja) >= 1) {
                                        $arreglo55 = array
                                            (
                                            "total_merma" => $sum,
                                        );
                                        $this->db->where('id', $hoja->id);
                                        $this->db->update("hoja_de_costos_datos", $arreglo55);
                                    }
                                    ?>
                                    <!--/mermas-->
                                </td>
                            </tr>
                            <tr>
                                <td class="celda_2">&nbsp;</td>
                                <td class="celda_1">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_2">&nbsp;</td>
                                <td class="celda_1">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_2"></td>
                                <td class="celda_1">&nbsp;</td>
                            </tr>
                        </table>
                        <div class="separador_20"></div>

                    </div>
                
            </header>
            
            
            
            <div class="separador_20"><hr /></div>
            
            <?php
                            if (($datoscantidad1>0) and ($ing->unidades_por_pliego>0))
                                $costoPlacaKilo=($datoscantidad1/$ing->unidades_por_pliego)+$sum;
                            else 
                                $costoPlacaKilo=0;
                            $valorPlacaKilo=($costoPlacaKilo*$tamano1*$tamano2*$tapaGramaje)/10000000;
                            $totalPlacaKilo=$valorPlacaKilo*$tapaPrecio;
							
                             if(sizeof($hoja)>=1 and $hoja->fecha)
                            {
                                $arreglo5=array
                                (
                                    "placa_kilo"=>$costoPlacaKilo,
                                    "total_pliegos"=>$valorPlacaKilo,
                                );
                                $this->db->where('id', $hoja->id);
                                $this->db->update("hoja_de_costos_datos",$arreglo5);
                                //echo $this->db->last_query();
                            }
			    if(sizeof($hoja)>=1)
                            {
                                $arreglokilo1=array
                                (
                                    "kilos_placa"=>$valorPlacaKilo,
                                 
                                );
                                $this->db->where('id', $hoja->id);
                                $this->db->update("hoja_de_costos_datos",$arreglokilo1);
                                //echo $this->db->last_query();
                            }
                        
                            $dos=($datoscantidad2/$ing->unidades_por_pliego)+$sum2."<br />";
                            $tres=($datoscantidad3/$ing->unidades_por_pliego)+$sum3."<br />";
                            $cuatro=($datoscantidad4/$ing->unidades_por_pliego)+$sum4."<br />";
                            $valorPlacaKilo2=(($dos*$tamano1*$tamano2*$tapaGramaje)/10000000)."<br />";
                            $valorPlacaKilo3=(($tres*$tamano1*$tamano2*$tapaGramaje)/10000000)."<br />";
                            $valorPlacaKilo4=(($cuatro*$tamano1*$tamano2*$tapaGramaje)/10000000)."<br />";
                            $totalPlacaKilo2=$valorPlacaKilo2*$materialidad_1->precio."<br />";
                            $totalPlacaKilo3=$valorPlacaKilo3*$materialidad_1->precio."<br />";
                            $totalPlacaKilo4=$valorPlacaKilo4*$materialidad_1->precio."<br />";
                            $v2= number_format((($datoscantidad2/$ing->unidades_por_pliego)*1.04)+104,0,'','.');
                            $v3= number_format((($datoscantidad3/$ing->unidades_por_pliego)*1.04)+104,0,'','.');
                            $v4= number_format((($datoscantidad4/$ing->unidades_por_pliego)*1.04)+104,0,'','.');
                            $OndaKilo2=number_format((($v2*$tamano1*$tamano2*$GramosMetroCuadrado)/10000),0,'','.')."<br />";
                            $OndaKilo3=number_format((($v3*$tamano1*$tamano2*$GramosMetroCuadrado)/10000),0,'','.')."<br />";
                            $OndaKilo4=number_format((($v4*$tamano1*$tamano2*$GramosMetroCuadrado)/10000),0,'','.')."<br />";
                            $vt2=number_format((($v2*$tamano1*$tamano2*$GramosMetroCuadrado)/10000)*$costo_kilo,0,'','.')."<br />";
                            $vt3=number_format((($v3*$tamano1*$tamano2*$GramosMetroCuadrado)/10000)*$costo_kilo,0,'','.')."<br />";
                            $vt4=number_format((($v4*$tamano1*$tamano2*$GramosMetroCuadrado)/10000)*$costo_kilo,0,'','.')."<br />";
                            //echo number_format($totalPlacaKilo2,0,'','.')."<br>";
                            
                            $totalDefi1=$totalPlacaKilo2+((($v2*$tamano1*$tamano2*$GramosMetroCuadrado)/10000)*$costo_kilo);
                            $totalDefi2=$totalPlacaKilo3+((($v3*$tamano1*$tamano2*$GramosMetroCuadrado)/10000)*$costo_kilo);
                            $totalDefi3=$totalPlacaKilo4+((($v4*$tamano1*$tamano2*$GramosMetroCuadrado)/10000)*$costo_kilo);
                            $totalDef2=number_format($totalDefi1,0,'','.');
                            $totalDef3=number_format($totalDefi2,0,'','.');
                            $totalDef4=number_format($totalDefi3,0,'','.');
                            //echo "<h1>".$datoscantidad2."</h1>";
                            ?>


<!----------------elvis hernandez----------------->
<?php
if($fotomecanica->estan_los_moldes=="NO LLEVA" or $fotomecanica->estan_los_moldes=="CLIENTE LO APORTA" or $fotomecanica->materialidad_datos_tecnicos == 'Sólo Cartulina')
        {
            $troquelado=0;
            $troquelado_fijo=0;
            $troquelado_merma=$mermaTroqueladoArray->precio;
        }else
        {

            $mermaTroqueladoArray=$this->variables_cotizador_model->getVariablesCotizadorPorId(36);
            if (($datoscantidad2>0) and ($ing->unidades_por_pliego>0))
                $troquelado=$datoscantidad2/$ing->unidades_por_pliego;
            else 
                $troquelado=0;
                $troquelado= $troquelado / 1000; /*Resultado de emplacado dividido por 1000*/                                                              
                $troquelado= ($troquelado * 1000)+ 0.5; /*Emplacado multiplicado por 1000 y el resultado de la multiplicacion se suman 0.5*/                          
                $troquelado= $troquelado/ 1000; /*emplacado dividido por 1000*/                      
                $troquelado = $troquelado +0.499; /*emplacado mas 0.499: Resultado emplacado es en decimales*/                                                               
                $EnteroTroquelado = number_format($troquelado,0,'',''); /* Guardar entero del emplacado*/                          
                $troquelado = $EnteroTroquelado * $mermaTroqueladoArray->precio; /*Multiplicar entero del emplacado por 15*/
                $troquelado_fijo = 40;
                $troquelado_merma=$mermaTroqueladoArray->precio;
        }
        
if($ing->materialidad_datos_tecnicos=="Sólo Cartulina")
        {
           $emplacado=0;
           $emplacado_fijo=0;
           $emplacado_merma = $mermaEmplacadoArray->precio;
        }else
        {
             $cantidad_1=$datoscantidad2/$ing->unidades_por_pliego;
             $mermaEmplacadoArray=$this->variables_cotizador_model->getVariablesCotizadorPorId(35);
             $emplacado= $cantidad_1; /*Valor x dividido por Unidad por pliego*/

                $emplacado= $emplacado / 1000; /*Resultado de emplacado dividido por 1000*/                                       

                $emplacado= ($emplacado * 1000)+ 0.5; /*Emplacado multiplicado por 1000 y el resultado de la multiplicacion se suman 0.5*/                                  

            $emplacado= $emplacado/ 1000; /*emplacado dividido por 1000*/                   

                $emplacado = $emplacado +0.499; /*emplacado mas 0.499: Resultado emplacado es en decimales*/                                                               

                $Entero = number_format($emplacado,0,'',''); /* Guardar entero del emplacado*/                         

                $emplacado_fijo = 50; /*Multiplicar entero del emplacado por 15*/
                $emplacado = $Entero * $mermaEmplacadoArray->precio; /*Multiplicar entero del emplacado por 15*/
                $emplacado_merma = $mermaEmplacadoArray->precio;
                
        }
if(($fotomecanica->fot_lleva_barniz!='') && ($fotomecanica->fot_lleva_barniz!='Nada'))
         {
            $cantidadBarniz=$datoscantidad2-1000;
            if($cantidadBarniz<1000)
            {
                if($maquina=="Máquina Roland 800")
                {
                    //$bar1=150;
                    $bar1=100;
                    $bar2=0;
                }else
                {
                    $bar1=100;
                    $bar2=0;
                }
            }else
            {
			
               //echo $datoscantidad1/$ing->unidades_por_pliego;exit;
               $enteroBarniz=($datoscantidad2/$ing->unidades_por_pliego);
		//echo $enteroBarniz;exit();
               if($enteroBarniz < 1000)
			   {
				//$bar1=150;
				$bar1=100;
                                $bar2=0;   
			   }else
			   {
               //$enteroBarniz=(((number_format($enteroBarniz,0,'','')/1000)+1)-2)*10;
               $enteroBarniz=number_format((((($enteroBarniz/1000)+1)-2)*10),0,'','');
               $bar1=100;
               //$bar2=$enteroBarniz;
               $bar2=number_format(((($datoscantidad2/$ing->unidades_por_pliego)-1000)/1000*1),0,'','');
			   
               
                           }
            }

         }else
         {
                $bar1=0;
                $bar2=0;
                }

if($cantidad_2>5000)
         {
            $vecescan1 = ($cantidad_2) / 5000;
            if($vecescan1 >1)
            {
               $can1= 30 * $vecescan1;
            }else{
               $can1=30;
            }
            if($vecescan1 >1)
            {
                //$entero=number_format(($cantidad_1/5000)+0.5,0,'','');
                $can2= 50 * $vecescan1;
            }else
            {
                $can2=50;
            }
         }else
         {
            $can1=0;
            $can2=0;
         }
$sum=$color1+$color2+$can1+$bar1+$bar2+$externo+$micromicro+$cartulina+$emplacado+$troquelado+$emplacado_fijo+$troquelado_fijo;
$sumerma2=$sum;
if(sizeof($hoja)>=1)
        {
            $arreglomerma2=array
                (
                    "total_merma2"=>$sumerma2,
                );
                $this->db->where('id', $hoja->id);
                $this->db->update("hoja_de_costos_datos",$arreglomerma2);
        }
?>
<input type="hidden" name="total_merma2" value="<?php echo $sum ?>">
<div class="container fuente">
    
            <header>
            
                    <div>
                    <hr class="hr_punteada" />
                    </div>
<!--                    <div id="cantidad">
                    Valor por : <?php //echo number_format($datoscantidad2,0,"",".")?> <a href="<?php //echo base_url()?>hoja/cantidad/<?php //echo $id?>/<?php //echo $pagina?>" class="fancybox fancybox.ajax"><img src="<?php //echo base_url()?>public/frontend/images/edit.png" class="img_16" /></a>
                    </div>-->
                  
                    <!--separador 20-->
                    <div class="separador_20"></div>
                    <!--/separador 20-->
                    <div>
                        <!--materialidad-->
                       
                        <table>
                            <tr>
                                <td class="celda_5 izquierda">
                                <?php
                                 switch($fotomecanica->materialidad_datos_tecnicos)
                                  {
                                    case 'Indefinido':
                                        $materialidad_1=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_placa1);
                                        $materialidad_2=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_onda2);
                                        $materialidad_3=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_liner3);
                                        $materialidad_4="No Aplica";
                                        $variable_cotizador=$this->variables_cotizador_model->getVariablesCotizadorPorId(24);
                                        $variable_cotizador2=$this->variables_cotizador_model->getVariablesCotizadorPorId(40);
                                        $base_imprenta=$this->variables_cotizador_model->getVariablesCotizadorPorId(6);
                                        $formula=$materialidad_1->gramaje+($materialidad_1->gramaje*($variable_cotizador->precio/100))+$materialidad_3->gramaje;
                                        if ($materialidad_2->precio>0) $materialidad_precio2=($materialidad_2->precio/1000); else $materialidad_precio2=0;
                                        if ($materialidad_3->precio>0) $materialidad_precio3=($materialidad_3->precio/1000); else $materialidad_precio3=0;
                                        if ($materialidad_2->gramaje>0) $materialidad_gramaje2=($materialidad_2->gramaje/1000); else $materialidad_gramaje2=0;
                                        $costo_kilo=0;
//                                        echo "costo_kilo=(((".$materialidad_2->gramaje."*(".$materialidad_2->precio."/1000)+((".$materialidad_2->gramaje."*(".$variable_cotizador->precio."/100)*".$materialidad_2->precio."/1000))+".$materialidad_3->gramaje."*".$materialidad_3->precio."/1000)/(".$materialidad_2->gramaje."+(".$materialidad_2->gramaje."*(".$variable_cotizador->precio."/100))+".$materialidad_3->gramaje.")))*1000";           
                                        if ($materialidad_2->gramaje>0)
                                            $costo_kilo=((($materialidad_2->gramaje*($materialidad_2->precio/1000)+(($materialidad_2->gramaje*($variable_cotizador->precio/100)*$materialidad_2->precio/1000))+$materialidad_3->gramaje*$materialidad_3->precio/1000)/($materialidad_2->gramaje+($materialidad_2->gramaje*($variable_cotizador->precio/100))+$materialidad_3->gramaje)))*1000;           
					else 	
                                            $costo_kilo=0;
//                                        echo $materialidad_3->tipo."======".$materialidad_3->reverso;
										
                                        if($materialidad_3->tipo == 14 and  $materialidad_3->reverso == 'Blanca')//valdivia
                                        {
//                                                echo "1==============";
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(44);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;
                                        }

                                        elseif($materialidad_3->tipo == 15 and  $materialidad_3->reverso == 'Blanca')//maule
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(45);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;                                                 
                                        }
                                        elseif($materialidad_3->tipo == 1 and  $materialidad_3->reverso == 'Blanca') //Cartulina Importada
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(43);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;                                                 
                                        }
                                        elseif($materialidad_3->tipo == 5 and  $materialidad_3->reverso == 'Blanco') // papel reverso blanco
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(42);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;                                                 
                                        }
                                        elseif($materialidad_3->tipo == 3 and  $materialidad_3->reverso == 'Blanco') // papel reverso blanco
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(42);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;                                                 
                                        }
                                        elseif($materialidad_3->tipo == 4 and  $materialidad_3->reverso == 'Café') // papel reverso cafe
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(41);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;                                                 
                                        }
                                        else
                                        $costo_kilo_obtenido=140;
                                        $costo_kilo=$costo_kilo+$costo_kilo_obtenido;
                                        if(($fotomecanica->fot_lleva_barniz=='Nada')||($fotomecanica->fot_lleva_barniz==''))
                                        {
                                            $barniz2=0;
                                        }else
                                        {
                                            $barniz2=1;
                                        }

                                        if($maquina=="Máquina Roland 800")
                                         {
                                            $tira1=((($datoscantidad2/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio )*($fotomecanica->colores+$barniz2);
                                            $recargo800Array=$this->variables_cotizador_model->getVariablesCotizadorPorId(34);
                                            $tira2=((($datoscantidad2/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio)*($fotomecanica->colores+$barniz2)*(1*$recargo800Array->precio/100);
                                            //echo $recargo800Array->precio."<br>".$tira1."<br>".$tira2;exit;
                                             
                                         }else
                                         {
                                            $tiraje=((($datoscantidad2/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio )*($fotomecanica->colores+$barniz2);  
                                         
                                            
                                         }   
                                        
                                        if ($materialidad_2->gramaje>0)
                                            $GramosMetroCuadrado=$materialidad_2->gramaje+($materialidad_2->gramaje*($variable_cotizador->precio/100))+$materialidad_3->gramaje;
					else 	
                                            $GramosMetroCuadrado=0;                                         
                                        $recargoGramosDeAlmidon=$this->variables_cotizador_model->getVariablesCotizadorPorId(30);
                                        $GramosMetroCuadrado=$GramosMetroCuadrado+$recargoGramosDeAlmidon->precio;
                                        if(sizeof($hoja)>=1)
                                        {
                                            $arreglo54=array
                                                (
                                                    "gramos_metro_cuadrado"=>$GramosMetroCuadrado,
                                                );
                                                $this->db->where('id', $hoja->id);
                                                $this->db->update("hoja_de_costos_datos",$arreglo54);
                                        }
                                        if ($materialidad_2->gramaje>0)
                                            $costoMonotapaPorMetro2=$materialidad_2->gramaje*($materialidad_2->precio/1000)+(($materialidad_2->gramaje*($variable_cotizador->precio/100)*$materialidad_2->precio/1000)+$materialidad_3->gramaje*$materialidad_3->precio/1000);
					else 	
                                            $costoMonotapaPorMetro2=0;     
//                            
                                       switch($fotomecanica->estan_los_moldes)
                                       {
                                          case 'NO':
                                            $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Nuevo</strong>)";
                                          break;
                                          case 'MOLDE GENERICO':
                                            if ($orden->id_molde!='')  
                                                $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            else
                                                $molde=$this->moldes_model->getMoldesPorId($datos->numero_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Antiguo</strong>)";
                                          break;
                                          case 'MOLDE REGISTRADOS DEL CLIENTE':
                                            if ($orden->id_molde!='')  
                                                $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            else
                                                $molde=$this->moldes_model->getMoldesPorId($datos->numero_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Antiguo</strong>)";
                                          break;                                          
                                          case 'NO LLEVA':
                                            $moldeNombre="<strong>NO ESTA MOLDE, PRODUCTO NO FABRICADO ANTERIORMENTE</strong>";
                                          break;
                                          case 'CLIENTE LO APORTA':
                                            $moldeNombre="<strong>CLIENTE LO APORTA</strong>";
                                          break;
                                       }
                                       
                                        $tapaNombre=$materialidad_1->nombre;
                                        $tapaGramaje=$materialidad_1->gramaje;
                                        $tapaFecha=$materialidad_1->fecha_ultima_actualizacion;
                                        $tapaPrecio=$materialidad_1->precio;
                                        $ondaNombre=$materialidad_2->nombre;
                                        if ($materialidad_2->gramaje>0)
                                            $ondaGramaje=$materialidad_2->gramaje;
					else 	
                                        $ondaGramaje=0;                                           
                                        $ondaFecha=$materialidad_2->fecha_ultima_actualizacion;
                                        $ondaPrecio=$materialidad_2->precio;
                                        $linerNombre=$materialidad_3->nombre;
                                        $linerGramaje=$materialidad_3->gramaje;
                                        $linerFecha=$materialidad_3->fecha_ultima_actualizacion;
                                        $linerPrecio=$materialidad_3->precio;
                                       ?>
                                      <?php $tapa = $this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_placa1) ?>
                                         <?php $tapa->materiales_tipo?> <?php $materialidad_1->gramaje?><?php $materialidad_1->precio?><?php $materialidad_1->reverso?>
                                        <?php $monda = $this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_onda2) ?>
                                        <?php $monda->materiales_tipo ?><?php $materialidad_2->gramaje?> <?php $materialidad_2->precio?><?php $materialidad_2->reverso?>
                                        <?php $mliner = $this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_liner3) ?>
                                        <?php $mliner->materiales_tipo ?><?php $materialidad_3->gramaje?><?php $materialidad_3->precio?><?php $materialidad_3->reverso?>
                                        <?php number_format($costo_kilo,0,'','.')?> <?php $GramosMetroCuadrado?> <?php $costoMonotapaPorMetro2?>
                                       
                                        <?php $moldeNombre?> <!--

-->
                                        <?php
                                    break;
                                    case 'Microcorrugado':
                                        $materialidad_1=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_placa1);

                                        $materialidad_2=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_onda2);
                                        $materialidad_3=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_liner3);
                                        $materialidad_4="No Aplica";
                                        $variable_cotizador=$this->variables_cotizador_model->getVariablesCotizadorPorId(24);
                                        $variable_cotizador2=$this->variables_cotizador_model->getVariablesCotizadorPorId(40);
                                        $base_imprenta=$this->variables_cotizador_model->getVariablesCotizadorPorId(6);

                                        $formula=$materialidad_1->gramaje+($materialidad_1->gramaje*($variable_cotizador->precio/100))+$materialidad_3->gramaje;
                                        if ($materialidad_2->precio>0) $materialidad_precio2=($materialidad_2->precio/1000); else $materialidad_precio2=0;
                                        if ($materialidad_3->precio>0) $materialidad_precio3=($materialidad_3->precio/1000); else $materialidad_precio3=0;
                                        if ($materialidad_2->gramaje>0) $materialidad_gramaje2=($materialidad_2->gramaje/1000); else $materialidad_gramaje2=0;
                                        $costo_kilo=0;
                                        if (($materialidad_2->gramaje>0) and ($materialidad_3->gramaje>0) and ($materialidad_2->precio>0))
                                            $costo_kilo=((($materialidad_2->gramaje*($materialidad_2->precio/1000)+(($materialidad_2->gramaje*($variable_cotizador->precio/100)*$materialidad_2->precio/1000))+$materialidad_3->gramaje*$materialidad_3->precio/1000)/($materialidad_2->gramaje+($materialidad_2->gramaje*($variable_cotizador->precio/100))+$materialidad_3->gramaje)))*1000;           
					else 	
                                            $costo_kilo=0;
									
                                        if($materialidad_3->tipo == 14 and  $materialidad_3->reverso == 'Blanca')//valdivia
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(44);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;
                                        }
                                        elseif($materialidad_3->tipo == 15 and  $materialidad_3->reverso == 'Blanca')//maule
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(45);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;                                                 
                                        }
                                        elseif($materialidad_3->tipo == 1 and  $materialidad_3->reverso == 'Blanca') //Cartulina Importada
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(43);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;                                                 
                                        }
                                        elseif($materialidad_3->tipo == 5 and  $materialidad_3->reverso == 'Blanco') // papel reverso blanco
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(42);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;                                                 
                                        }
                                        elseif($materialidad_3->tipo == 3 and  $materialidad_3->reverso == 'Blanco') // papel reverso blanco
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(42);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;                                                 
                                        }
                                        elseif($materialidad_3->tipo == 4 and  $materialidad_3->reverso == 'Café') // papel reverso cafe
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(41);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;                                                 
                                        }
                                        else
                                        $costo_kilo_obtenido=140;
                                        
                                        $costo_kilo=$costo_kilo+$costo_kilo_obtenido;
                                        
                                        if($fotomecanica->fot_lleva_barniz=='' || $fotomecanica->fot_lleva_barniz=='Nada')
                                        {
                                            $barniz2=0;
                                        }else
                                        {
                                            $barniz2=1;
                                        }
                                        
                                        if($maquina=="Máquina Roland 800")
                                         {
                                            $tira1=((($datoscantidad2/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio )*($fotomecanica->colores+$barniz2);
                                            $recargo800Array=$this->variables_cotizador_model->getVariablesCotizadorPorId(34);
                                            $tira2=((($datoscantidad2/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio)*($fotomecanica->colores+$barniz2)*(1*$recargo800Array->precio/100);
                                            $tiraje=$tira1+$tira2;
                                            
//                                       
                                         }else
                                         {
                                            $tiraje=((($datoscantidad2/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio )*($fotomecanica->colores+$barniz2);  
                                         }   
                                        if ($materialidad_2->gramaje>0)
                                        {    
                                            $GramosMetroCuadrado=$materialidad_2->gramaje+($materialidad_2->gramaje*($variable_cotizador->precio/100))+$materialidad_3->gramaje;
//                                           
                                        }    
					else 	
                                            $GramosMetroCuadrado=0;                                         
                                        $recargoGramosDeAlmidon=$this->variables_cotizador_model->getVariablesCotizadorPorId(30);

                                        $GramosMetroCuadrado=$GramosMetroCuadrado+$recargoGramosDeAlmidon->precio;
                                        if(sizeof($hoja)>=1)
                                        {
                                            $arreglo54=array
                                                (
                                                    "gramos_metro_cuadrado"=>$GramosMetroCuadrado,
                                                );
                                                $this->db->where('id', $hoja->id);
                                                $this->db->update("hoja_de_costos_datos",$arreglo54);
                                        }
                                        if ($materialidad_2->gramaje>0){
                                            $costoMonotapaPorMetro2=$materialidad_2->gramaje*($materialidad_2->precio/1000)+(($materialidad_2->gramaje*($variable_cotizador->precio/100)*$materialidad_2->precio/1000)+$materialidad_3->gramaje*$materialidad_3->precio/1000);
                                        }
					else 	
                                            $costoMonotapaPorMetro2=0;                                           
                                       switch($fotomecanica->estan_los_moldes)
                                       {
                                          case 'NO':
                                            $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Nuevo</strong>)";
                                          break;
                                          case 'MOLDE GENERICO':
                                            if ($orden->id_molde!='')  
                                                $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            else
                                                $molde=$this->moldes_model->getMoldesPorId($datos->numero_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Antiguo</strong>)";
                                          break;
                                          case 'MOLDE REGISTRADOS DEL CLIENTE':
                                            if ($orden->id_molde!='')  
                                                $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            else
                                                $molde=$this->moldes_model->getMoldesPorId($datos->numero_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Antiguo</strong>)";
                                          break;   
                                          case 'NO LLEVA':
                                            $moldeNombre="<strong>NO ESTA MOLDE, PRODUCTO NO FABRICADO ANTERIORMENTE</strong>";
                                          break;
                                          case 'CLIENTE LO APORTA':
                                            $moldeNombre="<strong>CLIENTE LO APORTA</strong>";
                                          break;
                                       }
                                        $tapaNombre=$materialidad_1->nombre;
                                        $tapaGramaje=$materialidad_1->gramaje;
                                        $tapaFecha=$materialidad_1->fecha_ultima_actualizacion;
                                        $tapaPrecio=$materialidad_1->precio;
                                        $ondaNombre=$materialidad_2->nombre;
                                        if ($materialidad_2->gramaje>0)
                                            $ondaGramaje=$materialidad_2->gramaje;
					else 	
                                            $ondaGramaje=0;                                           
                                        $ondaFecha=$materialidad_2->fecha_ultima_actualizacion;
                                        $ondaPrecio=$materialidad_2->precio;
                                        $linerNombre=$materialidad_3->nombre;
                                        $linerGramaje=$materialidad_3->gramaje;
                                        $linerFecha=$materialidad_3->fecha_ultima_actualizacion;
                                        $linerPrecio=$materialidad_3->precio;
//                                        print_r($materialidad_1);
                                       ?>
                                       <?php $tapa = $this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_placa1) ?>
                                        <?php $tapa->materiales_tipo?> <?php $materialidad_1->gramaje?><?php $materialidad_1->precio?><?php  $materialidad_1->reverso?>
                                        <?php $monda = $this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_onda2) ?>
                                        <?php $monda->materiales_tipo ?> <?php  $materialidad_2->gramaje?> <?php  $materialidad_2->precio?> <?php  $materialidad_2->reverso?>
                                        <?php $mliner = $this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_liner3) ?>
                                        <?php $mliner->materiales_tipo ?> <?php $materialidad_3->gramaje?><?php  $materialidad_3->precio?>  <?php  $materialidad_3->reverso?>
                                        <?php number_format($costo_kilo,0,'','.')?> <?php  $GramosMetroCuadrado?> <?php $costoMonotapaPorMetro2?>
                                      
                                        <?php $moldeNombre?> 
                                        <?php
                                    break;                                    
//                                  
//                                       ?>
                                       <?php $tapa = $this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_placa1) ?>
                                        <?php $tapa->materiales_tipo?><?php echo $materialidad_1->gramaje?> <?php echo $materialidad_1->precio?> <?php  $materialidad_1->reverso?>
					<?php $monda = $this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_onda2) ?>
                                        <?php $monda->materiales_tipo ?><?php echo $materialidad_2->gramaje?>  <?php echo $materialidad_2->precio?> <?php  $materialidad_2->reverso?>
					<?php $mliner = $this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_liner3) ?>
                                        <?php $mliner->materiales_tipo ?> <?php echo $materialidad_3->gramaje?> <?php echo $materialidad_3->precio?>  <?php  $materialidad_3->reverso?>
                                        <?php number_format($costo_kilo,0,'','.')?> <?php echo $GramosMetroCuadrado?> <?php echo $costoMonotapaPorMetro2?>
                                        
                                        <?php $moldeNombre?> 
                                        //<?php
//                                    break;
                                    case 'Corrugado'://la misma
                                        $materialidad_1=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_placa1);
                                        $materialidad_2=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_onda2);
                                        $materialidad_3=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_liner3);
                                        $materialidad_4="No Aplica";
                                        $variable_cotizador=$this->variables_cotizador_model->getVariablesCotizadorPorId(24);
                                        $variable_cotizador2=$this->variables_cotizador_model->getVariablesCotizadorPorId(40);
                                        $base_imprenta=$this->variables_cotizador_model->getVariablesCotizadorPorId(6);
                                        $formula=$materialidad_1->gramaje+($materialidad_1->gramaje*($variable_cotizador->precio/100))+$materialidad_3->gramaje;
                                        //echo $materialidad_2->gramaje."sss";exit;
                                        
                                        if (($materialidad_2->precio>0) and ($materialidad_3->gramaje>0) and ($materialidad_3->precio>0))
                                           $costo_kilo=((($materialidad_2->gramaje*($materialidad_2->precio/1000)+(($materialidad_2->gramaje*($variable_cotizador->precio/100)*$materialidad_2->precio/1000))+$materialidad_3->gramaje*$materialidad_3->precio/1000)/($materialidad_2->gramaje+($materialidad_2->gramaje*($variable_cotizador->precio/100))+$materialidad_3->gramaje)))*1000;           
                                        else 
                                            $costo_kilo=0;                                        
                                        if($materialidad_3->tipo == 14 and  $materialidad_3->reverso == 'Blanca')//valdivia
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(44);
                                        }
                                        if($materialidad_3->tipo == 15 and  $materialidad_3->reverso == 'Blanca')//maule
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(45);
                                        }
                                        if($materialidad_3->tipo == 1 and  $materialidad_3->reverso == 'Blanca') //Cartulina Importada
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(43);
                                        }
                                        if($materialidad_3->tipo == 5 and  $materialidad_3->reverso == 'Blanco') // papel reverso blanco
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(42);
                                        }
                                        if($materialidad_3->tipo == 3 and  $materialidad_3->reverso == 'Blanco') // papel reverso blanco/ white top
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(42);
                                        }
                                        if($materialidad_3->tipo == 4 and  $materialidad_3->reverso == 'Café') // papel reverso cafe
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(41);
                                        }
                                        $costo_kilo=$costo_kilo+$recargoCostoKilo->precio;
                                        if($fotomecanica->fot_lleva_barniz=='Nada' || $fotomecanica->fot_lleva_barniz=='')
                                        {
                                            $barniz2=0;
                                        }else
                                        {
                                            $barniz2=1;
                                        }
                                  
                                        if($maquina=="Máquina Roland 800")
                                         {
                                            $tira1=((($datoscantidad2/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio )*($fotomecanica->colores+$barniz2);
                                            $recargo800Array=$this->variables_cotizador_model->getVariablesCotizadorPorId(34);
                                            $tira2=((($datoscantidad2/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio)*($fotomecanica->colores+$barniz2)*(1*$recargo800Array->precio/100);
                                            $tiraje=$tira1+$tira2;

                                         }else
                                         {
                                            $tiraje=((($datoscantidad2/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio )*($fotomecanica->colores+$barniz2);  
                                          
                                         }    
                                        if  (($materialidad_2->gramaje>0) and ($materialidad_3->gramaje>0)) 
                                            $GramosMetroCuadrado=$materialidad_2->gramaje+($materialidad_2->gramaje*($variable_cotizador->precio/100))+$materialidad_3->gramaje;
                                        else
                                            $GramosMetroCuadrado=0;
                                        $recargoGramosDeAlmidon=$this->variables_cotizador_model->getVariablesCotizadorPorId(30);
                                        $GramosMetroCuadrado=$GramosMetroCuadrado+$recargoGramosDeAlmidon->precio;
										
					if(sizeof($hoja)>=1)
                                        {
                                            $arreglo54=array
                                                (
                                                    "gramos_metro_cuadrado"=>$GramosMetroCuadrado,
                                                );
                                                $this->db->where('id', $hoja->id);
                                                $this->db->update("hoja_de_costos_datos",$arreglo54);
                                        }
                                        if (($materialidad_2->gramaje>0) and ($materialidad_3->gramaje>0) and ($materialidad_2->precio>0))
                                            $costoMonotapaPorMetro2=$materialidad_2->gramaje*($materialidad_2->precio/1000)+(($materialidad_2->gramaje*($variable_cotizador->precio/100)*$materialidad_2->precio/1000)+$materialidad_3->gramaje*$materialidad_3->precio/1000);
                                        else
                                            $costoMonotapaPorMetro2=0;

                                       
                                       switch($fotomecanica->estan_los_moldes)
                                       {
                                          case 'NO':
                                            $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Nuevo</strong>)";
                                          break;
                                          case 'MOLDE GENERICO':
                                            if ($orden->id_molde!='')  
                                                $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            else
                                                $molde=$this->moldes_model->getMoldesPorId($datos->numero_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Antiguo</strong>)";
                                          break;
                                          case 'MOLDE REGISTRADOS DEL CLIENTE':
                                            if ($orden->id_molde!='')  
                                                $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            else
                                                $molde=$this->moldes_model->getMoldesPorId($datos->numero_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Antiguo</strong>)";
                                          break;                                          
                                          case 'NO LLEVA':
                                            $moldeNombre="<strong>NO ESTA MOLDE, PRODUCTO NO FABRICADO ANTERIORMENTE</strong>";
                                          break;
                                          case 'CLIENTE LO APORTA':
                                            $moldeNombre="<strong>CLIENTE LO APORTA</strong>";
                                          break;
                                       }                                       
                                       
                                       
                                       
                                        $tapaNombre=$materialidad_1->nombre;
                                        $tapaGramaje=$materialidad_1->gramaje;
                                        $tapaFecha=$materialidad_1->fecha_ultima_actualizacion;
                                        $tapaPrecio=$materialidad_1->precio;
                                        $ondaNombre=$materialidad_2->nombre;
                                        $ondaGramaje=$materialidad_2->gramaje;
                                        $ondaFecha=$materialidad_2->fecha_ultima_actualizacion;
                                        $ondaPrecio=$materialidad_2->precio;
                                        $linerNombre=$materialidad_3->nombre;
                                        $linerGramaje=$materialidad_3->gramaje;
                                        $linerFecha=$materialidad_3->fecha_ultima_actualizacion;
                                        $linerPrecio=$materialidad_3->precio;                      
                                        ?>
				
                                        <?php
                                    break;
                                    case 'Cartulina-cartulina': //Cartulina cartulina
                                        $materialidad_1=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_placa1);
                                        $materialidad_2=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_onda2);
                                        $materialidad_3=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_liner3);
                                        //$materialidad_3="No Aplica";;
                                        $materialidad_4="No Aplica";
                                        $variable_cotizador=$this->variables_cotizador_model->getVariablesCotizadorPorId(24);
                                        $variable_cotizador2=$this->variables_cotizador_model->getVariablesCotizadorPorId(40);
                                        $base_imprenta=$this->variables_cotizador_model->getVariablesCotizadorPorId(6);
                                        if (($materialidad_2->precio>0) and ($materialidad_2->gramaje>0) and ($variable_cotizador->precio>0))
                                            $costo_kilo=((($materialidad_2->gramaje*($materialidad_2->precio/1000)+(($materialidad_2->gramaje*($variable_cotizador->precio/100)*$materialidad_2->precio/1000))+0*0/1000)/($materialidad_2->gramaje+($materialidad_2->gramaje*($variable_cotizador->precio/100))+0)))*1000;     
                                        else 
                                            $costo_kilo=0;
                                        $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(40);
                                        $costo_kilo=$costo_kilo+$recargoCostoKilo->precio;
                                        if($fotomecanica->fot_lleva_barniz=='' || $fotomecanica->fot_lleva_barniz=='Nada')
                                        {
                                            $barniz2=0;
                                        }else
                                        {
                                            $barniz2=1;
                                        }

                                        if($maquina=="Máquina Roland 800")
                                         {
                                        $tira1=((($datoscantidad2/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio )*($fotomecanica->colores+$barniz2);
                                            $recargo800Array=$this->variables_cotizador_model->getVariablesCotizadorPorId(34);
                                        $tira2=((($datoscantidad2/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio)*($fotomecanica->colores+$barniz2)*(1*$recargo800Array->precio/100);
                                            $tiraje=$tira1+$tira2;
                                            
                                         }else
                                         {
                                            $tiraje=((($datoscantidad2/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio )*($fotomecanica->colores+$barniz2);  
                                          
                                         }    
                                        if  ($materialidad_2->gramaje>0) 
                                            $GramosMetroCuadrado=$materialidad_2->gramaje+($materialidad_2->gramaje*($variable_cotizador->precio/100))+0;
                                        else 
                                            $GramosMetroCuadrado=0;
                                        $recargoGramosDeAlmidon=$this->variables_cotizador_model->getVariablesCotizadorPorId(30);
                                        $GramosMetroCuadrado=$GramosMetroCuadrado+$recargoGramosDeAlmidon->precio;
                                        if  ($materialidad_2->gramaje>0) 
                                            $costoMonotapaPorMetro2=$materialidad_2->gramaje*($materialidad_2->precio/1000)+(($materialidad_2->gramaje*($variable_cotizador->precio/100)*$materialidad_2->precio/1000)+0*0/1000);
                                        else 
                                            $costoMonotapaPorMetro2=0;
                                         
                                        
                                       switch($fotomecanica->estan_los_moldes)
                                       {
                                          case 'NO':
                                            $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Nuevo</strong>)";
                                          break;
                                          case 'MOLDE GENERICO':
                                            if ($orden->id_molde!='')  
                                                $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            else
                                                $molde=$this->moldes_model->getMoldesPorId($datos->numero_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Antiguo</strong>)";
                                          break;
                                          case 'MOLDE REGISTRADOS DEL CLIENTE':
                                            if ($orden->id_molde!='')  
                                                $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            else
                                                $molde=$this->moldes_model->getMoldesPorId($datos->numero_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Antiguo</strong>)";
                                          break;                                          
                                          case 'NO LLEVA':
                                            $moldeNombre="<strong>NO ESTA MOLDE, PRODUCTO NO FABRICADO ANTERIORMENTE</strong>";
                                          break;
                                          case 'CLIENTE LO APORTA':
                                            $moldeNombre="<strong>CLIENTE LO APORTA</strong>";
                                          break;
                                       }                                        

                                        $tapaNombre=$materialidad_1->nombre;
                                        $tapaGramaje=$materialidad_1->gramaje;
                                        $tapaFecha=$materialidad_1->fecha_ultima_actualizacion;
                                        $tapaPrecio=$materialidad_1->precio;
										
                                        $tapaNombre2=$materialidad_2->nombre;
                                        $tapaGramaje2=$materialidad_2->gramaje;
                                        $tapaFecha2=$materialidad_2->fecha_ultima_actualizacion;
                                        $tapaPrecio2=$materialidad_2->precio;
                                        
                                        $tapaNombre3=$materialidad_3->nombre;
                                        $tapaGramaje3=$materialidad_3->gramaje;
                                        $tapaFecha3=$materialidad_3->fecha_ultima_actualizacion;
                                        $tapaPrecio3=$materialidad_3->precio;
                     
                                        ?>
                                        <?php $fotomecanica->materialidad_1?><?php $materialidad_1->gramaje?> <?php $materialidad_1->precio?><?php $materialidad_1->reverso?>
                                        <?php $fotomecanica->materialidad_3?><?php $materialidad_3->gramaje?> <?php $materialidad_3->precio?><?php $materialidad_3->reverso?>
                                        <?php $formula?>
                                        <?php $fotomecanica->impresion?>
                                        <?php $moldeNombre?>
                                        <?php
                                        
                                    break;
                                    case 'Sólo Cartulina':
									
					$materialidad_1=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_placa1);
                                        $variable_cotizador=$this->variables_cotizador_model->getVariablesCotizadorPorId(24);
                                        $variable_cotizador2=$this->variables_cotizador_model->getVariablesCotizadorPorId(40);
                                        $base_imprenta=$this->variables_cotizador_model->getVariablesCotizadorPorId(6);
                                      
                                        $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(40);
                                        $costo_kilo=0;
                                        if($fotomecanica->fot_lleva_barniz=='' || $fotomecanica->fot_lleva_barniz=='Nada')
                                        {
                                            $barniz2=0;
                                        }else
                                        {
                                            $barniz2=1;
                                        }
                                        
                                        if($maquina=="Máquina Roland 800")
                                         {
                                            $tira1=((($datoscantidad2/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio )*($fotomecanica->colores+$barniz2);
                                            $recargo800Array=$this->variables_cotizador_model->getVariablesCotizadorPorId(34);
                                            $tira2=((($datoscantidad2/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio)*($fotomecanica->colores+$barniz2)*(1*$recargo800Array->precio/100);
                                            $tiraje=$tira1+$tira2;
  
                                         }else
                                         {
                                            $tiraje=((($datoscantidad2/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio )*($fotomecanica->colores+$barniz2);  
                                          
                                         }    
                                        if  ($materialidad_2->gramaje>0) 
                                            $GramosMetroCuadrado=$materialidad_2->gramaje+($materialidad_2->gramaje*($variable_cotizador->precio/100))+0;
                                        else 
                                            $GramosMetroCuadrado=0;
                                        $recargoGramosDeAlmidon=$this->variables_cotizador_model->getVariablesCotizadorPorId(30);
                                        
                                        $GramosMetroCuadrado=$GramosMetroCuadrado+$recargoGramosDeAlmidon->precio;
                                        if  ($materialidad_2->gramaje>0) 
                                            $costoMonotapaPorMetro2=$materialidad_2->gramaje*($materialidad_2->precio/1000)+(($materialidad_2->gramaje*($variable_cotizador->precio/100)*$materialidad_2->precio/1000)+0*0/1000);
                                        else 
                                            $costoMonotapaPorMetro2=0; 
                                                                             
                                       switch($fotomecanica->estan_los_moldes)
                                       {
                                          case 'NO':
                                            $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Nuevo</strong>)";
                                          break;
                                          case 'MOLDE GENERICO':
                                            if ($orden->id_molde!='')  
                                                $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            else
                                                $molde=$this->moldes_model->getMoldesPorId($datos->numero_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Antiguo</strong>)";
                                          break;
                                          case 'MOLDE REGISTRADOS DEL CLIENTE':
                                            if ($orden->id_molde!='')  
                                                $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            else
                                                $molde=$this->moldes_model->getMoldesPorId($datos->numero_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Antiguo</strong>)";
                                          break;                                          
                                          case 'NO LLEVA':
                                            $moldeNombre="<strong>NO ESTA MOLDE, PRODUCTO NO FABRICADO ANTERIORMENTE</strong>";
                                          break;
                                          case 'CLIENTE LO APORTA':
                                            $moldeNombre="<strong>CLIENTE LO APORTA</strong>";
                                          break;
                                       }                                        
                                        $tapaNombre=$materialidad_1->nombre;
                                        $tapaGramaje=$materialidad_1->gramaje;
                                        $tapaFecha=$materialidad_1->fecha_ultima_actualizacion;
                                        $tapaPrecio=$materialidad_1->precio;
										
                                        $tapaNombre2=$materialidad_2->nombre;
                                        $tapaGramaje2=$materialidad_2->gramaje;
                                        $tapaFecha2=$materialidad_2->fecha_ultima_actualizacion;
                                        $tapaPrecio2=$materialidad_2->precio;
                     
                                        ?>
                                        <?php $fotomecanica->materialidad_1?><?php $materialidad_1->gramaje?><?php $materialidad_1->precio?><?php  $materialidad_1->reverso?>
                                        <?php $fotomecanica->materialidad_2?><?php $materialidad_2->gramaje?><?php $materialidad_2->precio?> <?php $materialidad_2->reverso?>
                                        <?php $formula?>
                                        <?php $fotomecanica->impresion?>
                                        <?php $moldeNombre?>
                                        <?php	
                                    break;
                                    case 'Se solicita proposición':
                                        
                                    break;
                                  }  
                                ?>
                 </td>
                <td class="celda_5 valign_top">
                    <!--trabajos externos-->
                    <table border="1">
                                         
               <?php
                                $cantidad_4=0;
                                $externos_produccion=0;
                             //    exit($fotomecanica->acabado_impresion_4."hollaaa");
				if($fotomecanica->acabado_impresion_4=="17")
                                {
                                    $acabado_4="";
                                    $acabado_4Valor="";
                                    $acabado_4MedidaMasValorVenta="";
                                    $acabado_4Unitario="";
                                    $acabado_4UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_4Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_4);
                                    $acabado_4=$acabado_4Array->caracteristicas; // Nombre acabado
                                    $acabado_4UnidadVentaNombre=$acabado_4Array->unv; //Nombre unidad de venta
                                    $acabado_4Valor=$acabado_4Array->valor_venta; // ej: 52
                                    $acabado_4MedidaMasValorVenta=($tamano1*$tamano2*$acabado_4Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_4CostoFijo=$acabado_4Array->costo_fijo;	
								
                                    
                                    if ($acabado_4Array->unidad_de_venta == '1') //Metros
                                    {
                                        $costo_unitario4=$acabado_4MedidaMasValorVenta;
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad2);
                                        $cantidad_4=$datoscantidad2;
                                    }
                                    elseif ($acabado_4Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $costo_unitario4=$acabado_4Valor;
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }  
                                    elseif ($acabado_4Array->unidad_de_venta == '3') //tONELADA
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad2);
                                    }                                    
                                    elseif ($acabado_4Array->unidad_de_venta == '4') //caja de carton
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad2);
                                    }                                            
                                    elseif ($acabado_4Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($datoscantidad2*$acabado_4Valor);
                                        $cantidad_4=$datoscantidad2;
                                    }       
                                    elseif ($acabado_4Array->unidad_de_venta == '6') //cm2
                                    {
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $costo_unitario4=$acabado_4Valor;     
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }   
                                    elseif ($acabado_4Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario4=$acabado_4MedidaMasValorVenta;
                                        $precio_total_4=$acabado_4MedidaMasValorVenta*$datoscantidad2;
                                        $cantidad_4=$datoscantidad2;
                                    }
                                    elseif ($acabado_4Array->unidad_de_venta == '8') //cms
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad2);
                                    }           
                                    elseif ($acabado_4Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }     
                                    elseif ($acabado_4Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($acabado_4Valor*$datoscantidad2);
                                        $cantidad_4=$datoscantidad2;                                        
                                    }
                                    
                                }
								
                                if($fotomecanica->acabado_impresion_5=="17")
                                {
                                    $acabado_5="";
                                    $acabado_5Valor="";
                                    $acabado_5MedidaMasValorVenta="";
                                    $acabado_5Unitario="";
                                    $acabado_5UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_5Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_5);
                                    $acabado_5=$acabado_5Array->caracteristicas;
                                    $acabado_5UnidadVentaNombre=$acabado_5Array->unv; //Nombre unidad de venta
                                    $acabado_5Valor=$acabado_5Array->valor_venta; // ej: 52
                                    $acabado_5MedidaMasValorVenta=($tamano1*$tamano2*$acabado_5Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_5CostoFijo=$acabado_5Array->costo_fijo;		
                                  if ($acabado_5Array->unidad_de_venta == '1') //mt2
                                    {
                                        $costo_unitario5=$acabado_5MedidaMasValorVenta;
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad2);                                      
                                        $cantidad_5=$datoscantidad2;
                                    }
                                    elseif ($acabado_5Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $costo_unitario5=$acabado_5Valor; 
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }    
                                    elseif ($acabado_5Array->unidad_de_venta == '3') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad2);
                                    }                                    
                                    elseif ($acabado_5Array->unidad_de_venta == '4') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad2);
                                    }                                            
                                    elseif ($acabado_5Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($datoscantidad2*$acabado_5Valor);
                                        $cantidad_5=$datoscantidad2;
                                    }       
                                    elseif ($acabado_5Array->unidad_de_venta == '6') //mt2
                                    {
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $costo_unitario5=$acabado_5Valor;
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }   
                                    elseif ($acabado_5Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario5=$acabado_5MedidaMasValorVenta;
                                        $precio_total_5=$acabado_5MedidaMasValorVenta*$datoscantidad2;
                                        $cantidad_5=$datoscantidad2;
                                    }
                                    elseif ($acabado_5Array->unidad_de_venta == '8') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad2);
                                    }           
                                    elseif ($acabado_5Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }   
                                    elseif ($acabado_5Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($acabado_5Valor*$datoscantidad2);
                                        $cantidad_5=$datoscantidad2;
                                    }                                      
                                }    
                                if($fotomecanica->acabado_impresion_6=="17")
                                {
                                    $acabado_6="";
                                    $acabado_6Valor="";
                                    $acabado_6MedidaMasValorVenta="";
                                    $acabado_6Unitario="";
                                    $acabado_6UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_6Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_6);
                                    $acabado_6=$acabado_6Array->caracteristicas;
                                    $acabado_6UnidadVentaNombre=$acabado_6Array->unv; //Nombre unidad de venta
                                    $acabado_6Valor=$acabado_6Array->valor_venta; // ej: 52
                                    $acabado_6MedidaMasValorVenta=($tamano1*$tamano2*$acabado_6Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_6CostoFijo=$acabado_6Array->costo_fijo;		
                                    if ($acabado_6Array->unidad_de_venta == '1') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad2);
                                    }
                                    elseif ($acabado_6Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $costo_unitario6=$acabado_6Valor; 
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    }  
                                    elseif ($acabado_6Array->unidad_de_venta == '3') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad2);
                                    }                                    
                                    elseif ($acabado_6Array->unidad_de_venta == '4') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad2);
                                    }                                            
                                    elseif ($acabado_6Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($datoscantidad2*$acabado_5Valor);
                                        $cantidad_6=$datoscantidad2;
                                    }       
                                    elseif ($acabado_6Array->unidad_de_venta == '6') //mt2
                                    {
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $costo_unitario6=$acabado_6Valor;
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    }   
                                    elseif ($acabado_6Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario6=$acabado_6MedidaMasValorVenta;
                                        $precio_total_6=$acabado_6MedidaMasValorVenta*$datoscantidad2;
                                        $cantidad_6=$datoscantidad2;
                                    }
                                    elseif ($acabado_6Array->unidad_de_venta == '8') //cms
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad2);
                                    }           
                                    elseif ($acabado_6Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    } 
                                    elseif ($acabado_6Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($acabado_6Valor*$datoscantidad2);
                                        $cantidad_6=$datoscantidad2;
                                    }                                      

                                }        
               ?>
                <?php

                if($ing->piezas_adicionales == 'NO LLEVA')
                {
                    $piezaAdacionalNom1 ="No Lleva";
                    $piezaAdacionalValor1="&nbsp;";
                    $piezaAdacionalTotal1="&nbsp;";
                    $piezaAdacionalEmpresa1="&nbsp;";
                }else
                {
                    $piezasAdicionales = $this->piezas_adicionales_model->getPiezasAdicionalesPorNombreHojaCosto($ing->piezas_adicionales);
                    $piezaUnidadVentaNombre1=$piezasAdicionales->unv; //Nombre unidad de venta
                    $piezaAdacionalNom1 = $piezasAdicionales->piezas_adicionales;
                    $piezaAdacionalValor1= $piezasAdicionales->valor_venta;
                    $piezaAdacionalTotal1 = $datoscantidad2 * $piezaAdacionalValor1;
                    $piezaAdacionalEmpresa1= $hoja->piezas_adicionales1;
                }
                if($ing->piezas_adicionales2 == 'NO LLEVA')
                {
                    $piezaAdacionalNom2 ="No Lleva";
                    $piezaAdacionalValor2="&nbsp;";
                    $piezaAdacionalTotal2="&nbsp;";
                    $piezaAdacionalEmpresa2="&nbsp;";
                }else
                {
                    $piezasAdicionales = $this->piezas_adicionales_model->getPiezasAdicionalesPorNombreHojaCosto($ing->piezas_adicionales2);
                    $piezaUnidadVentaNombre2=$piezasAdicionales->unv; //Nombre unidad de venta                                    
                    $piezaAdacionalNom2 = $piezasAdicionales->piezas_adicionales;
                    $piezaAdacionalValor2= $piezasAdicionales->valor_venta;
                    $piezaAdacionalTotal2= $datoscantidad2 * $piezaAdacionalValor2;
                    $piezaAdacionalEmpresa2= $hoja->piezas_adicionales2;
                }
                if($ing->piezas_adicionales3 == 'NO LLEVA')
                {
                    $piezaAdacionalNom3 ="No Lleva";
                    $piezaAdacionalValor3="&nbsp;";
                    $piezaAdacionalTotal3="&nbsp;";
                    $piezaAdacionalEmpresa3="&nbsp;";
                }else
                {
                    $piezasAdicionales = $this->piezas_adicionales_model->getPiezasAdicionalesPorNombreHojaCosto($ing->piezas_adicionales3);
                    $piezaUnidadVentaNombre3=$piezasAdicionales->unv; //Nombre unidad de venta                                    
                    $piezaAdacionalNom3 = $piezasAdicionales->piezas_adicionales;
                    $piezaAdacionalValor3 =  $piezasAdicionales->valor_venta;
                    $piezaAdacionalTotal3= $datoscantidad3 * $piezaAdacionalValor3;;
                    $piezaAdacionalEmpresa3= $hoja->piezas_adicionales3;
                }
                ?>
                </table>
                                    <!--/trabajos externos-->
                                </td>
                            </tr>
                        </table>
                        <!--/materialidad-->
                    </div>
                    <div class="separador_10"></div>
                    <div>
                        <table id="tabla_detalle">
                         
                        <?php
                            if (($datoscantidad2>0) and ($ing->unidades_por_pliego>0))
                                $costoPlacaKilo=($datoscantidad2/$ing->unidades_por_pliego)+$sum;
                            else 
                                $costoPlacaKilo=0;
                            $valorPlacaKilo=($costoPlacaKilo*$tamano1*$tamano2*$tapaGramaje)/10000000;
                            $totalPlacaKilo=$valorPlacaKilo*$tapaPrecio;
							
                             if(sizeof($hoja)>=1 and $hoja->fecha)
                            {
                                $arreglo5=array
                                (
                                    "placa_kilo"=>$costoPlacaKilo,
                                    "total_pliegos"=>$valorPlacaKilo,
                                );
//                                $this->db->where('id', $hoja->id);
//                                $this->db->update("hoja_de_costos_datos",$arreglo5);
//                                echo $this->db->last_query();
                            }
			    if(sizeof($hoja)>=1)
                            {
                                $arreglokilo1=array
                                (
                                    "kilos_placa"=>$valorPlacaKilo,
                                 
                                );
//                                $this->db->where('id', $hoja->id);
//                                $this->db->update("hoja_de_costos_datos",$arreglokilo1);
//                                echo $this->db->last_query();
                            }
                        ?>
                        
                                  <?php
                                  $variableComplemento=$this->variables_cotizador_model->getVariablesCotizadorPorId(32);
                                        $valorTiraje=$variableComplemento->precio-$tiraje;
										
                                        if($valorTiraje>0)
                                        {
                                            if($fotomecanica->colores == 0)
                                            {
                                              $complemento=0;
                                            }else{
                                              $complemento=$valorTiraje;	
                                            }
                                            
											
                                        }else
                                        {
                                            $complemento=0;
                                        }
                                        
                                        
                                  ?>  
					<?php if($hoja->valor_externo!=0){ $externos_produccion=$externos_produccion+$hoja->valor_externo+$costo1+$costo2+$costo3+$costo4+$costo5+$costoa1+$costoa2+$costoa3+$costoa4+$costoa5; }else{  $externos_produccion=$precio_total_4+$precio_total_5+$precio_total_6+$costo1+$costo2+$costo3+$costo4+$costo5+$costoa1+$costoa2+$costoa3+$costoa4+$costoa5; } ?>			  

                    <?php
                        if($maquina=="Máquina Roland 800")
                        {
                           if (($datoscantidad2>0) and ($ing->unidades_por_pliego>0))
                                $costoOndaKilo=((($datoscantidad2/$ing->unidades_por_pliego)*1.04)+100)+4;
                            else 
                                $costoOndaKilo=0;                            
                        }else
                        {
                           if (($datoscantidad2>0) and ($ing->unidades_por_pliego>0))
                                $costoOndaKilo=(($datoscantidad2/$ing->unidades_por_pliego)+100)+4;
                            else 
                                $costoOndaKilo=0;                               
                        }
                        
                        if($fotomecanica->materialidad_datos_tecnicos == 'Sólo Cartulina')
                        {
                                $costoOndaKilo=0;
                                $valorOndaKilo=0;
                                $totalOndaKilo=0;
                                $valorCorte=0;

                        }else{
                            $valorOndaKilo=($costoOndaKilo*$tamano1*$tamano2*$GramosMetroCuadrado)/10000000;
                            $totalOndaKilo=$valorOndaKilo*$costo_kilo;
                            $valorCorte=$costoOndaKilo*4.5;
			}
                        
                        $costoOndaKilo1=((($datoscantidad2/$ing->unidades_por_pliego)*1.04)+100)+4;
                        $costoOndaKilo2=(($datoscantidad2/$ing->unidades_por_pliego)+$emplacado+$troquelado);
                        
                        if($costoOndaKilo1>$costoOndaKilo2){
                            $costoOndaKilo=$costoOndaKilo1;
                        }
                        if($costoOndaKilo1<$costoOndaKilo2){
                            $costoOndaKilo=$costoOndaKilo2;
                        }
                        
                    ?>
                    <?php
                        $variableEmplacado=$this->variables_cotizador_model->getVariablesCotizadorPorId(8);
                        $valorEmplacadado=($variableEmplacado->precio*$tamano1*$tamano2)/10000;
                        $totalEmplacado=$valorEmplacadado*$costoOndaKilo;
                    ?>
                    <?php
                    
                        if($fotomecanica->estan_los_moldes == 'NO LLEVA')
                        {
                            $variableMontajeMoldeTroquel=0;
                            $totalMontajeMolde=0;
                        }else
                        {
                            $variableRecargoMontaje=$this->variables_cotizador_model->getVariablesCotizadorPorId(31);
                            $variableMontajeMoldeTroquel=$this->variables_cotizador_model->getVariablesCotizadorPorId(10);
                            $totalMontajeMolde=$variableMontajeMoldeTroquel->precio*1.5;	
                        }                    

//                       
                    ?>
                    <?php
						if($fotomecanica->estan_los_moldes == 'NO LLEVA')
						{
                                                    $variableTroquelado=0;
                                                    $totalTroquelado=0;
						}else
						{
                                                    $variableTroquelado=$this->variables_cotizador_model->getVariablesCotizadorPorId(11);
                                                    $totalTroquelado=($costoOndaKilo*$variableTroquelado->precio)*1.5;	
						}                    
//					
                    ?>
                    <?php
                                        $variableDesgajado=$this->variables_cotizador_model->getVariablesCotizadorPorId(12);
                                        $totalDesgajado=$ing->piezas_totales_en_el_pliego*$variableDesgajado->precio*1.5*$costoOndaKilo;
                    ?>                                
 
                 
                                        <?php
                                           $variablePegado=$this->variables_cotizador_model->getVariablesCotizadorPorId(21);
                                           if(sizeof($hoja)==0) { 
                                               if ($datos->pegado_migrado==null || $datos->pegado_migrado=='' || $datos->pegado_migrado==0){
                                                   if($presupuesto->costo_pegado>=1){
                                                       $pegado_migrado=$presupuesto->costo_pegado;
                                                   }else{
                                                       $pegado_migrado=30; 
                                                   }
                                                }else{ 
                                                    $pegado_migrado=$datos->pegado_migrado;
                                                }
                                           }else{
                                                    $pegado_migrado=$hoja->pegado;
                                           }
                                           
                                           $totalPegado=$datoscantidad2*$pegado_migrado*$variablePegado->precio;
                                           
                                        ?>    
                     <?php
					 if(sizeof($hoja->pegado)>=1)
					 {
                                            $divisionPegado=$hoja->pegado/2;
                                            $totalDespacho=$divisionPegado*$datoscantidad2;
					 }
					 else
					 {
                                                $divisionPegado=$pegado_migrado/2;
                                                $totalDespacho=$divisionPegado*$datoscantidad2;
                                         }
	 
                     
                     ?>
                     <?php
					 
					 	
					 
					 //%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
					 
                    if($fotomecanica->condicion_del_producto == 'Nuevo') //nuevo 
                    {
                        if($fotomecanica->estan_los_moldes == 'NO')
			{
				$variableTroquel=$this->variables_cotizador_model->getVariablesCotizadorPorId(9);
                                $moldeTroquel=$variableTroquel->precio;
                        }
                        elseif($fotomecanica->estan_los_moldes == 'NO LLEVA')
                        {
                            $moldeTroquel=0;
                        }elseif($fotomecanica->estan_los_moldes == 'CLIENTE LO APORTA')
                        {
                            $moldeTroquel=0;
                        }
                    }
                    if($fotomecanica->condicion_del_producto == 'Repetición Sin Cambios') //
                    {

                    if($fotomecanica->estan_los_moldes == 'NO LLEVA')
                    {
                            $variableTroquel=$this->variables_cotizador_model->getVariablesCotizadorPorId(9);

                            $moldeTroquel=0;
                    }
                    }					
                    if($fotomecanica->condicion_del_producto == 'Repetición con Cambios') //
                    {
			$moldeTroquel=0;
                    }
                    if($fotomecanica->condicion_del_producto == 'Producto Genérico') //
                    {
			$moldeTroquel=0;
                    }
            						   
                     ?>
               
					 <?php
					 $variableEmplacado=$this->variables_cotizador_model->getVariablesCotizadorPorId(39);
					 if($fotomecanica->lleva_barniz == 'SI' and $fotomecanica->reserva_barniz == 'SI')
					 {
						 $otrosCaucho = $variableEmplacado->precio; 
					 }else
					 {
						$otrosCaucho = 0;
					 }
                                         if($fotomecanica->fot_cala_caucho== 'Si')
										 {
											 $otrosCaucho = 50000; 
										 }else
										 {
											$otrosCaucho = 0;
										 }
					 
					 ?>
	
					 <?php
					 if($piezaAdacionalEmpresa1 != 0)
					 {
						$TotalPiezasAdicionales = $TotalPiezasAdicionales + $piezaAdacionalEmpresa1;

					 }
					 else
					 {
						 	$TotalPiezasAdicionales = $TotalPiezasAdicionales + $piezaAdacionalTotal1;
						 
					 }
					 
					  if($piezaAdacionalEmpresa2 != 0)
					 {
						$TotalPiezasAdicionales = $TotalPiezasAdicionales + $piezaAdacionalEmpresa2;

					 }
					else
					 {
						 $TotalPiezasAdicionales = $TotalPiezasAdicionales + $piezaAdacionalTotal2;
						 
					 }
					 
					 
					  if( $piezaAdacionalEmpresa3 != 0)
					 {
						$TotalPiezasAdicionales = $TotalPiezasAdicionales + $piezaAdacionalEmpresa3;

					 }
					else
					 {
						 $TotalPiezasAdicionales = $TotalPiezasAdicionales + $piezaAdacionalTotal3;
						 
					 }
					 
					// $TotalPiezasAdicionales = $piezaAdacionalTotal1 + $piezaAdacionalTotal2 + $piezaAdacionalTotal3;
					 ?>
				
                     <?php
                     $totalProduccion=$costosporlacado+$complemento+$valorCorte+$totalEmplacado+$totalMontajeMolde+$totalTroquelado+$totalPegado+$totalDespacho+$tiraje+$moldeTroquel+$totalDesgajado+$externos_produccion+$otrosCaucho + $TotalPiezasAdicionales + $valor_extra + $valor_bv_maquina + $valor_acepeta_exce;

                     ?>
                   
                                            
                     <?php

                      $costoVentaValor=(($totalOndaKilo+$totalPlacaKilo+$totalPreImpresion+$totalProduccion)*$costoVenta->precio)/100;

                     ?>
                     <tr>
                                            <?php number_format($costoVentaValor,0,'','.')?></td>
                     </tr>
                     <?php
                      $costoAdministracionValor=(($totalOndaKilo+$totalPlacaKilo+$totalPreImpresion+$totalProduccion)*$costoAdministracion->precio)/100;
                      
                     ?>
                     <tr>
                                            <td class="celda_33"><?php number_format($costoAdministracionValor,0,'','.')?></td>
                                        </tr>
                                           <?php number_format($hoja->valor_extra*$datoscantidad2,0,'','.') ?>
                                
                     <?php
                      $totalCostosVarios=$costoAdministracionValor+$costoVentaValor+$hoja->costo_adicional+$valor_extra;
                     ?>
                     
                                    </table>
                                    <!--/producción-->
                                </td>
                            </tr>

                            </tr>
                            <?php
                            if(sizeof($hoja)>=1)
                            {
                                $arreglo6=array
                                (
                                    "onda_kilo"=>$costoOndaKilo,
                                );
//                                $this->db->where('id', $hoja->id);
//                                $this->db->update("hoja_de_costos_datos",$arreglo6);
                            }
							
							
							
                            ?>
                           
                           <?php $porcentajeTotalCorte =$totalPlacaKilo*7/100; number_format((($totalPlacaKilo*7)/(100)),0,'','.')?>
                             <?php

                                                                
								if($fotomecanica->materialidad_datos_tecnicos == 'Cartulina-cartulina')
								{
                                                                $costoPlacaKilo2 = ($datoscantidad2/$ing->unidades_por_pliego);

                                                                $cuatro_por_ciento = ($costoPlacaKilo2 / 100)* 4;
							
                                                                //if($costoPlacaKilo2 >= 1 and $costoPlacaKilo2 <= 100)
                                                                if($cuatro_por_ciento >= 1 and $cuatro_por_ciento <= 100)
                                                                {
                                                                        if($fotomecanica->colores==0){
                                                                        $agregado_a_apliegos = 25;}else{    
                                                                        $agregado_a_apliegos = 100;
                                                                        }
                                                                }

                                                                if($cuatro_por_ciento > 100)
                                                                {
                                                                        $agregado_a_apliegos = $cuatro_por_ciento;
                                                                }
                                                                $costoPlacaKilo2 = $costoPlacaKilo2 + $agregado_a_apliegos;
                                                                $valorPlacaKilo2 = ($costoPlacaKilo2*$tamano1*$tamano2*$tapaGramaje3)/10000000;
                                                                //$valorPlacaKilo2 = number_format($valorPlacaKilo2,0,'','.');
                                                                
                                                                $totalPlacaKilo2 = $valorPlacaKilo2*$tapaPrecio3;
							
                                                                ?>
                                                               <?php  number_format($valorPlacaKilo2,0,'','.');?>
                                                                <?php number_format($costoPlacaKilo2,0,'','.')?>
                                                                <?php number_format($totalPlacaKilo2,0,'','.')?>
                                                                <?php $totalMerma=$totalPlacaKilo2;		
								}
								else
								{
                                                                ?>		
                                                                <?php number_format($valorOndaKilo,0,'','.');?>
                                                                <?php number_format($costoOndaKilo,0,'','.')?>
                                                                <?php number_format($totalOndaKilo,0,'','.')?>
                                                                <?php $totalMerma=$totalOndaKilo;
								}
                                                                ?>
                            
                            <?php $porcentajeTotalMerma =$totalMerma*10/100; number_format((($totalMerma*10)/(100)),0,'','.')?>
                            
                            
                            <?php
							if($fotomecanica->materialidad_datos_tecnicos == 'Cartulina-cartulina')
								{
									$totalMateriaPrima= $totalPlacaKilo+$totalPlacaKilo2+$porcentajeTotalMerma+$porcentajeTotalCorte;
								}else
								{
									$totalMateriaPrima= $totalOndaKilo+$totalPlacaKilo+$porcentajeTotalMerma+$porcentajeTotalCorte;	
								}
                            
                            ?>
                      <tr>
                
                                <td class="celda_3"><?php number_format($totalMateriaPrima,0,'','.')?></td>
                            </tr>
                     
                            
                            <tr>
                                <?php  $coloresMontaje;?>
                                <td class="celda_3"><?php if($fotomecanica->condicion_del_producto=='Repetición Sin Cambios'){ '0';}else{ number_format($montajePreImpresion->precio,0,'','.');}?></td>
                                <?php if ($fotomecanica->condicion_del_producto=='Repetición Sin Cambios') { ?>
                                <td class="celda_3"><?php number_format(0,0,'','.')?></td>
                                <?php } else { ?>
                                <td class="celda_3"><?php number_format($cantidadMontaje,0,'','.')?></td>
                                <?php } ?>                                
                            </tr>
                        </table>
                         <table id="tabla_detalle">
                     
                         <?php
                        
                        if($fotomecanica->materialidad_datos_tecnicos == 'Cartulina-cartulina')
								{
									$totalMateriaPrima= $totalPlacaKilo+$totalPlacaKilo2+$porcentajeTotalMerma+$porcentajeTotalCorte;
								}else
								{
									//$totalMateriaPrima= $totalOndaKilo+$totalPlacaKilo+$porcentajeTotalMerma+$porcentajeTotalCorte;	
                                                                        $corte2=(($totalPlacaKilo*7)/100);
                                                                        $merma2=(($totalOndaKilo*10)/100);
                                                                        $totalMateriaPrima=$totalOndaKilo+$totalPlacaKilo+$corte2+$merma2;
                                                                        
                                                                }
                                                              
                                                                
                        
                         ?>
                               
                                
                         <?php
                           $totalTotal=$totalMateriaPrima+$totalPreImpresion+$totalProduccion+$totalCostosVarios;                                               
                           $totalValorUnitario=$totalTotal/$datoscantidad2;

                          
                          if ($hoja->margen!="") {
                            $valorFinal=(($totalValorUnitario/(100-$hoja->margen))/100)*10000;
                          
                          }else{ 
                              if($datos->margen_migrado!=0 || $datos->margen_migrado!=null){
                                  $valorFinal=(($totalValorUnitario/(100-$datos->margen_migrado))/100)*10000;
                                  $valorFinal2xxx = $this->cotizaciones_model->CantidadPorXXX($id,$datoscantidad2,2);
                                  $valorFinal3xxx = $this->cotizaciones_model->CantidadPorXXX($id,$datoscantidad3,3);
                                  $valorFinal4xxx = $this->cotizaciones_model->CantidadPorXXX($id,$datoscantidad4,4);
                                  
                              }else{
                                  $valorFinal=(($totalValorUnitario/(100-15))/100)*10000;
                                  $valorFinal2xxx = $this->cotizaciones_model->CantidadPorXXX($id,$datoscantidad2,2);
                                  $valorFinal3xxx = $this->cotizaciones_model->CantidadPorXXX($id,$datoscantidad3,3);
                                  $valorFinal4xxx = $this->cotizaciones_model->CantidadPorXXX($id,$datoscantidad4,4);
                              }

                          }
                         ?>
<!--                          <tr>
                               
                                <td class="celda_3"><span class="subrayado">CANTIDAD 2</span></td>
                                <td class="celda_3"><?php //echo number_format($datoscantidad2,0,'','.')?></td>
                            </tr>                                
                          <tr>
                               
                                <td class="celda_3"><span class="subrayado">VALOR FINAL</span></td>
                                <td class="celda_3"><?php //echo number_format($valorFinal,0,'','.')?></td>
                            </tr>
                        -->
                <?php
                            $vcostoFinanciero=$this->variables_cotizador_model->getVariablesCotizadorPorId(33);
                            $recargoPorCantidadJusta=$this->variables_cotizador_model->getVariablesCotizadorPorId(37);
										
                            $valorFinanciado=$valorFinal*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
                            $valorFinanciado2=$valorFinal2xxx*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
                            $valorFinanciado3=$valorFinal3xxx*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
                            $valorFinanciado4=$valorFinal4xxx*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
				
                          //  echo "<h1>$valorFinal2xxx</h1>";
							
                            if($datos->acepta_excedentes=='NO')
                            {
                                $valorFinanciado=(((100+$recargoPorCantidadJusta->precio)/100)*$valorFinanciado);
                                $valorFinanciado2=(((100+$recargoPorCantidadJusta->precio)/100)*$valorFinanciado2);
                                $valorFinanciado3=(((100+$recargoPorCantidadJusta->precio)/100)*$valorFinanciado3);
                                $valorFinanciado4=(((100+$recargoPorCantidadJusta->precio)/100)*$valorFinanciado4);
                            }
                            
                            $var2 = (((($totalProduccion2+$totalDefi1+$totalPreImpresion)*0.085)+(($totalProduccion2+$totalDefi1+$totalPreImpresion)*0.085)+($totalProduccion2+$totalDefi1+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad2;
                            $var3 = (((($totalProduccion3+$totalDefi2+$totalPreImpresion)*0.085)+(($totalProduccion3+$totalDefi2+$totalPreImpresion)*0.085)+($totalProduccion3+$totalDefi2+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad3;
                            $var4 = (((($totalProduccion4+$totalDefi3+$totalPreImpresion)*0.085)+(($totalProduccion4+$totalDefi3+$totalPreImpresion)*0.085)+($totalProduccion4+$totalDefi3+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad4;
			    $cf2= $var2*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
			    $cf3= $var3*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
			    $cf4= $var4*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
			    $valorFinanciado2= $var2*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
			    $valorFinanciado3= $var3*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
			    $valorFinanciado4= $var4*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
                            
                            
                ?>
							<tr>
                               
<!--                                <td class="celda_3">VALOR FINANCIADO <?php// echo $forma_pago->forma_pago?> (<?php //echo $forma_pago->dias?>)</td>
                                <td class="celda_3"><?php// echo number_format($valorFinanciado,0,'','.')?> <input type="hidden" name="valor_financiado" value="<?php// echo $valorFinanciado?>" /> </td>
								-->
                            </tr>
                            <?php
                           
                                if(sizeof($hoja)==0)
                                {
                                    if(($fotomecanica->materialidad_datos_tecnicos=="Indefinido") or ($fotomecanica->materialidad_datos_tecnicos=="Microcorrugado") or ($fotomecanica->materialidad_datos_tecnicos=="Corrugado")  or ($fotomecanica->materialidad_datos_tecnicos=="Cartulina-cartulina"))
                                    {        
                                        $valorEmpresa=$datos->precio_migrado;
                                    }
                                    else {
                                        $valorEmpresa=$valorFinanciado;
                                    }                                    
                                }else
                                {
                                    
                                    if(($fotomecanica->materialidad_datos_tecnicos=="Indefinido") or ($fotomecanica->materialidad_datos_tecnicos=="Microcorrugado") or ($fotomecanica->materialidad_datos_tecnicos=="Corrugado")  or ($fotomecanica->materialidad_datos_tecnicos=="Cartulina-cartulina"))
                                    {        
                                        $valorEmpresa=$datos->precio_migrado;
                                        if($valorEmpresa==0){
                                            $valorEmpresa = $valorFinanciado;
                                        }else{
                                            $valorEmpresa = $datos->precio_migrado;
                                            
                                        }
                                    }
                                    else {
                                        $valorEmpresa=$valorFinanciado;
                                    }      
                                }
                          
                               
                            ?>
<!--                            <tr>
                              
                                <td class="celda_3">VALOR EMPRESA</td>
                                <td class="celda_3"><?php
                                    if (sizeof($hoja) == 0) {
                                        if ($valorEmpresa == 0) {
                                           // echo number_format($valorFinanciado, 0, '', '.');
                                            $valorEmpresa = $valorFinanciado;
                                        } else {
                                          //  echo number_format($valorEmpresa, 0, '', '.');
                                        }
                                    } else {
                                      //  echo number_format($hoja->valor_empresa, 0, '', '.');
                                    }
                                    ?><a href="<?php// echo base_url() ?>hoja/valor_empresa/<?php //echo $id ?>/<?php //echo $pagina ?>/<?php //echo $valorFinanciado; ?>" class="fancybox fancybox.ajax"><img src="<?php //echo base_url() ?>public/frontend/images/edit.png" class="img_16" /></a>
                                    <input type="hidden" name="valor_empresa" value="<?php
                                    if (sizeof($hoja) == 0) {
                                        if ($valorEmpresa == 0 || $valorEmpresa == null){
                                           // echo number_format($valorFinanciado, 0, '', '.');
                                            $valorEmpresa = $valorFinanciado;
                                        } else {
                                         //   echo number_format($valorEmpresa, 0, '', '.');
                                        }
                                    } else {
                                     //   echo $hoja->valor_empresa;
                                    }
                                    ?>" /></td>
                            </tr>-->
<!--                            <tr>
                            
                                <td class="celda_3">DÍAS DE ENTREGA</td>
                                <td class="celda_3"><?php if (sizeof($hoja) == 0) {
                               // echo '20';
                            } else {
                               // echo $hoja->dias_de_entrega;
                            } ?><a href="<?php //echo base_url() ?>hoja/dias/<?php //echo $id ?>/<?php// echo $pagina ?>" class="fancybox fancybox.ajax"><img src="<?php //echo base_url() ?>public/frontend/images/edit.png" class="img_16" /></a><input type="hidden" name="dias_de_entrega" value="<?php //echo $hoja->dias_de_entrega ?>" /></td>
                            </tr>-->
<!--                            <tr>
                                <td class="celda_3">VALOR UNITARIO</td>
                                <td class="celda_3"><?php// echo number_format($totalValorUnitario,0,'','.')?></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>-->
                            <tr>
                                <td class="celda_3">MARGEN</td>
                                        <?php
                                        if(sizeof($hoja)==0) { ?>
                                        <td class="celda_3"><?php if($datos->margen_migrado!=0 || $datos->margen_migrado!= null){echo $datos->margen_migrado;}else{echo "15";} ?> 
                                            <!--<a href="<?php //echo base_url()?>hoja/margen/<?php //echo $id?>/<?php //echo $pagina?>" class="fancybox fancybox.ajax"><img src="<?php //echo base_url()?>public/frontend/images/edit.png" class="img_16" /></a>-->
                                            <?php if($hoja->impreso!=1){echo "<a href='".base_url()."hoja/margen/".$id."/".$pagina."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";}else{echo "<a href='".base_url()."hoja2/margen/".$id."/".$pagina."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";} ?>
                                            <input type="hidden" name="margen" value="<?php if($datos->margen_migrado!=0 || $datos->margen_migrado!= null){echo $datos->margen_migrado;}else{echo "15";} ?>" /></td>
					  <?php } else { ?>
                                        <td class="celda_3"><?php if($hoja->margen == null){echo '15';}else{echo $hoja->margen;}?> 
                                            <!--<a href="<?php //echo base_url()?>hoja/margen/<?php //echo $id?>/<?php //echo $pagina?>" class="fancybox fancybox.ajax"><img src="<?php //echo base_url()?>public/frontend/images/edit.png" class="img_16" /></a>-->
                                            <?php if($hoja->impreso!=1){echo "<a href='".base_url()."hoja/margen/".$id."/".$pagina."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";}else{echo "<a href='".base_url()."hoja2/margen/".$id."/".$pagina."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";} ?>
                                            <input type="hidden" name="margen" value="<?php echo $hoja->margen?>" /></td>
					<?php }  ?>                                     
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                        </table>
                        <div class="separador_20">&nbsp;</div>
                        <?php
                       
                       if(sizeof($hoja)==0) { 
                        $variablePegado=$this->variables_cotizador_model->getVariablesCotizadorPorId(21);
                        $totalPegado=$datoscantidad2*$pegado_migrado*$variablePegado->precio;                                               
                        $totalPegado2=$datoscantidad3*$pegado_migrado*$variablePegado->precio;                                               
                        $totalPegado3=$datoscantidad4*$pegado_migrado*$variablePegado->precio;                                               
                         } else { 
                        $variablePegado=$this->variables_cotizador_model->getVariablesCotizadorPorId(21);
                        $totalPegado=$datoscantidad2*$hoja->pegado*$variablePegado->precio;                                              
                        $totalPegado2=$datoscantidad3*$hoja->pegado*$variablePegado->precio;                                              
                        $totalPegado3=$datoscantidad4*$hoja->pegado*$variablePegado->precio;                                              
                        }
                        
                        
                     //   echo $pegado_migrado."<br>";
                        if(sizeof($hoja->pegado)>=1)
                         {
                            $divisionPegado=$hoja->pegado/2;
                            $totalDespacho2=$divisionPegado*$datoscantidad2;
                         }
                         else
                         {
                            $divisionPegado=$pegado_migrado/2;
                            $totalDespacho2=$divisionPegado*$datoscantidad2;
                           // echo $totalDespacho2;
                         }
                                         
                        if(sizeof($hoja->pegado)>=1)
                         {
                            $divisionPegado=$hoja->pegado/2;
                            $totalDespacho3=$divisionPegado*$datoscantidad3;
                         }
                         else
                         {
                             if ($datos->pegado_migrado=='')
                                $divisionPegado=$presupuesto->costo_pegado/2;
                             else
                                $divisionPegado=$datos->pegado_migrado/2;
                             $totalDespacho3=$divisionPegado*$datoscantidad3;	 
                         }
                        if(sizeof($hoja->pegado)>=1)
                         {
                            $divisionPegado=$hoja->pegado/2;
                            $totalDespacho4=$divisionPegado*$datoscantidad4;
                         }
                         else
                         {
                             if ($datos->pegado_migrado=='')
                                $divisionPegado=$presupuesto->costo_pegado/2;
                             else
                                $divisionPegado=$datos->pegado_migrado/2;
                             $totalDespacho4=$divisionPegado*$datoscantidad4;	 
                         }
                         
                         //*******************************************
                        $externos_produccion=0;
				if($fotomecanica->acabado_impresion_4=="17")
                                {
                                    $acabado_4="";
                                    $acabado_4Valor="";
                                    $acabado_4MedidaMasValorVenta="";
                                    $acabado_4Unitario="";
                                    $acabado_4UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_4Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_4);
                                    $acabado_4=$acabado_4Array->caracteristicas; // Nombre acabado
                                    $acabado_4UnidadVentaNombre=$acabado_4Array->unv; //Nombre unidad de venta
                                    $acabado_4Valor=$acabado_4Array->valor_venta; // ej: 52
                                    $acabado_4MedidaMasValorVenta=($tamano1*$tamano2*$acabado_4Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_4CostoFijo=$acabado_4Array->costo_fijo;	
                                    
                                    if ($acabado_4Array->unidad_de_venta == '1') //Metros
                                    {
                                        $costo_unitario4=$acabado_4MedidaMasValorVenta;
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad3);
                                        $cantidad_4=$datoscantidad3;
                                    }
                                    elseif ($acabado_4Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $costo_unitario4=$acabado_4Valor;
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }  
                                    elseif ($acabado_4Array->unidad_de_venta == '3') //tONELADA
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad3);
                                    }                                    
                                    elseif ($acabado_4Array->unidad_de_venta == '4') //caja de carton
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad3);
                                    }                                            
                                    elseif ($acabado_4Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($datoscantidad3*$acabado_4Valor);
                                        $cantidad_4=$datoscantidad3;
                                    }       
                                    elseif ($acabado_4Array->unidad_de_venta == '6') //cm2
                                    {
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $costo_unitario4=$acabado_4Valor;     
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }   
                                    elseif ($acabado_4Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario4=$acabado_4MedidaMasValorVenta;
                                        $precio_total_4=$acabado_4MedidaMasValorVenta*$datoscantidad3;
                                        $cantidad_4=$datoscantidad3;
                                    }
                                    elseif ($acabado_4Array->unidad_de_venta == '8') //cms
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad3);
                                    }           
                                    elseif ($acabado_4Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }     
                                    elseif ($acabado_4Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($acabado_4Valor*$datoscantidad3);
                                        $cantidad_4=$datoscantidad3;                                        
                                    }                                      
                                }
								
                                if($fotomecanica->acabado_impresion_5=="17")
                                {
                                    $acabado_5="";
                                    $acabado_5Valor="";
                                    $acabado_5MedidaMasValorVenta="";
                                    $acabado_5Unitario="";
                                    $acabado_5UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_5Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_5);
                                    $acabado_5=$acabado_5Array->caracteristicas;
                                    $acabado_5UnidadVentaNombre=$acabado_5Array->unv; //Nombre unidad de venta
                                    $acabado_5Valor=$acabado_5Array->valor_venta; // ej: 52
                                    $acabado_5MedidaMasValorVenta=($tamano1*$tamano2*$acabado_5Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_5CostoFijo=$acabado_5Array->costo_fijo;		
                                  if ($acabado_5Array->unidad_de_venta == '1') //mt2
                                    {
                                        $costo_unitario5=$acabado_5MedidaMasValorVenta;
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad3);                                      
                                        $cantidad_5=$datoscantidad3;
                                    }
                                    elseif ($acabado_5Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $costo_unitario5=$acabado_5Valor; 
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }    
                                    elseif ($acabado_5Array->unidad_de_venta == '3') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad3);
                                    }                                    
                                    elseif ($acabado_5Array->unidad_de_venta == '4') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad3);
                                    }                                            
                                    elseif ($acabado_5Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($datoscantidad3*$acabado_5Valor);
                                        $cantidad_5=$datoscantidad3;
                                    }       
                                    elseif ($acabado_5Array->unidad_de_venta == '6') //mt2
                                    {
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $costo_unitario5=$acabado_5Valor;
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }   
                                    elseif ($acabado_5Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario5=$acabado_5MedidaMasValorVenta;
                                        $precio_total_5=$acabado_5MedidaMasValorVenta*$datoscantidad3;
                                        $cantidad_5=$datoscantidad3;
                                    }
                                    elseif ($acabado_5Array->unidad_de_venta == '8') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad3);
                                    }           
                                    elseif ($acabado_5Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }   
                                    elseif ($acabado_5Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($acabado_5Valor*$datoscantidad3);
                                        $cantidad_5=$datoscantidad3;
                                    }                                      
                                }    
                                if($fotomecanica->acabado_impresion_6=="17")
                                {
                                    $acabado_6="";
                                    $acabado_6Valor="";
                                    $acabado_6MedidaMasValorVenta="";
                                    $acabado_6Unitario="";
                                    $acabado_6UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_6Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_6);
                                    $acabado_6=$acabado_6Array->caracteristicas;
                                    $acabado_6UnidadVentaNombre=$acabado_6Array->unv; //Nombre unidad de venta
                                    $acabado_6Valor=$acabado_6Array->valor_venta; // ej: 52
                                    $acabado_6MedidaMasValorVenta=($tamano1*$tamano2*$acabado_6Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_6CostoFijo=$acabado_6Array->costo_fijo;		
                                    if ($acabado_6Array->unidad_de_venta == '1') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad3);
                                    }
                                    elseif ($acabado_6Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $costo_unitario6=$acabado_6Valor; 
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    }  
                                    elseif ($acabado_6Array->unidad_de_venta == '3') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad3);
                                    }                                    
                                    elseif ($acabado_6Array->unidad_de_venta == '4') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad3);
                                    }                                            
                                    elseif ($acabado_6Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($datoscantidad3*$acabado_5Valor);
                                        $cantidad_6=$datoscantidad3;
                                    }       
                                    elseif ($acabado_6Array->unidad_de_venta == '6') //mt2
                                    {
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $costo_unitario6=$acabado_6Valor;
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    }   
                                    elseif ($acabado_6Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario6=$acabado_6MedidaMasValorVenta;
                                        $precio_total_6=$acabado_6MedidaMasValorVenta*$datoscantidad3;
                                        $cantidad_6=$datoscantidad3;
                                    }
                                    elseif ($acabado_6Array->unidad_de_venta == '8') //cms
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad3);
                                    }           
                                    elseif ($acabado_6Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    } 
                                    elseif ($acabado_6Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($acabado_6Valor*$datoscantidad3);
                                        $cantidad_6=$datoscantidad3;
                                    }                                      
									

                                }            
                        //*******************************************
              $externos_produccion3=$precio_total_4+$precio_total_5+$precio_total_6;
                        $externos_produccion=0;
				if($fotomecanica->acabado_impresion_4=="17")
                                {
                                    $acabado_4="";
                                    $acabado_4Valor="";
                                    $acabado_4MedidaMasValorVenta="";
                                    $acabado_4Unitario="";
                                    $acabado_4UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_4Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_4);
                                    $acabado_4=$acabado_4Array->caracteristicas; // Nombre acabado
                                    $acabado_4UnidadVentaNombre=$acabado_4Array->unv; //Nombre unidad de venta
                                    $acabado_4Valor=$acabado_4Array->valor_venta; // ej: 52
                                    $acabado_4MedidaMasValorVenta=($tamano1*$tamano2*$acabado_4Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_4CostoFijo=$acabado_4Array->costo_fijo;	
                                    
                                    if ($acabado_4Array->unidad_de_venta == '1') //Metros
                                    {
                                        $costo_unitario4=$acabado_4MedidaMasValorVenta;
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad4);
                                        $cantidad_4=$datoscantidad4;
                                    }
                                    elseif ($acabado_4Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $costo_unitario4=$acabado_4Valor;
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }  
                                    elseif ($acabado_4Array->unidad_de_venta == '3') //tONELADA
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad4);
                                    }                                    
                                    elseif ($acabado_4Array->unidad_de_venta == '4') //caja de carton
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad4);
                                    }                                            
                                    elseif ($acabado_4Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($datoscantidad3*$acabado_4Valor);
                                        $cantidad_4=$datoscantidad4;
                                    }       
                                    elseif ($acabado_4Array->unidad_de_venta == '6') //cm2
                                    {
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $costo_unitario4=$acabado_4Valor;     
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }   
                                    elseif ($acabado_4Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario4=$acabado_4MedidaMasValorVenta;
                                        $precio_total_4=$acabado_4MedidaMasValorVenta*$datoscantidad4;
                                        $cantidad_4=$datoscantidad4;
                                    }
                                    elseif ($acabado_4Array->unidad_de_venta == '8') //cms
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad4);
                                    }           
                                    elseif ($acabado_4Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }     
                                    elseif ($acabado_4Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($acabado_4Valor*$datoscantidad4);
                                        $cantidad_4=$datoscantidad4;                                        
                                    }                                      
                                }
								
                                if($fotomecanica->acabado_impresion_5=="17")
                                {
                                    $acabado_5="";
                                    $acabado_5Valor="";
                                    $acabado_5MedidaMasValorVenta="";
                                    $acabado_5Unitario="";
                                    $acabado_5UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_5Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_5);
                                    $acabado_5=$acabado_5Array->caracteristicas;
                                    $acabado_5UnidadVentaNombre=$acabado_5Array->unv; //Nombre unidad de venta
                                    $acabado_5Valor=$acabado_5Array->valor_venta; // ej: 52
                                    $acabado_5MedidaMasValorVenta=($tamano1*$tamano2*$acabado_5Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_5CostoFijo=$acabado_5Array->costo_fijo;		
                                  if ($acabado_5Array->unidad_de_venta == '1') //mt2
                                    {
                                        $costo_unitario5=$acabado_5MedidaMasValorVenta;
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad4);                                      
                                        $cantidad_5=$datoscantidad4;
                                    }
                                    elseif ($acabado_5Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $costo_unitario5=$acabado_5Valor; 
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }    
                                    elseif ($acabado_5Array->unidad_de_venta == '3') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad4);
                                    }                                    
                                    elseif ($acabado_5Array->unidad_de_venta == '4') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad4);
                                    }                                            
                                    elseif ($acabado_5Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($datoscantidad4*$acabado_5Valor);
                                        $cantidad_5=$datoscantidad4;
                                    }       
                                    elseif ($acabado_5Array->unidad_de_venta == '6') //mt2
                                    {
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $costo_unitario5=$acabado_5Valor;
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }   
                                    elseif ($acabado_5Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario5=$acabado_5MedidaMasValorVenta;
                                        $precio_total_5=$acabado_5MedidaMasValorVenta*$datoscantidad4;
                                        $cantidad_5=$datoscantidad4;
                                    }
                                    elseif ($acabado_5Array->unidad_de_venta == '8') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad4);
                                    }           
                                    elseif ($acabado_5Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }   
                                    elseif ($acabado_5Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($acabado_5Valor*$datoscantidad4);
                                        $cantidad_5=$datoscantidad4;
                                    }                                      
                                }    
                                if($fotomecanica->acabado_impresion_6=="17")
                                {
                                    $acabado_6="";
                                    $acabado_6Valor="";
                                    $acabado_6MedidaMasValorVenta="";
                                    $acabado_6Unitario="";
                                    $acabado_6UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_6Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_6);
                                    $acabado_6=$acabado_6Array->caracteristicas;
                                    $acabado_6UnidadVentaNombre=$acabado_6Array->unv; //Nombre unidad de venta
                                    $acabado_6Valor=$acabado_6Array->valor_venta; // ej: 52
                                    $acabado_6MedidaMasValorVenta=($tamano1*$tamano2*$acabado_6Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_6CostoFijo=$acabado_6Array->costo_fijo;		
                                    if ($acabado_6Array->unidad_de_venta == '1') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad4);
                                    }
                                    elseif ($acabado_6Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $costo_unitario6=$acabado_6Valor; 
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    }  
                                    elseif ($acabado_6Array->unidad_de_venta == '3') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad4);
                                    }                                    
                                    elseif ($acabado_6Array->unidad_de_venta == '4') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad4);
                                    }                                            
                                    elseif ($acabado_6Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($datoscantidad4*$acabado_5Valor);
                                        $cantidad_6=$datoscantidad4;
                                    }       
                                    elseif ($acabado_6Array->unidad_de_venta == '6') //mt2
                                    {
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $costo_unitario6=$acabado_6Valor;
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    }   
                                    elseif ($acabado_6Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario6=$acabado_6MedidaMasValorVenta;
                                        $precio_total_6=$acabado_6MedidaMasValorVenta*$datoscantidad4;
                                        $cantidad_6=$datoscantidad4;
                                    }
                                    elseif ($acabado_6Array->unidad_de_venta == '8') //cms
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad4);
                                    }           
                                    elseif ($acabado_6Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    } 
                                    elseif ($acabado_6Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($acabado_6Valor*$datoscantidad4);
                                        $cantidad_6=$datoscantidad4;
                                    }                                      
									

                                }            
                        //*******************************************
              $externos_produccion4=$precio_total_4+$precio_total_5+$precio_total_6;
                         //*******************************************
                        $externos_produccion=0;
				if($fotomecanica->acabado_impresion_4=="17")
                                {
                                    $acabado_4="";
                                    $acabado_4Valor="";
                                    $acabado_4MedidaMasValorVenta="";
                                    $acabado_4Unitario="";
                                    $acabado_4UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_4Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_4);
                                    $acabado_4=$acabado_4Array->caracteristicas; // Nombre acabado
                                    $acabado_4UnidadVentaNombre=$acabado_4Array->unv; //Nombre unidad de venta
                                    $acabado_4Valor=$acabado_4Array->valor_venta; // ej: 52
                                    $acabado_4MedidaMasValorVenta=($tamano1*$tamano2*$acabado_4Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_4CostoFijo=$acabado_4Array->costo_fijo;	
                                    
                                    if ($acabado_4Array->unidad_de_venta == '1') //Metros
                                    {
                                        $costo_unitario4=$acabado_4MedidaMasValorVenta;
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad2);
                                        $cantidad_4=$datoscantidad2;
                                    }
                                    elseif ($acabado_4Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $costo_unitario4=$acabado_4Valor;
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }  
                                    elseif ($acabado_4Array->unidad_de_venta == '3') //tONELADA
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad2);
                                    }                                    
                                    elseif ($acabado_4Array->unidad_de_venta == '4') //caja de carton
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad2);
                                    }                                            
                                    elseif ($acabado_4Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($datoscantidad2*$acabado_4Valor);
                                        $cantidad_4=$datoscantidad2;
                                    }       
                                    elseif ($acabado_4Array->unidad_de_venta == '6') //cm2
                                    {
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $costo_unitario4=$acabado_4Valor;     
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }   
                                    elseif ($acabado_4Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario4=$acabado_4MedidaMasValorVenta;
                                        $precio_total_4=$acabado_4MedidaMasValorVenta*$datoscantidad2;
                                        $cantidad_4=$datoscantidad2;
                                    }
                                    elseif ($acabado_4Array->unidad_de_venta == '8') //cms
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad2);
                                    }           
                                    elseif ($acabado_4Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }     
                                    elseif ($acabado_4Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($acabado_4Valor*$datoscantidad2);
                                        $cantidad_4=$datoscantidad2;                                        
                                    }                                      
                                }
								
                                if($fotomecanica->acabado_impresion_5=="17")
                                {
                                    $acabado_5="";
                                    $acabado_5Valor="";
                                    $acabado_5MedidaMasValorVenta="";
                                    $acabado_5Unitario="";
                                    $acabado_5UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_5Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_5);
                                    $acabado_5=$acabado_5Array->caracteristicas;
                                    $acabado_5UnidadVentaNombre=$acabado_5Array->unv; //Nombre unidad de venta
                                    $acabado_5Valor=$acabado_5Array->valor_venta; // ej: 52
                                    $acabado_5MedidaMasValorVenta=($tamano1*$tamano2*$acabado_5Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_5CostoFijo=$acabado_5Array->costo_fijo;		
                                  if ($acabado_5Array->unidad_de_venta == '1') //mt2
                                    {
                                        $costo_unitario5=$acabado_5MedidaMasValorVenta;
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad2);                                      
                                        $cantidad_5=$datoscantidad2;
                                    }
                                    elseif ($acabado_5Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $costo_unitario5=$acabado_5Valor; 
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }    
                                    elseif ($acabado_5Array->unidad_de_venta == '3') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad2);
                                    }                                    
                                    elseif ($acabado_5Array->unidad_de_venta == '4') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad2);
                                    }                                            
                                    elseif ($acabado_5Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($datoscantidad2*$acabado_5Valor);
                                        $cantidad_5=$datoscantidad2;
                                    }       
                                    elseif ($acabado_5Array->unidad_de_venta == '6') //mt2
                                    {
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $costo_unitario5=$acabado_5Valor;
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }   
                                    elseif ($acabado_5Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario5=$acabado_5MedidaMasValorVenta;
                                        $precio_total_5=$acabado_5MedidaMasValorVenta*$datoscantidad2;
                                        $cantidad_5=$datoscantidad2;
                                    }
                                    elseif ($acabado_5Array->unidad_de_venta == '8') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad2);
                                    }           
                                    elseif ($acabado_5Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }   
                                    elseif ($acabado_5Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($acabado_5Valor*$datoscantidad2);
                                        $cantidad_5=$datoscantidad2;
                                    }                                      
                                }    
                                if($fotomecanica->acabado_impresion_6=="17")
                                {
                                    $acabado_6="";
                                    $acabado_6Valor="";
                                    $acabado_6MedidaMasValorVenta="";
                                    $acabado_6Unitario="";
                                    $acabado_6UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_6Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_6);
                                    $acabado_6=$acabado_6Array->caracteristicas;
                                    $acabado_6UnidadVentaNombre=$acabado_6Array->unv; //Nombre unidad de venta
                                    $acabado_6Valor=$acabado_6Array->valor_venta; // ej: 52
                                    $acabado_6MedidaMasValorVenta=($tamano1*$tamano2*$acabado_6Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_6CostoFijo=$acabado_6Array->costo_fijo;		
                                    if ($acabado_6Array->unidad_de_venta == '1') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad2);
                                    }
                                    elseif ($acabado_6Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $costo_unitario6=$acabado_6Valor; 
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    }  
                                    elseif ($acabado_6Array->unidad_de_venta == '3') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad2);
                                    }                                    
                                    elseif ($acabado_6Array->unidad_de_venta == '4') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad2);
                                    }                                            
                                    elseif ($acabado_6Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($datoscantidad2*$acabado_5Valor);
                                        $cantidad_6=$datoscantidad2;
                                    }       
                                    elseif ($acabado_6Array->unidad_de_venta == '6') //mt2
                                    {
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $costo_unitario6=$acabado_6Valor;
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    }   
                                    elseif ($acabado_6Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario6=$acabado_6MedidaMasValorVenta;
                                        $precio_total_6=$acabado_6MedidaMasValorVenta*$datoscantidad2;
                                        $cantidad_6=$datoscantidad2;
                                    }
                                    elseif ($acabado_6Array->unidad_de_venta == '8') //cms
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad2);
                                    }           
                                    elseif ($acabado_6Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    } 
                                    elseif ($acabado_6Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($acabado_6Valor*$datoscantidad2);
                                        $cantidad_6=$datoscantidad2;
                                    }                                      
									

                                }            
                        //*******************************************
              $externos_produccion2=$precio_total_4+$precio_total_5+$precio_total_6;
                                            
            //$tira3=((($datoscantidad2/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio )*($fotomecanica->colores+$barniz2)."<br>";
            //$tira4=((($datoscantidad2/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio)*($fotomecanica->colores+$barniz2)*(1*$recargo800Array->precio/100);
            $tirajetotal2=$tira3+$tira4."<br>";
            
            $tira5=((($datoscantidad3/$ing->unidades_por_pliego)+$sum)*$factor_rango3+$base_imprenta->precio )*($fotomecanica->colores+$barniz2)."<br>";
            $tira6=((($datoscantidad3/$ing->unidades_por_pliego)+$sum)*$factor_rango3+$base_imprenta->precio)*($fotomecanica->colores+$barniz2)*(1*$recargo800Array->precio/100);
            $tirajetotal3=$tira5+$tira6."<br>";
            
            $tira7=((($datoscantidad4/$ing->unidades_por_pliego)+$sum)*$factor_rango4+$base_imprenta->precio )*($fotomecanica->colores+$barniz2)."<br>";
            $tira8=((($datoscantidad4/$ing->unidades_por_pliego)+$sum)*$factor_rango4+$base_imprenta->precio)*($fotomecanica->colores+$barniz2)*(1*$recargo800Array->precio/100);
            $tirajetotal4=$tira7+$tira8."<br>";
            //exit();
            //valor corte para los 4
            $valorCorte2=(((($datoscantidad2/$ing->unidades_por_pliego)*1.04)+104)*4.5);
            $valorCorte3=(((($datoscantidad3/$ing->unidades_por_pliego)*1.04)+104)*4.5);
            $valorCorte4=(((($datoscantidad4/$ing->unidades_por_pliego)*1.04)+104)*4.5);
            
           $costoOnda2=(((($datoscantidad2/$ing->unidades_por_pliego)*1.04)+104))."<br>";
           $costoOnda3=(((($datoscantidad3/$ing->unidades_por_pliego)*1.04)+104))."<br>";
           $costoOnda4=(((($datoscantidad4/$ing->unidades_por_pliego)*1.04)+104))."<br>";
           
            if($fotomecanica->estan_los_moldes == 'NO LLEVA')
	    {
            $variableTroquelado=0;
            $totalTroquelado=0;
            }else
            {
            $variableTroquelado=$this->variables_cotizador_model->getVariablesCotizadorPorId(11);
            $totalTroquelado2=($costoOnda2*$variableTroquelado->precio)*1.5;	
            }     
            if($fotomecanica->estan_los_moldes == 'NO LLEVA')
	    {
            $variableTroquelado=0;
            $totalTroquelado=0;
            }else
            {
            $variableTroquelado=$this->variables_cotizador_model->getVariablesCotizadorPorId(11);
            $totalTroquelado3=($costoOnda3*$variableTroquelado->precio)*1.5;	
            }     
            if($fotomecanica->estan_los_moldes == 'NO LLEVA')
	    {
            $variableTroquelado=0;
            $totalTroquelado=0;
            }else
            {
            $variableTroquelado=$this->variables_cotizador_model->getVariablesCotizadorPorId(11);
            $totalTroquelado4=($costoOnda4*$variableTroquelado->precio)*1.5;	
            }     
           // valor del emplacado 
           $variableEmplacado=$this->variables_cotizador_model->getVariablesCotizadorPorId(8);
           $valorEmplacadado=($variableEmplacado->precio*$tamano1*$tamano2)/10000;
           $totalEmplacado2=$valorEmplacadado*$costoOnda2."<br>";
           $totalEmplacado3=$valorEmplacadado*$costoOnda3."<br>";
           $totalEmplacado4=$valorEmplacadado*$costoOnda4."<br>";
           
                            $dos=($datoscantidad2/$ing->unidades_por_pliego)+$sum2."<br />";
                            $tres=($datoscantidad3/$ing->unidades_por_pliego)+$sum3."<br />";
                            $cuatro=($datoscantidad4/$ing->unidades_por_pliego)+$sum4."<br />";
                          
                            $valorPlacaKilo2=(($dos*$tamano1*$tamano2*$tapaGramaje)/10000000)."<br />";
                            $valorPlacaKilo3=(($tres*$tamano1*$tamano2*$tapaGramaje)/10000000)."<br />";
                            $valorPlacaKilo4=(($cuatro*$tamano1*$tamano2*$tapaGramaje)/10000000)."<br />";
                            
                            $totalPlacaKilo2=$valorPlacaKilo2*$materialidad_1->precio."<br />";
                            $totalPlacaKilo3=$valorPlacaKilo3*$materialidad_1->precio."<br />";
                            $totalPlacaKilo4=$valorPlacaKilo4*$materialidad_1->precio."<br />";
                            
                            //$v2= number_format((($datoscantidad2/$ing->unidades_por_pliego)*1.04)+104,0,'','.');
                            $v2= number_format((($datoscantidad2/$ing->unidades_por_pliego)*1.04)+104,0,'','.');
                            $v3= number_format((($datoscantidad3/$ing->unidades_por_pliego)*1.04)+104,0,'','.');
                            $v4= number_format((($datoscantidad4/$ing->unidades_por_pliego)*1.04)+104,0,'','.');
                            
                            $OndaKilo2=number_format((($v2*$tamano1*$tamano2*$GramosMetroCuadrado)/10000),0,'','.')."<br />";
                            $OndaKilo3=number_format((($v3*$tamano1*$tamano2*$GramosMetroCuadrado)/10000),0,'','.')."<br />";
                            $OndaKilo4=number_format((($v4*$tamano1*$tamano2*$GramosMetroCuadrado)/10000),0,'','.')."<br />";
                            
                            $vt2=number_format(((($v2*$tamano1*$tamano2*$GramosMetroCuadrado)/10000)*$costo_kilo),0,'','.');
                            $vt3=number_format(((($v3*$tamano1*$tamano2*$GramosMetroCuadrado)/10000)*$costo_kilo),0,'','.')."<br />";
                            $vt4=number_format(((($v4*$tamano1*$tamano2*$GramosMetroCuadrado)/10000)*$costo_kilo),0,'','.')."<br />";
                            //echo number_format($totalPlacaKilo2,0,'','.')."<br>";
                            
                           $totalDefi1=$totalPlacaKilo2+((($v2*$tamano1*$tamano2*$GramosMetroCuadrado)/10000)*$costo_kilo);
                            $totalDefi2=$totalPlacaKilo3+((($v3*$tamano1*$tamano2*$GramosMetroCuadrado)/10000)*$costo_kilo);
                            $totalDefi3=$totalPlacaKilo4+((($v4*$tamano1*$tamano2*$GramosMetroCuadrado)/10000)*$costo_kilo);
                            
                            
                            
                            $variableDesgajado=$this->variables_cotizador_model->getVariablesCotizadorPorId(12);
                            $totalDesgajado2=$ing->piezas_totales_en_el_pliego*$variableDesgajado->precio*1.5*$costoOnda2;
                            $totalDesgajado3=$ing->piezas_totales_en_el_pliego*$variableDesgajado->precio*1.5*$costoOnda3;
                            $totalDesgajado4=$ing->piezas_totales_en_el_pliego*$variableDesgajado->precio*1.5*$costoOnda4;
                            $TotalPiezasAdicionales2=$datoscantidad2*$piezaAdacionalValor1;
                            $TotalPiezasAdicionales3=$datoscantidad3*$piezaAdacionalValor1;
                            $TotalPiezasAdicionales4=$datoscantidad4*$piezaAdacionalValor1;
                           
                             if(sizeof($hoja)==0) { 
                              if($datos->margen_migrado==0){
                                 $margen=15; 
                              }else{
                                 $margen= $datos->margen_migrado;
                              }
				 } else {if($hoja->margen == null){$margen=15;}
                                 else{
                                 $margen=$hoja->margen;}
			         }  
                            //  echo "<h1>margen</h1>".$margen;
                                       if($fotomecanica->materialidad_datos_tecnicos == 'Sólo Cartulina')
                        {
                                $costoOndaKilo3=0;
                                $valorOndaKilo3=0;
                                $totalOndaKilo3=0;
                                $valorCorte3=0;

                        }
                         //   $totalProduccion2=$costosporlacado2+$complemento+$valorCorte2+$totalEmplacado2+$totalMontajeMolde+$totalTroquelado2+$totalPegado+$totalDespacho2+$tirajetotal2+$moldeTroquel+$totalDesgajado2+$externos_produccion2+$otrosCaucho + $TotalPiezasAdicionales2 + $valor_extra + $valor_bv_maquina + $valor_acepeta_exce."<br>";
                            //$totalProduccion3=$costosporlacado3+$complemento+$valorCorte3+$totalEmplacado3+$totalMontajeMolde+$totalTroquelado3+$totalPegado2+$totalDespacho3+$tirajetotal3+$moldeTroquel+$totalDesgajado3+$externos_produccion3+$otrosCaucho + $TotalPiezasAdicionales3 + $valor_extra + $valor_bv_maquina + $valor_acepeta_exce."<br>";
                            //$totalProduccion4=$costosporlacado4+$complemento+$valorCorte4+$totalEmplacado4+$totalMontajeMolde+$totalTroquelado4+$totalPegado3+$totalDespacho4+$tirajetotal4+$moldeTroquel+$totalDesgajado4+$externos_produccion4+$otrosCaucho + $TotalPiezasAdicionales4 + $valor_extra + $valor_bv_maquina + $valor_acepeta_exce."<br>";
                      
                
//                    echo "<h1>-------------------</h1>";       
//                     echo "<h1>a$costoporlacado3</h1>";   
//                     echo "<h1>b$complemento</h1>";   
//                     echo "<h1>c$valorCorte3</h1>";   
//                     echo "<h1>d$totalEmplacado3</h1>";   
//                     echo "<h1>e$totalMontajeMolde</h1>";   
//                     echo "<h1>f$totalTroquelado3</h1>";   
//                     echo "<h1>g$totalPegado</h1>";   
//                     echo "<h1>h$totalDespacho3</h1>";   
//                     echo "<h1>tiraje".($tirajetotal3)."</h1>";   
//                     echo "<h1>h$moldeTroquel</h1>";   
//                     echo "<h1>h$totalDesgajado3</h1>";   
//                     echo "<h1>i$externos_produccion3</h1>";   
//                     echo "<h1>j$otrosCaucho</h1>";   
//                     echo "<h1>k$TotalPiezasAdicionales3</h1>";   
//                     echo "<h1>l$valor_extra</h1>";   
//                     echo "<h1>m$valor_bv_maquina</h1>";   
//                     echo "<h1>n$valor_acepeta_exce;</h1>";   
//                     echo "<h1>-------------------</h1>";   
//           
                                                              
                                                if($mdt=='Cartulina-cartulina' || $mdt=='Sólo Cartulina'){
                                                    $des = calcularDespacho($valorPlacaKilo, $valorPlacaKilo2, $retiro, $mdt, $fuerasantiago, $distancia);  
                                                }else{
                                                    $des = calcularDespacho($valorPlacaKilo, $valorOndaKilo, $retiro, $mdt, $fuerasantiago, $distancia);
                                                }                                           
                                                                
                                  $totalProduccion2 = $totalProduccion2+$des[0];                     
                            ?>
                       
                        <table id="tabla_detalle" border="0">
                            <tr>
                                <td width="150px">PALETS:&nbsp;<?php echo $des[1];?></td>
                                <td>VALOR:&nbsp;<?php echo $des[0]; ?></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td width="150px">TIRAJE 2</td>
                                <td><?php if($mostrarboton != 1){echo number_format($tirajetotal2,0,'','.');}else{if($hoja->tiraje2!=""){$tirajetotal2=$hoja->tiraje2; echo number_format($hoja->tiraje2,0,'','.');}else{echo number_format($tirajetotal2,0,'','.');}}?>
                                <?php if($hoja->impreso!=1 && $mostrarboton == 1){echo "<a href='".base_url()."hoja/tiraje2/".$id."/4' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";}else{echo "<a href='".base_url()."hoja2/tiraje2/".$id."/4' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";} ?>
                                </td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td width="150px">&nbsp;</td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td width="150px">Total Materia Prima</td>
                                <td><?php echo number_format($totalMateriaPrima,0,",",".") ?></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>Total Pre Impresion</td>
                                <td><?php echo number_format($totalPreImpresion,0,",",".")?></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>Total Produccion</td>
                                <td><?php echo number_format($totalProduccion2,0,",",".") ?></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td colspan="5">---------------------------------------------------------------------</td>
                            </tr>
                            <tr>
                                <td>Sub Total</td>
                                <td><?php echo number_format($totalProduccion2+$totalPreImpresion+$totalMateriaPrima,0,",",".") ?></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>Total Costos Varios</td>
                                <td><?php echo number_format(($totalProduccion2+$totalPreImpresion+$totalMateriaPrima)*0.17,0,",",".") ?></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>&nbsp;</td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>Total</td>
                                <td><?php echo number_format(($totalProduccion2+$totalPreImpresion+$totalMateriaPrima)*0.17+($totalProduccion2+$totalPreImpresion+$totalMateriaPrima),0,",",".") ?></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>&nbsp;</td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                        </table>
                        <?php 
                        $totalTotal2=($totalProduccion2+$totalPreImpresion+$totalMateriaPrima)*0.17+($totalProduccion2+$totalPreImpresion+$totalMateriaPrima);
                        $totalValorUnitario2=$totalTotal2/$datoscantidad2;

                          if ($hoja->margen!="") {
                            $valorFinal2=(($totalValorUnitario2/(100-$hoja->margen))/100)*10000;
                            $valorFinanciado2=$valorFinal2*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;              
                          }else{ 
                              if($datos->margen_migrado!=0 || $datos->margen_migrado!=null){
                                  $valorFinal2=(($totalValorUnitario2/(100-$datos->margen_migrado))/100)*10000;
                              }else{
                                  $valorFinal2=(($totalValorUnitario2/(100-15))/100)*10000;
                              }

                          }
                        ?>
                        <table id="tabla_detalle">
                            
                            <tr>
                                <td class="celda_3"><h5>CANTIDAD 2</h5></td>
                                <td class="celda_3"><h5><?php if($datoscantidad2 == 1){ echo 0;}else{echo number_format($datoscantidad2,0,"",".");}?> 
                                <!--<a href="<?php //echo base_url()?>hoja/cantidad2/<?php //echo $id?>/2" class="fancybox fancybox.ajax"><img src="<?php //echo base_url()?>public/frontend/images/edit.png" class="img_16" /></a></td>-->
                                <?php if($hoja->impreso!=1){echo "<a href='".base_url()."hoja/cantidad2/".$id."/2' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";}else{echo "<a href='".base_url()."hoja2/cantidad2/".$id."/2' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a></h5></td>";} ?>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"><?php if($datoscantidad3 == 1){ echo 0;}else{ number_format($datoscantidad3,0,"",".");}?></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"><?php if($datoscantidad4 == 1){ echo 0;}else{ number_format($datoscantidad4,0,"",".");}?></td>
                            </tr>
						
							
                            <tr>
                                <td class="celda_3">VALOR FINAL</td>
                                <td class="celda_3"><?php if($datoscantidad2 == 1){ echo 0;}else{
                                echo number_format($valorFinal2,0,'','.');}?></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"><?php if($datoscantidad3 == 1){ echo 0;}else{
                                 number_format(((((($totalProduccion3+$totalDefi2+$totalPreImpresion)*0.085)+(($totalProduccion3+$totalDefi2+$totalPreImpresion)*0.085)+($totalProduccion3+$totalDefi2+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad3),0,'','.');}?></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"><?php if($datoscantidad4 == 1){ echo 0;}else{
                                 number_format(((((($totalProduccion4+$totalDefi3+$totalPreImpresion)*0.085)+(($totalProduccion4+$totalDefi3+$totalPreImpresion)*0.085)+($totalProduccion4+$totalDefi3+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad4),0,'','.');}?></td>
                            </tr>
                            <?php
                            //echo "<h1>SSSS".sizeof($hoja)."</h1>";
				if(sizeof($hoja)==0)
                                {
                                    $valorEmpresa2=number_format($valorFinanciado2,0,'','.');
                                    $valorEmpresa3=number_format($valorFinanciado3,0,'','.');
                                    $valorEmpresa4=number_format($valorFinanciado4,0,'','.');
                                }else
                                {
                                    $valorEmpresa2=$hoja->valor_empresa_2;
                                    $valorEmpresa3=$hoja->valor_empresa_3;
                                    $valorEmpresa4=$hoja->valor_empresa_4;
                                }
								

				if($hoja->valor_empresa_2 == 0)
                                {
                                 $valorEmpresa_2=$valorFinanciado2;  			
                                 $arregloVEmpresa=array
                                 (
                                        "valor_empresa_2"=>$valorEmpresa_2,
                                 );

                                $this->db->where('id', $hoja->id);
                                $this->db->update("hoja_de_costos_datos",$arregloVEmpresa);
                                }
								
				if($hoja->valor_empresa_3 ==0)
                                {                                    
                                $valorEmpresa_3=$valorFinanciado3;  					
                                $arregloVEmpresa=array
                                (
                                        "valor_empresa_3"=>$valorEmpresa_3,
                                );

                                $this->db->where('id', $hoja->id);
                                $this->db->update("hoja_de_costos_datos",$arregloVEmpresa);                                  
                                }
								
				if($hoja->valor_empresa_4 ==0)
                                {
                                $valorEmpresa_4=$valorFinanciado4;  					
                                $arregloVEmpresa=array
                                (
                                        "valor_empresa_4"=>$valorEmpresa_4,
                                );

                                $this->db->where('id', $hoja->id);
                                $this->db->update("hoja_de_costos_datos",$arregloVEmpresa);   
                                }					
                            ?>
                            
							<?php
							$var2 = (((($totalProduccion2+$totalDefi1+$totalPreImpresion)*0.085)+(($totalProduccion2+$totalDefi1+$totalPreImpresion)*0.085)+($totalProduccion2+$totalDefi1+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad2;
                                                        $var3 = (((($totalProduccion3+$totalDefi2+$totalPreImpresion)*0.085)+(($totalProduccion3+$totalDefi2+$totalPreImpresion)*0.085)+($totalProduccion3+$totalDefi2+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad3;
                                                        $var4 = (((($totalProduccion4+$totalDefi3+$totalPreImpresion)*0.085)+(($totalProduccion4+$totalDefi3+$totalPreImpresion)*0.085)+($totalProduccion4+$totalDefi3+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad4;
							$cf2= $var2*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
							$cf3= $var3*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
							$cf4= $var4*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
							?>
							
                            <tr>
                                <td class="celda_3">VALOR FINANCIERO 2</td>
                                <td class="celda_3">
                                <?php //echo number_format((((($vcostoFinanciero->precio/30)*30)+100)/100)*((((($totalProduccion2+$totalDefi1+$totalPreImpresion)*0.085)+(($totalProduccion2+$totalDefi1+$totalPreImpresion)*0.085)+($totalProduccion2+$totalDefi1+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad2),0,'','.') ?>
                                <?php //echo number_format($cf2,0,'','.') ?>
                                <?php echo number_format($valorFinanciado2,0,'','.') ?>
                                </td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">
                                <?php //echo number_format((((($vcostoFinanciero->precio/30)*30)+100)/100)*((((($totalProduccion3+$totalDefi2+$totalPreImpresion)*0.085)+(($totalProduccion3+$totalDefi2+$totalPreImpresion)*0.085)+($totalProduccion3+$totalDefi2+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad3),0,'','.') ?>
                                <?php  number_format($cf3,0,'','.') ?>
                                </td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">
                                <?php //echo number_format((((($vcostoFinanciero->precio/30)*30)+100)/100)*((((($totalProduccion4+$totalDefi3+$totalPreImpresion)*0.085)+(($totalProduccion4+$totalDefi3+$totalPreImpresion)*0.085)+($totalProduccion4+$totalDefi3+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad4),0,'','.') ?>
                                <?php  number_format($cf4,0,'','.') ?>
                                </td>
                            </tr><input type="hidden" id="vf2" name="vf2" value="<?php echo number_format($valorFinanciado2, 0, '', '.'); ?>">
                            <?php
                            $vfinanciero2=number_format((((($vcostoFinanciero->precio/30)*30)+100)/100)*((((($totalProduccion2+$totalDefi1+$totalPreImpresion)*0.085)+(($totalProduccion2+$totalDefi1+$totalPreImpresion)*0.085)+($totalProduccion2+$totalDefi1+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad2),0,'','.');
                            $vfinanciero3=number_format((((($vcostoFinanciero->precio/30)*30)+100)/100)*((((($totalProduccion3+$totalDefi2+$totalPreImpresion)*0.085)+(($totalProduccion3+$totalDefi2+$totalPreImpresion)*0.085)+($totalProduccion3+$totalDefi2+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad3),0,'','.');
                            $vfinanciero4=number_format((((($vcostoFinanciero->precio/30)*30)+100)/100)*((((($totalProduccion4+$totalDefi3+$totalPreImpresion)*0.085)+(($totalProduccion4+$totalDefi3+$totalPreImpresion)*0.085)+($totalProduccion4+$totalDefi3+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad4),0,'','.');
                            
                            ?>
                            <tr>
                                <td class="celda_3"><h5>VALOR EMPRESA 2</h5></td>
                                <!--<td class="celda_3"><?php //if(sizeof($hoja)==0){if($datoscantidad2 == 1){echo 0;}else{if( $valorEmpresa2 == 0){echo number_format($valorFinanciado2,0,'','.');}else{echo $vfinanciero2;}}}else{echo number_format($hoja->valor_empresa_2,0,'','.');}?> <a href="<?php //echo base_url()?>hoja/valor_empresa_2/<?php //echo $id?>/2" class="fancybox fancybox.ajax"><img src="<?php //echo base_url()?>public/frontend/images/edit.png" class="img_16" /></a></td>-->
                                 <td class="celda_3"><h5><?php
                                    if (sizeof($hoja) == 0) {
                                        if ($valorEmpresa == 0) {
                                            echo number_format($valorFinanciado, 0, '', '.');
                                            $valorEmpresa = $valorFinanciado;
                                        } else {
                                            echo number_format($valorEmpresa, 0, '', '.');
                                        }
                                    } else {
                                        echo number_format($hoja->valor_empresa_2, 0, '', '.');
                                        $valorEmpresa = $hoja->valor_empresa_2;
                                    }
                                    ?>
                                    <!--<a href="<?php //echo base_url() ?>hoja/valor_empresa_2/<?php //echo $id ?>/<?php //echo $pagina ?>/<?php //echo $valorFinanciado; ?>" class="fancybox fancybox.ajax"><img src="<?php //echo base_url() ?>public/frontend/images/edit.png" class="img_16" /></a>-->
                                    <?php if($hoja->impreso!=1){echo "<a href='".base_url()."hoja/valor_empresa_2/".$id."/".$pagina."/".$valorFinanciado."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";}else{echo "<a href='".base_url()."hoja2/valor_empresa_2/".$id."/".$pagina."/".$valorFinanciado."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";} ?>
                                     <input type="hidden" name="valor_empresa_2" value="<?php
                                    if (sizeof($hoja) == 0) {
                                        if ($valorEmpresa == 0 || $valorEmpresa == null){
                                            echo number_format($valorFinanciado, 0, '', '.');
                                            $valorEmpresa = $valorFinanciado;
                                        } else {
                                            echo number_format($valorEmpresa, 0, '', '.');
                                        }
                                    } else {
                                        echo $hoja->valor_empresa_2;
                                        $valorEmpresa = $hoja->valor_empresa_2;
                                    }
                                    ?>" /></h5></td><input type="hidden" id="ve2" name="ve2" value="<?php echo $valorEmpresa; ?>">
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"><?php if(sizeof($hoja)==0){if($datoscantidad3 == 1){echo 0;}else{if( $valorEmpresa3 == 0){ number_format($valorFinanciado3,0,'','.');}else{ $vfinanciero3;}}}else{ number_format($hoja->valor_empresa_3,0,'','.');}?> </td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"><?php if(sizeof($hoja)==0){if($datoscantidad4 == 1){echo 0;}else{if( $valorEmpresa4 == 0){ number_format($valorFinanciado4,0,'','.');}else{ $vfinanciero4;}}}else{ number_format($hoja->valor_empresa_4,0,'','.');}?> </td>
								 
                            </tr>
                            <input type="hidden" name="valor_empresa_2" value="<?php if($datoscantidad2 == 1){
                                echo 0;
                            }
                            else{
                                    if( $valorEmpresa2 == 0){
                                        echo str_replace ( ".", "",$valorFinanciado2);
                                    }else{
                                        //echo str_replace ( ".", "",$vfinanciero2);
                                        echo str_replace ( ".", "",$valorEmpresa2);
                                    }
                                }?>" />
                            <input type="hidden" name="valor_empresa_3" value="<?php if($datoscantidad3 == 1){
                                echo 0;
                            }
                            else{
                                    if( $valorEmpresa3 == 0){
                                        echo str_replace ( ".", "",$valorFinanciado3);
                                    }else{
                                        //echo str_replace ( ".", "",$vfinanciero3);
                                        echo str_replace ( ".", "",$valorEmpresa3);
                                    }
                                }?>" />
                            <input type="hidden" name="valor_empresa_4" value="<?php if($datoscantidad4 == 1){
                                echo 0;
                            }
                            else{
                                    if( $valorEmpresa4 == 0){
                                        echo str_replace ( ".", "",$valorFinanciado4);
                                    }else{
                                        //echo str_replace ( ".", "",$vfinanciero4);
                                        echo str_replace ( ".", "",$valorEmpresa4);
                                    }
                                }?>" />
<!--                            <input type="hidden" name="valor_empresa_2" value="<?php// echo str_replace ( '.', '', $valorEmpresa2);?>" />
                            <input type="hidden" name="valor_empresa_3" value="<?php// echo str_replace ( '.', '', $valorEmpresa3);?>" />
                            <input type="hidden" name="valor_empresa_4" value="<?php// echo str_replace ( '.', '', $valorEmpresa4);?>" />-->
                        </table>
                        <div class="separador_10">&nbsp;</div>
                        <table id="tabla_detalle">
						
                            <tr>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3">MATERIAL</td>
                                <td class="celda_3">GRAMAJE</td>
                                <td class="celda_3">TOTAL PLIEGOS</td>
                                <td class="celda_3"></td>
                                <td class="celda_3">TOTAL KILOS</td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3"><?php echo $fotomecanica->materialidad_datos_tecnicos;?></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"></td>
                                <td class="celda_3"></td>
                                <td class="celda_3"></td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
							<?php 
                            if($fotomecanica->materialidad_datos_tecnicos == 'Cartulina-cartulina')
                                    {
							?>				
											
							<tr>
                                <td class="celda_3">TAPA</td>
                                <td class="celda_3"><?php echo $tapaNombre?> (<?php echo number_format($tapaPrecio,0,'','.')?>)</td>
                                <td class="celda_3"><?php echo number_format($costoPlacaKilo,0,'','.') ?></td>
                                <td class="celda_3"></td>
                                <td class="celda_3"><?php echo number_format($valorPlacaKilo,0,'','.');?></td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3">Tapa (Respaldo)</td>
                                <td class="celda_3"><?php echo $tapaNombre2?> (<?php echo number_format($tapaPrecio2,0,'','.')?>)</td>
                                <td class="celda_3"><?php echo number_format($costoPlacaKilo2,0,'','.') ?></td>
                                <td class="celda_3"></td>
                                <td class="celda_3"><?php echo number_format($valorPlacaKilo2,0,'','.');?></td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3"></td>
                                <td class="celda_3"></td>
                                <td class="celda_3"></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"></td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>				
											
							<?php				
				}else{

                                    if($fotomecanica->materialidad_datos_tecnicos == 'Corrugado')
                                    {

                                        $variable_cotizador=$this->variables_cotizador_model->getVariablesCotizadorPorId(25);
                                    }
                                    if($fotomecanica->materialidad_datos_tecnicos == 'Microcorrugado'){
                                    
                                        $variable_cotizador=$this->variables_cotizador_model->getVariablesCotizadorPorId(24);	
                                    }			
                                    if($fotomecanica->materialidad_datos_tecnicos == 'Indefinido'){

                                        $variable_cotizador=$this->variables_cotizador_model->getVariablesCotizadorPorId(24);	
                                    }	                                    
//                                    exit($fotomecanica->materialidad_datos_tecnicos."aquiii");       
                                    if (($datoscantidad2>0) and ($ing->unidades_por_pliego>0))
                                        $cantidad_cajas = ($datoscantidad2 / $ing->unidades_por_pliego) + 104;                                    
                                    else $cantidad_cajas = 104;                                    
                                   

                                    $kilosOnda =  ($tamano1 * $tamano2 * $ondaGramaje * $cantidad_cajas * (($variable_cotizador->precio * 10 + 1000)/1000)) / 10000000;
                                    
                                    $kilosLiner =  ($tamano1 * $tamano2 * $linerGramaje * $cantidad_cajas ) / 10000000;				
//                                    echo $kilosLiner ."=  (".$tamano1." * ".$tamano2." * ".$linerGramaje." * ".$cantidad_cajas." ) / 10000000";
    
                                    if(sizeof($hoja)>=1)
                                    {
                                        $arreglokilo2=array
                                        (
                                            "kilos_onda"=>$kilosOnda,
                                        );
                               
                                        $this->db->where('id', $hoja->id);
                                        $this->db->update("hoja_de_costos_datos",$arreglokilo2);
                                 
                                      

                                        $arreglokilo3=array
                                        (
                                            "kilos_liner"=>$kilosLiner,
                                        );
                                        $this->db->where('id', $hoja->id);
                                        $this->db->update("hoja_de_costos_datos",$arreglokilo3);
//                                        echo $hoja->id."---jaime----";
//                                        exit(print_r($arreglokilo2));                                           
                                    }
                                    ?>				
										
										
										
							<tr>
                                <td class="celda_3">TAPA</td>
                                <td class="celda_3"><?php echo $tapaNombre?> (<?php echo number_format($tapaPrecio,0,'','.')?>)</td>
                                <td class="celda_3">pliego_tapa</td>
                                <td class="celda_3"></td>
                                <td class="celda_3"><?php echo number_format($valorPlacaKilo,0,'','.');?></td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3">ONDA</td>
                                <td class="celda_3"><?php echo $ondaNombre?> (<?php echo number_format($ondaPrecio,0,'','.')?>)</td>
                                <td class="celda_3">pliego_ondas</td>
                                <td class="celda_3"></td>
                                <td class="celda_3"><?php echo number_format($kilosOnda,0,'','.');?></td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3">LINER</td>
                                <td class="celda_3"><?php echo $linerNombre?> (<?php echo number_format($linerPrecio,0,'','.')?>)</td>
                                <td class="celda_3">pliego_liner</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"><?php echo number_format($kilosLiner,0,'','.');?></td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>	
							<?php				
										}
							?>
                          
							<?php
									if($fotomecanica->materialidad_datos_tecnicos == 'Cartulina-cartulina')
										{
							?>	
							<tr>
                                <td class="celda_3">FECHA TAPA: <?php echo fecha_con_slash($tapaFecha)?></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3">FECHA Tapa (Respaldo): <?php echo fecha_con_slash($tapaFecha2)?></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3"></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"></td>
                                <td class="celda_3"></td>
                            </tr>

							<?php
										}else{
							?>											
                            <tr>
                                <td class="celda_3">FECHA TAPA: <?php echo fecha_con_slash($tapaFecha)?></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3">FECHA ONDA: <?php echo fecha_con_slash($ondaFecha)?></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3">FECHA LINER: <?php echo fecha_con_slash($linerFecha)?></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">240</td>
                                <td class="celda_3">449.71</td>
                            </tr>
							
						<?php
						}
                                                
                                                //***************ehndz********************
                                                
                                                 if($totalTrabajosInternos=='No'){$totalTrabajosInternos=0;}else{$totalTrabajosInternos=$totalTrabajosInternos*50;}
                                                 if($totalTrabajosExternos=='No'){$totalTrabajosExternos="No";}else{$cantidadTrabajosExternos=$totalTrabajosExternos/50;}
                                                 //***************ehndz********************
                                                 //echo "<h1>".$totalTrabajosExternos."</h1>";exit();
						?>		
                        </table>    
                        <div class="separador_20"></div>
                        <table id="tabla_detalle">
                            <tr>
                                <td class="celda_2">

                                </td>
                                <td class="celda_1">&nbsp;</td>
                                <td class="celda_60 valign_top" rowspan="5">
                                    <!--mermas-->                          
                                    <table id="tabla_produccion">
                                        <tr>
                                            <td colspan="4">Tabla de Patrón de MERMAS Microonda TIPO E + Tapa por <?php echo $datoscantidad2; ?> = <?php echo ($datoscantidad2 / $ing->unidades_por_pliego); ?> Pliegos -- Total Colores <?php echo ($fotomecanica->colores); ?> Barniz: <?php echo ($fotomecanica->fot_lleva_barniz); ?>
                                            Trabajos Externos: <?php echo $cantidadTrabajosExternos; ?></td>
                                        </tr>
                                        <tr>
                                            <td>Imprenta</td>
                                            <!--<td>Ultra</td>-->
                                            <td>Roland:800</td>
                                            <td>Roland:800</td>
                                            <td>&nbsp;</td>
                                            <td>&nbsp;</td>
                                        </tr>
                                        <tr>
                                            <td>Color 1-2-3</td>
                                            <td>400</td>
                                            <td>400</td>
                                            <td>&nbsp;</td>
                                            <td><?php echo $color1?></td>
                                        </tr>
                                        <tr>
                                            <td>Color &gt; 3</td>
                                            <td><?php if($datos->vb_maquina == 'SI' or $datos->acepta_excedentes == 'NO'){echo '150';}else{echo '100';}?></td>
                                            <td><?php if($datos->vb_maquina == 'SI' or $datos->acepta_excedentes == 'NO'){echo '150';}else{echo '100';}?></td>
                                            <td>* Color</td>
                                            <td><?php echo $color2?></td>
                                        </tr>
                                        <tr>
                                            <td>Cantidad</td>
                                            <td>30</td>
                                            <td>30</td>
                                            <td>Cantidad &gt; 5.000 * c/5.000</td>
                                            <td><?php echo $can1?></td>
                                        </tr>
<!--                                        <tr>
                                            <td>&nbsp;</td>
                                            <td>050</td>
                                            <td>050</td>
                                            <td>Cantidad &gt; 5.000 * c/5.000</td>
                                            <td><?php// echo $can2?></td>
                                        </tr>-->
                                        <tr>
                                            <td>Barniz</td>
                                            <td>100</td>
                                            <td>100</td>
                                            <td>Primeros 1.000</td>
                                            <td><?php echo $bar1 ?></td>
                                        </tr>
                                        <tr>
                                            <td>&nbsp;</td>
                                            <td>01</td>
                                            <td>01</td>
                                            <td>por cada 1.000 extra</td>
                                            <td><?php echo $bar2?></td>
                                        </tr>
                                        <tr>
                                            <td>Trabajo externo</td>
                                            <td>050</td>
                                            <td>050</td>
                                            <td>una sola vez</td>					
                                            <td><?php echo $externo?></td>
                                        </tr>
                                        <tr>
                                            <td>Micro/Micro</td>
                                            <td>030</td>
                                            <td>030</td>
                                            <td>una sola vez</td>
                                            <td><?php echo $micromicro?></td>
                                        </tr>
                                        <tr>
                                            <td>Cart/Cart</td>
                                            <td>030</td>
                                            <td>030</td>
                                            <td>una sola vez</td>
                                            <td><?php echo $cartulina?></td>
                                        </tr>
                                        <tr>
                                            <td>Tamaños Normales</td>
                                            <td>&nbsp;</td>
                                            <td>&nbsp;</td>
                                            <td>&nbsp;</td>
                                            <td>&nbsp;</td>
                                        </tr>
                                        <tr>
                                            <td>Emplacado</td>
                                            <td>50</td>
                                            <td>50</td>
                                            <td>primeros 1.000</td>
                                            <td><?php echo $emplacado_fijo?></td>
                                        </tr>
                                        <tr>
                                            <td></td>
                                            <td><?php echo $emplacado_merma?></td>
                                            <td><?php echo $emplacado_merma?></td>
                                            <td>por cada 1000</td>
                                            <td><?php echo $emplacado?></td>
                                        </tr>
                                        <tr>
                                            <td>Troquelado</td>
                                            <td>40</td>
                                            <td>40</td>
                                            <td>Los primeros 1.000</td>
                                            <td><?php echo $troquelado_fijo ?></td>
                                        </tr>
                                        <tr>
                                            <td></td>
                                            <td><?php echo $troquelado_merma ?></td>
                                            <td><?php echo $troquelado_merma ?></td>
                                            <td>por cada 1.000</td>
                                            <td><?php echo $troquelado?></td>
                                        </tr>
                                        <tr>
                                            <td colspan="5"><hr class="hr_punteada_corto" /></td>
                                        </tr>
                                        <tr>
                                            <td>&nbsp;</td>
                                            <td>&nbsp;</td>
                                            <td>&nbsp;</td>
                                            <td>&nbsp;</td>
                                            <td><?php echo number_format($sum,0,'','.')?></td>
                                        </tr>
                                    </table>
                                    <!--/mermas-->
                                </td>
                            </tr>
                            <tr>
                                <td class="celda_2">&nbsp;</td>
                                <td class="celda_1">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_2">&nbsp;</td>
                                <td class="celda_1">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_2"></td>
                                <td class="celda_1">&nbsp;</td>
                            </tr>
                        </table>
                        <div class="separador_20"></div>

                    </div>
                
<?php //echo "<h1>C.A.P ".number_format($costoAdministracion->precio,0,'','.')."</h1>"?>            
<?php //echo "<h1>M.P ".number_format($totalMateriaPrima,0,'','.')."</h1>"?>            
<?php //echo "<h1>P.I ".number_format($totalPreImpresion,0,'','.')."</h1>"?>            
<?php //echo "<h1>T.P ".number_format($totalProduccion,0,'','.')."</h1>"?>            
<?php //echo "<h1>T.P ".number_format($totalProduccion+$totalPreImpresion+$totalMateriaPrima,0,'','.')."</h1>"?>            
<!----------------elvis hernandez---------------->
<!----------------elvis hernandez-cantidad 3---------------->
<?php
if($fotomecanica->estan_los_moldes=="NO LLEVA" or $fotomecanica->estan_los_moldes=="CLIENTE LO APORTA" or $fotomecanica->materialidad_datos_tecnicos == 'Sólo Cartulina')
        {
            $troquelado=0;
            $troquelado_fijo=0;
            $troquelado_merma=$mermaTroqueladoArray->precio;
        }else
        {

            $mermaTroqueladoArray=$this->variables_cotizador_model->getVariablesCotizadorPorId(36);
            if (($datoscantidad3>0) and ($ing->unidades_por_pliego>0))
                $troquelado=$datoscantidad3/$ing->unidades_por_pliego;
            else 
                $troquelado=0;
                $troquelado= $troquelado / 1000; /*Resultado de emplacado dividido por 1000*/                                                              
                $troquelado= ($troquelado * 1000)+ 0.5; /*Emplacado multiplicado por 1000 y el resultado de la multiplicacion se suman 0.5*/                          
                $troquelado= $troquelado/ 1000; /*emplacado dividido por 1000*/                      
                $troquelado = $troquelado +0.499; /*emplacado mas 0.499: Resultado emplacado es en decimales*/                                                               
                $EnteroTroquelado = number_format($troquelado,0,'',''); /* Guardar entero del emplacado*/                          
                $troquelado = $EnteroTroquelado * $mermaTroqueladoArray->precio; /*Multiplicar entero del emplacado por 15*/
                $troquelado_fijo = 40;
                $troquelado_merma=$mermaTroqueladoArray->precio;
        }
if($ing->materialidad_datos_tecnicos=="Sólo Cartulina")
        {
           $emplacado=0;
           $emplacado_fijo=0;
           $emplacado_merma = $mermaEmplacadoArray->precio;
        }else
        {
             $cantidad_1=$datoscantidad3/$ing->unidades_por_pliego;
             $mermaEmplacadoArray=$this->variables_cotizador_model->getVariablesCotizadorPorId(35);
             $emplacado= $cantidad_1; /*Valor x dividido por Unidad por pliego*/

                $emplacado= $emplacado / 1000; /*Resultado de emplacado dividido por 1000*/                                       

                $emplacado= ($emplacado * 1000)+ 0.5; /*Emplacado multiplicado por 1000 y el resultado de la multiplicacion se suman 0.5*/                                  

            $emplacado= $emplacado/ 1000; /*emplacado dividido por 1000*/                   

                $emplacado = $emplacado +0.499; /*emplacado mas 0.499: Resultado emplacado es en decimales*/                                                               

                $Entero = number_format($emplacado,0,'',''); /* Guardar entero del emplacado*/                         

                $emplacado_fijo = 50; /*Multiplicar entero del emplacado por 15*/
                $emplacado = $Entero * $mermaEmplacadoArray->precio; /*Multiplicar entero del emplacado por 15*/
                $emplacado_merma = $mermaEmplacadoArray->precio;
                
        }
if(($fotomecanica->fot_lleva_barniz!='') && ($fotomecanica->fot_lleva_barniz!='Nada'))
         {
            $cantidadBarniz=$datoscantidad3-1000;
            if($cantidadBarniz<1000)
            {
                if($maquina=="Máquina Roland 800")
                {
                    //$bar1=150;
                    $bar1=100;
                    $bar2=0;
                }else
                {
                    $bar1=100;
                    $bar2=0;
                }
            }else
            {
			
               //echo $datoscantidad1/$ing->unidades_por_pliego;exit;
               $enteroBarniz=($datoscantidad3/$ing->unidades_por_pliego);
		//echo $enteroBarniz;exit();
               if($enteroBarniz < 1000)
			   {
				//$bar1=150;
				$bar1=100;
                                $bar2=0;   
			   }else
			   {
               //$enteroBarniz=(((number_format($enteroBarniz,0,'','')/1000)+1)-2)*10;
               $enteroBarniz=number_format((((($enteroBarniz/1000)+1)-2)*10),0,'','');
               $bar1=100;
               //$bar2=$enteroBarniz;
               $bar2=number_format((($datoscantidad3-1000)/1000*1),0,'','');
               $bar2=number_format(((($datoscantidad3/$ing->unidades_por_pliego)-1000)/1000*1),0,'','');
			   
               
                           }
            }

         }else
         {
                $bar1=0;
                $bar2=0;
                }

if($cantidad_3>5000)
         {
            $vecescan1 = ($cantidad_3) / 5000;
            if($vecescan1 >1)
            {
               $can1= 30 * $vecescan1;
            }else{
               $can1=30;
            }
            if($vecescan1 >1)
            {
                //$entero=number_format(($cantidad_1/5000)+0.5,0,'','');
                $can2= 50 * $vecescan1;
            }else
            {
                $can2=50;
            }
         }else
         {
            $can1=0;
            $can2=0;
         }
$sum=$color1+$color2+$can1+$bar1+$bar2+$externo+$micromicro+$cartulina+$emplacado+$troquelado+$emplacado_fijo+$troquelado_fijo;
$sumerma3=$sum;
if(sizeof($hoja)>=1)
        {
            $arreglomerma3=array
                (
                    "total_merma3"=>$sumerma3,
                );
                $this->db->where('id', $hoja->id);
                $this->db->update("hoja_de_costos_datos",$arreglomerma3);
        }
?>
<input type="hidden" name="total_merma3" value="<?php echo $sum ?>">
<div class="container fuente">
    
            <header>
            
                    <div>
                    <hr class="hr_punteada" />
                    </div>
<!--                    <div id="cantidad">
                    Valor por : <?php //echo number_format($datoscantidad3,0,"",".")?> <a href="<?php //echo base_url()?>hoja/cantidad/<?php //echo $id?>/<?php //echo $pagina?>" class="fancybox fancybox.ajax"><img src="<?php //echo base_url()?>public/frontend/images/edit.png" class="img_16" /></a>
                    </div>-->
                  
                    <!--separador 20-->
                    <div class="separador_20"></div>
                    <!--/separador 20-->
                    <div>
                        <!--materialidad-->
                       
                        <table>
                            <tr>
                                <td class="celda_5 izquierda">
                                <?php
                                 switch($fotomecanica->materialidad_datos_tecnicos)
                                  {
                                    case 'Indefinido':
                                        $materialidad_1=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_placa1);
                                        $materialidad_2=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_onda2);
                                        $materialidad_3=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_liner3);
                                        $materialidad_4="No Aplica";
                                        $variable_cotizador=$this->variables_cotizador_model->getVariablesCotizadorPorId(24);
                                        $variable_cotizador2=$this->variables_cotizador_model->getVariablesCotizadorPorId(40);
                                        $base_imprenta=$this->variables_cotizador_model->getVariablesCotizadorPorId(6);
                                        $formula=$materialidad_1->gramaje+($materialidad_1->gramaje*($variable_cotizador->precio/100))+$materialidad_3->gramaje;
                                        if ($materialidad_2->precio>0) $materialidad_precio2=($materialidad_2->precio/1000); else $materialidad_precio2=0;
                                        if ($materialidad_3->precio>0) $materialidad_precio3=($materialidad_3->precio/1000); else $materialidad_precio3=0;
                                        if ($materialidad_2->gramaje>0) $materialidad_gramaje2=($materialidad_2->gramaje/1000); else $materialidad_gramaje2=0;
                                        $costo_kilo=0;
//                                        echo "costo_kilo=(((".$materialidad_2->gramaje."*(".$materialidad_2->precio."/1000)+((".$materialidad_2->gramaje."*(".$variable_cotizador->precio."/100)*".$materialidad_2->precio."/1000))+".$materialidad_3->gramaje."*".$materialidad_3->precio."/1000)/(".$materialidad_2->gramaje."+(".$materialidad_2->gramaje."*(".$variable_cotizador->precio."/100))+".$materialidad_3->gramaje.")))*1000";           
                                        if ($materialidad_2->gramaje>0)
                                            $costo_kilo=((($materialidad_2->gramaje*($materialidad_2->precio/1000)+(($materialidad_2->gramaje*($variable_cotizador->precio/100)*$materialidad_2->precio/1000))+$materialidad_3->gramaje*$materialidad_3->precio/1000)/($materialidad_2->gramaje+($materialidad_2->gramaje*($variable_cotizador->precio/100))+$materialidad_3->gramaje)))*1000;           
					else 	
                                            $costo_kilo=0;
//                                        echo $materialidad_3->tipo."======".$materialidad_3->reverso;
										
                                        if($materialidad_3->tipo == 14 and  $materialidad_3->reverso == 'Blanca')//valdivia
                                        {
//                                                echo "1==============";
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(44);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;
                                        }

                                        elseif($materialidad_3->tipo == 15 and  $materialidad_3->reverso == 'Blanca')//maule
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(45);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;                                                 
                                        }
                                        elseif($materialidad_3->tipo == 1 and  $materialidad_3->reverso == 'Blanca') //Cartulina Importada
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(43);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;                                                 
                                        }
                                        elseif($materialidad_3->tipo == 5 and  $materialidad_3->reverso == 'Blanco') // papel reverso blanco
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(42);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;                                                 
                                        }
                                        elseif($materialidad_3->tipo == 3 and  $materialidad_3->reverso == 'Blanco') // papel reverso blanco
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(42);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;                                                 
                                        }
                                        elseif($materialidad_3->tipo == 4 and  $materialidad_3->reverso == 'Café') // papel reverso cafe
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(41);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;                                                 
                                        }
                                        else
                                        $costo_kilo_obtenido=140;
                                        $costo_kilo=$costo_kilo+$costo_kilo_obtenido;
                                        if(($fotomecanica->fot_lleva_barniz=='Nada')||($fotomecanica->fot_lleva_barniz==''))
                                        {
                                            $barniz2=0;
                                        }else
                                        {
                                            $barniz2=1;
                                        }

                                        if($maquina=="Máquina Roland 800")
                                         {
                                            $tira1=((($datoscantidad3/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio )*($fotomecanica->colores+$barniz2);
                                            $recargo800Array=$this->variables_cotizador_model->getVariablesCotizadorPorId(34);
                                            $tira2=((($datoscantidad3/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio)*($fotomecanica->colores+$barniz2)*(1*$recargo800Array->precio/100);
                                            //echo $recargo800Array->precio."<br>".$tira1."<br>".$tira2;exit;
                                             
                                         }else
                                         {
                                            $tiraje=((($datoscantidad3/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio )*($fotomecanica->colores+$barniz2);  
                                         
                                            
                                         }   
                                        
                                        if ($materialidad_2->gramaje>0)
                                            $GramosMetroCuadrado=$materialidad_2->gramaje+($materialidad_2->gramaje*($variable_cotizador->precio/100))+$materialidad_3->gramaje;
					else 	
                                            $GramosMetroCuadrado=0;                                         
                                        $recargoGramosDeAlmidon=$this->variables_cotizador_model->getVariablesCotizadorPorId(30);
                                        $GramosMetroCuadrado=$GramosMetroCuadrado+$recargoGramosDeAlmidon->precio;
                                        if(sizeof($hoja)>=1)
                                        {
                                            $arreglo54=array
                                                (
                                                    "gramos_metro_cuadrado"=>$GramosMetroCuadrado,
                                                );
                                                $this->db->where('id', $hoja->id);
                                                $this->db->update("hoja_de_costos_datos",$arreglo54);
                                        }
                                        if ($materialidad_2->gramaje>0)
                                            $costoMonotapaPorMetro2=$materialidad_2->gramaje*($materialidad_2->precio/1000)+(($materialidad_2->gramaje*($variable_cotizador->precio/100)*$materialidad_2->precio/1000)+$materialidad_3->gramaje*$materialidad_3->precio/1000);
					else 	
                                            $costoMonotapaPorMetro2=0;     
//                            
                                       switch($fotomecanica->estan_los_moldes)
                                       {
                                          case 'NO':
                                            $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Nuevo</strong>)";
                                          break;
                                          case 'MOLDE GENERICO':
                                            if ($orden->id_molde!='')  
                                                $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            else
                                                $molde=$this->moldes_model->getMoldesPorId($datos->numero_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Antiguo</strong>)";
                                          break;
                                          case 'MOLDE REGISTRADOS DEL CLIENTE':
                                            if ($orden->id_molde!='')  
                                                $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            else
                                                $molde=$this->moldes_model->getMoldesPorId($datos->numero_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Antiguo</strong>)";
                                          break;                                          
                                          case 'NO LLEVA':
                                            $moldeNombre="<strong>NO ESTA MOLDE, PRODUCTO NO FABRICADO ANTERIORMENTE</strong>";
                                          break;
                                          case 'CLIENTE LO APORTA':
                                            $moldeNombre="<strong>CLIENTE LO APORTA</strong>";
                                          break;
                                       }
                                       
                                        $tapaNombre=$materialidad_1->nombre;
                                        $tapaGramaje=$materialidad_1->gramaje;
                                        $tapaFecha=$materialidad_1->fecha_ultima_actualizacion;
                                        $tapaPrecio=$materialidad_1->precio;
                                        $ondaNombre=$materialidad_2->nombre;
                                        if ($materialidad_2->gramaje>0)
                                            $ondaGramaje=$materialidad_2->gramaje;
					else 	
                                        $ondaGramaje=0;                                           
                                        $ondaFecha=$materialidad_2->fecha_ultima_actualizacion;
                                        $ondaPrecio=$materialidad_2->precio;
                                        $linerNombre=$materialidad_3->nombre;
                                        $linerGramaje=$materialidad_3->gramaje;
                                        $linerFecha=$materialidad_3->fecha_ultima_actualizacion;
                                        $linerPrecio=$materialidad_3->precio;
                                       ?>
                                      <?php $tapa = $this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_placa1) ?>
                                         <?php $tapa->materiales_tipo?> <?php $materialidad_1->gramaje?><?php $materialidad_1->precio?><?php $materialidad_1->reverso?>
                                        <?php $monda = $this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_onda2) ?>
                                        <?php $monda->materiales_tipo ?><?php $materialidad_2->gramaje?> <?php $materialidad_2->precio?><?php $materialidad_2->reverso?>
                                        <?php $mliner = $this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_liner3) ?>
                                        <?php $mliner->materiales_tipo ?><?php $materialidad_3->gramaje?><?php $materialidad_3->precio?><?php $materialidad_3->reverso?>
                                        <?php number_format($costo_kilo,0,'','.')?> <?php $GramosMetroCuadrado?> <?php $costoMonotapaPorMetro2?>
                                       
                                        <?php $moldeNombre?> <!--

-->
                                        <?php
                                    break;
                                    case 'Microcorrugado':
                                        $materialidad_1=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_placa1);

                                        $materialidad_2=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_onda2);
                                        $materialidad_3=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_liner3);
                                        $materialidad_4="No Aplica";
                                        $variable_cotizador=$this->variables_cotizador_model->getVariablesCotizadorPorId(24);
                                        $variable_cotizador2=$this->variables_cotizador_model->getVariablesCotizadorPorId(40);
                                        $base_imprenta=$this->variables_cotizador_model->getVariablesCotizadorPorId(6);

                                        $formula=$materialidad_1->gramaje+($materialidad_1->gramaje*($variable_cotizador->precio/100))+$materialidad_3->gramaje;
                                        if ($materialidad_2->precio>0) $materialidad_precio2=($materialidad_2->precio/1000); else $materialidad_precio2=0;
                                        if ($materialidad_3->precio>0) $materialidad_precio3=($materialidad_3->precio/1000); else $materialidad_precio3=0;
                                        if ($materialidad_2->gramaje>0) $materialidad_gramaje2=($materialidad_2->gramaje/1000); else $materialidad_gramaje2=0;
                                        $costo_kilo=0;
                                        if (($materialidad_2->gramaje>0) and ($materialidad_3->gramaje>0) and ($materialidad_2->precio>0))
                                            $costo_kilo=((($materialidad_2->gramaje*($materialidad_2->precio/1000)+(($materialidad_2->gramaje*($variable_cotizador->precio/100)*$materialidad_2->precio/1000))+$materialidad_3->gramaje*$materialidad_3->precio/1000)/($materialidad_2->gramaje+($materialidad_2->gramaje*($variable_cotizador->precio/100))+$materialidad_3->gramaje)))*1000;           
					else 	
                                            $costo_kilo=0;
									
                                        if($materialidad_3->tipo == 14 and  $materialidad_3->reverso == 'Blanca')//valdivia
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(44);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;
                                        }
                                        elseif($materialidad_3->tipo == 15 and  $materialidad_3->reverso == 'Blanca')//maule
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(45);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;                                                 
                                        }
                                        elseif($materialidad_3->tipo == 1 and  $materialidad_3->reverso == 'Blanca') //Cartulina Importada
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(43);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;                                                 
                                        }
                                        elseif($materialidad_3->tipo == 5 and  $materialidad_3->reverso == 'Blanco') // papel reverso blanco
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(42);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;                                                 
                                        }
                                        elseif($materialidad_3->tipo == 3 and  $materialidad_3->reverso == 'Blanco') // papel reverso blanco
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(42);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;                                                 
                                        }
                                        elseif($materialidad_3->tipo == 4 and  $materialidad_3->reverso == 'Café') // papel reverso cafe
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(41);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;                                                 
                                        }
                                        else
                                        $costo_kilo_obtenido=140;
                                        
                                        $costo_kilo=$costo_kilo+$costo_kilo_obtenido;
                                        
                                        if($fotomecanica->fot_lleva_barniz=='' || $fotomecanica->fot_lleva_barniz=='Nada')
                                        {
                                            $barniz2=0;
                                        }else
                                        {
                                            $barniz2=1;
                                        }
                                        
                                        if($maquina=="Máquina Roland 800")
                                         {
                                            $tira1=((($datoscantidad3/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio )*($fotomecanica->colores+$barniz2);
                                            $recargo800Array=$this->variables_cotizador_model->getVariablesCotizadorPorId(34);
                                            $tira2=((($datoscantidad3/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio)*($fotomecanica->colores+$barniz2)*(1*$recargo800Array->precio/100);
                                            $tiraje=$tira1+$tira2;
                                            
//                                       
                                         }else
                                         {
                                            $tiraje=((($datoscantidad3/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio )*($fotomecanica->colores+$barniz2);  
                                         }   
                                        if ($materialidad_2->gramaje>0)
                                        {    
                                            $GramosMetroCuadrado=$materialidad_2->gramaje+($materialidad_2->gramaje*($variable_cotizador->precio/100))+$materialidad_3->gramaje;
//                                           
                                        }    
					else 	
                                            $GramosMetroCuadrado=0;                                         
                                        $recargoGramosDeAlmidon=$this->variables_cotizador_model->getVariablesCotizadorPorId(30);

                                        $GramosMetroCuadrado=$GramosMetroCuadrado+$recargoGramosDeAlmidon->precio;
                                        if(sizeof($hoja)>=1)
                                        {
                                            $arreglo54=array
                                                (
                                                    "gramos_metro_cuadrado"=>$GramosMetroCuadrado,
                                                );
                                                $this->db->where('id', $hoja->id);
                                                $this->db->update("hoja_de_costos_datos",$arreglo54);
                                        }
                                        if ($materialidad_2->gramaje>0){
                                            $costoMonotapaPorMetro2=$materialidad_2->gramaje*($materialidad_2->precio/1000)+(($materialidad_2->gramaje*($variable_cotizador->precio/100)*$materialidad_2->precio/1000)+$materialidad_3->gramaje*$materialidad_3->precio/1000);
                                        }
					else 	
                                            $costoMonotapaPorMetro2=0;                                           
                                       switch($fotomecanica->estan_los_moldes)
                                       {
                                          case 'NO':
                                            $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Nuevo</strong>)";
                                          break;
                                          case 'MOLDE GENERICO':
                                            if ($orden->id_molde!='')  
                                                $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            else
                                                $molde=$this->moldes_model->getMoldesPorId($datos->numero_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Antiguo</strong>)";
                                          break;
                                          case 'MOLDE REGISTRADOS DEL CLIENTE':
                                            if ($orden->id_molde!='')  
                                                $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            else
                                                $molde=$this->moldes_model->getMoldesPorId($datos->numero_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Antiguo</strong>)";
                                          break;   
                                          case 'NO LLEVA':
                                            $moldeNombre="<strong>NO ESTA MOLDE, PRODUCTO NO FABRICADO ANTERIORMENTE</strong>";
                                          break;
                                          case 'CLIENTE LO APORTA':
                                            $moldeNombre="<strong>CLIENTE LO APORTA</strong>";
                                          break;
                                       }
                                        $tapaNombre=$materialidad_1->nombre;
                                        $tapaGramaje=$materialidad_1->gramaje;
                                        $tapaFecha=$materialidad_1->fecha_ultima_actualizacion;
                                        $tapaPrecio=$materialidad_1->precio;
                                        $ondaNombre=$materialidad_2->nombre;
                                        if ($materialidad_2->gramaje>0)
                                            $ondaGramaje=$materialidad_2->gramaje;
					else 	
                                            $ondaGramaje=0;                                           
                                        $ondaFecha=$materialidad_2->fecha_ultima_actualizacion;
                                        $ondaPrecio=$materialidad_2->precio;
                                        $linerNombre=$materialidad_3->nombre;
                                        $linerGramaje=$materialidad_3->gramaje;
                                        $linerFecha=$materialidad_3->fecha_ultima_actualizacion;
                                        $linerPrecio=$materialidad_3->precio;
//                                        print_r($materialidad_1);
                                       ?>
                                       <?php $tapa = $this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_placa1) ?>
                                        <?php $tapa->materiales_tipo?> <?php $materialidad_1->gramaje?><?php $materialidad_1->precio?><?php  $materialidad_1->reverso?>
                                        <?php $monda = $this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_onda2) ?>
                                        <?php $monda->materiales_tipo ?> <?php  $materialidad_2->gramaje?> <?php  $materialidad_2->precio?> <?php  $materialidad_2->reverso?>
                                        <?php $mliner = $this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_liner3) ?>
                                        <?php $mliner->materiales_tipo ?> <?php $materialidad_3->gramaje?><?php  $materialidad_3->precio?>  <?php  $materialidad_3->reverso?>
                                        <?php number_format($costo_kilo,0,'','.')?> <?php  $GramosMetroCuadrado?> <?php $costoMonotapaPorMetro2?>
                                      
                                        <?php $moldeNombre?> 
                                        <?php
                                    break;                                    
//                                  
//                                       ?>
                                       <?php $tapa = $this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_placa1) ?>
                                        <?php $tapa->materiales_tipo?><?php echo $materialidad_1->gramaje?> <?php echo $materialidad_1->precio?> <?php  $materialidad_1->reverso?>
					<?php $monda = $this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_onda2) ?>
                                        <?php $monda->materiales_tipo ?><?php echo $materialidad_2->gramaje?>  <?php echo $materialidad_2->precio?> <?php  $materialidad_2->reverso?>
					<?php $mliner = $this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_liner3) ?>
                                        <?php $mliner->materiales_tipo ?> <?php echo $materialidad_3->gramaje?> <?php echo $materialidad_3->precio?>  <?php  $materialidad_3->reverso?>
                                        <?php number_format($costo_kilo,0,'','.')?> <?php echo $GramosMetroCuadrado?> <?php echo $costoMonotapaPorMetro2?>
                                        
                                        <?php $moldeNombre?> 
                                        //<?php
//                                    break;
                                    case 'Corrugado'://la misma
                                        $materialidad_1=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_placa1);
                                        $materialidad_2=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_onda2);
                                        $materialidad_3=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_liner3);
                                        $materialidad_4="No Aplica";
                                        $variable_cotizador=$this->variables_cotizador_model->getVariablesCotizadorPorId(24);
                                        $variable_cotizador2=$this->variables_cotizador_model->getVariablesCotizadorPorId(40);
                                        $base_imprenta=$this->variables_cotizador_model->getVariablesCotizadorPorId(6);
                                        $formula=$materialidad_1->gramaje+($materialidad_1->gramaje*($variable_cotizador->precio/100))+$materialidad_3->gramaje;
                                        //echo $materialidad_2->gramaje."sss";exit;
                                        
                                        if (($materialidad_2->precio>0) and ($materialidad_3->gramaje>0) and ($materialidad_3->precio>0))
                                           $costo_kilo=((($materialidad_2->gramaje*($materialidad_2->precio/1000)+(($materialidad_2->gramaje*($variable_cotizador->precio/100)*$materialidad_2->precio/1000))+$materialidad_3->gramaje*$materialidad_3->precio/1000)/($materialidad_2->gramaje+($materialidad_2->gramaje*($variable_cotizador->precio/100))+$materialidad_3->gramaje)))*1000;           
                                        else 
                                            $costo_kilo=0;                                        
                                        if($materialidad_3->tipo == 14 and  $materialidad_3->reverso == 'Blanca')//valdivia
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(44);
                                        }
                                        if($materialidad_3->tipo == 15 and  $materialidad_3->reverso == 'Blanca')//maule
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(45);
                                        }
                                        if($materialidad_3->tipo == 1 and  $materialidad_3->reverso == 'Blanca') //Cartulina Importada
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(43);
                                        }
                                        if($materialidad_3->tipo == 5 and  $materialidad_3->reverso == 'Blanco') // papel reverso blanco
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(42);
                                        }
                                        if($materialidad_3->tipo == 3 and  $materialidad_3->reverso == 'Blanco') // papel reverso blanco/ white top
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(42);
                                        }
                                        if($materialidad_3->tipo == 4 and  $materialidad_3->reverso == 'Café') // papel reverso cafe
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(41);
                                        }
                                        $costo_kilo=$costo_kilo+$recargoCostoKilo->precio;
                                        if($fotomecanica->fot_lleva_barniz=='Nada' || $fotomecanica->fot_lleva_barniz=='')
                                        {
                                            $barniz2=0;
                                        }else
                                        {
                                            $barniz2=1;
                                        }
                                  
                                        if($maquina=="Máquina Roland 800")
                                         {
                                            $tira1=((($datoscantidad3/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio )*($fotomecanica->colores+$barniz2);
                                            $recargo800Array=$this->variables_cotizador_model->getVariablesCotizadorPorId(34);
                                            $tira2=((($datoscantidad3/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio)*($fotomecanica->colores+$barniz2)*(1*$recargo800Array->precio/100);
                                            $tiraje=$tira1+$tira2;

                                         }else
                                         {
                                            $tiraje=((($datoscantidad3/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio )*($fotomecanica->colores+$barniz2);  
                                          
                                         }    
                                        if  (($materialidad_2->gramaje>0) and ($materialidad_3->gramaje>0)) 
                                            $GramosMetroCuadrado=$materialidad_2->gramaje+($materialidad_2->gramaje*($variable_cotizador->precio/100))+$materialidad_3->gramaje;
                                        else
                                            $GramosMetroCuadrado=0;
                                        $recargoGramosDeAlmidon=$this->variables_cotizador_model->getVariablesCotizadorPorId(30);
                                        $GramosMetroCuadrado=$GramosMetroCuadrado+$recargoGramosDeAlmidon->precio;
										
					if(sizeof($hoja)>=1)
                                        {
                                            $arreglo54=array
                                                (
                                                    "gramos_metro_cuadrado"=>$GramosMetroCuadrado,
                                                );
                                                $this->db->where('id', $hoja->id);
                                                $this->db->update("hoja_de_costos_datos",$arreglo54);
                                        }
                                        if (($materialidad_2->gramaje>0) and ($materialidad_3->gramaje>0) and ($materialidad_2->precio>0))
                                            $costoMonotapaPorMetro2=$materialidad_2->gramaje*($materialidad_2->precio/1000)+(($materialidad_2->gramaje*($variable_cotizador->precio/100)*$materialidad_2->precio/1000)+$materialidad_3->gramaje*$materialidad_3->precio/1000);
                                        else
                                            $costoMonotapaPorMetro2=0;

                                       
                                       switch($fotomecanica->estan_los_moldes)
                                       {
                                          case 'NO':
                                            $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Nuevo</strong>)";
                                          break;
                                          case 'MOLDE GENERICO':
                                            if ($orden->id_molde!='')  
                                                $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            else
                                                $molde=$this->moldes_model->getMoldesPorId($datos->numero_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Antiguo</strong>)";
                                          break;
                                          case 'MOLDE REGISTRADOS DEL CLIENTE':
                                            if ($orden->id_molde!='')  
                                                $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            else
                                                $molde=$this->moldes_model->getMoldesPorId($datos->numero_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Antiguo</strong>)";
                                          break;                                          
                                          case 'NO LLEVA':
                                            $moldeNombre="<strong>NO ESTA MOLDE, PRODUCTO NO FABRICADO ANTERIORMENTE</strong>";
                                          break;
                                          case 'CLIENTE LO APORTA':
                                            $moldeNombre="<strong>CLIENTE LO APORTA</strong>";
                                          break;
                                       }                                       
                                       
                                       
                                       
                                        $tapaNombre=$materialidad_1->nombre;
                                        $tapaGramaje=$materialidad_1->gramaje;
                                        $tapaFecha=$materialidad_1->fecha_ultima_actualizacion;
                                        $tapaPrecio=$materialidad_1->precio;
                                        $ondaNombre=$materialidad_2->nombre;
                                        $ondaGramaje=$materialidad_2->gramaje;
                                        $ondaFecha=$materialidad_2->fecha_ultima_actualizacion;
                                        $ondaPrecio=$materialidad_2->precio;
                                        $linerNombre=$materialidad_3->nombre;
                                        $linerGramaje=$materialidad_3->gramaje;
                                        $linerFecha=$materialidad_3->fecha_ultima_actualizacion;
                                        $linerPrecio=$materialidad_3->precio;                      
                                        ?>
				
                                        <?php
                                    break;
                                    case 'Cartulina-cartulina': //Cartulina cartulina
                                        $materialidad_1=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_placa1);
                                        $materialidad_2=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_onda2);
                                        $materialidad_3=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_liner3);
                                        //$materialidad_3="No Aplica";;
                                        $materialidad_4="No Aplica";
                                        $variable_cotizador=$this->variables_cotizador_model->getVariablesCotizadorPorId(24);
                                        $variable_cotizador2=$this->variables_cotizador_model->getVariablesCotizadorPorId(40);
                                        $base_imprenta=$this->variables_cotizador_model->getVariablesCotizadorPorId(6);
                                        if (($materialidad_2->precio>0) and ($materialidad_2->gramaje>0) and ($variable_cotizador->precio>0))
                                            $costo_kilo=((($materialidad_2->gramaje*($materialidad_2->precio/1000)+(($materialidad_2->gramaje*($variable_cotizador->precio/100)*$materialidad_2->precio/1000))+0*0/1000)/($materialidad_2->gramaje+($materialidad_2->gramaje*($variable_cotizador->precio/100))+0)))*1000;     
                                        else 
                                            $costo_kilo=0;
                                        $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(40);
                                        $costo_kilo=$costo_kilo+$recargoCostoKilo->precio;
                                        if($fotomecanica->fot_lleva_barniz=='' || $fotomecanica->fot_lleva_barniz=='Nada')
                                        {
                                            $barniz2=0;
                                        }else
                                        {
                                            $barniz2=1;
                                        }

                                        if($maquina=="Máquina Roland 800")
                                         {
                                        $tira1=((($datoscantidad3/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio )*($fotomecanica->colores+$barniz2);
                                            $recargo800Array=$this->variables_cotizador_model->getVariablesCotizadorPorId(34);
                                        $tira2=((($datoscantidad3/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio)*($fotomecanica->colores+$barniz2)*(1*$recargo800Array->precio/100);
                                            $tiraje=$tira1+$tira2;
                                            
                                         }else
                                         {
                                            $tiraje=((($datoscantidad3/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio )*($fotomecanica->colores+$barniz2);  
                                          
                                         }    
                                        if  ($materialidad_2->gramaje>0) 
                                            $GramosMetroCuadrado=$materialidad_2->gramaje+($materialidad_2->gramaje*($variable_cotizador->precio/100))+0;
                                        else 
                                            $GramosMetroCuadrado=0;
                                        $recargoGramosDeAlmidon=$this->variables_cotizador_model->getVariablesCotizadorPorId(30);
                                        $GramosMetroCuadrado=$GramosMetroCuadrado+$recargoGramosDeAlmidon->precio;
                                        if  ($materialidad_2->gramaje>0) 
                                            $costoMonotapaPorMetro2=$materialidad_2->gramaje*($materialidad_2->precio/1000)+(($materialidad_2->gramaje*($variable_cotizador->precio/100)*$materialidad_2->precio/1000)+0*0/1000);
                                        else 
                                            $costoMonotapaPorMetro2=0;
                                         
                                        
                                       switch($fotomecanica->estan_los_moldes)
                                       {
                                          case 'NO':
                                            $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Nuevo</strong>)";
                                          break;
                                          case 'MOLDE GENERICO':
                                            if ($orden->id_molde!='')  
                                                $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            else
                                                $molde=$this->moldes_model->getMoldesPorId($datos->numero_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Antiguo</strong>)";
                                          break;
                                          case 'MOLDE REGISTRADOS DEL CLIENTE':
                                            if ($orden->id_molde!='')  
                                                $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            else
                                                $molde=$this->moldes_model->getMoldesPorId($datos->numero_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Antiguo</strong>)";
                                          break;                                          
                                          case 'NO LLEVA':
                                            $moldeNombre="<strong>NO ESTA MOLDE, PRODUCTO NO FABRICADO ANTERIORMENTE</strong>";
                                          break;
                                          case 'CLIENTE LO APORTA':
                                            $moldeNombre="<strong>CLIENTE LO APORTA</strong>";
                                          break;
                                       }                                        

                                        $tapaNombre=$materialidad_1->nombre;
                                        $tapaGramaje=$materialidad_1->gramaje;
                                        $tapaFecha=$materialidad_1->fecha_ultima_actualizacion;
                                        $tapaPrecio=$materialidad_1->precio;
										
                                        $tapaNombre2=$materialidad_2->nombre;
                                        $tapaGramaje2=$materialidad_2->gramaje;
                                        $tapaFecha2=$materialidad_2->fecha_ultima_actualizacion;
                                        $tapaPrecio2=$materialidad_2->precio;
                                        
                                        $tapaNombre3=$materialidad_3->nombre;
                                        $tapaGramaje3=$materialidad_3->gramaje;
                                        $tapaFecha3=$materialidad_3->fecha_ultima_actualizacion;
                                        $tapaPrecio3=$materialidad_3->precio;
                     
                                        ?>
                                        <?php $fotomecanica->materialidad_1?><?php $materialidad_1->gramaje?> <?php $materialidad_1->precio?><?php $materialidad_1->reverso?>
                                        <?php $fotomecanica->materialidad_3?><?php $materialidad_3->gramaje?> <?php $materialidad_3->precio?><?php $materialidad_3->reverso?>
                                        <?php $formula?>
                                        <?php $fotomecanica->impresion?>
                                        <?php $moldeNombre?>
                                        <?php
                                        
                                    break;
                                    case 'Sólo Cartulina':
									
					$materialidad_1=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_placa1);
                                        $variable_cotizador=$this->variables_cotizador_model->getVariablesCotizadorPorId(24);
                                        $variable_cotizador2=$this->variables_cotizador_model->getVariablesCotizadorPorId(40);
                                        $base_imprenta=$this->variables_cotizador_model->getVariablesCotizadorPorId(6);
                                      
                                        $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(40);
                                        $costo_kilo=0;
                                        if($fotomecanica->fot_lleva_barniz=='' || $fotomecanica->fot_lleva_barniz=='Nada')
                                        {
                                            $barniz2=0;
                                        }else
                                        {
                                            $barniz2=1;
                                        }
                                        
                                        if($maquina=="Máquina Roland 800")
                                         {
                                            $tira1=((($datoscantidad3/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio )*($fotomecanica->colores+$barniz2);
                                            $recargo800Array=$this->variables_cotizador_model->getVariablesCotizadorPorId(34);
                                            $tira2=((($datoscantidad3/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio)*($fotomecanica->colores+$barniz2)*(1*$recargo800Array->precio/100);
                                            $tiraje=$tira1+$tira2;
  
                                         }else
                                         {
                                            $tiraje=((($datoscantidad3/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio )*($fotomecanica->colores+$barniz2);  
                                          
                                         }    
                                        if  ($materialidad_2->gramaje>0) 
                                            $GramosMetroCuadrado=$materialidad_2->gramaje+($materialidad_2->gramaje*($variable_cotizador->precio/100))+0;
                                        else 
                                            $GramosMetroCuadrado=0;
                                        $recargoGramosDeAlmidon=$this->variables_cotizador_model->getVariablesCotizadorPorId(30);
                                        
                                        $GramosMetroCuadrado=$GramosMetroCuadrado+$recargoGramosDeAlmidon->precio;
                                        if  ($materialidad_2->gramaje>0) 
                                            $costoMonotapaPorMetro2=$materialidad_2->gramaje*($materialidad_2->precio/1000)+(($materialidad_2->gramaje*($variable_cotizador->precio/100)*$materialidad_2->precio/1000)+0*0/1000);
                                        else 
                                            $costoMonotapaPorMetro2=0; 
                                                                             
                                       switch($fotomecanica->estan_los_moldes)
                                       {
                                          case 'NO':
                                            $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Nuevo</strong>)";
                                          break;
                                          case 'MOLDE GENERICO':
                                            if ($orden->id_molde!='')  
                                                $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            else
                                                $molde=$this->moldes_model->getMoldesPorId($datos->numero_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Antiguo</strong>)";
                                          break;
                                          case 'MOLDE REGISTRADOS DEL CLIENTE':
                                            if ($orden->id_molde!='')  
                                                $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            else
                                                $molde=$this->moldes_model->getMoldesPorId($datos->numero_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Antiguo</strong>)";
                                          break;                                          
                                          case 'NO LLEVA':
                                            $moldeNombre="<strong>NO ESTA MOLDE, PRODUCTO NO FABRICADO ANTERIORMENTE</strong>";
                                          break;
                                          case 'CLIENTE LO APORTA':
                                            $moldeNombre="<strong>CLIENTE LO APORTA</strong>";
                                          break;
                                       }                                        
                                        $tapaNombre=$materialidad_1->nombre;
                                        $tapaGramaje=$materialidad_1->gramaje;
                                        $tapaFecha=$materialidad_1->fecha_ultima_actualizacion;
                                        $tapaPrecio=$materialidad_1->precio;
										
                                        $tapaNombre2=$materialidad_2->nombre;
                                        $tapaGramaje2=$materialidad_2->gramaje;
                                        $tapaFecha2=$materialidad_2->fecha_ultima_actualizacion;
                                        $tapaPrecio2=$materialidad_2->precio;
                     
                                        ?>
                                        <?php $fotomecanica->materialidad_1?><?php $materialidad_1->gramaje?><?php $materialidad_1->precio?><?php  $materialidad_1->reverso?>
                                        <?php $fotomecanica->materialidad_2?><?php $materialidad_2->gramaje?><?php $materialidad_2->precio?> <?php $materialidad_2->reverso?>
                                        <?php $formula?>
                                        <?php $fotomecanica->impresion?>
                                        <?php $moldeNombre?>
                                        <?php	
                                    break;
                                    case 'Se solicita proposición':
                                        
                                    break;
                                  }  
                                ?>
                 </td>
                <td class="celda_5 valign_top">
                    <!--trabajos externos-->
                    <table border="1">
                                         
               <?php
                                $cantidad_4=0;
                                $externos_produccion=0;
                             //    exit($fotomecanica->acabado_impresion_4."hollaaa");
				if($fotomecanica->acabado_impresion_4=="17")
                                {
                                    $acabado_4="";
                                    $acabado_4Valor="";
                                    $acabado_4MedidaMasValorVenta="";
                                    $acabado_4Unitario="";
                                    $acabado_4UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_4Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_4);
                                    $acabado_4=$acabado_4Array->caracteristicas; // Nombre acabado
                                    $acabado_4UnidadVentaNombre=$acabado_4Array->unv; //Nombre unidad de venta
                                    $acabado_4Valor=$acabado_4Array->valor_venta; // ej: 52
                                    $acabado_4MedidaMasValorVenta=($tamano1*$tamano2*$acabado_4Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_4CostoFijo=$acabado_4Array->costo_fijo;	
								
                                    
                                    if ($acabado_4Array->unidad_de_venta == '1') //Metros
                                    {
                                        $costo_unitario4=$acabado_4MedidaMasValorVenta;
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad3);
                                        $cantidad_4=$datoscantidad3;
                                    }
                                    elseif ($acabado_4Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $costo_unitario4=$acabado_4Valor;
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }  
                                    elseif ($acabado_4Array->unidad_de_venta == '3') //tONELADA
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad3);
                                    }                                    
                                    elseif ($acabado_4Array->unidad_de_venta == '4') //caja de carton
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad3);
                                    }                                            
                                    elseif ($acabado_4Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($datoscantidad3*$acabado_4Valor);
                                        $cantidad_4=$datoscantidad3;
                                    }       
                                    elseif ($acabado_4Array->unidad_de_venta == '6') //cm2
                                    {
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $costo_unitario4=$acabado_4Valor;     
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }   
                                    elseif ($acabado_4Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario4=$acabado_4MedidaMasValorVenta;
                                        $precio_total_4=$acabado_4MedidaMasValorVenta*$datoscantidad3;
                                        $cantidad_4=$datoscantidad3;
                                    }
                                    elseif ($acabado_4Array->unidad_de_venta == '8') //cms
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad3);
                                    }           
                                    elseif ($acabado_4Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }     
                                    elseif ($acabado_4Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($acabado_4Valor*$datoscantidad3);
                                        $cantidad_4=$datoscantidad3;                                        
                                    }
                                    
                                }
								
                                if($fotomecanica->acabado_impresion_5=="17")
                                {
                                    $acabado_5="";
                                    $acabado_5Valor="";
                                    $acabado_5MedidaMasValorVenta="";
                                    $acabado_5Unitario="";
                                    $acabado_5UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_5Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_5);
                                    $acabado_5=$acabado_5Array->caracteristicas;
                                    $acabado_5UnidadVentaNombre=$acabado_5Array->unv; //Nombre unidad de venta
                                    $acabado_5Valor=$acabado_5Array->valor_venta; // ej: 52
                                    $acabado_5MedidaMasValorVenta=($tamano1*$tamano2*$acabado_5Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_5CostoFijo=$acabado_5Array->costo_fijo;		
                                  if ($acabado_5Array->unidad_de_venta == '1') //mt2
                                    {
                                        $costo_unitario5=$acabado_5MedidaMasValorVenta;
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad3);                                      
                                        $cantidad_5=$datoscantidad3;
                                    }
                                    elseif ($acabado_5Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $costo_unitario5=$acabado_5Valor; 
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }    
                                    elseif ($acabado_5Array->unidad_de_venta == '3') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad3);
                                    }                                    
                                    elseif ($acabado_5Array->unidad_de_venta == '4') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad3);
                                    }                                            
                                    elseif ($acabado_5Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($datoscantidad3*$acabado_5Valor);
                                        $cantidad_5=$datoscantidad3;
                                    }       
                                    elseif ($acabado_5Array->unidad_de_venta == '6') //mt2
                                    {
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $costo_unitario5=$acabado_5Valor;
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }   
                                    elseif ($acabado_5Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario5=$acabado_5MedidaMasValorVenta;
                                        $precio_total_5=$acabado_5MedidaMasValorVenta*$datoscantidad3;
                                        $cantidad_5=$datoscantidad3;
                                    }
                                    elseif ($acabado_5Array->unidad_de_venta == '8') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad3);
                                    }           
                                    elseif ($acabado_5Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }   
                                    elseif ($acabado_5Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($acabado_5Valor*$datoscantidad3);
                                        $cantidad_5=$datoscantidad3;
                                    }                                      
                                }    
                                if($fotomecanica->acabado_impresion_6=="17")
                                {
                                    $acabado_6="";
                                    $acabado_6Valor="";
                                    $acabado_6MedidaMasValorVenta="";
                                    $acabado_6Unitario="";
                                    $acabado_6UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_6Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_6);
                                    $acabado_6=$acabado_6Array->caracteristicas;
                                    $acabado_6UnidadVentaNombre=$acabado_6Array->unv; //Nombre unidad de venta
                                    $acabado_6Valor=$acabado_6Array->valor_venta; // ej: 52
                                    $acabado_6MedidaMasValorVenta=($tamano1*$tamano2*$acabado_6Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_6CostoFijo=$acabado_6Array->costo_fijo;		
                                    if ($acabado_6Array->unidad_de_venta == '1') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad3);
                                    }
                                    elseif ($acabado_6Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $costo_unitario6=$acabado_6Valor; 
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    }  
                                    elseif ($acabado_6Array->unidad_de_venta == '3') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad3);
                                    }                                    
                                    elseif ($acabado_6Array->unidad_de_venta == '4') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad3);
                                    }                                            
                                    elseif ($acabado_6Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($datoscantidad3*$acabado_5Valor);
                                        $cantidad_6=$datoscantidad3;
                                    }       
                                    elseif ($acabado_6Array->unidad_de_venta == '6') //mt2
                                    {
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $costo_unitario6=$acabado_6Valor;
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    }   
                                    elseif ($acabado_6Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario6=$acabado_6MedidaMasValorVenta;
                                        $precio_total_6=$acabado_6MedidaMasValorVenta*$datoscantidad3;
                                        $cantidad_6=$datoscantidad3;
                                    }
                                    elseif ($acabado_6Array->unidad_de_venta == '8') //cms
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad3);
                                    }           
                                    elseif ($acabado_6Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    } 
                                    elseif ($acabado_6Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($acabado_6Valor*$datoscantidad3);
                                        $cantidad_6=$datoscantidad3;
                                    }                                      

                                }        
               ?>
                <?php

                if($ing->piezas_adicionales == 'NO LLEVA')
                {
                    $piezaAdacionalNom1 ="No Lleva";
                    $piezaAdacionalValor1="&nbsp;";
                    $piezaAdacionalTotal1="&nbsp;";
                    $piezaAdacionalEmpresa1="&nbsp;";
                }else
                {
                    $piezasAdicionales = $this->piezas_adicionales_model->getPiezasAdicionalesPorNombreHojaCosto($ing->piezas_adicionales);
                    $piezaUnidadVentaNombre1=$piezasAdicionales->unv; //Nombre unidad de venta
                    $piezaAdacionalNom1 = $piezasAdicionales->piezas_adicionales;
                    $piezaAdacionalValor1= $piezasAdicionales->valor_venta;
                    $piezaAdacionalTotal1 = $datoscantidad3 * $piezaAdacionalValor1;
                    $piezaAdacionalEmpresa1= $hoja->piezas_adicionales1;
                }
                if($ing->piezas_adicionales2 == 'NO LLEVA')
                {
                    $piezaAdacionalNom2 ="No Lleva";
                    $piezaAdacionalValor2="&nbsp;";
                    $piezaAdacionalTotal2="&nbsp;";
                    $piezaAdacionalEmpresa2="&nbsp;";
                }else
                {
                    $piezasAdicionales = $this->piezas_adicionales_model->getPiezasAdicionalesPorNombreHojaCosto($ing->piezas_adicionales2);
                    $piezaUnidadVentaNombre2=$piezasAdicionales->unv; //Nombre unidad de venta                                    
                    $piezaAdacionalNom2 = $piezasAdicionales->piezas_adicionales;
                    $piezaAdacionalValor2= $piezasAdicionales->valor_venta;
                    $piezaAdacionalTotal2= $datoscantidad3 * $piezaAdacionalValor2;
                    $piezaAdacionalEmpresa2= $hoja->piezas_adicionales2;
                }
                if($ing->piezas_adicionales3 == 'NO LLEVA')
                {
                    $piezaAdacionalNom3 ="No Lleva";
                    $piezaAdacionalValor3="&nbsp;";
                    $piezaAdacionalTotal3="&nbsp;";
                    $piezaAdacionalEmpresa3="&nbsp;";
                }else
                {
                    $piezasAdicionales = $this->piezas_adicionales_model->getPiezasAdicionalesPorNombreHojaCosto($ing->piezas_adicionales3);
                    $piezaUnidadVentaNombre3=$piezasAdicionales->unv; //Nombre unidad de venta                                    
                    $piezaAdacionalNom3 = $piezasAdicionales->piezas_adicionales;
                    $piezaAdacionalValor3 =  $piezasAdicionales->valor_venta;
                    $piezaAdacionalTotal3= $datoscantidad3 * $piezaAdacionalValor3;;
                    $piezaAdacionalEmpresa3= $hoja->piezas_adicionales3;
                }
                ?>
                </table>
                                    <!--/trabajos externos-->
                                </td>
                            </tr>
                        </table>
                        <!--/materialidad-->
                    </div>
                    <div class="separador_10"></div>
                    <div>
                        <table id="tabla_detalle">
                         
                        <?php
                            if (($datoscantidad3>0) and ($ing->unidades_por_pliego>0))
                                $costoPlacaKilo=($datoscantidad3/$ing->unidades_por_pliego)+$sum;
                            else 
                                $costoPlacaKilo=0;
                            $valorPlacaKilo=($costoPlacaKilo*$tamano1*$tamano2*$tapaGramaje)/10000000;
                            $totalPlacaKilo=$valorPlacaKilo*$tapaPrecio;
							
                             if(sizeof($hoja)>=1 and $hoja->fecha)
                            {
                                $arreglo5=array
                                (
                                    "placa_kilo"=>$costoPlacaKilo,
                                    "total_pliegos"=>$valorPlacaKilo,
                                );
//                                $this->db->where('id', $hoja->id);
//                                $this->db->update("hoja_de_costos_datos",$arreglo5);
//                                echo $this->db->last_query();
                            }
			    if(sizeof($hoja)>=1)
                            {
                                $arreglokilo1=array
                                (
                                    "kilos_placa"=>$valorPlacaKilo,
                                 
                                );
//                                $this->db->where('id', $hoja->id);
//                                $this->db->update("hoja_de_costos_datos",$arreglokilo1);
//                                echo $this->db->last_query();
                            }
                        ?>
                        
                                  <?php
                                  $variableComplemento=$this->variables_cotizador_model->getVariablesCotizadorPorId(32);
                                        $valorTiraje=$variableComplemento->precio-$tiraje;
										
                                        if($valorTiraje>0)
                                        {
                                            if($fotomecanica->colores == 0)
                                            {
                                              $complemento=0;
                                            }else{
                                              $complemento=$valorTiraje;	
                                            }
                                            
											
                                        }else
                                        {
                                            $complemento=0;
                                        }
                                        
                                        
                                  ?>  
					<?php if($hoja->valor_externo!=0){ $externos_produccion=$externos_produccion+$hoja->valor_externo+$costo1+$costo2+$costo3+$costo4+$costo5+$costoa1+$costoa2+$costoa3+$costoa4+$costoa5; }else{  $externos_produccion=$precio_total_4+$precio_total_5+$precio_total_6+$costo1+$costo2+$costo3+$costo4+$costo5+$costoa1+$costoa2+$costoa3+$costoa4+$costoa5; } ?>			  

                    <?php
                        if($maquina=="Máquina Roland 800")
                        {
                           if (($datoscantidad3>0) and ($ing->unidades_por_pliego>0))
                                $costoOndaKilo=((($datoscantidad3/$ing->unidades_por_pliego)*1.04)+100)+4;
                            else 
                                $costoOndaKilo=0;                            
                        }else
                        {
                           if (($datoscantidad3>0) and ($ing->unidades_por_pliego>0))
                                $costoOndaKilo=(($datoscantidad3/$ing->unidades_por_pliego)+100)+4;
                            else 
                                $costoOndaKilo=0;                               
                        }
                        
                        if($fotomecanica->materialidad_datos_tecnicos == 'Sólo Cartulina')
                        {
                                $costoOndaKilo=0;
                                $valorOndaKilo=0;
                                $totalOndaKilo=0;
                                $valorCorte=0;

                        }else{
                            $valorOndaKilo=($costoOndaKilo*$tamano1*$tamano2*$GramosMetroCuadrado)/10000000;
                            $totalOndaKilo=$valorOndaKilo*$costo_kilo;
                            $valorCorte=$costoOndaKilo*4.5;
			}
                        
                        $costoOndaKilo1=((($datoscantidad3/$ing->unidades_por_pliego)*1.04)+100)+4;
                        $costoOndaKilo2=(($datoscantidad3/$ing->unidades_por_pliego)+$emplacado+$troquelado);
                        
                        if($costoOndaKilo1>$costoOndaKilo2){
                            $costoOndaKilo=$costoOndaKilo1;
                        }
                        if($costoOndaKilo1<$costoOndaKilo2){
                            $costoOndaKilo=$costoOndaKilo2;
                        }
                        
                    ?>
                    <?php
                        $variableEmplacado=$this->variables_cotizador_model->getVariablesCotizadorPorId(8);
                        $valorEmplacadado=($variableEmplacado->precio*$tamano1*$tamano2)/10000;
                        $totalEmplacado=$valorEmplacadado*$costoOndaKilo;
                    ?>
                    <?php
                    
                        if($fotomecanica->estan_los_moldes == 'NO LLEVA')
                        {
                            $variableMontajeMoldeTroquel=0;
                            $totalMontajeMolde=0;
                        }else
                        {
                            $variableRecargoMontaje=$this->variables_cotizador_model->getVariablesCotizadorPorId(31);
                            $variableMontajeMoldeTroquel=$this->variables_cotizador_model->getVariablesCotizadorPorId(10);
                            $totalMontajeMolde=$variableMontajeMoldeTroquel->precio*1.5;	
                        }                    

//                       
                    ?>
                    <?php
						if($fotomecanica->estan_los_moldes == 'NO LLEVA')
						{
                                                    $variableTroquelado=0;
                                                    $totalTroquelado=0;
						}else
						{
                                                    $variableTroquelado=$this->variables_cotizador_model->getVariablesCotizadorPorId(11);
                                                    $totalTroquelado=($costoOndaKilo*$variableTroquelado->precio)*1.5;	
						}                    
//					
                    ?>
                    <?php
                                        $variableDesgajado=$this->variables_cotizador_model->getVariablesCotizadorPorId(12);
                                        $totalDesgajado=$ing->piezas_totales_en_el_pliego*$variableDesgajado->precio*1.5*$costoOndaKilo;
                    ?>                                
 
                 
                                        <?php
                                           $variablePegado=$this->variables_cotizador_model->getVariablesCotizadorPorId(21);
                                           if(sizeof($hoja)==0) { 
                                               if ($datos->pegado_migrado==null || $datos->pegado_migrado=='' || $datos->pegado_migrado==0){
                                                   if($presupuesto->costo_pegado>=1){
                                                       $pegado_migrado=$presupuesto->costo_pegado;
                                                   }else{
                                                       $pegado_migrado=30; 
                                                   }
                                                }else{ 
                                                    $pegado_migrado=$datos->pegado_migrado;
                                                }
                                           }else{
                                                    $pegado_migrado=$hoja->pegado;
                                           }
                                           
                                           $totalPegado=$datoscantidad3*$pegado_migrado*$variablePegado->precio;
                                           
                                        ?>    
                     <?php
					 if(sizeof($hoja->pegado)>=1)
					 {
                                            $divisionPegado=$hoja->pegado/2;
                                            $totalDespacho=$divisionPegado*$datoscantidad3;
					 }
					 else
					 {
                                                $divisionPegado=$pegado_migrado/2;
                                                $totalDespacho=$divisionPegado*$datoscantidad3;
                                         }
	 
                     
                     ?>
                     <?php
					 
					 	
					 
					 //%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
					 
                    if($fotomecanica->condicion_del_producto == 'Nuevo') //nuevo 
                    {
                        if($fotomecanica->estan_los_moldes == 'NO')
			{
				$variableTroquel=$this->variables_cotizador_model->getVariablesCotizadorPorId(9);
                                $moldeTroquel=$variableTroquel->precio;
                        }
                        elseif($fotomecanica->estan_los_moldes == 'NO LLEVA')
                        {
                            $moldeTroquel=0;
                        }elseif($fotomecanica->estan_los_moldes == 'CLIENTE LO APORTA')
                        {
                            $moldeTroquel=0;
                        }
                    }
                    if($fotomecanica->condicion_del_producto == 'Repetición Sin Cambios') //
                    {

                    if($fotomecanica->estan_los_moldes == 'NO LLEVA')
                    {
                            $variableTroquel=$this->variables_cotizador_model->getVariablesCotizadorPorId(9);

                            $moldeTroquel=0;
                    }
                    }					
                    if($fotomecanica->condicion_del_producto == 'Repetición con Cambios') //
                    {
			$moldeTroquel=0;
                    }
                    if($fotomecanica->condicion_del_producto == 'Producto Genérico') //
                    {
			$moldeTroquel=0;
                    }
            						   
                     ?>
               
					 <?php
					 $variableEmplacado=$this->variables_cotizador_model->getVariablesCotizadorPorId(39);
					 if($fotomecanica->lleva_barniz == 'SI' and $fotomecanica->reserva_barniz == 'SI')
					 {
						 $otrosCaucho = $variableEmplacado->precio; 
					 }else
					 {
						$otrosCaucho = 0;
					 }
                                         if($fotomecanica->fot_cala_caucho== 'Si')
										 {
											 $otrosCaucho = 50000; 
										 }else
										 {
											$otrosCaucho = 0;
										 }
					 
					 ?>
	
					 <?php
					 if($piezaAdacionalEmpresa1 != 0)
					 {
						$TotalPiezasAdicionales = $TotalPiezasAdicionales + $piezaAdacionalEmpresa1;

					 }
					 else
					 {
						 	$TotalPiezasAdicionales = $TotalPiezasAdicionales + $piezaAdacionalTotal1;
						 
					 }
					 
					  if($piezaAdacionalEmpresa2 != 0)
					 {
						$TotalPiezasAdicionales = $TotalPiezasAdicionales + $piezaAdacionalEmpresa2;

					 }
					else
					 {
						 $TotalPiezasAdicionales = $TotalPiezasAdicionales + $piezaAdacionalTotal2;
						 
					 }
					 
					 
					  if( $piezaAdacionalEmpresa3 != 0)
					 {
						$TotalPiezasAdicionales = $TotalPiezasAdicionales + $piezaAdacionalEmpresa3;

					 }
					else
					 {
						 $TotalPiezasAdicionales = $TotalPiezasAdicionales + $piezaAdacionalTotal3;
						 
					 }
					 
					// $TotalPiezasAdicionales = $piezaAdacionalTotal1 + $piezaAdacionalTotal2 + $piezaAdacionalTotal3;
					 ?>
				
                     <?php
                     $totalProduccion=$costosporlacado+$complemento+$valorCorte+$totalEmplacado+$totalMontajeMolde+$totalTroquelado+$totalPegado+$totalDespacho+$tiraje+$moldeTroquel+$totalDesgajado+$externos_produccion+$otrosCaucho + $TotalPiezasAdicionales + $valor_extra + $valor_bv_maquina + $valor_acepeta_exce;

                     ?>
                   
                                            
                     <?php

                      $costoVentaValor=(($totalOndaKilo+$totalPlacaKilo+$totalPreImpresion+$totalProduccion)*$costoVenta->precio)/100;

                     ?>
                     <tr>
                                            <?php number_format($costoVentaValor,0,'','.')?></td>
                     </tr>
                     <?php
                      $costoAdministracionValor=(($totalOndaKilo+$totalPlacaKilo+$totalPreImpresion+$totalProduccion)*$costoAdministracion->precio)/100;
                      
                     ?>
                     <tr>
                                            <td class="celda_33"><?php number_format($costoAdministracionValor,0,'','.')?></td>
                                        </tr>
                                           <?php number_format($hoja->valor_extra*$datoscantidad3,0,'','.') ?>
                                
                     <?php
                      $totalCostosVarios=$costoAdministracionValor+$costoVentaValor+$hoja->costo_adicional+$valor_extra;
                     ?>
                     
                                    </table>
                                    <!--/producción-->
                                </td>
                            </tr>

                            </tr>
                            <?php
                            if(sizeof($hoja)>=1)
                            {
                                $arreglo6=array
                                (
                                    "onda_kilo"=>$costoOndaKilo,
                                );
//                                $this->db->where('id', $hoja->id);
//                                $this->db->update("hoja_de_costos_datos",$arreglo6);
                            }
							
							
							
                            ?>
                           
                           <?php $porcentajeTotalCorte =$totalPlacaKilo*7/100; number_format((($totalPlacaKilo*7)/(100)),0,'','.')?>
                             <?php

                                                                
								if($fotomecanica->materialidad_datos_tecnicos == 'Cartulina-cartulina')
								{
                                                                $costoPlacaKilo2 = ($datoscantidad3/$ing->unidades_por_pliego);

                                                                $cuatro_por_ciento = ($costoPlacaKilo2 / 100)* 4;
							
                                                                //if($costoPlacaKilo2 >= 1 and $costoPlacaKilo2 <= 100)
                                                                if($cuatro_por_ciento >= 1 and $cuatro_por_ciento <= 100)
                                                                {
                                                                        if($fotomecanica->colores==0){
                                                                        $agregado_a_apliegos = 25;}else{    
                                                                        $agregado_a_apliegos = 100;
                                                                        }
                                                                }

                                                                if($cuatro_por_ciento > 100)
                                                                {
                                                                        $agregado_a_apliegos = $cuatro_por_ciento;
                                                                }
                                                                $costoPlacaKilo2 = $costoPlacaKilo2 + $agregado_a_apliegos;
                                                                $valorPlacaKilo2 = ($costoPlacaKilo2*$tamano1*$tamano2*$tapaGramaje3)/10000000;
                                                                //$valorPlacaKilo2 = number_format($valorPlacaKilo2,0,'','.');
                                                                
                                                                $totalPlacaKilo2 = $valorPlacaKilo2*$tapaPrecio3;
							
                                                                ?>
                                                               <?php  number_format($valorPlacaKilo2,0,'','.');?>
                                                                <?php number_format($costoPlacaKilo2,0,'','.')?>
                                                                <?php number_format($totalPlacaKilo2,0,'','.')?>
                                                                <?php $totalMerma=$totalPlacaKilo2;		
								}
								else
								{
                                                                ?>		
                                                                <?php number_format($valorOndaKilo,0,'','.');?>
                                                                <?php number_format($costoOndaKilo,0,'','.')?>
                                                                <?php number_format($totalOndaKilo,0,'','.')?>
                                                                <?php $totalMerma=$totalOndaKilo;
								}
                                                                ?>
                            
                            <?php $porcentajeTotalMerma =$totalMerma*10/100; number_format((($totalMerma*10)/(100)),0,'','.')?>
                            
                            
                            <?php
							if($fotomecanica->materialidad_datos_tecnicos == 'Cartulina-cartulina')
								{
									$totalMateriaPrima= $totalPlacaKilo+$totalPlacaKilo2+$porcentajeTotalMerma+$porcentajeTotalCorte;
								}else
								{
									$totalMateriaPrima= $totalOndaKilo+$totalPlacaKilo+$porcentajeTotalMerma+$porcentajeTotalCorte;	
								}
                            
                            ?>
                      <tr>
                
                                <td class="celda_3"><?php number_format($totalMateriaPrima,0,'','.')?></td>
                            </tr>
                     
                            
                            <tr>
                                <?php  $coloresMontaje;?>
                                <td class="celda_3"><?php if($fotomecanica->condicion_del_producto=='Repetición Sin Cambios'){ '0';}else{ number_format($montajePreImpresion->precio,0,'','.');}?></td>
                                <?php if ($fotomecanica->condicion_del_producto=='Repetición Sin Cambios') { ?>
                                <td class="celda_3"><?php number_format(0,0,'','.')?></td>
                                <?php } else { ?>
                                <td class="celda_3"><?php number_format($cantidadMontaje,0,'','.')?></td>
                                <?php } ?>                                
                            </tr>
                        </table>
                         <table id="tabla_detalle">
                     
                         <?php
                        
                        if($fotomecanica->materialidad_datos_tecnicos == 'Cartulina-cartulina')
								{
									$totalMateriaPrima= $totalPlacaKilo+$totalPlacaKilo2+$porcentajeTotalMerma+$porcentajeTotalCorte;
								}else
								{
									$totalMateriaPrima= $totalOndaKilo+$totalPlacaKilo+$porcentajeTotalMerma+$porcentajeTotalCorte;	
								}
                        
                         ?>
                                <?php  number_format($totalMateriaPrima,0,'','.')?>
                                <?php  number_format($totalPreImpresion,0,'','.')?>
                                <?php  number_format($totalProduccion,0,'','.')?>
                                
                         <?php
                           $totalTotal=$totalMateriaPrima+$totalPreImpresion+$totalProduccion+$totalCostosVarios;                                               
                           $totalValorUnitario=$totalTotal/$datoscantidad3;

                          
                          if ($hoja->margen!="") {
                            $valorFinal=(($totalValorUnitario/(100-$hoja->margen))/100)*10000;
                          
                          }else{ 
                              if($datos->margen_migrado!=0 || $datos->margen_migrado!=null){
                                  $valorFinal=(($totalValorUnitario/(100-$datos->margen_migrado))/100)*10000;
                                  $valorFinal2xxx = $this->cotizaciones_model->CantidadPorXXX($id,$datoscantidad3,2);
                                  $valorFinal3xxx = $this->cotizaciones_model->CantidadPorXXX($id,$datoscantidad3,3);
                                  $valorFinal4xxx = $this->cotizaciones_model->CantidadPorXXX($id,$datoscantidad4,4);
                                  
                              }else{
                                  $valorFinal=(($totalValorUnitario/(100-15))/100)*10000;
                                  $valorFinal2xxx = $this->cotizaciones_model->CantidadPorXXX($id,$datoscantidad3,2);
                                  $valorFinal3xxx = $this->cotizaciones_model->CantidadPorXXX($id,$datoscantidad3,3);
                                  $valorFinal4xxx = $this->cotizaciones_model->CantidadPorXXX($id,$datoscantidad4,4);
                              }

                          }
                         ?>
<!--                          <tr>
                               
                                <td class="celda_3"><span class="subrayado">CANTIDAD 3</span></td>
                                <td class="celda_3"><?php //echo number_format($datoscantidad3,0,'','.')?></td>
                            </tr>                                
                          <tr>
                               
                                <td class="celda_3"><span class="subrayado">VALOR FINAL</span></td>
                                <td class="celda_3"><?php //echo number_format($valorFinal,0,'','.')?></td>
                            </tr>
                        -->
                <?php
                            $vcostoFinanciero=$this->variables_cotizador_model->getVariablesCotizadorPorId(33);
                            $recargoPorCantidadJusta=$this->variables_cotizador_model->getVariablesCotizadorPorId(37);
										
                            $valorFinanciado=$valorFinal*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
                            $valorFinanciado2=$valorFinal2xxx*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
                            $valorFinanciado3=$valorFinal3xxx*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
                            $valorFinanciado4=$valorFinal4xxx*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
				
                          //  echo "<h1>$valorFinal2xxx</h1>";
							
                            if($datos->acepta_excedentes=='NO')
                            {
                                $valorFinanciado=(((100+$recargoPorCantidadJusta->precio)/100)*$valorFinanciado);
                                $valorFinanciado2=(((100+$recargoPorCantidadJusta->precio)/100)*$valorFinanciado2);
                                $valorFinanciado3=(((100+$recargoPorCantidadJusta->precio)/100)*$valorFinanciado3);
                                $valorFinanciado4=(((100+$recargoPorCantidadJusta->precio)/100)*$valorFinanciado4);
                            }
                            
                            $var2 = (((($totalProduccion2+$totalDefi1+$totalPreImpresion)*0.085)+(($totalProduccion2+$totalDefi1+$totalPreImpresion)*0.085)+($totalProduccion2+$totalDefi1+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad3;
                            $var3 = (((($totalProduccion3+$totalDefi2+$totalPreImpresion)*0.085)+(($totalProduccion3+$totalDefi2+$totalPreImpresion)*0.085)+($totalProduccion3+$totalDefi2+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad3;
                            $var4 = (((($totalProduccion4+$totalDefi3+$totalPreImpresion)*0.085)+(($totalProduccion4+$totalDefi3+$totalPreImpresion)*0.085)+($totalProduccion4+$totalDefi3+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad4;
			    $cf2= $var2*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
			    $cf3= $var3*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
			    $cf4= $var4*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
			    $valorFinanciado2= $var2*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
			    $valorFinanciado3= $var3*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
			    $valorFinanciado4= $var4*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
                            
                            
                ?>
							<tr>
                               
<!--                                <td class="celda_3">VALOR FINANCIADO <?php// echo $forma_pago->forma_pago?> (<?php //echo $forma_pago->dias?>)</td>
                                <td class="celda_3"><?php// echo number_format($valorFinanciado,0,'','.')?> <input type="hidden" name="valor_financiado" value="<?php// echo $valorFinanciado?>" /> </td>
								-->
                            </tr>
                            <?php
                           
                                if(sizeof($hoja)==0)
                                {
                                    if(($fotomecanica->materialidad_datos_tecnicos=="Indefinido") or ($fotomecanica->materialidad_datos_tecnicos=="Microcorrugado") or ($fotomecanica->materialidad_datos_tecnicos=="Corrugado")  or ($fotomecanica->materialidad_datos_tecnicos=="Cartulina-cartulina"))
                                    {        
                                        $valorEmpresa=$datos->precio_migrado;
                                    }
                                    else {
                                        $valorEmpresa=$valorFinanciado;
                                    }                                    
                                }else
                                {
                                    
                                    if(($fotomecanica->materialidad_datos_tecnicos=="Indefinido") or ($fotomecanica->materialidad_datos_tecnicos=="Microcorrugado") or ($fotomecanica->materialidad_datos_tecnicos=="Corrugado")  or ($fotomecanica->materialidad_datos_tecnicos=="Cartulina-cartulina"))
                                    {        
                                        $valorEmpresa=$datos->precio_migrado;
                                        if($valorEmpresa==0){
                                            $valorEmpresa = $valorFinanciado;
                                        }else{
                                            $valorEmpresa = $datos->precio_migrado;
                                            
                                        }
                                    }
                                    else {
                                        $valorEmpresa=$valorFinanciado;
                                    }      
                                }
                          
                               
                            ?>
<!--                            <tr>
                              
                                <td class="celda_3">VALOR EMPRESA</td>
                                <td class="celda_3"><?php
                                    if (sizeof($hoja) == 0) {
                                        if ($valorEmpresa == 0) {
                                           // echo number_format($valorFinanciado, 0, '', '.');
                                            $valorEmpresa = $valorFinanciado;
                                        } else {
                                          //  echo number_format($valorEmpresa, 0, '', '.');
                                        }
                                    } else {
                                      //  echo number_format($hoja->valor_empresa, 0, '', '.');
                                    }
                                    ?><a href="<?php// echo base_url() ?>hoja/valor_empresa/<?php //echo $id ?>/<?php //echo $pagina ?>/<?php //echo $valorFinanciado; ?>" class="fancybox fancybox.ajax"><img src="<?php //echo base_url() ?>public/frontend/images/edit.png" class="img_16" /></a>
                                    <input type="hidden" name="valor_empresa" value="<?php
                                    if (sizeof($hoja) == 0) {
                                        if ($valorEmpresa == 0 || $valorEmpresa == null){
                                           // echo number_format($valorFinanciado, 0, '', '.');
                                            $valorEmpresa = $valorFinanciado;
                                        } else {
                                         //   echo number_format($valorEmpresa, 0, '', '.');
                                        }
                                    } else {
                                     //   echo $hoja->valor_empresa;
                                    }
                                    ?>" /></td>
                            </tr>-->
<!--                            <tr>
                            
                                <td class="celda_3">DÍAS DE ENTREGA</td>
                                <td class="celda_3"><?php if (sizeof($hoja) == 0) {
                               // echo '20';
                            } else {
                               // echo $hoja->dias_de_entrega;
                            } ?><a href="<?php //echo base_url() ?>hoja/dias/<?php //echo $id ?>/<?php// echo $pagina ?>" class="fancybox fancybox.ajax"><img src="<?php //echo base_url() ?>public/frontend/images/edit.png" class="img_16" /></a><input type="hidden" name="dias_de_entrega" value="<?php //echo $hoja->dias_de_entrega ?>" /></td>
                            </tr>-->
<!--                            <tr>
                                <td class="celda_3">VALOR UNITARIO</td>
                                <td class="celda_3"><?php// echo number_format($totalValorUnitario,0,'','.')?></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>-->
                            <tr>
                                <td class="celda_3">MARGEN</td>
                                        <?php
                                        if(sizeof($hoja)==0) { ?>
                                        <td class="celda_3"><?php if($datos->margen_migrado!=0 || $datos->margen_migrado!= null){echo $datos->margen_migrado;}else{echo "15";} ?> <a href="<?php echo base_url()?>hoja/margen/<?php echo $id?>/<?php echo $pagina?>" class="fancybox fancybox.ajax"><img src="<?php echo base_url()?>public/frontend/images/edit.png" class="img_16" /></a><input type="hidden" name="margen" value="<?php if($datos->margen_migrado!=0 || $datos->margen_migrado!= null){echo $datos->margen_migrado;}else{echo "15";} ?>" /></td>
					  <?php } else { ?>
                                        <td class="celda_3"><?php if($hoja->margen == null){echo '15';}else{echo $hoja->margen;}?> 
                                        <!--<a href="<?php //echo base_url()?>hoja/margen/<?php //echo $id?>/<?php //echo $pagina?>" class="fancybox fancybox.ajax"><img src="<?php //echo base_url()?>public/frontend/images/edit.png" class="img_16" /></a>-->
                                        <?php if($hoja->impreso!=1){echo "<a href='".base_url()."hoja/margen/".$id."/".$pagina."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";}else{echo "<a href='".base_url()."hoja2/margen/".$id."/".$pagina."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";} ?>
                                        <input type="hidden" name="margen" value="<?php echo $hoja->margen?>" /></td>
					<?php }  ?>                                     
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                        </table>
                        <div class="separador_20">&nbsp;</div>
                        <?php
                       
                       if(sizeof($hoja)==0) { 
                        $variablePegado=$this->variables_cotizador_model->getVariablesCotizadorPorId(21);
                        $totalPegado=$datoscantidad3*$pegado_migrado*$variablePegado->precio;                                               
                        $totalPegado2=$datoscantidad3*$pegado_migrado*$variablePegado->precio;                                               
                        $totalPegado3=$datoscantidad4*$pegado_migrado*$variablePegado->precio;                                               
                         } else { 
                        $variablePegado=$this->variables_cotizador_model->getVariablesCotizadorPorId(21);
                        $totalPegado=$datoscantidad3*$hoja->pegado*$variablePegado->precio;                                              
                        $totalPegado2=$datoscantidad3*$hoja->pegado*$variablePegado->precio;                                              
                        $totalPegado3=$datoscantidad4*$hoja->pegado*$variablePegado->precio;                                              
                        }
                        
                        
                     //   echo $pegado_migrado."<br>";
                        if(sizeof($hoja->pegado)>=1)
                         {
                            $divisionPegado=$hoja->pegado/2;
                            $totalDespacho2=$divisionPegado*$datoscantidad3;
                         }
                         else
                         {
                            $divisionPegado=$pegado_migrado/2;
                            $totalDespacho2=$divisionPegado*$datoscantidad3;
                           // echo $totalDespacho2;
                         }
                                         
                        if(sizeof($hoja->pegado)>=1)
                         {
                            $divisionPegado=$hoja->pegado/2;
                            $totalDespacho3=$divisionPegado*$datoscantidad3;
                         }
                         else
                         {
                             if ($datos->pegado_migrado=='')
                                $divisionPegado=$presupuesto->costo_pegado/2;
                             else
                                $divisionPegado=$datos->pegado_migrado/2;
                             $totalDespacho3=$divisionPegado*$datoscantidad3;	 
                         }
                        if(sizeof($hoja->pegado)>=1)
                         {
                            $divisionPegado=$hoja->pegado/2;
                            $totalDespacho4=$divisionPegado*$datoscantidad4;
                         }
                         else
                         {
                             if ($datos->pegado_migrado=='')
                                $divisionPegado=$presupuesto->costo_pegado/2;
                             else
                                $divisionPegado=$datos->pegado_migrado/2;
                             $totalDespacho4=$divisionPegado*$datoscantidad4;	 
                         }
                         
                         //*******************************************
                        $externos_produccion=0;
				if($fotomecanica->acabado_impresion_4=="17")
                                {
                                    $acabado_4="";
                                    $acabado_4Valor="";
                                    $acabado_4MedidaMasValorVenta="";
                                    $acabado_4Unitario="";
                                    $acabado_4UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_4Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_4);
                                    $acabado_4=$acabado_4Array->caracteristicas; // Nombre acabado
                                    $acabado_4UnidadVentaNombre=$acabado_4Array->unv; //Nombre unidad de venta
                                    $acabado_4Valor=$acabado_4Array->valor_venta; // ej: 52
                                    $acabado_4MedidaMasValorVenta=($tamano1*$tamano2*$acabado_4Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_4CostoFijo=$acabado_4Array->costo_fijo;	
                                    
                                    if ($acabado_4Array->unidad_de_venta == '1') //Metros
                                    {
                                        $costo_unitario4=$acabado_4MedidaMasValorVenta;
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad3);
                                        $cantidad_4=$datoscantidad3;
                                    }
                                    elseif ($acabado_4Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $costo_unitario4=$acabado_4Valor;
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }  
                                    elseif ($acabado_4Array->unidad_de_venta == '3') //tONELADA
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad3);
                                    }                                    
                                    elseif ($acabado_4Array->unidad_de_venta == '4') //caja de carton
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad3);
                                    }                                            
                                    elseif ($acabado_4Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($datoscantidad3*$acabado_4Valor);
                                        $cantidad_4=$datoscantidad3;
                                    }       
                                    elseif ($acabado_4Array->unidad_de_venta == '6') //cm2
                                    {
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $costo_unitario4=$acabado_4Valor;     
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }   
                                    elseif ($acabado_4Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario4=$acabado_4MedidaMasValorVenta;
                                        $precio_total_4=$acabado_4MedidaMasValorVenta*$datoscantidad3;
                                        $cantidad_4=$datoscantidad3;
                                    }
                                    elseif ($acabado_4Array->unidad_de_venta == '8') //cms
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad3);
                                    }           
                                    elseif ($acabado_4Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }     
                                    elseif ($acabado_4Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($acabado_4Valor*$datoscantidad3);
                                        $cantidad_4=$datoscantidad3;                                        
                                    }                                      
                                }
								
                                if($fotomecanica->acabado_impresion_5=="17")
                                {
                                    $acabado_5="";
                                    $acabado_5Valor="";
                                    $acabado_5MedidaMasValorVenta="";
                                    $acabado_5Unitario="";
                                    $acabado_5UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_5Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_5);
                                    $acabado_5=$acabado_5Array->caracteristicas;
                                    $acabado_5UnidadVentaNombre=$acabado_5Array->unv; //Nombre unidad de venta
                                    $acabado_5Valor=$acabado_5Array->valor_venta; // ej: 52
                                    $acabado_5MedidaMasValorVenta=($tamano1*$tamano2*$acabado_5Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_5CostoFijo=$acabado_5Array->costo_fijo;		
                                  if ($acabado_5Array->unidad_de_venta == '1') //mt2
                                    {
                                        $costo_unitario5=$acabado_5MedidaMasValorVenta;
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad3);                                      
                                        $cantidad_5=$datoscantidad3;
                                    }
                                    elseif ($acabado_5Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $costo_unitario5=$acabado_5Valor; 
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }    
                                    elseif ($acabado_5Array->unidad_de_venta == '3') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad3);
                                    }                                    
                                    elseif ($acabado_5Array->unidad_de_venta == '4') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad3);
                                    }                                            
                                    elseif ($acabado_5Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($datoscantidad3*$acabado_5Valor);
                                        $cantidad_5=$datoscantidad3;
                                    }       
                                    elseif ($acabado_5Array->unidad_de_venta == '6') //mt2
                                    {
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $costo_unitario5=$acabado_5Valor;
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }   
                                    elseif ($acabado_5Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario5=$acabado_5MedidaMasValorVenta;
                                        $precio_total_5=$acabado_5MedidaMasValorVenta*$datoscantidad3;
                                        $cantidad_5=$datoscantidad3;
                                    }
                                    elseif ($acabado_5Array->unidad_de_venta == '8') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad3);
                                    }           
                                    elseif ($acabado_5Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }   
                                    elseif ($acabado_5Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($acabado_5Valor*$datoscantidad3);
                                        $cantidad_5=$datoscantidad3;
                                    }                                      
                                }    
                                if($fotomecanica->acabado_impresion_6=="17")
                                {
                                    $acabado_6="";
                                    $acabado_6Valor="";
                                    $acabado_6MedidaMasValorVenta="";
                                    $acabado_6Unitario="";
                                    $acabado_6UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_6Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_6);
                                    $acabado_6=$acabado_6Array->caracteristicas;
                                    $acabado_6UnidadVentaNombre=$acabado_6Array->unv; //Nombre unidad de venta
                                    $acabado_6Valor=$acabado_6Array->valor_venta; // ej: 52
                                    $acabado_6MedidaMasValorVenta=($tamano1*$tamano2*$acabado_6Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_6CostoFijo=$acabado_6Array->costo_fijo;		
                                    if ($acabado_6Array->unidad_de_venta == '1') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad3);
                                    }
                                    elseif ($acabado_6Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $costo_unitario6=$acabado_6Valor; 
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    }  
                                    elseif ($acabado_6Array->unidad_de_venta == '3') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad3);
                                    }                                    
                                    elseif ($acabado_6Array->unidad_de_venta == '4') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad3);
                                    }                                            
                                    elseif ($acabado_6Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($datoscantidad3*$acabado_5Valor);
                                        $cantidad_6=$datoscantidad3;
                                    }       
                                    elseif ($acabado_6Array->unidad_de_venta == '6') //mt2
                                    {
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $costo_unitario6=$acabado_6Valor;
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    }   
                                    elseif ($acabado_6Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario6=$acabado_6MedidaMasValorVenta;
                                        $precio_total_6=$acabado_6MedidaMasValorVenta*$datoscantidad3;
                                        $cantidad_6=$datoscantidad3;
                                    }
                                    elseif ($acabado_6Array->unidad_de_venta == '8') //cms
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad3);
                                    }           
                                    elseif ($acabado_6Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    } 
                                    elseif ($acabado_6Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($acabado_6Valor*$datoscantidad3);
                                        $cantidad_6=$datoscantidad3;
                                    }                                      
									

                                }            
                        //*******************************************
              $externos_produccion3=$precio_total_4+$precio_total_5+$precio_total_6;
                        $externos_produccion=0;
				if($fotomecanica->acabado_impresion_4=="17")
                                {
                                    $acabado_4="";
                                    $acabado_4Valor="";
                                    $acabado_4MedidaMasValorVenta="";
                                    $acabado_4Unitario="";
                                    $acabado_4UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_4Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_4);
                                    $acabado_4=$acabado_4Array->caracteristicas; // Nombre acabado
                                    $acabado_4UnidadVentaNombre=$acabado_4Array->unv; //Nombre unidad de venta
                                    $acabado_4Valor=$acabado_4Array->valor_venta; // ej: 52
                                    $acabado_4MedidaMasValorVenta=($tamano1*$tamano2*$acabado_4Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_4CostoFijo=$acabado_4Array->costo_fijo;	
                                    
                                    if ($acabado_4Array->unidad_de_venta == '1') //Metros
                                    {
                                        $costo_unitario4=$acabado_4MedidaMasValorVenta;
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad4);
                                        $cantidad_4=$datoscantidad4;
                                    }
                                    elseif ($acabado_4Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $costo_unitario4=$acabado_4Valor;
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }  
                                    elseif ($acabado_4Array->unidad_de_venta == '3') //tONELADA
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad4);
                                    }                                    
                                    elseif ($acabado_4Array->unidad_de_venta == '4') //caja de carton
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad4);
                                    }                                            
                                    elseif ($acabado_4Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($datoscantidad3*$acabado_4Valor);
                                        $cantidad_4=$datoscantidad4;
                                    }       
                                    elseif ($acabado_4Array->unidad_de_venta == '6') //cm2
                                    {
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $costo_unitario4=$acabado_4Valor;     
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }   
                                    elseif ($acabado_4Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario4=$acabado_4MedidaMasValorVenta;
                                        $precio_total_4=$acabado_4MedidaMasValorVenta*$datoscantidad4;
                                        $cantidad_4=$datoscantidad4;
                                    }
                                    elseif ($acabado_4Array->unidad_de_venta == '8') //cms
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad4);
                                    }           
                                    elseif ($acabado_4Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }     
                                    elseif ($acabado_4Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($acabado_4Valor*$datoscantidad4);
                                        $cantidad_4=$datoscantidad4;                                        
                                    }                                      
                                }
								
                                if($fotomecanica->acabado_impresion_5=="17")
                                {
                                    $acabado_5="";
                                    $acabado_5Valor="";
                                    $acabado_5MedidaMasValorVenta="";
                                    $acabado_5Unitario="";
                                    $acabado_5UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_5Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_5);
                                    $acabado_5=$acabado_5Array->caracteristicas;
                                    $acabado_5UnidadVentaNombre=$acabado_5Array->unv; //Nombre unidad de venta
                                    $acabado_5Valor=$acabado_5Array->valor_venta; // ej: 52
                                    $acabado_5MedidaMasValorVenta=($tamano1*$tamano2*$acabado_5Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_5CostoFijo=$acabado_5Array->costo_fijo;		
                                  if ($acabado_5Array->unidad_de_venta == '1') //mt2
                                    {
                                        $costo_unitario5=$acabado_5MedidaMasValorVenta;
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad4);                                      
                                        $cantidad_5=$datoscantidad4;
                                    }
                                    elseif ($acabado_5Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $costo_unitario5=$acabado_5Valor; 
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }    
                                    elseif ($acabado_5Array->unidad_de_venta == '3') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad4);
                                    }                                    
                                    elseif ($acabado_5Array->unidad_de_venta == '4') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad4);
                                    }                                            
                                    elseif ($acabado_5Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($datoscantidad4*$acabado_5Valor);
                                        $cantidad_5=$datoscantidad4;
                                    }       
                                    elseif ($acabado_5Array->unidad_de_venta == '6') //mt2
                                    {
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $costo_unitario5=$acabado_5Valor;
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }   
                                    elseif ($acabado_5Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario5=$acabado_5MedidaMasValorVenta;
                                        $precio_total_5=$acabado_5MedidaMasValorVenta*$datoscantidad4;
                                        $cantidad_5=$datoscantidad4;
                                    }
                                    elseif ($acabado_5Array->unidad_de_venta == '8') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad4);
                                    }           
                                    elseif ($acabado_5Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }   
                                    elseif ($acabado_5Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($acabado_5Valor*$datoscantidad4);
                                        $cantidad_5=$datoscantidad4;
                                    }                                      
                                }    
                                if($fotomecanica->acabado_impresion_6=="17")
                                {
                                    $acabado_6="";
                                    $acabado_6Valor="";
                                    $acabado_6MedidaMasValorVenta="";
                                    $acabado_6Unitario="";
                                    $acabado_6UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_6Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_6);
                                    $acabado_6=$acabado_6Array->caracteristicas;
                                    $acabado_6UnidadVentaNombre=$acabado_6Array->unv; //Nombre unidad de venta
                                    $acabado_6Valor=$acabado_6Array->valor_venta; // ej: 52
                                    $acabado_6MedidaMasValorVenta=($tamano1*$tamano2*$acabado_6Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_6CostoFijo=$acabado_6Array->costo_fijo;		
                                    if ($acabado_6Array->unidad_de_venta == '1') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad4);
                                    }
                                    elseif ($acabado_6Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $costo_unitario6=$acabado_6Valor; 
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    }  
                                    elseif ($acabado_6Array->unidad_de_venta == '3') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad4);
                                    }                                    
                                    elseif ($acabado_6Array->unidad_de_venta == '4') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad4);
                                    }                                            
                                    elseif ($acabado_6Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($datoscantidad4*$acabado_5Valor);
                                        $cantidad_6=$datoscantidad4;
                                    }       
                                    elseif ($acabado_6Array->unidad_de_venta == '6') //mt2
                                    {
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $costo_unitario6=$acabado_6Valor;
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    }   
                                    elseif ($acabado_6Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario6=$acabado_6MedidaMasValorVenta;
                                        $precio_total_6=$acabado_6MedidaMasValorVenta*$datoscantidad4;
                                        $cantidad_6=$datoscantidad4;
                                    }
                                    elseif ($acabado_6Array->unidad_de_venta == '8') //cms
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad4);
                                    }           
                                    elseif ($acabado_6Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    } 
                                    elseif ($acabado_6Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($acabado_6Valor*$datoscantidad4);
                                        $cantidad_6=$datoscantidad4;
                                    }                                      
									

                                }            
                        //*******************************************
              $externos_produccion4=$precio_total_4+$precio_total_5+$precio_total_6;
                         //*******************************************
                        $externos_produccion=0;
				if($fotomecanica->acabado_impresion_4=="17")
                                {
                                    $acabado_4="";
                                    $acabado_4Valor="";
                                    $acabado_4MedidaMasValorVenta="";
                                    $acabado_4Unitario="";
                                    $acabado_4UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_4Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_4);
                                    $acabado_4=$acabado_4Array->caracteristicas; // Nombre acabado
                                    $acabado_4UnidadVentaNombre=$acabado_4Array->unv; //Nombre unidad de venta
                                    $acabado_4Valor=$acabado_4Array->valor_venta; // ej: 52
                                    $acabado_4MedidaMasValorVenta=($tamano1*$tamano2*$acabado_4Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_4CostoFijo=$acabado_4Array->costo_fijo;	
                                    
                                    if ($acabado_4Array->unidad_de_venta == '1') //Metros
                                    {
                                        $costo_unitario4=$acabado_4MedidaMasValorVenta;
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad3);
                                        $cantidad_4=$datoscantidad3;
                                    }
                                    elseif ($acabado_4Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $costo_unitario4=$acabado_4Valor;
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }  
                                    elseif ($acabado_4Array->unidad_de_venta == '3') //tONELADA
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad3);
                                    }                                    
                                    elseif ($acabado_4Array->unidad_de_venta == '4') //caja de carton
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad3);
                                    }                                            
                                    elseif ($acabado_4Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($datoscantidad3*$acabado_4Valor);
                                        $cantidad_4=$datoscantidad3;
                                    }       
                                    elseif ($acabado_4Array->unidad_de_venta == '6') //cm2
                                    {
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $costo_unitario4=$acabado_4Valor;     
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }   
                                    elseif ($acabado_4Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario4=$acabado_4MedidaMasValorVenta;
                                        $precio_total_4=$acabado_4MedidaMasValorVenta*$datoscantidad3;
                                        $cantidad_4=$datoscantidad3;
                                    }
                                    elseif ($acabado_4Array->unidad_de_venta == '8') //cms
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad3);
                                    }           
                                    elseif ($acabado_4Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }     
                                    elseif ($acabado_4Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($acabado_4Valor*$datoscantidad3);
                                        $cantidad_4=$datoscantidad3;                                        
                                    }                                      
                                }
								
                                if($fotomecanica->acabado_impresion_5=="17")
                                {
                                    $acabado_5="";
                                    $acabado_5Valor="";
                                    $acabado_5MedidaMasValorVenta="";
                                    $acabado_5Unitario="";
                                    $acabado_5UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_5Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_5);
                                    $acabado_5=$acabado_5Array->caracteristicas;
                                    $acabado_5UnidadVentaNombre=$acabado_5Array->unv; //Nombre unidad de venta
                                    $acabado_5Valor=$acabado_5Array->valor_venta; // ej: 52
                                    $acabado_5MedidaMasValorVenta=($tamano1*$tamano2*$acabado_5Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_5CostoFijo=$acabado_5Array->costo_fijo;		
                                  if ($acabado_5Array->unidad_de_venta == '1') //mt2
                                    {
                                        $costo_unitario5=$acabado_5MedidaMasValorVenta;
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad3);                                      
                                        $cantidad_5=$datoscantidad3;
                                    }
                                    elseif ($acabado_5Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $costo_unitario5=$acabado_5Valor; 
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }    
                                    elseif ($acabado_5Array->unidad_de_venta == '3') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad3);
                                    }                                    
                                    elseif ($acabado_5Array->unidad_de_venta == '4') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad3);
                                    }                                            
                                    elseif ($acabado_5Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($datoscantidad3*$acabado_5Valor);
                                        $cantidad_5=$datoscantidad3;
                                    }       
                                    elseif ($acabado_5Array->unidad_de_venta == '6') //mt2
                                    {
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $costo_unitario5=$acabado_5Valor;
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }   
                                    elseif ($acabado_5Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario5=$acabado_5MedidaMasValorVenta;
                                        $precio_total_5=$acabado_5MedidaMasValorVenta*$datoscantidad3;
                                        $cantidad_5=$datoscantidad3;
                                    }
                                    elseif ($acabado_5Array->unidad_de_venta == '8') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad3);
                                    }           
                                    elseif ($acabado_5Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }   
                                    elseif ($acabado_5Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($acabado_5Valor*$datoscantidad3);
                                        $cantidad_5=$datoscantidad3;
                                    }                                      
                                }    
                                if($fotomecanica->acabado_impresion_6=="17")
                                {
                                    $acabado_6="";
                                    $acabado_6Valor="";
                                    $acabado_6MedidaMasValorVenta="";
                                    $acabado_6Unitario="";
                                    $acabado_6UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_6Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_6);
                                    $acabado_6=$acabado_6Array->caracteristicas;
                                    $acabado_6UnidadVentaNombre=$acabado_6Array->unv; //Nombre unidad de venta
                                    $acabado_6Valor=$acabado_6Array->valor_venta; // ej: 52
                                    $acabado_6MedidaMasValorVenta=($tamano1*$tamano2*$acabado_6Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_6CostoFijo=$acabado_6Array->costo_fijo;		
                                    if ($acabado_6Array->unidad_de_venta == '1') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad3);
                                    }
                                    elseif ($acabado_6Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $costo_unitario6=$acabado_6Valor; 
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    }  
                                    elseif ($acabado_6Array->unidad_de_venta == '3') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad3);
                                    }                                    
                                    elseif ($acabado_6Array->unidad_de_venta == '4') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad3);
                                    }                                            
                                    elseif ($acabado_6Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($datoscantidad3*$acabado_5Valor);
                                        $cantidad_6=$datoscantidad3;
                                    }       
                                    elseif ($acabado_6Array->unidad_de_venta == '6') //mt2
                                    {
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $costo_unitario6=$acabado_6Valor;
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    }   
                                    elseif ($acabado_6Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario6=$acabado_6MedidaMasValorVenta;
                                        $precio_total_6=$acabado_6MedidaMasValorVenta*$datoscantidad3;
                                        $cantidad_6=$datoscantidad3;
                                    }
                                    elseif ($acabado_6Array->unidad_de_venta == '8') //cms
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad3);
                                    }           
                                    elseif ($acabado_6Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    } 
                                    elseif ($acabado_6Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($acabado_6Valor*$datoscantidad3);
                                        $cantidad_6=$datoscantidad3;
                                    }                                      
									

                                }            
                        //*******************************************
              $externos_produccion2=$precio_total_4+$precio_total_5+$precio_total_6;
                                            
            $tira3=((($datoscantidad3/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio )*($fotomecanica->colores+$barniz2)."<br>";
            $tira4=((($datoscantidad3/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio)*($fotomecanica->colores+$barniz2)*(1*$recargo800Array->precio/100);
            $tirajetotal2=$tira3+$tira4."<br>";
            
            $tira5=((($datoscantidad3/$ing->unidades_por_pliego)+$sum)*$factor_rango3+$base_imprenta->precio )*($fotomecanica->colores+$barniz2)."<br>";
            $tira6=((($datoscantidad3/$ing->unidades_por_pliego)+$sum)*$factor_rango3+$base_imprenta->precio)*($fotomecanica->colores+$barniz2)*(1*$recargo800Array->precio/100);
            $tirajetotal3=$tira5+$tira6."<br>";
            
            $tira7=((($datoscantidad4/$ing->unidades_por_pliego)+$sum)*$factor_rango4+$base_imprenta->precio )*($fotomecanica->colores+$barniz2)."<br>";
            $tira8=((($datoscantidad4/$ing->unidades_por_pliego)+$sum)*$factor_rango4+$base_imprenta->precio)*($fotomecanica->colores+$barniz2)*(1*$recargo800Array->precio/100);
            $tirajetotal4=$tira7+$tira8."<br>";
            //exit();
            //valor corte para los 4
            $valorCorte2=(((($datoscantidad3/$ing->unidades_por_pliego)*1.04)+104)*4.5);
            $valorCorte3=(((($datoscantidad3/$ing->unidades_por_pliego)*1.04)+104)*4.5);
            $valorCorte4=(((($datoscantidad4/$ing->unidades_por_pliego)*1.04)+104)*4.5);
            
           $costoOnda2=(((($datoscantidad3/$ing->unidades_por_pliego)*1.04)+104))."<br>";
           $costoOnda3=(((($datoscantidad3/$ing->unidades_por_pliego)*1.04)+104))."<br>";
           $costoOnda4=(((($datoscantidad4/$ing->unidades_por_pliego)*1.04)+104))."<br>";
           
            if($fotomecanica->estan_los_moldes == 'NO LLEVA')
	    {
            $variableTroquelado=0;
            $totalTroquelado=0;
            }else
            {
            $variableTroquelado=$this->variables_cotizador_model->getVariablesCotizadorPorId(11);
            $totalTroquelado2=($costoOnda2*$variableTroquelado->precio)*1.5;	
            }     
            if($fotomecanica->estan_los_moldes == 'NO LLEVA')
	    {
            $variableTroquelado=0;
            $totalTroquelado=0;
            }else
            {
            $variableTroquelado=$this->variables_cotizador_model->getVariablesCotizadorPorId(11);
            $totalTroquelado3=($costoOnda3*$variableTroquelado->precio)*1.5;	
            }     
            if($fotomecanica->estan_los_moldes == 'NO LLEVA')
	    {
            $variableTroquelado=0;
            $totalTroquelado=0;
            }else
            {
            $variableTroquelado=$this->variables_cotizador_model->getVariablesCotizadorPorId(11);
            $totalTroquelado4=($costoOnda4*$variableTroquelado->precio)*1.5;	
            }     
           // valor del emplacado 
           $variableEmplacado=$this->variables_cotizador_model->getVariablesCotizadorPorId(8);
           $valorEmplacadado=($variableEmplacado->precio*$tamano1*$tamano2)/10000;
           $totalEmplacado2=$valorEmplacadado*$costoOnda2."<br>";
           $totalEmplacado3=$valorEmplacadado*$costoOnda3."<br>";
           $totalEmplacado4=$valorEmplacadado*$costoOnda4."<br>";
           
                            $dos=($datoscantidad3/$ing->unidades_por_pliego)+$sum2."<br />";
                            $tres=($datoscantidad3/$ing->unidades_por_pliego)+$sum3."<br />";
                            $cuatro=($datoscantidad4/$ing->unidades_por_pliego)+$sum4."<br />";
                          
                            $valorPlacaKilo2=(($dos*$tamano1*$tamano2*$tapaGramaje)/10000000)."<br />";
                            $valorPlacaKilo3=(($tres*$tamano1*$tamano2*$tapaGramaje)/10000000)."<br />";
                            $valorPlacaKilo4=(($cuatro*$tamano1*$tamano2*$tapaGramaje)/10000000)."<br />";
                            
                            $totalPlacaKilo2=$valorPlacaKilo2*$materialidad_1->precio."<br />";
                            $totalPlacaKilo3=$valorPlacaKilo3*$materialidad_1->precio."<br />";
                            $totalPlacaKilo4=$valorPlacaKilo4*$materialidad_1->precio."<br />";
                            
                            //$v2= number_format((($datoscantidad3/$ing->unidades_por_pliego)*1.04)+104,0,'','.');
                            $v2= number_format((($datoscantidad3/$ing->unidades_por_pliego)*1.04)+104,0,'','.');
                            $v3= number_format((($datoscantidad3/$ing->unidades_por_pliego)*1.04)+104,0,'','.');
                            $v4= number_format((($datoscantidad4/$ing->unidades_por_pliego)*1.04)+104,0,'','.');
                            
                            $OndaKilo2=number_format((($v2*$tamano1*$tamano2*$GramosMetroCuadrado)/10000),0,'','.')."<br />";
                            $OndaKilo3=number_format((($v3*$tamano1*$tamano2*$GramosMetroCuadrado)/10000),0,'','.')."<br />";
                            $OndaKilo4=number_format((($v4*$tamano1*$tamano2*$GramosMetroCuadrado)/10000),0,'','.')."<br />";
                            
                            $vt2=number_format(((($v2*$tamano1*$tamano2*$GramosMetroCuadrado)/10000)*$costo_kilo),0,'','.');
                            $vt3=number_format(((($v3*$tamano1*$tamano2*$GramosMetroCuadrado)/10000)*$costo_kilo),0,'','.')."<br />";
                            $vt4=number_format(((($v4*$tamano1*$tamano2*$GramosMetroCuadrado)/10000)*$costo_kilo),0,'','.')."<br />";
                            //echo number_format($totalPlacaKilo2,0,'','.')."<br>";
                            
                           $totalDefi1=$totalPlacaKilo2+((($v2*$tamano1*$tamano2*$GramosMetroCuadrado)/10000)*$costo_kilo);
                            $totalDefi2=$totalPlacaKilo3+((($v3*$tamano1*$tamano2*$GramosMetroCuadrado)/10000)*$costo_kilo);
                            $totalDefi3=$totalPlacaKilo4+((($v4*$tamano1*$tamano2*$GramosMetroCuadrado)/10000)*$costo_kilo);
                            
                            
                            
                            $variableDesgajado=$this->variables_cotizador_model->getVariablesCotizadorPorId(12);
                            $totalDesgajado2=$ing->piezas_totales_en_el_pliego*$variableDesgajado->precio*1.5*$costoOnda2;
                            $totalDesgajado3=$ing->piezas_totales_en_el_pliego*$variableDesgajado->precio*1.5*$costoOnda3;
                            $totalDesgajado4=$ing->piezas_totales_en_el_pliego*$variableDesgajado->precio*1.5*$costoOnda4;
                            $TotalPiezasAdicionales2=$datoscantidad3*$piezaAdacionalValor1;
                            $TotalPiezasAdicionales3=$datoscantidad3*$piezaAdacionalValor1;
                            $TotalPiezasAdicionales4=$datoscantidad4*$piezaAdacionalValor1;
                           
                             if(sizeof($hoja)==0) { 
                              if($datos->margen_migrado==0){
                                 $margen=15; 
                              }else{
                                 $margen= $datos->margen_migrado;
                              }
				 } else {if($hoja->margen == null){$margen=15;}
                                 else{
                                 $margen=$hoja->margen;}
			         }  
                            $totalProduccion2=$costosporlacado2+$complemento+$valorCorte2+$totalEmplacado2+$totalMontajeMolde+$totalTroquelado2+$totalPegado+$totalDespacho2+$tirajetotal2+$moldeTroquel+$totalDesgajado2+$externos_produccion2+$otrosCaucho + $TotalPiezasAdicionales2 + $valor_extra + $valor_bv_maquina + $valor_acepeta_exce."<br>";
                            //$totalProduccion3=$costosporlacado3+$complemento+$valorCorte3+$totalEmplacado3+$totalMontajeMolde+$totalTroquelado3+$totalPegado2+$totalDespacho3+$tirajetotal3+$moldeTroquel+$totalDesgajado3+$externos_produccion3+$otrosCaucho + $TotalPiezasAdicionales3 + $valor_extra + $valor_bv_maquina + $valor_acepeta_exce."<br>";
                            //$totalProduccion4=$costosporlacado4+$complemento+$valorCorte4+$totalEmplacado4+$totalMontajeMolde+$totalTroquelado4+$totalPegado3+$totalDespacho4+$tirajetotal4+$moldeTroquel+$totalDesgajado4+$externos_produccion4+$otrosCaucho + $TotalPiezasAdicionales4 + $valor_extra + $valor_bv_maquina + $valor_acepeta_exce."<br>";

                                                if($mdt=='Cartulina-cartulina' || $mdt=='Sólo Cartulina'){
                                                    $des = calcularDespacho($valorPlacaKilo, $valorPlacaKilo2, $retiro, $mdt, $fuerasantiago, $distancia);  
                                                }else{
                                                    $des = calcularDespacho($valorPlacaKilo, $valorOndaKilo, $retiro, $mdt, $fuerasantiago, $distancia);
                                                }                                           
                                                                
                                   $totalProduccion3 = $totalProduccion3+$des[0];                     
                            ?>
                       
                        <table id="tabla_detalle" border="0">
                            <tr>
                                <td width="150px">PALETS:&nbsp;<?php echo $des[1];?></td>
                                <td>VALOR:&nbsp;<?php echo $des[0]; ?></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td width="150px">TIRAJE 3</td>
                                <td><?php if($mostrarboton != 1){echo number_format($tirajetotal3,0,'','.');}else{if($hoja->tiraje3!=""){$tirajetotal3=$hoja->tiraje3; echo number_format($hoja->tiraje3,0,'','.');}else{echo number_format($tirajetotal3,0,'','.');}}?>
                                <?php if($hoja->impreso!=1 && $mostrarboton == 1){echo "<a href='".base_url()."hoja/tiraje3/".$id."/4' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";}else{echo "<a href='".base_url()."hoja2/tiraje3/".$id."/4' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";} ?>
                                </td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td width="150px">&nbsp;</td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td width="150px">Total Materia Prima</td>
                                <td><?php echo number_format($totalMateriaPrima,0,",",".") ?></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>Total Pre Impresion</td>
                                <td><?php echo number_format($totalPreImpresion,0,",",".")?></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>Total Produccion</td>
                                <td><?php echo number_format($totalProduccion3,0,",",".") ?></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>&nbsp;</td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>Sub Total</td>
                                <td><?php echo number_format($totalProduccion3+$totalPreImpresion+$totalMateriaPrima,0,",",".") ?></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>Total Costos Varios</td>
                                <td><?php echo number_format(($totalProduccion3+$totalPreImpresion+$totalMateriaPrima)*0.17,0,",",".") ?></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>&nbsp;</td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>Total</td>
                                <td><?php echo number_format(($totalProduccion3+$totalPreImpresion+$totalMateriaPrima)*0.17+($totalProduccion3+$totalPreImpresion+$totalMateriaPrima),0,",",".") ?></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>&nbsp;</td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                        </table>
                        <?php 
                        $totalTotal3=($totalProduccion3+$totalPreImpresion+$totalMateriaPrima)*0.17+($totalProduccion3+$totalPreImpresion+$totalMateriaPrima);
                        $totalValorUnitario3=$totalTotal3/$datoscantidad3;

                          if ($hoja->margen!="") {
                            $valorFinal3=(($totalValorUnitario3/(100-$hoja->margen))/100)*10000;
                            $valorFinanciado3=$valorFinal3*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;            
                          }else{ 
                              if($datos->margen_migrado!=0 || $datos->margen_migrado!=null){
                                  $valorFinal3=(($totalValorUnitario3/(100-$datos->margen_migrado))/100)*10000;
                              }else{
                                  $valorFinal3=(($totalValorUnitario3/(100-15))/100)*10000;
                              }

                          }
                          if($datos->acepta_excedentes=='NO')
                            {
                                $valorFinanciado3=(((100+$recargoPorCantidadJusta->precio)/100)*$valorFinanciado3);
                            }
                        ?>
                        <table id="tabla_detalle">
                            
                            <tr>
                                <td class="celda_3"><h5>CANTIDAD 3</h5></td>
                                <td class="celda_3"><h5><?php if($datoscantidad3 == 1){ echo 0;}else{echo number_format($datoscantidad3,0,"",".");}?> 
                                <!--<a href="<?php //echo base_url()?>hoja/cantidad3/<?php//echo $id?>/3" class="fancybox fancybox.ajax"><img src="<?php //echo base_url()?>public/frontend/images/edit.png" class="img_16" /></a></td>-->
                                <?php if($hoja->impreso!=1){echo "<a href='".base_url()."hoja/cantidad3/".$id."/3' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";}else{echo "<a href='".base_url()."hoja2/cantidad3/".$id."/3' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a></h5>";} ?>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"><?php if($datoscantidad3 == 1){ echo 0;}else{ number_format($datoscantidad3,0,"",".");}?></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"><?php if($datoscantidad4 == 1){ echo 0;}else{ number_format($datoscantidad4,0,"",".");}?></td>
                            </tr>
						
							
                            <tr>
                                <td class="celda_3">VALOR FINAL</td>
                                <td class="celda_3"><?php if($datoscantidad3 == 1){ echo 0;}else{
                                echo number_format($valorFinal3,0,'','.');}?></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"><?php if($datoscantidad3 == 1){ echo 0;}else{
                                 number_format(((((($totalProduccion3+$totalDefi2+$totalPreImpresion)*0.085)+(($totalProduccion3+$totalDefi2+$totalPreImpresion)*0.085)+($totalProduccion3+$totalDefi2+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad3),0,'','.');}?></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"><?php if($datoscantidad4 == 1){ echo 0;}else{
                                 number_format(((((($totalProduccion4+$totalDefi3+$totalPreImpresion)*0.085)+(($totalProduccion4+$totalDefi3+$totalPreImpresion)*0.085)+($totalProduccion4+$totalDefi3+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad4),0,'','.');}?></td>
                            </tr>
                            <?php
				if(sizeof($hoja)==0)
                                {
                                    $valorEmpresa2=number_format($valorFinanciado2,0,'','.');
                                    $valorEmpresa3=number_format($valorFinanciado3,0,'','.');
                                    $valorEmpresa4=number_format($valorFinanciado4,0,'','.');
                                }else
                                {
                                    $valorEmpresa2=$hoja->valor_empresa_3;
                                    $valorEmpresa3=$hoja->valor_empresa_3;
                                    $valorEmpresa4=$hoja->valor_empresa_4;
                                }
								

				if($hoja->valor_empresa_3)
                                {
                                $valorEmpresa_3=$valorFinanciado3;  
                          
									
                                    $arregloVEmpresa=array
                                    (
                                            "valor_empresa_3"=>$valorEmpresa_3,
                                    );

                                //    $this->db->where('id', $hoja->id);
                                //    $this->db->update("hoja_de_costos_datos",$arregloVEmpresa);
                                }
								
//				if($hoja->valor_empresa_3 ==0)
//                                {                                    
//                                    $valorEmpresa_3=$valorFinanciado3;  
//									
//                                    $arregloVEmpresa=array
//                                    (
//                                            "valor_empresa_3"=>$valorEmpresa_3,
//                                    );
//
//                                    $this->db->where('id', $hoja->id);
//                                    $this->db->update("hoja_de_costos_datos",$arregloVEmpresa);                                  
//                                }
								
//								if($hoja->valor_empresa_4 ==0)
//                                {
//                                    $valorEmpresa_4=$valorFinanciado4;  
//
//                                    $arregloVEmpresa=array
//                                    (
//                                            "valor_empresa_4"=>$valorEmpresa_4,
//                                    );
//
//                                    $this->db->where('id', $hoja->id);
//                                    $this->db->update("hoja_de_costos_datos",$arregloVEmpresa);   
//                                }
								
								
                            ?>
                            
							<?php
							$var2 = (((($totalProduccion2+$totalDefi1+$totalPreImpresion)*0.085)+(($totalProduccion2+$totalDefi1+$totalPreImpresion)*0.085)+($totalProduccion2+$totalDefi1+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad3;
                                                        $var3 = (((($totalProduccion3+$totalDefi2+$totalPreImpresion)*0.085)+(($totalProduccion3+$totalDefi2+$totalPreImpresion)*0.085)+($totalProduccion3+$totalDefi2+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad3;
                                                        $var4 = (((($totalProduccion4+$totalDefi3+$totalPreImpresion)*0.085)+(($totalProduccion4+$totalDefi3+$totalPreImpresion)*0.085)+($totalProduccion4+$totalDefi3+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad4;
							$cf2= $var2*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
							$cf3= $var3*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
							$cf4= $var4*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
							?>
							
                            <tr>
                                <td class="celda_3">VALOR FINANCIERO 3 (<?php echo "Dias: ".$forma_pago->dias?>)</td>
                                <td class="celda_3">
                                <?php //echo number_format((((($vcostoFinanciero->precio/30)*30)+100)/100)*((((($totalProduccion2+$totalDefi1+$totalPreImpresion)*0.085)+(($totalProduccion2+$totalDefi1+$totalPreImpresion)*0.085)+($totalProduccion2+$totalDefi1+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad3),0,'','.') ?>
                                <?php //echo number_format($cf2,0,'','.') ?>
                                <?php echo number_format($valorFinanciado3,0,'','.') ?>
                                </td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">
                                <?php //echo number_format((((($vcostoFinanciero->precio/30)*30)+100)/100)*((((($totalProduccion3+$totalDefi2+$totalPreImpresion)*0.085)+(($totalProduccion3+$totalDefi2+$totalPreImpresion)*0.085)+($totalProduccion3+$totalDefi2+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad3),0,'','.') ?>
                                <?php  number_format($cf3,0,'','.') ?>
                                </td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">
                                <?php //echo number_format((((($vcostoFinanciero->precio/30)*30)+100)/100)*((((($totalProduccion4+$totalDefi3+$totalPreImpresion)*0.085)+(($totalProduccion4+$totalDefi3+$totalPreImpresion)*0.085)+($totalProduccion4+$totalDefi3+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad4),0,'','.') ?>
                                <?php  number_format($cf4,0,'','.') ?>
                                </td>
                            </tr><input type="hidden" id="vf3" name="vf3" value="<?php echo $valorFinanciado3; ?>"/>
                            <?php
                            $vfinanciero2=number_format((((($vcostoFinanciero->precio/30)*30)+100)/100)*((((($totalProduccion2+$totalDefi1+$totalPreImpresion)*0.085)+(($totalProduccion2+$totalDefi1+$totalPreImpresion)*0.085)+($totalProduccion2+$totalDefi1+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad3),0,'','.');
                            $vfinanciero3=number_format((((($vcostoFinanciero->precio/30)*30)+100)/100)*((((($totalProduccion3+$totalDefi2+$totalPreImpresion)*0.085)+(($totalProduccion3+$totalDefi2+$totalPreImpresion)*0.085)+($totalProduccion3+$totalDefi2+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad3),0,'','.');
                            $vfinanciero4=number_format((((($vcostoFinanciero->precio/30)*30)+100)/100)*((((($totalProduccion4+$totalDefi3+$totalPreImpresion)*0.085)+(($totalProduccion4+$totalDefi3+$totalPreImpresion)*0.085)+($totalProduccion4+$totalDefi3+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad4),0,'','.');
                            
                            ?>
                            <tr>
                                <td class="celda_3"><h5>VALOR EMPRESA 3</h5></td>
                                <!--<td class="celda_3"><?php //if(sizeof($hoja)==0){if($datoscantidad3 == 1){echo 0;}else{if( $valorEmpresa2 == 0){echo number_format($valorFinanciado2,0,'','.');}else{echo $vfinanciero2;}}}else{echo number_format($hoja->valor_empresa_3,0,'','.');}?> <a href="<?php //echo base_url()?>hoja/valor_empresa_3/<?php //echo $id?>/2" class="fancybox fancybox.ajax"><img src="<?php //echo base_url()?>public/frontend/images/edit.png" class="img_16" /></a></td>-->
                                 <td class="celda_3"><h5><?php
                                    if (sizeof($hoja) == 0) {
                                        if ($valorEmpresa == 0) {
                                            echo number_format($valorFinanciado3, 0, '', '.');
                                            $valorEmpresa = $valorFinanciado3;
                                        } else {
                                            echo number_format($valorEmpresa, 0, '', '.');
                                        }
                                    } else {
                                        echo number_format($hoja->valor_empresa_3, 0, '', '.');
                                        $valorEmpresa = $hoja->valor_empresa_3;
                                    }
                                    ?>
                                     <!--<a href="<?php //echo base_url() ?>hoja/valor_empresa_3/<?php //echo $id ?>/<?php// echo $pagina ?>/<?php //echo $valorFinanciado; ?>" class="fancybox fancybox.ajax"><img src="<?php echo base_url() ?>public/frontend/images/edit.png" class="img_16" /></a>-->
                                     <?php if($hoja->impreso!=1){echo "<a href='".base_url()."hoja/valor_empresa_3/".$id."/".$pagina."/".$valorFinanciado."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";}else{echo "<a href='".base_url()."hoja2/valor_empresa_3/".$id."/".$pagina."/".$valorFinanciado."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";} ?>
                                     <input type="hidden" name="valor_empresa_3" value="<?php
                                    if (sizeof($hoja) == 0) {
                                        if ($valorEmpresa == 0 || $valorEmpresa == null){
                                            echo number_format($valorFinanciado, 0, '', '.');
                                            $valorEmpresa = $valorFinanciado;
                                        } else {
                                            echo number_format($valorEmpresa, 0, '', '.');
                                        }
                                    } else {
                                        echo $hoja->valor_empresa_3;
                                        $valorEmpresa = $hoja->valor_empresa_3;
                                    }
                                    ?>" /></h5></td><input type="hidden" id="ve3" name="ve3" value="<?php echo $valorEmpresa; ?>"/>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"><?php if(sizeof($hoja)==0){if($datoscantidad3 == 1){echo 0;}else{if( $valorEmpresa3 == 0){ number_format($valorFinanciado3,0,'','.');}else{ $vfinanciero3;}}}else{ number_format($hoja->valor_empresa_3,0,'','.');}?> </td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"><?php if(sizeof($hoja)==0){if($datoscantidad4 == 1){echo 0;}else{if( $valorEmpresa4 == 0){ number_format($valorFinanciado4,0,'','.');}else{ $vfinanciero4;}}}else{ number_format($hoja->valor_empresa_4,0,'','.');}?> </td>
								 
                            </tr>
                            <input type="hidden" name="valor_empresa_3" value="<?php if($datoscantidad3 == 1){
                                echo 0;
                            }
                            else{
                                    if( $valorEmpresa2 == 0){
                                        echo str_replace ( ".", "",$valorFinanciado2);
                                    }else{
                                        //echo str_replace ( ".", "",$vfinanciero2);
                                        echo str_replace ( ".", "",$valorEmpresa2);
                                    }
                                }?>" />
                            <input type="hidden" name="valor_empresa_3" value="<?php if($datoscantidad3 == 1){
                                echo 0;
                            }
                            else{
                                    if( $valorEmpresa3 == 0){
                                        echo str_replace ( ".", "",$valorFinanciado3);
                                    }else{
                                        //echo str_replace ( ".", "",$vfinanciero3);
                                        echo str_replace ( ".", "",$valorEmpresa3);
                                    }
                                }?>" />
                            <input type="hidden" name="valor_empresa_4" value="<?php if($datoscantidad4 == 1){
                                echo 0;
                            }
                            else{
                                    if( $valorEmpresa4 == 0){
                                        echo str_replace ( ".", "",$valorFinanciado4);
                                    }else{
                                        //echo str_replace ( ".", "",$vfinanciero4);
                                        echo str_replace ( ".", "",$valorEmpresa4);
                                    }
                                }?>" />
<!--                            <input type="hidden" name="valor_empresa_3" value="<?php// echo str_replace ( '.', '', $valorEmpresa2);?>" />
                            <input type="hidden" name="valor_empresa_3" value="<?php// echo str_replace ( '.', '', $valorEmpresa3);?>" />
                            <input type="hidden" name="valor_empresa_4" value="<?php// echo str_replace ( '.', '', $valorEmpresa4);?>" />-->
                        </table>
                        <div class="separador_10">&nbsp;</div>
                        <table id="tabla_detalle">
						
                            <tr>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3">MATERIAL</td>
                                <td class="celda_3">GRAMAJE</td>
                                <td class="celda_3">TOTAL PLIEGOS</td>
                                <td class="celda_3"></td>
                                <td class="celda_3">TOTAL KILOS</td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3"><?php echo $fotomecanica->materialidad_datos_tecnicos;?></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"></td>
                                <td class="celda_3"></td>
                                <td class="celda_3"></td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
							<?php 
                            if($fotomecanica->materialidad_datos_tecnicos == 'Cartulina-cartulina')
                                    {
							?>				
											
							<tr>
                                <td class="celda_3">TAPA</td>
                                <td class="celda_3"><?php echo $tapaNombre?> (<?php echo number_format($tapaPrecio,0,'','.')?>)</td>
                                <td class="celda_3"><?php echo number_format($costoPlacaKilo,0,'','.') ?></td>
                                <td class="celda_3"></td>
                                <td class="celda_3"><?php echo number_format($valorPlacaKilo,0,'','.');?></td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3">Tapa (Respaldo)</td>
                                <td class="celda_3"><?php echo $tapaNombre2?> (<?php echo number_format($tapaPrecio2,0,'','.')?>)</td>
                                <td class="celda_3"><?php echo number_format($costoPlacaKilo2,0,'','.') ?></td>
                                <td class="celda_3"></td>
                                <td class="celda_3"><?php echo number_format($valorPlacaKilo2,0,'','.');?></td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3"></td>
                                <td class="celda_3"></td>
                                <td class="celda_3"></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"></td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>				
											
							<?php				
				}else{

                                    if($fotomecanica->materialidad_datos_tecnicos == 'Corrugado')
                                    {

                                        $variable_cotizador=$this->variables_cotizador_model->getVariablesCotizadorPorId(25);
                                    }
                                    if($fotomecanica->materialidad_datos_tecnicos == 'Microcorrugado'){
                                    
                                        $variable_cotizador=$this->variables_cotizador_model->getVariablesCotizadorPorId(24);	
                                    }			
                                    if($fotomecanica->materialidad_datos_tecnicos == 'Indefinido'){

                                        $variable_cotizador=$this->variables_cotizador_model->getVariablesCotizadorPorId(24);	
                                    }	                                    
//                                    exit($fotomecanica->materialidad_datos_tecnicos."aquiii");       
                                    if (($datoscantidad3>0) and ($ing->unidades_por_pliego>0))
                                        $cantidad_cajas = ($datoscantidad3 / $ing->unidades_por_pliego) + 104;                                    
                                    else $cantidad_cajas = 104;                                    
                                   

                                    $kilosOnda =  ($tamano1 * $tamano2 * $ondaGramaje * $cantidad_cajas * (($variable_cotizador->precio * 10 + 1000)/1000)) / 10000000;
                                    
                                    $kilosLiner =  ($tamano1 * $tamano2 * $linerGramaje * $cantidad_cajas ) / 10000000;				
//                                    echo $kilosLiner ."=  (".$tamano1." * ".$tamano2." * ".$linerGramaje." * ".$cantidad_cajas." ) / 10000000";
    
                                    if(sizeof($hoja)>=1)
                                    {
                                        $arreglokilo2=array
                                        (
                                            "kilos_onda"=>$kilosOnda,
                                        );
                               
                                        $this->db->where('id', $hoja->id);
                                        $this->db->update("hoja_de_costos_datos",$arreglokilo2);
                                 
                                      

                                        $arreglokilo3=array
                                        (
                                            "kilos_liner"=>$kilosLiner,
                                        );
                                        $this->db->where('id', $hoja->id);
                                        $this->db->update("hoja_de_costos_datos",$arreglokilo3);
//                                        echo $hoja->id."---jaime----";
//                                        exit(print_r($arreglokilo2));                                           
                                    }
                                    ?>				
										
										
										
							<tr>
                                <td class="celda_3">TAPA</td>
                                <td class="celda_3"><?php echo $tapaNombre?> (<?php echo number_format($tapaPrecio,0,'','.')?>)</td>
                                <td class="celda_3">pliego_tapa</td>
                                <td class="celda_3"></td>
                                <td class="celda_3"><?php echo number_format($valorPlacaKilo,0,'','.');?></td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3">ONDA</td>
                                <td class="celda_3"><?php echo $ondaNombre?> (<?php echo number_format($ondaPrecio,0,'','.')?>)</td>
                                <td class="celda_3">pliego_ondas</td>
                                <td class="celda_3"></td>
                                <td class="celda_3"><?php echo number_format($kilosOnda,0,'','.');?></td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3">LINER</td>
                                <td class="celda_3"><?php echo $linerNombre?> (<?php echo number_format($linerPrecio,0,'','.')?>)</td>
                                <td class="celda_3">pliego_liner</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"><?php echo number_format($kilosLiner,0,'','.');?></td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>	
							<?php				
										}
							?>
                          
							<?php
									if($fotomecanica->materialidad_datos_tecnicos == 'Cartulina-cartulina')
										{
							?>	
							<tr>
                                <td class="celda_3">FECHA TAPA: <?php echo fecha_con_slash($tapaFecha)?></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3">FECHA Tapa (Respaldo): <?php echo fecha_con_slash($tapaFecha2)?></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3"></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"></td>
                                <td class="celda_3"></td>
                            </tr>

							<?php
										}else{
							?>											
                            <tr>
                                <td class="celda_3">FECHA TAPA: <?php echo fecha_con_slash($tapaFecha)?></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3">FECHA ONDA: <?php echo fecha_con_slash($ondaFecha)?></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3">FECHA LINER: <?php echo fecha_con_slash($linerFecha)?></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">240</td>
                                <td class="celda_3">449.71</td>
                            </tr>
							
						<?php
						}
                                                
                                                //***************ehndz********************
                                                
                                                 if($totalTrabajosInternos=='No'){$totalTrabajosInternos=0;}else{$totalTrabajosInternos=$totalTrabajosInternos*50;}
                                                 if($totalTrabajosExternos=='No'){$totalTrabajosExternos="No";}else{$cantidadTrabajosExternos=$totalTrabajosExternos/50;}
                                                 //***************ehndz********************
                                                 //echo "<h1>".$totalTrabajosExternos."</h1>";exit();
						?>		
                        </table>    
                        <div class="separador_20"></div>
                        <table id="tabla_detalle">
                            <tr>
                                <td class="celda_2">

                                </td>
                                <td class="celda_1">&nbsp;</td>
                                <td class="celda_60 valign_top" rowspan="5">
                                    <!--mermas-->                          
                                    <table id="tabla_produccion">
                                        <tr>
                                            <td colspan="4">Tabla de Patrón de MERMAS Microonda TIPO E + Tapa por <?php echo $datoscantidad3; ?> = <?php echo ($datoscantidad3 / $ing->unidades_por_pliego); ?> Pliegos -- Total Colores <?php echo ($fotomecanica->colores); ?> Barniz: <?php echo ($fotomecanica->fot_lleva_barniz); ?>
                                            Trabajos Externos: <?php echo $cantidadTrabajosExternos; ?></td>
                                        </tr>
                                        <tr>
                                            <td>Imprenta</td>
                                            <!--<td>Ultra</td>-->
                                            <td>Roland:800</td>
                                            <td>Roland:800</td>
                                            <td>&nbsp;</td>
                                            <td>&nbsp;</td>
                                        </tr>
                                        <tr>
                                            <td>Color 1-2-3</td>
                                            <td>400</td>
                                            <td>400</td>
                                            <td>&nbsp;</td>
                                            <td><?php echo $color1?></td>
                                        </tr>
                                        <tr>
                                            <td>Color &gt; 3</td>
                                            <td><?php if($datos->vb_maquina == 'SI' or $datos->acepta_excedentes == 'NO'){echo '150';}else{echo '100';}?></td>
                                            <td><?php if($datos->vb_maquina == 'SI' or $datos->acepta_excedentes == 'NO'){echo '150';}else{echo '100';}?></td>
                                            <td>* Color</td>
                                            <td><?php echo $color2?></td>
                                        </tr>
                                        <tr>
                                            <td>Cantidad</td>
                                            <td>30</td>
                                            <td>30</td>
                                            <td>Cantidad &gt; 5.000 * c/5.000</td>
                                            <td><?php echo $can1?></td>
                                        </tr>
<!--                                        <tr>
                                            <td>&nbsp;</td>
                                            <td>050</td>
                                            <td>050</td>
                                            <td>Cantidad &gt; 5.000 * c/5.000</td>
                                            <td><?php// echo $can2?></td>
                                        </tr>-->
                                        <tr>
                                            <td>Barniz</td>
                                            <td>100</td>
                                            <td>100</td>
                                            <td>Primeros 1.000</td>
                                            <td><?php echo $bar1 ?></td>
                                        </tr>
                                        <tr>
                                            <td>&nbsp;</td>
                                            <td>01</td>
                                            <td>01</td>
                                            <td>por cada 1.000 extra</td>
                                            <td><?php echo $bar2?></td>
                                        </tr>
                                        <tr>
                                            <td>Trabajo externo</td>
                                            <td>050</td>
                                            <td>050</td>
                                            <td>una sola vez</td>					
                                            <td><?php echo $externo?></td>
                                        </tr>
                                        <tr>
                                            <td>Micro/Micro</td>
                                            <td>030</td>
                                            <td>030</td>
                                            <td>una sola vez</td>
                                            <td><?php echo $micromicro?></td>
                                        </tr>
                                        <tr>
                                            <td>Cart/Cart</td>
                                            <td>030</td>
                                            <td>030</td>
                                            <td>una sola vez</td>
                                            <td><?php echo $cartulina?></td>
                                        </tr>
                                        <tr>
                                            <td>Tamaños Normales</td>
                                            <td>&nbsp;</td>
                                            <td>&nbsp;</td>
                                            <td>&nbsp;</td>
                                            <td>&nbsp;</td>
                                        </tr>
                                        <tr>
                                            <td>Emplacado</td>
                                            <td>50</td>
                                            <td>50</td>
                                            <td>primeros 1.000</td>
                                            <td><?php echo $emplacado_fijo?></td>
                                        </tr>
                                        <tr>
                                            <td></td>
                                            <td><?php echo $emplacado_merma?></td>
                                            <td><?php echo $emplacado_merma?></td>
                                            <td>por cada 1000</td>
                                            <td><?php echo $emplacado?></td>
                                        </tr>
                                        <tr>
                                            <td>Troquelado</td>
                                            <td>40</td>
                                            <td>40</td>
                                            <td>Los primeros 1.000</td>
                                            <td><?php echo $troquelado_fijo ?></td>
                                        </tr>
                                        <tr>
                                            <td></td>
                                            <td><?php echo $troquelado_merma ?></td>
                                            <td><?php echo $troquelado_merma ?></td>
                                            <td>por cada 1.000</td>
                                            <td><?php echo $troquelado?></td>
                                        </tr>
                                        <tr>
                                            <td colspan="5"><hr class="hr_punteada_corto" /></td>
                                        </tr>
                                        <tr>
                                            <td>&nbsp;</td>
                                            <td>&nbsp;</td>
                                            <td>&nbsp;</td>
                                            <td>&nbsp;</td>
                                            <td><?php echo number_format($sum,0,'','.')?></td>
                                        </tr>
                                    </table>
                                    <!--/mermas-->
                                </td>
                            </tr>
                            <tr>
                                <td class="celda_2">&nbsp;</td>
                                <td class="celda_1">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_2">&nbsp;</td>
                                <td class="celda_1">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_2"></td>
                                <td class="celda_1">&nbsp;</td>
                            </tr>
                        </table>
                        <div class="separador_20"></div>

                    </div>
                
            
<!----------------elvis hernandez---------------->
<!----------------elvis hernandez-cantidad-4---------------->
<?php
if($fotomecanica->estan_los_moldes=="NO LLEVA" or $fotomecanica->estan_los_moldes=="CLIENTE LO APORTA" or $fotomecanica->materialidad_datos_tecnicos == 'Sólo Cartulina')
        {
            $troquelado=0;
            $troquelado_fijo=0;
            $troquelado_merma=$mermaTroqueladoArray->precio;
        }else
        {

            $mermaTroqueladoArray=$this->variables_cotizador_model->getVariablesCotizadorPorId(36);
            if (($datoscantidad4>0) and ($ing->unidades_por_pliego>0))
                $troquelado=$datoscantidad4/$ing->unidades_por_pliego;
            else 
                $troquelado=0;
                $troquelado= $troquelado / 1000; /*Resultado de emplacado dividido por 1000*/                                                              
                $troquelado= ($troquelado * 1000)+ 0.5; /*Emplacado multiplicado por 1000 y el resultado de la multiplicacion se suman 0.5*/                          
                $troquelado= $troquelado/ 1000; /*emplacado dividido por 1000*/                      
                $troquelado = $troquelado +0.499; /*emplacado mas 0.499: Resultado emplacado es en decimales*/                                                               
                $EnteroTroquelado = number_format($troquelado,0,'',''); /* Guardar entero del emplacado*/                          
                $troquelado = $EnteroTroquelado * $mermaTroqueladoArray->precio; /*Multiplicar entero del emplacado por 15*/
                $troquelado_fijo = 40;
                $troquelado_merma=$mermaTroqueladoArray->precio;
        }
if($ing->materialidad_datos_tecnicos=="Sólo Cartulina")
        {
           $emplacado=0;
           $emplacado_fijo=0;
           $emplacado_merma = $mermaEmplacadoArray->precio;
        }else
        {
             $cantidad_1=$datoscantidad4/$ing->unidades_por_pliego;
             $mermaEmplacadoArray=$this->variables_cotizador_model->getVariablesCotizadorPorId(35);
             $emplacado= $cantidad_1; /*Valor x dividido por Unidad por pliego*/

                $emplacado= $emplacado / 1000; /*Resultado de emplacado dividido por 1000*/                                       

                $emplacado= ($emplacado * 1000)+ 0.5; /*Emplacado multiplicado por 1000 y el resultado de la multiplicacion se suman 0.5*/                                  

            $emplacado= $emplacado/ 1000; /*emplacado dividido por 1000*/                   

                $emplacado = $emplacado +0.499; /*emplacado mas 0.499: Resultado emplacado es en decimales*/                                                               

                $Entero = number_format($emplacado,0,'',''); /* Guardar entero del emplacado*/                         

                $emplacado_fijo = 50; /*Multiplicar entero del emplacado por 15*/
                $emplacado = $Entero * $mermaEmplacadoArray->precio; /*Multiplicar entero del emplacado por 15*/
                $emplacado_merma = $mermaEmplacadoArray->precio;
                
        }
if(($fotomecanica->fot_lleva_barniz!='') && ($fotomecanica->fot_lleva_barniz!='Nada'))
         {
            $cantidadBarniz=$datoscantidad4-1000;
            if($cantidadBarniz<1000)
            {
                if($maquina=="Máquina Roland 800")
                {
                    //$bar1=150;
                    $bar1=100;
                    $bar2=0;
                }else
                {
                    $bar1=100;
                    $bar2=0;
                }
            }else
            {
			
               //echo $datoscantidad1/$ing->unidades_por_pliego;exit;
               $enteroBarniz=($datoscantidad4/$ing->unidades_por_pliego);
		//echo $enteroBarniz;exit();
               if($enteroBarniz < 1000)
			   {
				//$bar1=150;
				$bar1=100;
                                $bar2=0;   
			   }else
			   {
               //$enteroBarniz=(((number_format($enteroBarniz,0,'','')/1000)+1)-2)*10;
               $enteroBarniz=number_format((((($enteroBarniz/1000)+1)-2)*10),0,'','');
               $bar1=100;
               //$bar2=$enteroBarniz;
               $bar2=$bar6=number_format(((($datoscantidad4/$ing->unidades_por_pliego)-1000)/1000*1),0,'','');
			   
               
                           }
            }

         }else
         {
                $bar1=0;
                $bar2=0;
                }
                
        $cantidad_4=$datoscantidad4/$ing->unidades_por_pliego;       
        if($cantidad_4>5000)
         {
            $vecescan1 = $cantidad_4/5000;
            if($vecescan1 >1)
            {
               $can1= 30 * $vecescan1;
            }else{
               $can1=30;
            }
            if($vecescan1 >1)
            {
                //$entero=number_format(($cantidad_1/5000)+0.5,0,'','');
                $can2= 50 * $vecescan1;
            }else
            {
                $can2=50;
            }
         }else
         {
            $can1=0;
            $can2=0;
         }
         
$sum=$color1+$color2+$can1+$bar1+$bar2+$externo+$micromicro+$cartulina+$emplacado+$troquelado+$emplacado_fijo+$troquelado_fijo;
$sumerma4=$sum;
if(sizeof($hoja)>=1)
        {
            $arreglomerma4=array
                (
                    "total_merma4"=>$sumerma4,
                );
                $this->db->where('id', $hoja->id);
                $this->db->update("hoja_de_costos_datos",$arreglomerma4);
        }
?>
<input type="hidden" name="total_merma4" value="<?php echo $sum ?>">
<div class="container fuente">
    
            <header>
            
                    <div>
                    <hr class="hr_punteada" />
                    </div>
<!--                    <div id="cantidad">
                    Valor por : <?php //echo number_format($datoscantidad4,0,"",".")?> <a href="<?php //echo base_url()?>hoja/cantidad/<?php //echo $id?>/<?php //echo $pagina?>" class="fancybox fancybox.ajax"><img src="<?php //echo base_url()?>public/frontend/images/edit.png" class="img_16" /></a>
                    </div>-->
                  
                    <!--separador 20-->
                    <div class="separador_20"></div>
                    <!--/separador 20-->
                    <div>
                        <!--materialidad-->
                       
                        <table>
                            <tr>
                                <td class="celda_5 izquierda">
                                <?php
                                 switch($fotomecanica->materialidad_datos_tecnicos)
                                  {
                                    case 'Indefinido':
                                        $materialidad_1=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_placa1);
                                        $materialidad_2=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_onda2);
                                        $materialidad_3=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_liner3);
                                        $materialidad_4="No Aplica";
                                        $variable_cotizador=$this->variables_cotizador_model->getVariablesCotizadorPorId(24);
                                        $variable_cotizador2=$this->variables_cotizador_model->getVariablesCotizadorPorId(40);
                                        $base_imprenta=$this->variables_cotizador_model->getVariablesCotizadorPorId(6);
                                        $formula=$materialidad_1->gramaje+($materialidad_1->gramaje*($variable_cotizador->precio/100))+$materialidad_3->gramaje;
                                        if ($materialidad_2->precio>0) $materialidad_precio2=($materialidad_2->precio/1000); else $materialidad_precio2=0;
                                        if ($materialidad_3->precio>0) $materialidad_precio3=($materialidad_3->precio/1000); else $materialidad_precio3=0;
                                        if ($materialidad_2->gramaje>0) $materialidad_gramaje2=($materialidad_2->gramaje/1000); else $materialidad_gramaje2=0;
                                        $costo_kilo=0;
//                                        echo "costo_kilo=(((".$materialidad_2->gramaje."*(".$materialidad_2->precio."/1000)+((".$materialidad_2->gramaje."*(".$variable_cotizador->precio."/100)*".$materialidad_2->precio."/1000))+".$materialidad_3->gramaje."*".$materialidad_3->precio."/1000)/(".$materialidad_2->gramaje."+(".$materialidad_2->gramaje."*(".$variable_cotizador->precio."/100))+".$materialidad_3->gramaje.")))*1000";           
                                        if ($materialidad_2->gramaje>0)
                                            $costo_kilo=((($materialidad_2->gramaje*($materialidad_2->precio/1000)+(($materialidad_2->gramaje*($variable_cotizador->precio/100)*$materialidad_2->precio/1000))+$materialidad_3->gramaje*$materialidad_3->precio/1000)/($materialidad_2->gramaje+($materialidad_2->gramaje*($variable_cotizador->precio/100))+$materialidad_3->gramaje)))*1000;           
					else 	
                                            $costo_kilo=0;
//                                        echo $materialidad_3->tipo."======".$materialidad_3->reverso;
										
                                        if($materialidad_3->tipo == 14 and  $materialidad_3->reverso == 'Blanca')//valdivia
                                        {
//                                                echo "1==============";
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(44);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;
                                        }

                                        elseif($materialidad_3->tipo == 15 and  $materialidad_3->reverso == 'Blanca')//maule
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(45);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;                                                 
                                        }
                                        elseif($materialidad_3->tipo == 1 and  $materialidad_3->reverso == 'Blanca') //Cartulina Importada
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(43);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;                                                 
                                        }
                                        elseif($materialidad_3->tipo == 5 and  $materialidad_3->reverso == 'Blanco') // papel reverso blanco
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(42);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;                                                 
                                        }
                                        elseif($materialidad_3->tipo == 3 and  $materialidad_3->reverso == 'Blanco') // papel reverso blanco
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(42);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;                                                 
                                        }
                                        elseif($materialidad_3->tipo == 4 and  $materialidad_3->reverso == 'Café') // papel reverso cafe
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(41);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;                                                 
                                        }
                                        else
                                        $costo_kilo_obtenido=140;
                                        $costo_kilo=$costo_kilo+$costo_kilo_obtenido;
                                        if(($fotomecanica->fot_lleva_barniz=='Nada')||($fotomecanica->fot_lleva_barniz==''))
                                        {
                                            $barniz2=0;
                                        }else
                                        {
                                            $barniz2=1;
                                        }

                                        if($maquina=="Máquina Roland 800")
                                         {
                                            $tira1=((($datoscantidad4/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio )*($fotomecanica->colores+$barniz2);
                                            $recargo800Array=$this->variables_cotizador_model->getVariablesCotizadorPorId(34);
                                            $tira2=((($datoscantidad4/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio)*($fotomecanica->colores+$barniz2)*(1*$recargo800Array->precio/100);
                                            //echo $recargo800Array->precio."<br>".$tira1."<br>".$tira2;exit;
                                             
                                         }else
                                         {
                                            $tiraje=((($datoscantidad4/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio )*($fotomecanica->colores+$barniz2);  
                                         
                                            
                                         }   
                                        
                                         
                                         
                                        if ($materialidad_2->gramaje>0)
                                            $GramosMetroCuadrado=$materialidad_2->gramaje+($materialidad_2->gramaje*($variable_cotizador->precio/100))+$materialidad_3->gramaje;
					else 	
                                            $GramosMetroCuadrado=0;                                         
                                        $recargoGramosDeAlmidon=$this->variables_cotizador_model->getVariablesCotizadorPorId(30);
                                        $GramosMetroCuadrado=$GramosMetroCuadrado+$recargoGramosDeAlmidon->precio;
                                        if(sizeof($hoja)>=1)
                                        {
                                            $arreglo54=array
                                                (
                                                    "gramos_metro_cuadrado"=>$GramosMetroCuadrado,
                                                );
                                                $this->db->where('id', $hoja->id);
                                                $this->db->update("hoja_de_costos_datos",$arreglo54);
                                        }
                                        if ($materialidad_2->gramaje>0)
                                            $costoMonotapaPorMetro2=$materialidad_2->gramaje*($materialidad_2->precio/1000)+(($materialidad_2->gramaje*($variable_cotizador->precio/100)*$materialidad_2->precio/1000)+$materialidad_3->gramaje*$materialidad_3->precio/1000);
					else 	
                                            $costoMonotapaPorMetro2=0;     
//                            
                                       switch($fotomecanica->estan_los_moldes)
                                       {
                                          case 'NO':
                                            $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Nuevo</strong>)";
                                          break;
                                          case 'MOLDE GENERICO':
                                            if ($orden->id_molde!='')  
                                                $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            else
                                                $molde=$this->moldes_model->getMoldesPorId($datos->numero_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Antiguo</strong>)";
                                          break;
                                          case 'MOLDE REGISTRADOS DEL CLIENTE':
                                            if ($orden->id_molde!='')  
                                                $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            else
                                                $molde=$this->moldes_model->getMoldesPorId($datos->numero_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Antiguo</strong>)";
                                          break;                                          
                                          case 'NO LLEVA':
                                            $moldeNombre="<strong>NO ESTA MOLDE, PRODUCTO NO FABRICADO ANTERIORMENTE</strong>";
                                          break;
                                          case 'CLIENTE LO APORTA':
                                            $moldeNombre="<strong>CLIENTE LO APORTA</strong>";
                                          break;
                                       }
                                       
                                        $tapaNombre=$materialidad_1->nombre;
                                        $tapaGramaje=$materialidad_1->gramaje;
                                        $tapaFecha=$materialidad_1->fecha_ultima_actualizacion;
                                        $tapaPrecio=$materialidad_1->precio;
                                        $ondaNombre=$materialidad_2->nombre;
                                        if ($materialidad_2->gramaje>0)
                                            $ondaGramaje=$materialidad_2->gramaje;
					else 	
                                        $ondaGramaje=0;                                           
                                        $ondaFecha=$materialidad_2->fecha_ultima_actualizacion;
                                        $ondaPrecio=$materialidad_2->precio;
                                        $linerNombre=$materialidad_3->nombre;
                                        $linerGramaje=$materialidad_3->gramaje;
                                        $linerFecha=$materialidad_3->fecha_ultima_actualizacion;
                                        $linerPrecio=$materialidad_3->precio;
                                       ?>
                                      <?php $tapa = $this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_placa1) ?>
                                         <?php $tapa->materiales_tipo?> <?php $materialidad_1->gramaje?><?php $materialidad_1->precio?><?php $materialidad_1->reverso?>
                                        <?php $monda = $this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_onda2) ?>
                                        <?php $monda->materiales_tipo ?><?php $materialidad_2->gramaje?> <?php $materialidad_2->precio?><?php $materialidad_2->reverso?>
                                        <?php $mliner = $this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_liner3) ?>
                                        <?php $mliner->materiales_tipo ?><?php $materialidad_3->gramaje?><?php $materialidad_3->precio?><?php $materialidad_3->reverso?>
                                        <?php number_format($costo_kilo,0,'','.')?> <?php $GramosMetroCuadrado?> <?php $costoMonotapaPorMetro2?>
                                       
                                        <?php $moldeNombre?> <!--

-->
                                        <?php
                                    break;
                                    case 'Microcorrugado':
                                        $materialidad_1=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_placa1);

                                        $materialidad_2=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_onda2);
                                        $materialidad_3=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_liner3);
                                        $materialidad_4="No Aplica";
                                        $variable_cotizador=$this->variables_cotizador_model->getVariablesCotizadorPorId(24);
                                        $variable_cotizador2=$this->variables_cotizador_model->getVariablesCotizadorPorId(40);
                                        $base_imprenta=$this->variables_cotizador_model->getVariablesCotizadorPorId(6);

                                        $formula=$materialidad_1->gramaje+($materialidad_1->gramaje*($variable_cotizador->precio/100))+$materialidad_3->gramaje;
                                        if ($materialidad_2->precio>0) $materialidad_precio2=($materialidad_2->precio/1000); else $materialidad_precio2=0;
                                        if ($materialidad_3->precio>0) $materialidad_precio3=($materialidad_3->precio/1000); else $materialidad_precio3=0;
                                        if ($materialidad_2->gramaje>0) $materialidad_gramaje2=($materialidad_2->gramaje/1000); else $materialidad_gramaje2=0;
                                        $costo_kilo=0;
                                        if (($materialidad_2->gramaje>0) and ($materialidad_3->gramaje>0) and ($materialidad_2->precio>0))
                                            $costo_kilo=((($materialidad_2->gramaje*($materialidad_2->precio/1000)+(($materialidad_2->gramaje*($variable_cotizador->precio/100)*$materialidad_2->precio/1000))+$materialidad_3->gramaje*$materialidad_3->precio/1000)/($materialidad_2->gramaje+($materialidad_2->gramaje*($variable_cotizador->precio/100))+$materialidad_3->gramaje)))*1000;           
					else 	
                                            $costo_kilo=0;
									
                                        if($materialidad_3->tipo == 14 and  $materialidad_3->reverso == 'Blanca')//valdivia
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(44);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;
                                        }
                                        elseif($materialidad_3->tipo == 15 and  $materialidad_3->reverso == 'Blanca')//maule
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(45);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;                                                 
                                        }
                                        elseif($materialidad_3->tipo == 1 and  $materialidad_3->reverso == 'Blanca') //Cartulina Importada
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(43);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;                                                 
                                        }
                                        elseif($materialidad_3->tipo == 5 and  $materialidad_3->reverso == 'Blanco') // papel reverso blanco
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(42);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;                                                 
                                        }
                                        elseif($materialidad_3->tipo == 3 and  $materialidad_3->reverso == 'Blanco') // papel reverso blanco
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(42);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;                                                 
                                        }
                                        elseif($materialidad_3->tipo == 4 and  $materialidad_3->reverso == 'Café') // papel reverso cafe
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(41);
                                                 $costo_kilo_obtenido=$recargoCostoKilo->precio;                                                 
                                        }
                                        else
                                        $costo_kilo_obtenido=140;
                                        
                                        $costo_kilo=$costo_kilo+$costo_kilo_obtenido;
                                        
                                        if($fotomecanica->fot_lleva_barniz=='' || $fotomecanica->fot_lleva_barniz=='Nada')
                                        {
                                            $barniz2=0;
                                        }else
                                        {
                                            $barniz2=1;
                                        }
                                        
                                        if($maquina=="Máquina Roland 800")
                                         {
                                            $tira1=((($datoscantidad4/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio )*($fotomecanica->colores+$barniz2);
                                            $recargo800Array=$this->variables_cotizador_model->getVariablesCotizadorPorId(34);
                                            $tira2=((($datoscantidad4/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio)*($fotomecanica->colores+$barniz2)*(1*$recargo800Array->precio/100);
                                            $tiraje=$tira1+$tira2;
                                            
//                                       
                                         }else
                                         {
                                            $tiraje=((($datoscantidad4/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio )*($fotomecanica->colores+$barniz2);  
                                         }   
                                        if ($materialidad_2->gramaje>0)
                                        {    
                                            $GramosMetroCuadrado=$materialidad_2->gramaje+($materialidad_2->gramaje*($variable_cotizador->precio/100))+$materialidad_3->gramaje;
//                                           
                                        }    
					else 	
                                            $GramosMetroCuadrado=0;                                         
                                        $recargoGramosDeAlmidon=$this->variables_cotizador_model->getVariablesCotizadorPorId(30);

                                        $GramosMetroCuadrado=$GramosMetroCuadrado+$recargoGramosDeAlmidon->precio;
                                        if(sizeof($hoja)>=1)
                                        {
                                            $arreglo54=array
                                                (
                                                    "gramos_metro_cuadrado"=>$GramosMetroCuadrado,
                                                );
                                                $this->db->where('id', $hoja->id);
                                                $this->db->update("hoja_de_costos_datos",$arreglo54);
                                        }
                                        if ($materialidad_2->gramaje>0){
                                            $costoMonotapaPorMetro2=$materialidad_2->gramaje*($materialidad_2->precio/1000)+(($materialidad_2->gramaje*($variable_cotizador->precio/100)*$materialidad_2->precio/1000)+$materialidad_3->gramaje*$materialidad_3->precio/1000);
                                        }
					else 	
                                            $costoMonotapaPorMetro2=0;                                           
                                       switch($fotomecanica->estan_los_moldes)
                                       {
                                          case 'NO':
                                            $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Nuevo</strong>)";
                                          break;
                                          case 'MOLDE GENERICO':
                                            if ($orden->id_molde!='')  
                                                $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            else
                                                $molde=$this->moldes_model->getMoldesPorId($datos->numero_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Antiguo</strong>)";
                                          break;
                                          case 'MOLDE REGISTRADOS DEL CLIENTE':
                                            if ($orden->id_molde!='')  
                                                $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            else
                                                $molde=$this->moldes_model->getMoldesPorId($datos->numero_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Antiguo</strong>)";
                                          break;   
                                          case 'NO LLEVA':
                                            $moldeNombre="<strong>NO ESTA MOLDE, PRODUCTO NO FABRICADO ANTERIORMENTE</strong>";
                                          break;
                                          case 'CLIENTE LO APORTA':
                                            $moldeNombre="<strong>CLIENTE LO APORTA</strong>";
                                          break;
                                       }
                                        $tapaNombre=$materialidad_1->nombre;
                                        $tapaGramaje=$materialidad_1->gramaje;
                                        $tapaFecha=$materialidad_1->fecha_ultima_actualizacion;
                                        $tapaPrecio=$materialidad_1->precio;
                                        $ondaNombre=$materialidad_2->nombre;
                                        if ($materialidad_2->gramaje>0)
                                            $ondaGramaje=$materialidad_2->gramaje;
					else 	
                                            $ondaGramaje=0;                                           
                                        $ondaFecha=$materialidad_2->fecha_ultima_actualizacion;
                                        $ondaPrecio=$materialidad_2->precio;
                                        $linerNombre=$materialidad_3->nombre;
                                        $linerGramaje=$materialidad_3->gramaje;
                                        $linerFecha=$materialidad_3->fecha_ultima_actualizacion;
                                        $linerPrecio=$materialidad_3->precio;
//                                        print_r($materialidad_1);
                                       ?>
                                       <?php $tapa = $this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_placa1) ?>
                                        <?php $tapa->materiales_tipo?> <?php $materialidad_1->gramaje?><?php $materialidad_1->precio?><?php  $materialidad_1->reverso?>
                                        <?php $monda = $this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_onda2) ?>
                                        <?php $monda->materiales_tipo ?> <?php  $materialidad_2->gramaje?> <?php  $materialidad_2->precio?> <?php  $materialidad_2->reverso?>
                                        <?php $mliner = $this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_liner3) ?>
                                        <?php $mliner->materiales_tipo ?> <?php $materialidad_3->gramaje?><?php  $materialidad_3->precio?>  <?php  $materialidad_3->reverso?>
                                        <?php number_format($costo_kilo,0,'','.')?> <?php  $GramosMetroCuadrado?> <?php $costoMonotapaPorMetro2?>
                                      
                                        <?php $moldeNombre?> 
                                        <?php
                                    break;                                    
//                                  
//                                       ?>
                                       <?php $tapa = $this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_placa1) ?>
                                        <?php $tapa->materiales_tipo?><?php echo $materialidad_1->gramaje?> <?php echo $materialidad_1->precio?> <?php  $materialidad_1->reverso?>
					<?php $monda = $this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_onda2) ?>
                                        <?php $monda->materiales_tipo ?><?php echo $materialidad_2->gramaje?>  <?php echo $materialidad_2->precio?> <?php  $materialidad_2->reverso?>
					<?php $mliner = $this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_liner3) ?>
                                        <?php $mliner->materiales_tipo ?> <?php echo $materialidad_3->gramaje?> <?php echo $materialidad_3->precio?>  <?php  $materialidad_3->reverso?>
                                        <?php number_format($costo_kilo,0,'','.')?> <?php echo $GramosMetroCuadrado?> <?php echo $costoMonotapaPorMetro2?>
                                        
                                        <?php $moldeNombre?> 
                                        //<?php
//                                    break;
                                    case 'Corrugado'://la misma
                                        $materialidad_1=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_placa1);
                                        $materialidad_2=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_onda2);
                                        $materialidad_3=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_liner3);
                                        $materialidad_4="No Aplica";
                                        $variable_cotizador=$this->variables_cotizador_model->getVariablesCotizadorPorId(24);
                                        $variable_cotizador2=$this->variables_cotizador_model->getVariablesCotizadorPorId(40);
                                        $base_imprenta=$this->variables_cotizador_model->getVariablesCotizadorPorId(6);
                                        $formula=$materialidad_1->gramaje+($materialidad_1->gramaje*($variable_cotizador->precio/100))+$materialidad_3->gramaje;
                                        //echo $materialidad_2->gramaje."sss";exit;
                                        
                                        if (($materialidad_2->precio>0) and ($materialidad_3->gramaje>0) and ($materialidad_3->precio>0))
                                           $costo_kilo=((($materialidad_2->gramaje*($materialidad_2->precio/1000)+(($materialidad_2->gramaje*($variable_cotizador->precio/100)*$materialidad_2->precio/1000))+$materialidad_3->gramaje*$materialidad_3->precio/1000)/($materialidad_2->gramaje+($materialidad_2->gramaje*($variable_cotizador->precio/100))+$materialidad_3->gramaje)))*1000;           
                                        else 
                                            $costo_kilo=0;                                        
                                        if($materialidad_3->tipo == 14 and  $materialidad_3->reverso == 'Blanca')//valdivia
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(44);
                                        }
                                        if($materialidad_3->tipo == 15 and  $materialidad_3->reverso == 'Blanca')//maule
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(45);
                                        }
                                        if($materialidad_3->tipo == 1 and  $materialidad_3->reverso == 'Blanca') //Cartulina Importada
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(43);
                                        }
                                        if($materialidad_3->tipo == 5 and  $materialidad_3->reverso == 'Blanco') // papel reverso blanco
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(42);
                                        }
                                        if($materialidad_3->tipo == 3 and  $materialidad_3->reverso == 'Blanco') // papel reverso blanco/ white top
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(42);
                                        }
                                        if($materialidad_3->tipo == 4 and  $materialidad_3->reverso == 'Café') // papel reverso cafe
                                        {
                                                 $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(41);
                                        }
                                        $costo_kilo=$costo_kilo+$recargoCostoKilo->precio;
                                        if($fotomecanica->fot_lleva_barniz=='Nada' || $fotomecanica->fot_lleva_barniz=='')
                                        {
                                            $barniz2=0;
                                        }else
                                        {
                                            $barniz2=1;
                                        }
                                  
                                        if($maquina=="Máquina Roland 800")
                                         {
                                            $tira1=((($datoscantidad4/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio )*($fotomecanica->colores+$barniz2);
                                            $recargo800Array=$this->variables_cotizador_model->getVariablesCotizadorPorId(34);
                                            $tira2=((($datoscantidad4/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio)*($fotomecanica->colores+$barniz2)*(1*$recargo800Array->precio/100);
                                            $tiraje=$tira1+$tira2;

                                         }else
                                         {
                                            $tiraje=((($datoscantidad4/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio )*($fotomecanica->colores+$barniz2);  
                                          
                                         }    
                                        if  (($materialidad_2->gramaje>0) and ($materialidad_3->gramaje>0)) 
                                            $GramosMetroCuadrado=$materialidad_2->gramaje+($materialidad_2->gramaje*($variable_cotizador->precio/100))+$materialidad_3->gramaje;
                                        else
                                            $GramosMetroCuadrado=0;
                                        $recargoGramosDeAlmidon=$this->variables_cotizador_model->getVariablesCotizadorPorId(30);
                                        $GramosMetroCuadrado=$GramosMetroCuadrado+$recargoGramosDeAlmidon->precio;
										
					if(sizeof($hoja)>=1)
                                        {
                                            $arreglo54=array
                                                (
                                                    "gramos_metro_cuadrado"=>$GramosMetroCuadrado,
                                                );
                                                $this->db->where('id', $hoja->id);
                                                $this->db->update("hoja_de_costos_datos",$arreglo54);
                                        }
                                        if (($materialidad_2->gramaje>0) and ($materialidad_3->gramaje>0) and ($materialidad_2->precio>0))
                                            $costoMonotapaPorMetro2=$materialidad_2->gramaje*($materialidad_2->precio/1000)+(($materialidad_2->gramaje*($variable_cotizador->precio/100)*$materialidad_2->precio/1000)+$materialidad_3->gramaje*$materialidad_3->precio/1000);
                                        else
                                            $costoMonotapaPorMetro2=0;

                                       
                                       switch($fotomecanica->estan_los_moldes)
                                       {
                                          case 'NO':
                                            $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Nuevo</strong>)";
                                          break;
                                          case 'MOLDE GENERICO':
                                            if ($orden->id_molde!='')  
                                                $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            else
                                                $molde=$this->moldes_model->getMoldesPorId($datos->numero_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Antiguo</strong>)";
                                          break;
                                          case 'MOLDE REGISTRADOS DEL CLIENTE':
                                            if ($orden->id_molde!='')  
                                                $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            else
                                                $molde=$this->moldes_model->getMoldesPorId($datos->numero_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Antiguo</strong>)";
                                          break;                                          
                                          case 'NO LLEVA':
                                            $moldeNombre="<strong>NO ESTA MOLDE, PRODUCTO NO FABRICADO ANTERIORMENTE</strong>";
                                          break;
                                          case 'CLIENTE LO APORTA':
                                            $moldeNombre="<strong>CLIENTE LO APORTA</strong>";
                                          break;
                                       }                                       
                                       
                                       
                                       
                                        $tapaNombre=$materialidad_1->nombre;
                                        $tapaGramaje=$materialidad_1->gramaje;
                                        $tapaFecha=$materialidad_1->fecha_ultima_actualizacion;
                                        $tapaPrecio=$materialidad_1->precio;
                                        $ondaNombre=$materialidad_2->nombre;
                                        $ondaGramaje=$materialidad_2->gramaje;
                                        $ondaFecha=$materialidad_2->fecha_ultima_actualizacion;
                                        $ondaPrecio=$materialidad_2->precio;
                                        $linerNombre=$materialidad_3->nombre;
                                        $linerGramaje=$materialidad_3->gramaje;
                                        $linerFecha=$materialidad_3->fecha_ultima_actualizacion;
                                        $linerPrecio=$materialidad_3->precio;                      
                                        ?>
				
                                        <?php
                                    break;
                                    case 'Cartulina-cartulina': //Cartulina cartulina
                                        $materialidad_1=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_placa1);
                                        $materialidad_2=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_onda2);
                                        $materialidad_3=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_liner3);
                                        //$materialidad_3="No Aplica";;
                                        $materialidad_4="No Aplica";
                                        $variable_cotizador=$this->variables_cotizador_model->getVariablesCotizadorPorId(24);
                                        $variable_cotizador2=$this->variables_cotizador_model->getVariablesCotizadorPorId(40);
                                        $base_imprenta=$this->variables_cotizador_model->getVariablesCotizadorPorId(6);
                                        if (($materialidad_2->precio>0) and ($materialidad_2->gramaje>0) and ($variable_cotizador->precio>0))
                                            $costo_kilo=((($materialidad_2->gramaje*($materialidad_2->precio/1000)+(($materialidad_2->gramaje*($variable_cotizador->precio/100)*$materialidad_2->precio/1000))+0*0/1000)/($materialidad_2->gramaje+($materialidad_2->gramaje*($variable_cotizador->precio/100))+0)))*1000;     
                                        else 
                                            $costo_kilo=0;
                                        $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(40);
                                        $costo_kilo=$costo_kilo+$recargoCostoKilo->precio;
                                        if($fotomecanica->fot_lleva_barniz=='' || $fotomecanica->fot_lleva_barniz=='Nada')
                                        {
                                            $barniz2=0;
                                        }else
                                        {
                                            $barniz2=1;
                                        }

                                        if($maquina=="Máquina Roland 800")
                                         {
                                        $tira1=((($datoscantidad4/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio )*($fotomecanica->colores+$barniz2);
                                            $recargo800Array=$this->variables_cotizador_model->getVariablesCotizadorPorId(34);
                                        $tira2=((($datoscantidad4/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio)*($fotomecanica->colores+$barniz2)*(1*$recargo800Array->precio/100);
                                            $tiraje=$tira1+$tira2;
                                            
                                         }else
                                         {
                                            $tiraje=((($datoscantidad4/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio )*($fotomecanica->colores+$barniz2);  
                                          
                                         }    
                                        if  ($materialidad_2->gramaje>0) 
                                            $GramosMetroCuadrado=$materialidad_2->gramaje+($materialidad_2->gramaje*($variable_cotizador->precio/100))+0;
                                        else 
                                            $GramosMetroCuadrado=0;
                                        $recargoGramosDeAlmidon=$this->variables_cotizador_model->getVariablesCotizadorPorId(30);
                                        $GramosMetroCuadrado=$GramosMetroCuadrado+$recargoGramosDeAlmidon->precio;
                                        if  ($materialidad_2->gramaje>0) 
                                            $costoMonotapaPorMetro2=$materialidad_2->gramaje*($materialidad_2->precio/1000)+(($materialidad_2->gramaje*($variable_cotizador->precio/100)*$materialidad_2->precio/1000)+0*0/1000);
                                        else 
                                            $costoMonotapaPorMetro2=0;
                                         
                                        
                                       switch($fotomecanica->estan_los_moldes)
                                       {
                                          case 'NO':
                                            $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Nuevo</strong>)";
                                          break;
                                          case 'MOLDE GENERICO':
                                            if ($orden->id_molde!='')  
                                                $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            else
                                                $molde=$this->moldes_model->getMoldesPorId($datos->numero_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Antiguo</strong>)";
                                          break;
                                          case 'MOLDE REGISTRADOS DEL CLIENTE':
                                            if ($orden->id_molde!='')  
                                                $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            else
                                                $molde=$this->moldes_model->getMoldesPorId($datos->numero_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Antiguo</strong>)";
                                          break;                                          
                                          case 'NO LLEVA':
                                            $moldeNombre="<strong>NO ESTA MOLDE, PRODUCTO NO FABRICADO ANTERIORMENTE</strong>";
                                          break;
                                          case 'CLIENTE LO APORTA':
                                            $moldeNombre="<strong>CLIENTE LO APORTA</strong>";
                                          break;
                                       }                                        

                                        $tapaNombre=$materialidad_1->nombre;
                                        $tapaGramaje=$materialidad_1->gramaje;
                                        $tapaFecha=$materialidad_1->fecha_ultima_actualizacion;
                                        $tapaPrecio=$materialidad_1->precio;
										
                                        $tapaNombre2=$materialidad_2->nombre;
                                        $tapaGramaje2=$materialidad_2->gramaje;
                                        $tapaFecha2=$materialidad_2->fecha_ultima_actualizacion;
                                        $tapaPrecio2=$materialidad_2->precio;
                                        
                                        $tapaNombre3=$materialidad_3->nombre;
                                        $tapaGramaje3=$materialidad_3->gramaje;
                                        $tapaFecha3=$materialidad_3->fecha_ultima_actualizacion;
                                        $tapaPrecio3=$materialidad_3->precio;
                     
                                        ?>
                                        <?php $fotomecanica->materialidad_1?><?php $materialidad_1->gramaje?> <?php $materialidad_1->precio?><?php $materialidad_1->reverso?>
                                        <?php $fotomecanica->materialidad_3?><?php $materialidad_3->gramaje?> <?php $materialidad_3->precio?><?php $materialidad_3->reverso?>
                                        <?php $formula?>
                                        <?php $fotomecanica->impresion?>
                                        <?php $moldeNombre?>
                                        <?php
                                        
                                    break;
                                    case 'Sólo Cartulina':
									
					$materialidad_1=$this->materiales_model->getMaterialesPorId($fotomecanica->id_mat_placa1);
                                        $variable_cotizador=$this->variables_cotizador_model->getVariablesCotizadorPorId(24);
                                        $variable_cotizador2=$this->variables_cotizador_model->getVariablesCotizadorPorId(40);
                                        $base_imprenta=$this->variables_cotizador_model->getVariablesCotizadorPorId(6);
                                      
                                        $recargoCostoKilo=$this->variables_cotizador_model->getVariablesCotizadorPorId(40);
                                        $costo_kilo=0;
                                        if($fotomecanica->fot_lleva_barniz=='' || $fotomecanica->fot_lleva_barniz=='Nada')
                                        {
                                            $barniz2=0;
                                        }else
                                        {
                                            $barniz2=1;
                                        }
                                        
                                        if($maquina=="Máquina Roland 800")
                                         {
                                            $tira1=((($datoscantidad4/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio )*($fotomecanica->colores+$barniz2);
                                            $recargo800Array=$this->variables_cotizador_model->getVariablesCotizadorPorId(34);
                                            $tira2=((($datoscantidad4/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio)*($fotomecanica->colores+$barniz2)*(1*$recargo800Array->precio/100);
                                            $tiraje=$tira1+$tira2;
  
                                         }else
                                         {
                                            $tiraje=((($datoscantidad4/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio )*($fotomecanica->colores+$barniz2);  
                                          
                                         }    
                                        if  ($materialidad_2->gramaje>0) 
                                            $GramosMetroCuadrado=$materialidad_2->gramaje+($materialidad_2->gramaje*($variable_cotizador->precio/100))+0;
                                        else 
                                            $GramosMetroCuadrado=0;
                                        $recargoGramosDeAlmidon=$this->variables_cotizador_model->getVariablesCotizadorPorId(30);
                                        
                                        $GramosMetroCuadrado=$GramosMetroCuadrado+$recargoGramosDeAlmidon->precio;
                                        if  ($materialidad_2->gramaje>0) 
                                            $costoMonotapaPorMetro2=$materialidad_2->gramaje*($materialidad_2->precio/1000)+(($materialidad_2->gramaje*($variable_cotizador->precio/100)*$materialidad_2->precio/1000)+0*0/1000);
                                        else 
                                            $costoMonotapaPorMetro2=0; 
                                                                             
                                       switch($fotomecanica->estan_los_moldes)
                                       {
                                          case 'NO':
                                            $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Nuevo</strong>)";
                                          break;
                                          case 'MOLDE GENERICO':
                                            if ($orden->id_molde!='')  
                                                $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            else
                                                $molde=$this->moldes_model->getMoldesPorId($datos->numero_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Antiguo</strong>)";
                                          break;
                                          case 'MOLDE REGISTRADOS DEL CLIENTE':
                                            if ($orden->id_molde!='')  
                                                $molde=$this->moldes_model->getMoldesPorId($orden->id_molde);
                                            else
                                                $molde=$this->moldes_model->getMoldesPorId($datos->numero_molde);
                                            $moldeNombre=$molde->nombre." N°".$molde->numero." (<strong>Molde Antiguo</strong>)";
                                          break;                                          
                                          case 'NO LLEVA':
                                            $moldeNombre="<strong>NO ESTA MOLDE, PRODUCTO NO FABRICADO ANTERIORMENTE</strong>";
                                          break;
                                          case 'CLIENTE LO APORTA':
                                            $moldeNombre="<strong>CLIENTE LO APORTA</strong>";
                                          break;
                                       }                                        
                                        $tapaNombre=$materialidad_1->nombre;
                                        $tapaGramaje=$materialidad_1->gramaje;
                                        $tapaFecha=$materialidad_1->fecha_ultima_actualizacion;
                                        $tapaPrecio=$materialidad_1->precio;
										
                                        $tapaNombre2=$materialidad_2->nombre;
                                        $tapaGramaje2=$materialidad_2->gramaje;
                                        $tapaFecha2=$materialidad_2->fecha_ultima_actualizacion;
                                        $tapaPrecio2=$materialidad_2->precio;
                     
                                        ?>
                                        <?php $fotomecanica->materialidad_1?><?php $materialidad_1->gramaje?><?php $materialidad_1->precio?><?php  $materialidad_1->reverso?>
                                        <?php $fotomecanica->materialidad_2?><?php $materialidad_2->gramaje?><?php $materialidad_2->precio?> <?php $materialidad_2->reverso?>
                                        <?php $formula?>
                                        <?php $fotomecanica->impresion?>
                                        <?php $moldeNombre?>
                                        <?php	
                                    break;
                                    case 'Se solicita proposición':
                                        
                                    break;
                                  }  
                                ?>
                 </td>
                <td class="celda_5 valign_top">
                    <!--trabajos externos-->
                    <table border="1">
                                         
               <?php
                                $cantidad_4=0;
                                $externos_produccion=0;
                             //    exit($fotomecanica->acabado_impresion_4."hollaaa");
				if($fotomecanica->acabado_impresion_4=="17")
                                {
                                    $acabado_4="";
                                    $acabado_4Valor="";
                                    $acabado_4MedidaMasValorVenta="";
                                    $acabado_4Unitario="";
                                    $acabado_4UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_4Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_4);
                                    $acabado_4=$acabado_4Array->caracteristicas; // Nombre acabado
                                    $acabado_4UnidadVentaNombre=$acabado_4Array->unv; //Nombre unidad de venta
                                    $acabado_4Valor=$acabado_4Array->valor_venta; // ej: 52
                                    $acabado_4MedidaMasValorVenta=($tamano1*$tamano2*$acabado_4Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_4CostoFijo=$acabado_4Array->costo_fijo;	
								
                                    
                                    if ($acabado_4Array->unidad_de_venta == '1') //Metros
                                    {
                                        $costo_unitario4=$acabado_4MedidaMasValorVenta;
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad4);
                                        $cantidad_4=$datoscantidad4;
                                    }
                                    elseif ($acabado_4Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $costo_unitario4=$acabado_4Valor;
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }  
                                    elseif ($acabado_4Array->unidad_de_venta == '3') //tONELADA
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad4);
                                    }                                    
                                    elseif ($acabado_4Array->unidad_de_venta == '4') //caja de carton
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad4);
                                    }                                            
                                    elseif ($acabado_4Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($datoscantidad4*$acabado_4Valor);
                                        $cantidad_4=$datoscantidad4;
                                    }       
                                    elseif ($acabado_4Array->unidad_de_venta == '6') //cm2
                                    {
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $costo_unitario4=$acabado_4Valor;     
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }   
                                    elseif ($acabado_4Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario4=$acabado_4MedidaMasValorVenta;
                                        $precio_total_4=$acabado_4MedidaMasValorVenta*$datoscantidad4;
                                        $cantidad_4=$datoscantidad4;
                                    }
                                    elseif ($acabado_4Array->unidad_de_venta == '8') //cms
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad4);
                                    }           
                                    elseif ($acabado_4Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }     
                                    elseif ($acabado_4Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($acabado_4Valor*$datoscantidad4);
                                        $cantidad_4=$datoscantidad4;                                        
                                    }
                                    
                                }
								
                                if($fotomecanica->acabado_impresion_5=="17")
                                {
                                    $acabado_5="";
                                    $acabado_5Valor="";
                                    $acabado_5MedidaMasValorVenta="";
                                    $acabado_5Unitario="";
                                    $acabado_5UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_5Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_5);
                                    $acabado_5=$acabado_5Array->caracteristicas;
                                    $acabado_5UnidadVentaNombre=$acabado_5Array->unv; //Nombre unidad de venta
                                    $acabado_5Valor=$acabado_5Array->valor_venta; // ej: 52
                                    $acabado_5MedidaMasValorVenta=($tamano1*$tamano2*$acabado_5Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_5CostoFijo=$acabado_5Array->costo_fijo;		
                                  if ($acabado_5Array->unidad_de_venta == '1') //mt2
                                    {
                                        $costo_unitario5=$acabado_5MedidaMasValorVenta;
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad4);                                      
                                        $cantidad_5=$datoscantidad4;
                                    }
                                    elseif ($acabado_5Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $costo_unitario5=$acabado_5Valor; 
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }    
                                    elseif ($acabado_5Array->unidad_de_venta == '3') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad4);
                                    }                                    
                                    elseif ($acabado_5Array->unidad_de_venta == '4') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad4);
                                    }                                            
                                    elseif ($acabado_5Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($datoscantidad4*$acabado_5Valor);
                                        $cantidad_5=$datoscantidad4;
                                    }       
                                    elseif ($acabado_5Array->unidad_de_venta == '6') //mt2
                                    {
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $costo_unitario5=$acabado_5Valor;
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }   
                                    elseif ($acabado_5Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario5=$acabado_5MedidaMasValorVenta;
                                        $precio_total_5=$acabado_5MedidaMasValorVenta*$datoscantidad4;
                                        $cantidad_5=$datoscantidad4;
                                    }
                                    elseif ($acabado_5Array->unidad_de_venta == '8') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad4);
                                    }           
                                    elseif ($acabado_5Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }   
                                    elseif ($acabado_5Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($acabado_5Valor*$datoscantidad4);
                                        $cantidad_5=$datoscantidad4;
                                    }                                      
                                }    
                                if($fotomecanica->acabado_impresion_6=="17")
                                {
                                    $acabado_6="";
                                    $acabado_6Valor="";
                                    $acabado_6MedidaMasValorVenta="";
                                    $acabado_6Unitario="";
                                    $acabado_6UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_6Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_6);
                                    $acabado_6=$acabado_6Array->caracteristicas;
                                    $acabado_6UnidadVentaNombre=$acabado_6Array->unv; //Nombre unidad de venta
                                    $acabado_6Valor=$acabado_6Array->valor_venta; // ej: 52
                                    $acabado_6MedidaMasValorVenta=($tamano1*$tamano2*$acabado_6Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_6CostoFijo=$acabado_6Array->costo_fijo;		
                                    if ($acabado_6Array->unidad_de_venta == '1') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad4);
                                    }
                                    elseif ($acabado_6Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $costo_unitario6=$acabado_6Valor; 
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    }  
                                    elseif ($acabado_6Array->unidad_de_venta == '3') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad4);
                                    }                                    
                                    elseif ($acabado_6Array->unidad_de_venta == '4') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad4);
                                    }                                            
                                    elseif ($acabado_6Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($datoscantidad4*$acabado_5Valor);
                                        $cantidad_6=$datoscantidad4;
                                    }       
                                    elseif ($acabado_6Array->unidad_de_venta == '6') //mt2
                                    {
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $costo_unitario6=$acabado_6Valor;
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    }   
                                    elseif ($acabado_6Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario6=$acabado_6MedidaMasValorVenta;
                                        $precio_total_6=$acabado_6MedidaMasValorVenta*$datoscantidad4;
                                        $cantidad_6=$datoscantidad4;
                                    }
                                    elseif ($acabado_6Array->unidad_de_venta == '8') //cms
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad4);
                                    }           
                                    elseif ($acabado_6Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    } 
                                    elseif ($acabado_6Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($acabado_6Valor*$datoscantidad4);
                                        $cantidad_6=$datoscantidad4;
                                    }                                      

                                }        
               ?>
                <?php

                if($ing->piezas_adicionales == 'NO LLEVA')
                {
                    $piezaAdacionalNom1 ="No Lleva";
                    $piezaAdacionalValor1="&nbsp;";
                    $piezaAdacionalTotal1="&nbsp;";
                    $piezaAdacionalEmpresa1="&nbsp;";
                }else
                {
                    $piezasAdicionales = $this->piezas_adicionales_model->getPiezasAdicionalesPorNombreHojaCosto($ing->piezas_adicionales);
                    $piezaUnidadVentaNombre1=$piezasAdicionales->unv; //Nombre unidad de venta
                    $piezaAdacionalNom1 = $piezasAdicionales->piezas_adicionales;
                    $piezaAdacionalValor1= $piezasAdicionales->valor_venta;
                    $piezaAdacionalTotal1 = $datoscantidad4 * $piezaAdacionalValor1;
                    $piezaAdacionalEmpresa1= $hoja->piezas_adicionales1;
                }
                if($ing->piezas_adicionales2 == 'NO LLEVA')
                {
                    $piezaAdacionalNom2 ="No Lleva";
                    $piezaAdacionalValor2="&nbsp;";
                    $piezaAdacionalTotal2="&nbsp;";
                    $piezaAdacionalEmpresa2="&nbsp;";
                }else
                {
                    $piezasAdicionales = $this->piezas_adicionales_model->getPiezasAdicionalesPorNombreHojaCosto($ing->piezas_adicionales2);
                    $piezaUnidadVentaNombre2=$piezasAdicionales->unv; //Nombre unidad de venta                                    
                    $piezaAdacionalNom2 = $piezasAdicionales->piezas_adicionales;
                    $piezaAdacionalValor2= $piezasAdicionales->valor_venta;
                    $piezaAdacionalTotal2= $datoscantidad4 * $piezaAdacionalValor2;
                    $piezaAdacionalEmpresa2= $hoja->piezas_adicionales2;
                }
                if($ing->piezas_adicionales3 == 'NO LLEVA')
                {
                    $piezaAdacionalNom3 ="No Lleva";
                    $piezaAdacionalValor3="&nbsp;";
                    $piezaAdacionalTotal3="&nbsp;";
                    $piezaAdacionalEmpresa3="&nbsp;";
                }else
                {
                    $piezasAdicionales = $this->piezas_adicionales_model->getPiezasAdicionalesPorNombreHojaCosto($ing->piezas_adicionales3);
                    $piezaUnidadVentaNombre3=$piezasAdicionales->unv; //Nombre unidad de venta                                    
                    $piezaAdacionalNom3 = $piezasAdicionales->piezas_adicionales;
                    $piezaAdacionalValor3 =  $piezasAdicionales->valor_venta;
                    $piezaAdacionalTotal3= $datoscantidad3 * $piezaAdacionalValor3;;
                    $piezaAdacionalEmpresa3= $hoja->piezas_adicionales3;
                }
                ?>
                </table>
                                    <!--/trabajos externos-->
                                </td>
                            </tr>
                        </table>
                        <!--/materialidad-->
                    </div>
                    <div class="separador_10"></div>
                    <div>
                        <table id="tabla_detalle">
                         
                        <?php
                            if (($datoscantidad4>0) and ($ing->unidades_por_pliego>0))
                                $costoPlacaKilo=($datoscantidad4/$ing->unidades_por_pliego)+$sum;
                            else 
                                $costoPlacaKilo=0;
                            $valorPlacaKilo=($costoPlacaKilo*$tamano1*$tamano2*$tapaGramaje)/10000000;
                            $totalPlacaKilo=$valorPlacaKilo*$tapaPrecio;
							
                             if(sizeof($hoja)>=1 and $hoja->fecha)
                            {
                                $arreglo5=array
                                (
                                    "placa_kilo"=>$costoPlacaKilo,
                                    "total_pliegos"=>$valorPlacaKilo,
                                );
//                                $this->db->where('id', $hoja->id);
//                                $this->db->update("hoja_de_costos_datos",$arreglo5);
//                                echo $this->db->last_query();
                            }
			    if(sizeof($hoja)>=1)
                            {
                                $arreglokilo1=array
                                (
                                    "kilos_placa"=>$valorPlacaKilo,
                                 
                                );
//                                $this->db->where('id', $hoja->id);
//                                $this->db->update("hoja_de_costos_datos",$arreglokilo1);
//                                echo $this->db->last_query();
                            }
                        ?>
                        
                                  <?php
                                  $variableComplemento=$this->variables_cotizador_model->getVariablesCotizadorPorId(32);
                                        $valorTiraje=$variableComplemento->precio-$tiraje;
										
                                        if($valorTiraje>0)
                                        {
                                            if($fotomecanica->colores == 0)
                                            {
                                              $complemento=0;
                                            }else{
                                              $complemento=$valorTiraje;	
                                            }
                                            
											
                                        }else
                                        {
                                            $complemento=0;
                                        }
                                        
                                        
                                  ?>  
					<?php if($hoja->valor_externo!=0){ $externos_produccion=$externos_produccion+$hoja->valor_externo+$costo1+$costo2+$costo3+$costo4+$costo5+$costoa1+$costoa2+$costoa3+$costoa4+$costoa5; }else{  $externos_produccion=$precio_total_4+$precio_total_5+$precio_total_6+$costo1+$costo2+$costo3+$costo4+$costo5+$costoa1+$costoa2+$costoa3+$costoa4+$costoa5; } ?>			  

                    <?php
                        if($maquina=="Máquina Roland 800")
                        {
                           if (($datoscantidad4>0) and ($ing->unidades_por_pliego>0))
                                $costoOndaKilo=((($datoscantidad4/$ing->unidades_por_pliego)*1.04)+100)+4;
                            else 
                                $costoOndaKilo=0;                            
                        }else
                        {
                           if (($datoscantidad4>0) and ($ing->unidades_por_pliego>0))
                                $costoOndaKilo=(($datoscantidad4/$ing->unidades_por_pliego)+100)+4;
                            else 
                                $costoOndaKilo=0;                               
                        }
                        
                        if($fotomecanica->materialidad_datos_tecnicos == 'Sólo Cartulina')
                        {
                                $costoOndaKilo=0;
                                $valorOndaKilo=0;
                                $totalOndaKilo=0;
                                $valorCorte=0;

                        }else{
                            $valorOndaKilo=($costoOndaKilo*$tamano1*$tamano2*$GramosMetroCuadrado)/10000000;
                            $totalOndaKilo=$valorOndaKilo*$costo_kilo;
                            $valorCorte=$costoOndaKilo*4.5;
			}
                        
                        $costoOndaKilo1=((($datoscantidad4/$ing->unidades_por_pliego)*1.04)+100)+4;
                        $costoOndaKilo2=(($datoscantidad4/$ing->unidades_por_pliego)+$emplacado+$troquelado);
                        
                        if($costoOndaKilo1>$costoOndaKilo2){
                            $costoOndaKilo=$costoOndaKilo1;
                        }
                        if($costoOndaKilo1<$costoOndaKilo2){
                            $costoOndaKilo=$costoOndaKilo2;
                        }
                        
                    ?>
                    <?php
                        $variableEmplacado=$this->variables_cotizador_model->getVariablesCotizadorPorId(8);
                        $valorEmplacadado=($variableEmplacado->precio*$tamano1*$tamano2)/10000;
                        $totalEmplacado=$valorEmplacadado*$costoOndaKilo;
                    ?>
                    <?php
                    
                        if($fotomecanica->estan_los_moldes == 'NO LLEVA')
                        {
                            $variableMontajeMoldeTroquel=0;
                            $totalMontajeMolde=0;
                        }else
                        {
                            $variableRecargoMontaje=$this->variables_cotizador_model->getVariablesCotizadorPorId(31);
                            $variableMontajeMoldeTroquel=$this->variables_cotizador_model->getVariablesCotizadorPorId(10);
                            $totalMontajeMolde=$variableMontajeMoldeTroquel->precio*1.5;	
                        }                    

//                       
                    ?>
                    <?php
						if($fotomecanica->estan_los_moldes == 'NO LLEVA')
						{
                                                    $variableTroquelado=0;
                                                    $totalTroquelado=0;
						}else
						{
                                                    $variableTroquelado=$this->variables_cotizador_model->getVariablesCotizadorPorId(11);
                                                    $totalTroquelado=($costoOndaKilo*$variableTroquelado->precio)*1.5;	
						}                    
//					
                    ?>
                    <?php
                                        $variableDesgajado=$this->variables_cotizador_model->getVariablesCotizadorPorId(12);
                                        $totalDesgajado=$ing->piezas_totales_en_el_pliego*$variableDesgajado->precio*1.5*$costoOndaKilo;
                    ?>                                
 
                 
                                        <?php
                                           $variablePegado=$this->variables_cotizador_model->getVariablesCotizadorPorId(21);
                                           if(sizeof($hoja)==0) { 
                                               if ($datos->pegado_migrado==null || $datos->pegado_migrado=='' || $datos->pegado_migrado==0){
                                                   if($presupuesto->costo_pegado>=1){
                                                       $pegado_migrado=$presupuesto->costo_pegado;
                                                   }else{
                                                       $pegado_migrado=30; 
                                                   }
                                                }else{ 
                                                    $pegado_migrado=$datos->pegado_migrado;
                                                }
                                           }else{
                                                    $pegado_migrado=$hoja->pegado;
                                           }
                                           
                                           $totalPegado=$datoscantidad4*$pegado_migrado*$variablePegado->precio;
                                           
                                        ?>    
                     <?php
					 if(sizeof($hoja->pegado)>=1)
					 {
                                            $divisionPegado=$hoja->pegado/2;
                                            $totalDespacho=$divisionPegado*$datoscantidad4;
					 }
					 else
					 {
                                                $divisionPegado=$pegado_migrado/2;
                                                $totalDespacho=$divisionPegado*$datoscantidad4;
                                         }
	 
                     
                     ?>
                     <?php
					 
					 	
					 
					 //%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
					 
                    if($fotomecanica->condicion_del_producto == 'Nuevo') //nuevo 
                    {
                        if($fotomecanica->estan_los_moldes == 'NO')
			{
				$variableTroquel=$this->variables_cotizador_model->getVariablesCotizadorPorId(9);
                                $moldeTroquel=$variableTroquel->precio;
                        }
                        elseif($fotomecanica->estan_los_moldes == 'NO LLEVA')
                        {
                            $moldeTroquel=0;
                        }elseif($fotomecanica->estan_los_moldes == 'CLIENTE LO APORTA')
                        {
                            $moldeTroquel=0;
                        }
                    }
                    if($fotomecanica->condicion_del_producto == 'Repetición Sin Cambios') //
                    {

                    if($fotomecanica->estan_los_moldes == 'NO LLEVA')
                    {
                            $variableTroquel=$this->variables_cotizador_model->getVariablesCotizadorPorId(9);

                            $moldeTroquel=0;
                    }
                    }					
                    if($fotomecanica->condicion_del_producto == 'Repetición con Cambios') //
                    {
			$moldeTroquel=0;
                    }
                    if($fotomecanica->condicion_del_producto == 'Producto Genérico') //
                    {
			$moldeTroquel=0;
                    }
            						   
                     ?>
               
					 <?php
					 $variableEmplacado=$this->variables_cotizador_model->getVariablesCotizadorPorId(39);
					 if($fotomecanica->lleva_barniz == 'SI' and $fotomecanica->reserva_barniz == 'SI')
					 {
						 $otrosCaucho = $variableEmplacado->precio; 
					 }else
					 {
						$otrosCaucho = 0;
					 }
                                         if($fotomecanica->fot_cala_caucho== 'Si')
										 {
											 $otrosCaucho = 50000; 
										 }else
										 {
											$otrosCaucho = 0;
										 }
					 
					 ?>
	
					 <?php
					 if($piezaAdacionalEmpresa1 != 0)
					 {
						$TotalPiezasAdicionales = $TotalPiezasAdicionales + $piezaAdacionalEmpresa1;

					 }
					 else
					 {
						 	$TotalPiezasAdicionales = $TotalPiezasAdicionales + $piezaAdacionalTotal1;
						 
					 }
					 
					  if($piezaAdacionalEmpresa2 != 0)
					 {
						$TotalPiezasAdicionales = $TotalPiezasAdicionales + $piezaAdacionalEmpresa2;

					 }
					else
					 {
						 $TotalPiezasAdicionales = $TotalPiezasAdicionales + $piezaAdacionalTotal2;
						 
					 }
					 
					 
					  if( $piezaAdacionalEmpresa3 != 0)
					 {
						$TotalPiezasAdicionales = $TotalPiezasAdicionales + $piezaAdacionalEmpresa3;

					 }
					else
					 {
						 $TotalPiezasAdicionales = $TotalPiezasAdicionales + $piezaAdacionalTotal3;
						 
					 }
					 
					// $TotalPiezasAdicionales = $piezaAdacionalTotal1 + $piezaAdacionalTotal2 + $piezaAdacionalTotal3;
					 ?>
				
                     <?php
                     $totalProduccion=$costosporlacado+$complemento+$valorCorte+$totalEmplacado+$totalMontajeMolde+$totalTroquelado+$totalPegado+$totalDespacho+$tiraje+$moldeTroquel+$totalDesgajado+$externos_produccion+$otrosCaucho + $TotalPiezasAdicionales + $valor_extra + $valor_bv_maquina + $valor_acepeta_exce;

                     ?>
                   
                                            
                     <?php

                      $costoVentaValor=(($totalOndaKilo+$totalPlacaKilo+$totalPreImpresion+$totalProduccion)*$costoVenta->precio)/100;

                     ?>
                     <tr>
                                            <?php number_format($costoVentaValor,0,'','.')?></td>
                     </tr>
                     <?php
                      $costoAdministracionValor=(($totalOndaKilo+$totalPlacaKilo+$totalPreImpresion+$totalProduccion)*$costoAdministracion->precio)/100;
                      
                     ?>
                     <tr>
                                            <td class="celda_33"><?php number_format($costoAdministracionValor,0,'','.')?></td>
                                        </tr>
                                           <?php number_format($hoja->valor_extra*$datoscantidad4,0,'','.') ?>
                                
                     <?php
                      $totalCostosVarios=$costoAdministracionValor+$costoVentaValor+$hoja->costo_adicional+$valor_extra;
                     ?>
                     
                                    </table>
                                    <!--/producción-->
                                </td>
                            </tr>

                            </tr>
                            <?php
                            if(sizeof($hoja)>=1)
                            {
                                $arreglo6=array
                                (
                                    "onda_kilo"=>$costoOndaKilo,
                                );
//                                $this->db->where('id', $hoja->id);
//                                $this->db->update("hoja_de_costos_datos",$arreglo6);
                            }
							
							
							
                            ?>
                           
                           <?php $porcentajeTotalCorte =$totalPlacaKilo*7/100; number_format((($totalPlacaKilo*7)/(100)),0,'','.')?>
                             <?php

                                                                
								if($fotomecanica->materialidad_datos_tecnicos == 'Cartulina-cartulina')
								{
                                                                $costoPlacaKilo2 = ($datoscantidad4/$ing->unidades_por_pliego);

                                                                $cuatro_por_ciento = ($costoPlacaKilo2 / 100)* 4;
							
                                                                //if($costoPlacaKilo2 >= 1 and $costoPlacaKilo2 <= 100)
                                                                if($cuatro_por_ciento >= 1 and $cuatro_por_ciento <= 100)
                                                                {
                                                                        if($fotomecanica->colores==0){
                                                                        $agregado_a_apliegos = 25;}else{    
                                                                        $agregado_a_apliegos = 100;
                                                                        }
                                                                }

                                                                if($cuatro_por_ciento > 100)
                                                                {
                                                                        $agregado_a_apliegos = $cuatro_por_ciento;
                                                                }
                                                                $costoPlacaKilo2 = $costoPlacaKilo2 + $agregado_a_apliegos;
                                                                $valorPlacaKilo2 = ($costoPlacaKilo2*$tamano1*$tamano2*$tapaGramaje3)/10000000;
                                                                //$valorPlacaKilo2 = number_format($valorPlacaKilo2,0,'','.');
                                                                
                                                                $totalPlacaKilo2 = $valorPlacaKilo2*$tapaPrecio3;
							
                                                                ?>
                                                               <?php  number_format($valorPlacaKilo2,0,'','.');?>
                                                                <?php number_format($costoPlacaKilo2,0,'','.')?>
                                                                <?php number_format($totalPlacaKilo2,0,'','.')?>
                                                                <?php $totalMerma=$totalPlacaKilo2;		
								}
								else
								{
                                                                ?>		
                                                                <?php number_format($valorOndaKilo,0,'','.');?>
                                                                <?php number_format($costoOndaKilo,0,'','.')?>
                                                                <?php number_format($totalOndaKilo,0,'','.')?>
                                                                <?php $totalMerma=$totalOndaKilo;
								}
                                                                ?>
                            
                            <?php $porcentajeTotalMerma =$totalMerma*10/100; number_format((($totalMerma*10)/(100)),0,'','.')?>
                            
                            
                            <?php
							if($fotomecanica->materialidad_datos_tecnicos == 'Cartulina-cartulina')
								{
									$totalMateriaPrima= $totalPlacaKilo+$totalPlacaKilo2+$porcentajeTotalMerma+$porcentajeTotalCorte;
								}else
								{
									$totalMateriaPrima= $totalOndaKilo+$totalPlacaKilo+$porcentajeTotalMerma+$porcentajeTotalCorte;	
								}
                            
                            ?>
                      <tr>
                
                                <td class="celda_3"><?php number_format($totalMateriaPrima,0,'','.')?></td>
                            </tr>
                     
                            
                            <tr>
                                <?php  $coloresMontaje;?>
                                <td class="celda_3"><?php if($fotomecanica->condicion_del_producto=='Repetición Sin Cambios'){ '0';}else{ number_format($montajePreImpresion->precio,0,'','.');}?></td>
                                <?php if ($fotomecanica->condicion_del_producto=='Repetición Sin Cambios') { ?>
                                <td class="celda_3"><?php number_format(0,0,'','.')?></td>
                                <?php } else { ?>
                                <td class="celda_3"><?php number_format($cantidadMontaje,0,'','.')?></td>
                                <?php } ?>                                
                            </tr>
                        </table>
                         <table id="tabla_detalle">
                     
                         <?php
                        
                        if($fotomecanica->materialidad_datos_tecnicos == 'Cartulina-cartulina')
								{
									$totalMateriaPrima= $totalPlacaKilo+$totalPlacaKilo2+$porcentajeTotalMerma+$porcentajeTotalCorte;
								}else
								{
									$totalMateriaPrima= $totalOndaKilo+$totalPlacaKilo+$porcentajeTotalMerma+$porcentajeTotalCorte;	
								}
                        
                         ?>
                                <?php  number_format($totalMateriaPrima,0,'','.')?>
                                <?php  number_format($totalPreImpresion,0,'','.')?>
                                <?php  number_format($totalProduccion,0,'','.')?>
                                
                         <?php
                           $totalTotal=$totalMateriaPrima+$totalPreImpresion+$totalProduccion+$totalCostosVarios;                                               
                           $totalValorUnitario=$totalTotal/$datoscantidad4;

                          
                          if ($hoja->margen!="") {
                            $valorFinal=(($totalValorUnitario/(100-$hoja->margen))/100)*10000;
                          
                          }else{ 
                              if($datos->margen_migrado!=0 || $datos->margen_migrado!=null){
                                  $valorFinal=(($totalValorUnitario/(100-$datos->margen_migrado))/100)*10000;
                                  $valorFinal2xxx = $this->cotizaciones_model->CantidadPorXXX($id,$datoscantidad4,2);
                                  $valorFinal3xxx = $this->cotizaciones_model->CantidadPorXXX($id,$datoscantidad3,3);
                                  $valorFinal4xxx = $this->cotizaciones_model->CantidadPorXXX($id,$datoscantidad4,4);
                                  
                              }else{
                                  $valorFinal=(($totalValorUnitario/(100-15))/100)*10000;
                                  $valorFinal2xxx = $this->cotizaciones_model->CantidadPorXXX($id,$datoscantidad4,2);
                                  $valorFinal3xxx = $this->cotizaciones_model->CantidadPorXXX($id,$datoscantidad3,3);
                                  $valorFinal4xxx = $this->cotizaciones_model->CantidadPorXXX($id,$datoscantidad4,4);
                              }

                          }
                         ?>
<!--                          <tr>
                               
                                <td class="celda_3"><span class="subrayado">CANTIDAD 4</span></td>
                                <td class="celda_3"><?php //echo number_format($datoscantidad4,0,'','.')?></td>
                            </tr>                                
                          <tr>
                               
                                <td class="celda_3"><span class="subrayado">VALOR FINAL</span></td>
                                <td class="celda_3"><?php //echo number_format($valorFinal,0,'','.')?></td>
                            </tr>
                        -->
                <?php
                            $vcostoFinanciero=$this->variables_cotizador_model->getVariablesCotizadorPorId(33);
                            $recargoPorCantidadJusta=$this->variables_cotizador_model->getVariablesCotizadorPorId(37);
										
                            $valorFinanciado=$valorFinal*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
                            $valorFinanciado2=$valorFinal2xxx*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
                            $valorFinanciado3=$valorFinal3xxx*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
                            $valorFinanciado4=$valorFinal4xxx*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
				
                          //  echo "<h1>$valorFinal2xxx</h1>";
							
                            if($datos->acepta_excedentes=='NO')
                            {
                                $valorFinanciado=(((100+$recargoPorCantidadJusta->precio)/100)*$valorFinanciado);
                                $valorFinanciado2=(((100+$recargoPorCantidadJusta->precio)/100)*$valorFinanciado2);
                                $valorFinanciado3=(((100+$recargoPorCantidadJusta->precio)/100)*$valorFinanciado3);
                                $valorFinanciado4=(((100+$recargoPorCantidadJusta->precio)/100)*$valorFinanciado4);
                            }
                            
                            $var2 = (((($totalProduccion2+$totalDefi1+$totalPreImpresion)*0.085)+(($totalProduccion2+$totalDefi1+$totalPreImpresion)*0.085)+($totalProduccion2+$totalDefi1+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad4;
                            $var3 = (((($totalProduccion3+$totalDefi2+$totalPreImpresion)*0.085)+(($totalProduccion3+$totalDefi2+$totalPreImpresion)*0.085)+($totalProduccion3+$totalDefi2+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad3;
                            $var4 = (((($totalProduccion4+$totalDefi3+$totalPreImpresion)*0.085)+(($totalProduccion4+$totalDefi3+$totalPreImpresion)*0.085)+($totalProduccion4+$totalDefi3+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad4;
			    $cf2= $var2*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
			    $cf3= $var3*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
			    $cf4= $var4*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
			    $valorFinanciado2= $var2*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
			    $valorFinanciado3= $var3*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
			    $valorFinanciado4= $var4*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
                            
                            
                ?>
							<tr>
                               
<!--                                <td class="celda_3">VALOR FINANCIADO <?php// echo $forma_pago->forma_pago?> (<?php //echo $forma_pago->dias?>)</td>
                                <td class="celda_3"><?php// echo number_format($valorFinanciado,0,'','.')?> <input type="hidden" name="valor_financiado" value="<?php// echo $valorFinanciado?>" /> </td>
								-->
                            </tr>
                            <?php
                           
                                if(sizeof($hoja)==0)
                                {
                                    if(($fotomecanica->materialidad_datos_tecnicos=="Indefinido") or ($fotomecanica->materialidad_datos_tecnicos=="Microcorrugado") or ($fotomecanica->materialidad_datos_tecnicos=="Corrugado")  or ($fotomecanica->materialidad_datos_tecnicos=="Cartulina-cartulina"))
                                    {        
                                        $valorEmpresa=$datos->precio_migrado;
                                    }
                                    else {
                                        $valorEmpresa=$valorFinanciado;
                                    }                                    
                                }else
                                {
                                    
                                    if(($fotomecanica->materialidad_datos_tecnicos=="Indefinido") or ($fotomecanica->materialidad_datos_tecnicos=="Microcorrugado") or ($fotomecanica->materialidad_datos_tecnicos=="Corrugado")  or ($fotomecanica->materialidad_datos_tecnicos=="Cartulina-cartulina"))
                                    {        
                                        $valorEmpresa=$datos->precio_migrado;
                                        if($valorEmpresa==0){
                                            $valorEmpresa = $valorFinanciado;
                                        }else{
                                            $valorEmpresa = $datos->precio_migrado;
                                            
                                        }
                                    }
                                    else {
                                        $valorEmpresa=$valorFinanciado;
                                    }      
                                }
                          
                               
                            ?>
<!--                            <tr>
                              
                                <td class="celda_3">VALOR EMPRESA</td>
                                <td class="celda_3"><?php
                                    if (sizeof($hoja) == 0) {
                                        if ($valorEmpresa == 0) {
                                           // echo number_format($valorFinanciado, 0, '', '.');
                                            $valorEmpresa = $valorFinanciado;
                                        } else {
                                          //  echo number_format($valorEmpresa, 0, '', '.');
                                        }
                                    } else {
                                      //  echo number_format($hoja->valor_empresa, 0, '', '.');
                                    }
                                    ?><a href="<?php// echo base_url() ?>hoja/valor_empresa/<?php //echo $id ?>/<?php //echo $pagina ?>/<?php //echo $valorFinanciado; ?>" class="fancybox fancybox.ajax"><img src="<?php //echo base_url() ?>public/frontend/images/edit.png" class="img_16" /></a>
                                    <input type="hidden" name="valor_empresa" value="<?php
                                    if (sizeof($hoja) == 0) {
                                        if ($valorEmpresa == 0 || $valorEmpresa == null){
                                           // echo number_format($valorFinanciado, 0, '', '.');
                                            $valorEmpresa = $valorFinanciado;
                                        } else {
                                         //   echo number_format($valorEmpresa, 0, '', '.');
                                        }
                                    } else {
                                     //   echo $hoja->valor_empresa;
                                    }
                                    ?>" /></td>
                            </tr>-->
<!--                            <tr>
                            
                                <td class="celda_3">DÍAS DE ENTREGA</td>
                                <td class="celda_3"><?php if (sizeof($hoja) == 0) {
                               // echo '20';
                            } else {
                               // echo $hoja->dias_de_entrega;
                            } ?><a href="<?php //echo base_url() ?>hoja/dias/<?php //echo $id ?>/<?php// echo $pagina ?>" class="fancybox fancybox.ajax"><img src="<?php //echo base_url() ?>public/frontend/images/edit.png" class="img_16" /></a><input type="hidden" name="dias_de_entrega" value="<?php //echo $hoja->dias_de_entrega ?>" /></td>
                            </tr>-->
<!--                            <tr>
                                <td class="celda_3">VALOR UNITARIO</td>
                                <td class="celda_3"><?php// echo number_format($totalValorUnitario,0,'','.')?></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>-->
                            <tr>
                                <td class="celda_3">MARGEN</td>
                                        <?php
                                        if(sizeof($hoja)==0) { ?>
                                        <td class="celda_3"><?php if($datos->margen_migrado!=0 || $datos->margen_migrado!= null){echo $datos->margen_migrado;}else{echo "15";} ?> <a href="<?php echo base_url()?>hoja/margen/<?php echo $id?>/<?php echo $pagina?>" class="fancybox fancybox.ajax"><img src="<?php echo base_url()?>public/frontend/images/edit.png" class="img_16" /></a><input type="hidden" name="margen" value="<?php if($datos->margen_migrado!=0 || $datos->margen_migrado!= null){echo $datos->margen_migrado;}else{echo "15";} ?>" /></td>
					  <?php } else { ?>
                                        <td class="celda_3"><?php if($hoja->margen == null){echo '15';}else{echo $hoja->margen;}?> 
                                            <!--<a href="<?php// echo base_url()?>hoja/margen/<?php //echo $id?>/<?php //echo $pagina?>" class="fancybox fancybox.ajax"><img src="<?php //echo base_url()?>public/frontend/images/edit.png" class="img_16" /></a>-->
                                            <?php if($hoja->impreso!=1){echo "<a href='".base_url()."hoja/margen/".$id."/".$pagina."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";}else{echo "<a href='".base_url()."hoja2/margen/".$id."/".$pagina."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";} ?>
                                            <input type="hidden" name="margen" value="<?php echo $hoja->margen?>" /></td>
					<?php }  ?>                                     
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                        </table>
                        <div class="separador_20">&nbsp;</div>
                        <?php
                       
                       if(sizeof($hoja)==0) { 
                        $variablePegado=$this->variables_cotizador_model->getVariablesCotizadorPorId(21);
                        $totalPegado=$datoscantidad4*$pegado_migrado*$variablePegado->precio;                                               
                        $totalPegado2=$datoscantidad3*$pegado_migrado*$variablePegado->precio;                                               
                        $totalPegado3=$datoscantidad4*$pegado_migrado*$variablePegado->precio;                                               
                         } else { 
                        $variablePegado=$this->variables_cotizador_model->getVariablesCotizadorPorId(21);
                        $totalPegado=$datoscantidad4*$hoja->pegado*$variablePegado->precio;                                              
                        $totalPegado2=$datoscantidad3*$hoja->pegado*$variablePegado->precio;                                              
                        $totalPegado3=$datoscantidad4*$hoja->pegado*$variablePegado->precio;                                              
                        }
                        
                        
                     //   echo $pegado_migrado."<br>";
                        if(sizeof($hoja->pegado)>=1)
                         {
                            $divisionPegado=$hoja->pegado/2;
                            $totalDespacho2=$divisionPegado*$datoscantidad4;
                         }
                         else
                         {
                            $divisionPegado=$pegado_migrado/2;
                            $totalDespacho2=$divisionPegado*$datoscantidad4;
                           // echo $totalDespacho2;
                         }
                                         
                        if(sizeof($hoja->pegado)>=1)
                         {
                            $divisionPegado=$hoja->pegado/2;
                            $totalDespacho3=$divisionPegado*$datoscantidad3;
                         }
                         else
                         {
                             if ($datos->pegado_migrado=='')
                                $divisionPegado=$presupuesto->costo_pegado/2;
                             else
                                $divisionPegado=$datos->pegado_migrado/2;
                             $totalDespacho3=$divisionPegado*$datoscantidad3;	 
                         }
                        if(sizeof($hoja->pegado)>=1)
                         {
                            $divisionPegado=$hoja->pegado/2;
                            $totalDespacho4=$divisionPegado*$datoscantidad4;
                         }
                         else
                         {
                             if ($datos->pegado_migrado=='')
                                $divisionPegado=$presupuesto->costo_pegado/2;
                             else
                                $divisionPegado=$datos->pegado_migrado/2;
                             $totalDespacho4=$divisionPegado*$datoscantidad4;	 
                         }
                         
                         //*******************************************
                        $externos_produccion=0;
				if($fotomecanica->acabado_impresion_4=="17")
                                {
                                    $acabado_4="";
                                    $acabado_4Valor="";
                                    $acabado_4MedidaMasValorVenta="";
                                    $acabado_4Unitario="";
                                    $acabado_4UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_4Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_4);
                                    $acabado_4=$acabado_4Array->caracteristicas; // Nombre acabado
                                    $acabado_4UnidadVentaNombre=$acabado_4Array->unv; //Nombre unidad de venta
                                    $acabado_4Valor=$acabado_4Array->valor_venta; // ej: 52
                                    $acabado_4MedidaMasValorVenta=($tamano1*$tamano2*$acabado_4Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_4CostoFijo=$acabado_4Array->costo_fijo;	
                                    
                                    if ($acabado_4Array->unidad_de_venta == '1') //Metros
                                    {
                                        $costo_unitario4=$acabado_4MedidaMasValorVenta;
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad3);
                                        $cantidad_4=$datoscantidad3;
                                    }
                                    elseif ($acabado_4Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $costo_unitario4=$acabado_4Valor;
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }  
                                    elseif ($acabado_4Array->unidad_de_venta == '3') //tONELADA
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad3);
                                    }                                    
                                    elseif ($acabado_4Array->unidad_de_venta == '4') //caja de carton
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad3);
                                    }                                            
                                    elseif ($acabado_4Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($datoscantidad3*$acabado_4Valor);
                                        $cantidad_4=$datoscantidad3;
                                    }       
                                    elseif ($acabado_4Array->unidad_de_venta == '6') //cm2
                                    {
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $costo_unitario4=$acabado_4Valor;     
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }   
                                    elseif ($acabado_4Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario4=$acabado_4MedidaMasValorVenta;
                                        $precio_total_4=$acabado_4MedidaMasValorVenta*$datoscantidad3;
                                        $cantidad_4=$datoscantidad3;
                                    }
                                    elseif ($acabado_4Array->unidad_de_venta == '8') //cms
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad3);
                                    }           
                                    elseif ($acabado_4Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }     
                                    elseif ($acabado_4Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($acabado_4Valor*$datoscantidad3);
                                        $cantidad_4=$datoscantidad3;                                        
                                    }                                      
                                }
								
                                if($fotomecanica->acabado_impresion_5=="17")
                                {
                                    $acabado_5="";
                                    $acabado_5Valor="";
                                    $acabado_5MedidaMasValorVenta="";
                                    $acabado_5Unitario="";
                                    $acabado_5UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_5Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_5);
                                    $acabado_5=$acabado_5Array->caracteristicas;
                                    $acabado_5UnidadVentaNombre=$acabado_5Array->unv; //Nombre unidad de venta
                                    $acabado_5Valor=$acabado_5Array->valor_venta; // ej: 52
                                    $acabado_5MedidaMasValorVenta=($tamano1*$tamano2*$acabado_5Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_5CostoFijo=$acabado_5Array->costo_fijo;		
                                  if ($acabado_5Array->unidad_de_venta == '1') //mt2
                                    {
                                        $costo_unitario5=$acabado_5MedidaMasValorVenta;
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad3);                                      
                                        $cantidad_5=$datoscantidad3;
                                    }
                                    elseif ($acabado_5Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $costo_unitario5=$acabado_5Valor; 
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }    
                                    elseif ($acabado_5Array->unidad_de_venta == '3') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad3);
                                    }                                    
                                    elseif ($acabado_5Array->unidad_de_venta == '4') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad3);
                                    }                                            
                                    elseif ($acabado_5Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($datoscantidad3*$acabado_5Valor);
                                        $cantidad_5=$datoscantidad3;
                                    }       
                                    elseif ($acabado_5Array->unidad_de_venta == '6') //mt2
                                    {
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $costo_unitario5=$acabado_5Valor;
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }   
                                    elseif ($acabado_5Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario5=$acabado_5MedidaMasValorVenta;
                                        $precio_total_5=$acabado_5MedidaMasValorVenta*$datoscantidad3;
                                        $cantidad_5=$datoscantidad3;
                                    }
                                    elseif ($acabado_5Array->unidad_de_venta == '8') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad3);
                                    }           
                                    elseif ($acabado_5Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }   
                                    elseif ($acabado_5Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($acabado_5Valor*$datoscantidad3);
                                        $cantidad_5=$datoscantidad3;
                                    }                                      
                                }    
                                if($fotomecanica->acabado_impresion_6=="17")
                                {
                                    $acabado_6="";
                                    $acabado_6Valor="";
                                    $acabado_6MedidaMasValorVenta="";
                                    $acabado_6Unitario="";
                                    $acabado_6UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_6Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_6);
                                    $acabado_6=$acabado_6Array->caracteristicas;
                                    $acabado_6UnidadVentaNombre=$acabado_6Array->unv; //Nombre unidad de venta
                                    $acabado_6Valor=$acabado_6Array->valor_venta; // ej: 52
                                    $acabado_6MedidaMasValorVenta=($tamano1*$tamano2*$acabado_6Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_6CostoFijo=$acabado_6Array->costo_fijo;		
                                    if ($acabado_6Array->unidad_de_venta == '1') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad3);
                                    }
                                    elseif ($acabado_6Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $costo_unitario6=$acabado_6Valor; 
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    }  
                                    elseif ($acabado_6Array->unidad_de_venta == '3') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad3);
                                    }                                    
                                    elseif ($acabado_6Array->unidad_de_venta == '4') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad3);
                                    }                                            
                                    elseif ($acabado_6Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($datoscantidad3*$acabado_5Valor);
                                        $cantidad_6=$datoscantidad3;
                                    }       
                                    elseif ($acabado_6Array->unidad_de_venta == '6') //mt2
                                    {
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $costo_unitario6=$acabado_6Valor;
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    }   
                                    elseif ($acabado_6Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario6=$acabado_6MedidaMasValorVenta;
                                        $precio_total_6=$acabado_6MedidaMasValorVenta*$datoscantidad3;
                                        $cantidad_6=$datoscantidad3;
                                    }
                                    elseif ($acabado_6Array->unidad_de_venta == '8') //cms
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad3);
                                    }           
                                    elseif ($acabado_6Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    } 
                                    elseif ($acabado_6Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($acabado_6Valor*$datoscantidad3);
                                        $cantidad_6=$datoscantidad3;
                                    }                                      
									

                                }            
                        //*******************************************
              $externos_produccion3=$precio_total_4+$precio_total_5+$precio_total_6;
                        $externos_produccion=0;
				if($fotomecanica->acabado_impresion_4=="17")
                                {
                                    $acabado_4="";
                                    $acabado_4Valor="";
                                    $acabado_4MedidaMasValorVenta="";
                                    $acabado_4Unitario="";
                                    $acabado_4UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_4Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_4);
                                    $acabado_4=$acabado_4Array->caracteristicas; // Nombre acabado
                                    $acabado_4UnidadVentaNombre=$acabado_4Array->unv; //Nombre unidad de venta
                                    $acabado_4Valor=$acabado_4Array->valor_venta; // ej: 52
                                    $acabado_4MedidaMasValorVenta=($tamano1*$tamano2*$acabado_4Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_4CostoFijo=$acabado_4Array->costo_fijo;	
                                    
                                    if ($acabado_4Array->unidad_de_venta == '1') //Metros
                                    {
                                        $costo_unitario4=$acabado_4MedidaMasValorVenta;
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad4);
                                        $cantidad_4=$datoscantidad4;
                                    }
                                    elseif ($acabado_4Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $costo_unitario4=$acabado_4Valor;
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }  
                                    elseif ($acabado_4Array->unidad_de_venta == '3') //tONELADA
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad4);
                                    }                                    
                                    elseif ($acabado_4Array->unidad_de_venta == '4') //caja de carton
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad4);
                                    }                                            
                                    elseif ($acabado_4Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($datoscantidad3*$acabado_4Valor);
                                        $cantidad_4=$datoscantidad4;
                                    }       
                                    elseif ($acabado_4Array->unidad_de_venta == '6') //cm2
                                    {
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $costo_unitario4=$acabado_4Valor;     
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }   
                                    elseif ($acabado_4Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario4=$acabado_4MedidaMasValorVenta;
                                        $precio_total_4=$acabado_4MedidaMasValorVenta*$datoscantidad4;
                                        $cantidad_4=$datoscantidad4;
                                    }
                                    elseif ($acabado_4Array->unidad_de_venta == '8') //cms
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad4);
                                    }           
                                    elseif ($acabado_4Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }     
                                    elseif ($acabado_4Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($acabado_4Valor*$datoscantidad4);
                                        $cantidad_4=$datoscantidad4;                                        
                                    }                                      
                                }
								
                                if($fotomecanica->acabado_impresion_5=="17")
                                {
                                    $acabado_5="";
                                    $acabado_5Valor="";
                                    $acabado_5MedidaMasValorVenta="";
                                    $acabado_5Unitario="";
                                    $acabado_5UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_5Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_5);
                                    $acabado_5=$acabado_5Array->caracteristicas;
                                    $acabado_5UnidadVentaNombre=$acabado_5Array->unv; //Nombre unidad de venta
                                    $acabado_5Valor=$acabado_5Array->valor_venta; // ej: 52
                                    $acabado_5MedidaMasValorVenta=($tamano1*$tamano2*$acabado_5Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_5CostoFijo=$acabado_5Array->costo_fijo;		
                                  if ($acabado_5Array->unidad_de_venta == '1') //mt2
                                    {
                                        $costo_unitario5=$acabado_5MedidaMasValorVenta;
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad4);                                      
                                        $cantidad_5=$datoscantidad4;
                                    }
                                    elseif ($acabado_5Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $costo_unitario5=$acabado_5Valor; 
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }    
                                    elseif ($acabado_5Array->unidad_de_venta == '3') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad4);
                                    }                                    
                                    elseif ($acabado_5Array->unidad_de_venta == '4') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad4);
                                    }                                            
                                    elseif ($acabado_5Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($datoscantidad4*$acabado_5Valor);
                                        $cantidad_5=$datoscantidad4;
                                    }       
                                    elseif ($acabado_5Array->unidad_de_venta == '6') //mt2
                                    {
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $costo_unitario5=$acabado_5Valor;
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }   
                                    elseif ($acabado_5Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario5=$acabado_5MedidaMasValorVenta;
                                        $precio_total_5=$acabado_5MedidaMasValorVenta*$datoscantidad4;
                                        $cantidad_5=$datoscantidad4;
                                    }
                                    elseif ($acabado_5Array->unidad_de_venta == '8') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad4);
                                    }           
                                    elseif ($acabado_5Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }   
                                    elseif ($acabado_5Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($acabado_5Valor*$datoscantidad4);
                                        $cantidad_5=$datoscantidad4;
                                    }                                      
                                }    
                                if($fotomecanica->acabado_impresion_6=="17")
                                {
                                    $acabado_6="";
                                    $acabado_6Valor="";
                                    $acabado_6MedidaMasValorVenta="";
                                    $acabado_6Unitario="";
                                    $acabado_6UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_6Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_6);
                                    $acabado_6=$acabado_6Array->caracteristicas;
                                    $acabado_6UnidadVentaNombre=$acabado_6Array->unv; //Nombre unidad de venta
                                    $acabado_6Valor=$acabado_6Array->valor_venta; // ej: 52
                                    $acabado_6MedidaMasValorVenta=($tamano1*$tamano2*$acabado_6Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_6CostoFijo=$acabado_6Array->costo_fijo;		
                                    if ($acabado_6Array->unidad_de_venta == '1') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad4);
                                    }
                                    elseif ($acabado_6Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $costo_unitario6=$acabado_6Valor; 
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    }  
                                    elseif ($acabado_6Array->unidad_de_venta == '3') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad4);
                                    }                                    
                                    elseif ($acabado_6Array->unidad_de_venta == '4') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad4);
                                    }                                            
                                    elseif ($acabado_6Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($datoscantidad4*$acabado_5Valor);
                                        $cantidad_6=$datoscantidad4;
                                    }       
                                    elseif ($acabado_6Array->unidad_de_venta == '6') //mt2
                                    {
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $costo_unitario6=$acabado_6Valor;
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    }   
                                    elseif ($acabado_6Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario6=$acabado_6MedidaMasValorVenta;
                                        $precio_total_6=$acabado_6MedidaMasValorVenta*$datoscantidad4;
                                        $cantidad_6=$datoscantidad4;
                                    }
                                    elseif ($acabado_6Array->unidad_de_venta == '8') //cms
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad4);
                                    }           
                                    elseif ($acabado_6Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    } 
                                    elseif ($acabado_6Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($acabado_6Valor*$datoscantidad4);
                                        $cantidad_6=$datoscantidad4;
                                    }                                      
									

                                }            
                        //*******************************************
              $externos_produccion4=$precio_total_4+$precio_total_5+$precio_total_6;
                         //*******************************************
                        $externos_produccion=0;
				if($fotomecanica->acabado_impresion_4=="17")
                                {
                                    $acabado_4="";
                                    $acabado_4Valor="";
                                    $acabado_4MedidaMasValorVenta="";
                                    $acabado_4Unitario="";
                                    $acabado_4UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_4Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_4);
                                    $acabado_4=$acabado_4Array->caracteristicas; // Nombre acabado
                                    $acabado_4UnidadVentaNombre=$acabado_4Array->unv; //Nombre unidad de venta
                                    $acabado_4Valor=$acabado_4Array->valor_venta; // ej: 52
                                    $acabado_4MedidaMasValorVenta=($tamano1*$tamano2*$acabado_4Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_4CostoFijo=$acabado_4Array->costo_fijo;	
                                    
                                    if ($acabado_4Array->unidad_de_venta == '1') //Metros
                                    {
                                        $costo_unitario4=$acabado_4MedidaMasValorVenta;
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad4);
                                        $cantidad_4=$datoscantidad4;
                                    }
                                    elseif ($acabado_4Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $costo_unitario4=$acabado_4Valor;
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }  
                                    elseif ($acabado_4Array->unidad_de_venta == '3') //tONELADA
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad4);
                                    }                                    
                                    elseif ($acabado_4Array->unidad_de_venta == '4') //caja de carton
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad4);
                                    }                                            
                                    elseif ($acabado_4Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($datoscantidad4*$acabado_4Valor);
                                        $cantidad_4=$datoscantidad4;
                                    }       
                                    elseif ($acabado_4Array->unidad_de_venta == '6') //cm2
                                    {
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $costo_unitario4=$acabado_4Valor;     
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }   
                                    elseif ($acabado_4Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario4=$acabado_4MedidaMasValorVenta;
                                        $precio_total_4=$acabado_4MedidaMasValorVenta*$datoscantidad4;
                                        $cantidad_4=$datoscantidad4;
                                    }
                                    elseif ($acabado_4Array->unidad_de_venta == '8') //cms
                                    {
                                        $precio_total_4=($acabado_4MedidaMasValorVenta*$datoscantidad4);
                                    }           
                                    elseif ($acabado_4Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($acabado_4Valor*$fotomecanica->input_variable_externo_4);
                                        $cantidad_4=$fotomecanica->input_variable_externo_4;
                                    }     
                                    elseif ($acabado_4Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario4=$acabado_4Valor;                                        
                                        $precio_total_4=($acabado_4Valor*$datoscantidad4);
                                        $cantidad_4=$datoscantidad4;                                        
                                    }                                      
                                }
								
                                if($fotomecanica->acabado_impresion_5=="17")
                                {
                                    $acabado_5="";
                                    $acabado_5Valor="";
                                    $acabado_5MedidaMasValorVenta="";
                                    $acabado_5Unitario="";
                                    $acabado_5UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_5Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_5);
                                    $acabado_5=$acabado_5Array->caracteristicas;
                                    $acabado_5UnidadVentaNombre=$acabado_5Array->unv; //Nombre unidad de venta
                                    $acabado_5Valor=$acabado_5Array->valor_venta; // ej: 52
                                    $acabado_5MedidaMasValorVenta=($tamano1*$tamano2*$acabado_5Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_5CostoFijo=$acabado_5Array->costo_fijo;		
                                  if ($acabado_5Array->unidad_de_venta == '1') //mt2
                                    {
                                        $costo_unitario5=$acabado_5MedidaMasValorVenta;
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad4);                                      
                                        $cantidad_5=$datoscantidad4;
                                    }
                                    elseif ($acabado_5Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $costo_unitario5=$acabado_5Valor; 
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }    
                                    elseif ($acabado_5Array->unidad_de_venta == '3') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad4);
                                    }                                    
                                    elseif ($acabado_5Array->unidad_de_venta == '4') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad4);
                                    }                                            
                                    elseif ($acabado_5Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($datoscantidad4*$acabado_5Valor);
                                        $cantidad_5=$datoscantidad4;
                                    }       
                                    elseif ($acabado_5Array->unidad_de_venta == '6') //mt2
                                    {
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $costo_unitario5=$acabado_5Valor;
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }   
                                    elseif ($acabado_5Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario5=$acabado_5MedidaMasValorVenta;
                                        $precio_total_5=$acabado_5MedidaMasValorVenta*$datoscantidad4;
                                        $cantidad_5=$datoscantidad4;
                                    }
                                    elseif ($acabado_5Array->unidad_de_venta == '8') //mt2
                                    {
                                        $precio_total_5=($acabado_5MedidaMasValorVenta*$datoscantidad4);
                                    }           
                                    elseif ($acabado_5Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($acabado_5Valor*$fotomecanica->input_variable_externo_5);
                                        $cantidad_5=$fotomecanica->input_variable_externo_5;
                                    }   
                                    elseif ($acabado_5Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario5=$acabado_5Valor;                                        
                                        $precio_total_5=($acabado_5Valor*$datoscantidad4);
                                        $cantidad_5=$datoscantidad4;
                                    }                                      
                                }    
                                if($fotomecanica->acabado_impresion_6=="17")
                                {
                                    $acabado_6="";
                                    $acabado_6Valor="";
                                    $acabado_6MedidaMasValorVenta="";
                                    $acabado_6Unitario="";
                                    $acabado_6UnidadVentaNombre="";
                                }else
                                {
                                    $acabado_6Array=$this->acabados_model->getAcabadosPorId($fotomecanica->acabado_impresion_6);
                                    $acabado_6=$acabado_6Array->caracteristicas;
                                    $acabado_6UnidadVentaNombre=$acabado_6Array->unv; //Nombre unidad de venta
                                    $acabado_6Valor=$acabado_6Array->valor_venta; // ej: 52
                                    $acabado_6MedidaMasValorVenta=($tamano1*$tamano2*$acabado_6Valor)/10000; // (ancho x largo x valor venta) /10000									
                                    $acabado_6CostoFijo=$acabado_6Array->costo_fijo;		
                                    if ($acabado_6Array->unidad_de_venta == '1') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad4);
                                    }
                                    elseif ($acabado_6Array->unidad_de_venta == '2') //Kilos
                                    {
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $costo_unitario6=$acabado_6Valor; 
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    }  
                                    elseif ($acabado_6Array->unidad_de_venta == '3') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad4);
                                    }                                    
                                    elseif ($acabado_6Array->unidad_de_venta == '4') //mt2
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad4);
                                    }                                            
                                    elseif ($acabado_6Array->unidad_de_venta == '5') //unidad
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($datoscantidad4*$acabado_5Valor);
                                        $cantidad_6=$datoscantidad4;
                                    }       
                                    elseif ($acabado_6Array->unidad_de_venta == '6') //mt2
                                    {
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $costo_unitario6=$acabado_6Valor;
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    }   
                                    elseif ($acabado_6Array->unidad_de_venta == '7') //mt2
                                    {
                                        $costo_unitario6=$acabado_6MedidaMasValorVenta;
                                        $precio_total_6=$acabado_6MedidaMasValorVenta*$datoscantidad4;
                                        $cantidad_6=$datoscantidad4;
                                    }
                                    elseif ($acabado_6Array->unidad_de_venta == '8') //cms
                                    {
                                        $precio_total_6=($acabado_6MedidaMasValorVenta*$datoscantidad4);
                                    }           
                                    elseif ($acabado_6Array->unidad_de_venta == '9') //Monto Fijo 
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($acabado_6Valor*$fotomecanica->input_variable_externo_6);
                                        $cantidad_6=$fotomecanica->input_variable_externo_6;
                                    } 
                                    elseif ($acabado_6Array->unidad_de_venta == '10') //Por Pasada 
                                    {
                                        $costo_unitario6=$acabado_6Valor;                                        
                                        $precio_total_6=($acabado_6Valor*$datoscantidad4);
                                        $cantidad_6=$datoscantidad4;
                                    }                                      
									

                                }            
                        //*******************************************
              $externos_produccion2=$precio_total_4+$precio_total_5+$precio_total_6;
                                            
            $tira3=((($datoscantidad4/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio )*($fotomecanica->colores+$barniz2)."<br>";
            $tira4=((($datoscantidad4/$ing->unidades_por_pliego)+$sum)*$factor_rango+$base_imprenta->precio)*($fotomecanica->colores+$barniz2)*(1*$recargo800Array->precio/100);
            $tirajetotal2=$tira3+$tira4."<br>";
            
            $tira5=((($datoscantidad3/$ing->unidades_por_pliego)+$sum)*$factor_rango3+$base_imprenta->precio )*($fotomecanica->colores+$barniz2)."<br>";
            $tira6=((($datoscantidad3/$ing->unidades_por_pliego)+$sum)*$factor_rango3+$base_imprenta->precio)*($fotomecanica->colores+$barniz2)*(1*$recargo800Array->precio/100);
            $tirajetotal3=$tira5+$tira6."<br>";
            
            $tira7=((($datoscantidad4/$ing->unidades_por_pliego)+$sum)*$factor_rango4+$base_imprenta->precio )*($fotomecanica->colores+$barniz2)."<br>";
            $tira8=((($datoscantidad4/$ing->unidades_por_pliego)+$sum)*$factor_rango4+$base_imprenta->precio)*($fotomecanica->colores+$barniz2)*(1*$recargo800Array->precio/100);
            $tirajetotal4=$tira7+$tira8."<br>";
            //exit();
            //valor corte para los 4
            $valorCorte2=(((($datoscantidad4/$ing->unidades_por_pliego)*1.04)+104)*4.5);
            $valorCorte3=(((($datoscantidad3/$ing->unidades_por_pliego)*1.04)+104)*4.5);
            $valorCorte4=(((($datoscantidad4/$ing->unidades_por_pliego)*1.04)+104)*4.5);
            
           $costoOnda2=(((($datoscantidad4/$ing->unidades_por_pliego)*1.04)+104))."<br>";
           $costoOnda3=(((($datoscantidad3/$ing->unidades_por_pliego)*1.04)+104))."<br>";
           $costoOnda4=(((($datoscantidad4/$ing->unidades_por_pliego)*1.04)+104))."<br>";
           
            if($fotomecanica->estan_los_moldes == 'NO LLEVA')
	    {
            $variableTroquelado=0;
            $totalTroquelado=0;
            }else
            {
            $variableTroquelado=$this->variables_cotizador_model->getVariablesCotizadorPorId(11);
            $totalTroquelado2=($costoOnda2*$variableTroquelado->precio)*1.5;	
            }     
            if($fotomecanica->estan_los_moldes == 'NO LLEVA')
	    {
            $variableTroquelado=0;
            $totalTroquelado=0;
            }else
            {
            $variableTroquelado=$this->variables_cotizador_model->getVariablesCotizadorPorId(11);
            $totalTroquelado3=($costoOnda3*$variableTroquelado->precio)*1.5;	
            }     
            if($fotomecanica->estan_los_moldes == 'NO LLEVA')
	    {
            $variableTroquelado=0;
            $totalTroquelado=0;
            }else
            {
            $variableTroquelado=$this->variables_cotizador_model->getVariablesCotizadorPorId(11);
            $totalTroquelado4=($costoOnda4*$variableTroquelado->precio)*1.5;	
            }     
           // valor del emplacado 
           $variableEmplacado=$this->variables_cotizador_model->getVariablesCotizadorPorId(8);
           $valorEmplacadado=($variableEmplacado->precio*$tamano1*$tamano2)/10000;
           $totalEmplacado2=$valorEmplacadado*$costoOnda2."<br>";
           $totalEmplacado3=$valorEmplacadado*$costoOnda3."<br>";
           $totalEmplacado4=$valorEmplacadado*$costoOnda4."<br>";
           
                            $dos=($datoscantidad4/$ing->unidades_por_pliego)+$sum2."<br />";
                            $tres=($datoscantidad3/$ing->unidades_por_pliego)+$sum3."<br />";
                            $cuatro=($datoscantidad4/$ing->unidades_por_pliego)+$sum4."<br />";
                          
                            $valorPlacaKilo2=(($dos*$tamano1*$tamano2*$tapaGramaje)/10000000)."<br />";
                            $valorPlacaKilo3=(($tres*$tamano1*$tamano2*$tapaGramaje)/10000000)."<br />";
                            $valorPlacaKilo4=(($cuatro*$tamano1*$tamano2*$tapaGramaje)/10000000)."<br />";
                            
                            $totalPlacaKilo2=$valorPlacaKilo2*$materialidad_1->precio."<br />";
                            $totalPlacaKilo3=$valorPlacaKilo3*$materialidad_1->precio."<br />";
                            $totalPlacaKilo4=$valorPlacaKilo4*$materialidad_1->precio."<br />";
                            
                            //$v2= number_format((($datoscantidad4/$ing->unidades_por_pliego)*1.04)+104,0,'','.');
                            $v2= number_format((($datoscantidad4/$ing->unidades_por_pliego)*1.04)+104,0,'','.');
                            $v3= number_format((($datoscantidad3/$ing->unidades_por_pliego)*1.04)+104,0,'','.');
                            $v4= number_format((($datoscantidad4/$ing->unidades_por_pliego)*1.04)+104,0,'','.');
                            
                            $OndaKilo2=number_format((($v2*$tamano1*$tamano2*$GramosMetroCuadrado)/10000),0,'','.')."<br />";
                            $OndaKilo3=number_format((($v3*$tamano1*$tamano2*$GramosMetroCuadrado)/10000),0,'','.')."<br />";
                            $OndaKilo4=number_format((($v4*$tamano1*$tamano2*$GramosMetroCuadrado)/10000),0,'','.')."<br />";
                            
                            $vt2=number_format(((($v2*$tamano1*$tamano2*$GramosMetroCuadrado)/10000)*$costo_kilo),0,'','.');
                            $vt3=number_format(((($v3*$tamano1*$tamano2*$GramosMetroCuadrado)/10000)*$costo_kilo),0,'','.')."<br />";
                            $vt4=number_format(((($v4*$tamano1*$tamano2*$GramosMetroCuadrado)/10000)*$costo_kilo),0,'','.')."<br />";
                            //echo number_format($totalPlacaKilo2,0,'','.')."<br>";
                            
                           $totalDefi1=$totalPlacaKilo2+((($v2*$tamano1*$tamano2*$GramosMetroCuadrado)/10000)*$costo_kilo);
                            $totalDefi2=$totalPlacaKilo3+((($v3*$tamano1*$tamano2*$GramosMetroCuadrado)/10000)*$costo_kilo);
                            $totalDefi3=$totalPlacaKilo4+((($v4*$tamano1*$tamano2*$GramosMetroCuadrado)/10000)*$costo_kilo);
                            
                            
                            
                            $variableDesgajado=$this->variables_cotizador_model->getVariablesCotizadorPorId(12);
                            $totalDesgajado2=$ing->piezas_totales_en_el_pliego*$variableDesgajado->precio*1.5*$costoOnda2;
                            $totalDesgajado3=$ing->piezas_totales_en_el_pliego*$variableDesgajado->precio*1.5*$costoOnda3;
                            $totalDesgajado4=$ing->piezas_totales_en_el_pliego*$variableDesgajado->precio*1.5*$costoOnda4;
                            $TotalPiezasAdicionales2=$datoscantidad4*$piezaAdacionalValor1;
                            $TotalPiezasAdicionales3=$datoscantidad3*$piezaAdacionalValor1;
                            $TotalPiezasAdicionales4=$datoscantidad4*$piezaAdacionalValor1;
                           
                             if(sizeof($hoja)==0) { 
                              if($datos->margen_migrado==0){
                                 $margen=15; 
                              }else{
                                 $margen= $datos->margen_migrado;
                              }
				 } else {if($hoja->margen == null){$margen=15;}
                                 else{
                                 $margen=$hoja->margen;}
			         }  
                            //  echo "<h1>margen</h1>".$margen;
                            $totalProduccion2=$costosporlacado2+$complemento+$valorCorte2+$totalEmplacado2+$totalMontajeMolde+$totalTroquelado2+$totalPegado+$totalDespacho2+$tirajetotal2+$moldeTroquel+$totalDesgajado2+$externos_produccion2+$otrosCaucho + $TotalPiezasAdicionales2 + $valor_extra + $valor_bv_maquina + $valor_acepeta_exce."<br>";
                            $totalProduccion3=$costosporlacado3+$complemento+$valorCorte3+$totalEmplacado3+$totalMontajeMolde+$totalTroquelado3+$totalPegado2+$totalDespacho3+$tirajetotal3+$moldeTroquel+$totalDesgajado3+$externos_produccion3+$otrosCaucho + $TotalPiezasAdicionales3 + $valor_extra + $valor_bv_maquina + $valor_acepeta_exce."<br>";
                           // $totalProduccion4=$costosporlacado4+$complemento+$valorCorte4+$totalEmplacado4+$totalMontajeMolde+$totalTroquelado4+$totalPegado3+$totalDespacho4+$tirajetotal4+$moldeTroquel+$totalDesgajado4+$externos_produccion4+$otrosCaucho + $TotalPiezasAdicionales4 + $valor_extra + $valor_bv_maquina + $valor_acepeta_exce."<br>";
                            

                                                              
                                                if($mdt=='Cartulina-cartulina' || $mdt=='Sólo Cartulina'){
                                                    $des = calcularDespacho($valorPlacaKilo, $valorPlacaKilo2, $retiro, $mdt, $fuerasantiago, $distancia);  
                                                }else{
                                                    $des = calcularDespacho($valorPlacaKilo, $valorOndaKilo, $retiro, $mdt, $fuerasantiago, $distancia);
                                                }                                           
                                                                
                                         $totalProduccion4 = $totalProduccion4+$des[0];               
                            ?>
                       
                        <table id="tabla_detalle" border="0">
                            <tr>
                                <td width="150px">PALETS:&nbsp;<?php echo $des[1];?></td>
                                <td>VALOR:&nbsp;<?php echo $des[0]; ?></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td width="150px">TIRAJE 4</td>
                                <td><?php if($mostrarboton != 1){echo number_format($tirajetotal4,0,'','.');}else{if($hoja->tiraje4!=""){$tirajetotal4=$hoja->tiraje4; echo number_format($hoja->tiraje4,0,'','.');}else{echo number_format($tirajetotal4,0,'','.');}}?>
                                <?php if($hoja->impreso!=1 && $mostrarboton == 1){echo "<a href='".base_url()."hoja2/tiraje4/".$id."/4' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";} ?>
                                </td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td width="150px">&nbsp;</td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td width="150px">Total Materia Prima</td>
                                <td><?php echo number_format($totalMateriaPrima,0,",",".") ?></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>Total Pre Impresion</td>
                                <td><?php echo number_format($totalPreImpresion,0,",",".")?></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>Total Produccion</td>
                                <td><?php echo number_format($totalProduccion4,0,",",".") ?></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>&nbsp;</td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>Sub Total</td>
                                <td><?php echo number_format($totalProduccion4+$totalPreImpresion+$totalMateriaPrima,0,",",".") ?></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>Total Costos Varios</td>
                                <td><?php echo number_format(($totalProduccion4+$totalPreImpresion+$totalMateriaPrima)*0.17,0,",",".") ?></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>&nbsp;</td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>Total</td>
                                <td><?php echo number_format(($totalProduccion4+$totalPreImpresion+$totalMateriaPrima)*0.17+($totalProduccion4+$totalPreImpresion+$totalMateriaPrima),0,",",".") ?></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>&nbsp;</td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                        </table>
                         <?php 
                        $totalTotal4=($totalProduccion4+$totalPreImpresion+$totalMateriaPrima)*0.17+($totalProduccion4+$totalPreImpresion+$totalMateriaPrima);
                        $totalValorUnitario4=$totalTotal4/$datoscantidad4;

                          if ($hoja->margen!="") {
                            $valorFinal4=(($totalValorUnitario4/(100-$hoja->margen))/100)*10000;
                            $valorFinanciado4=$valorFinal4*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;              
                          }else{ 
                              if($datos->margen_migrado!=0 || $datos->margen_migrado!=null){
                                  $valorFinal4=(($totalValorUnitario4/(100-$datos->margen_migrado))/100)*10000;   
                              }else{
                                  $valorFinal4=(($totalValorUnitario4/(100-15))/100)*10000;
                              }

                          }
                          
                            if($datos->acepta_excedentes=='NO')
                            {
                                $valorFinanciado4=(((100+$recargoPorCantidadJusta->precio)/100)*$valorFinanciado4);
                            }
                        ?>
                        <table id="tabla_detalle">
                            
                            <tr>
                                <td class="celda_3"><h5>CANTIDAD 4</h5></td>
                                <td class="celda_3"><h5><?php if($datoscantidad4 == 1){ echo 0;}else{echo number_format($datoscantidad4,0,"",".");}?> 
                                <!--<a href="<?php //echo base_url()?>hoja/cantidad4/<?php //echo $id?>/4" class="fancybox fancybox.ajax"><img src="<?php //echo base_url()?>public/frontend/images/edit.png" class="img_16" /></a></td>-->
                                <?php if($hoja->impreso!=1){echo "<a href='".base_url()."hoja/cantidad4/".$id."/4' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";}else{echo "<a href='".base_url()."hoja2/cantidad4/".$id."/4' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a></h5>";} ?>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"><?php if($datoscantidad3 == 1){ echo 0;}else{ number_format($datoscantidad3,0,"",".");}?> </td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"><?php if($datoscantidad4 == 1){ echo 0;}else{ number_format($datoscantidad4,0,"",".");}?> </td>
                            </tr>
						
							
                            <tr>
                                <td class="celda_3">VALOR FINAL</td>
                                <td class="celda_3"><?php if($datoscantidad4 == 1){ echo 0;}else{
                                echo number_format($valorFinal4,0,'','.');}?></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"><?php if($datoscantidad3 == 1){ echo 0;}else{
                                 number_format(((((($totalProduccion3+$totalDefi2+$totalPreImpresion)*0.085)+(($totalProduccion3+$totalDefi2+$totalPreImpresion)*0.085)+($totalProduccion3+$totalDefi2+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad3),0,'','.');}?></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"><?php if($datoscantidad4 == 1){ echo 0;}else{
                                 number_format(((((($totalProduccion4+$totalDefi3+$totalPreImpresion)*0.085)+(($totalProduccion4+$totalDefi3+$totalPreImpresion)*0.085)+($totalProduccion4+$totalDefi3+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad4),0,'','.');}?></td>
                            </tr>
                            <?php
				if(sizeof($hoja)==0)
                                {
                                    $valorEmpresa2=number_format($valorFinanciado2,0,'','.');
                                    $valorEmpresa3=number_format($valorFinanciado3,0,'','.');
                                    $valorEmpresa4=number_format($valorFinanciado4,0,'','.');
                                }else
                                {
                                    $valorEmpresa2=$hoja->valor_empresa_4;
                                    $valorEmpresa3=$hoja->valor_empresa_3;
                                    $valorEmpresa4=$hoja->valor_empresa_4;
                                }
								

				if($hoja->valor_empresa_4 == 0)
                                {
                                $valorEmpresa_4=$valorFinanciado4;  
                          	$arregloVEmpresa=array
                                (
                                        "valor_empresa_4"=>$valorEmpresa_4,
                                );

                                $this->db->where('id', $hoja->id);
                                $this->db->update("hoja_de_costos_datos",$arregloVEmpresa);
                                }
								
//								if($hoja->valor_empresa_3 ==0)
//                                {                                    
//                                    $valorEmpresa_3=$valorFinanciado3;  
//									
//									$arregloVEmpresa=array
//									(
//										"valor_empresa_3"=>$valorEmpresa_3,
//									);
//									
//									$this->db->where('id', $hoja->id);
//									$this->db->update("hoja_de_costos_datos",$arregloVEmpresa);                                  
//                                }
//								
//								if($hoja->valor_empresa_4 ==0)
//                                {
//                                    $valorEmpresa_4=$valorFinanciado4;  
//									
//									$arregloVEmpresa=array
//									(
//										"valor_empresa_4"=>$valorEmpresa_4,
//									);
//									
//									$this->db->where('id', $hoja->id);
//									$this->db->update("hoja_de_costos_datos",$arregloVEmpresa);   
//                                }
								
								
                            ?>
                            
							<?php
							$var2 = (((($totalProduccion2+$totalDefi1+$totalPreImpresion)*0.085)+(($totalProduccion2+$totalDefi1+$totalPreImpresion)*0.085)+($totalProduccion2+$totalDefi1+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad4;
                                                        $var3 = (((($totalProduccion3+$totalDefi2+$totalPreImpresion)*0.085)+(($totalProduccion3+$totalDefi2+$totalPreImpresion)*0.085)+($totalProduccion3+$totalDefi2+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad3;
                                                        $var4 = (((($totalProduccion4+$totalDefi3+$totalPreImpresion)*0.085)+(($totalProduccion4+$totalDefi3+$totalPreImpresion)*0.085)+($totalProduccion4+$totalDefi3+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad4;
							$cf2= $var2*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
							$cf3= $var3*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
							$cf4= $var4*(((( $vcostoFinanciero->precio/30)*$forma_pago->dias)+100))/100;
							?>
							
                            <tr>
                                <td class="celda_3">VALOR FINANCIERO 4</td>
                                <td class="celda_3">
                                <?php //echo number_format((((($vcostoFinanciero->precio/30)*30)+100)/100)*((((($totalProduccion2+$totalDefi1+$totalPreImpresion)*0.085)+(($totalProduccion2+$totalDefi1+$totalPreImpresion)*0.085)+($totalProduccion2+$totalDefi1+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad4),0,'','.') ?>
                                <?php //echo number_format($cf2,0,'','.') ?>
                                <?php echo number_format($valorFinanciado4,0,'','.') ?>
                                </td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">
                                <?php //echo number_format((((($vcostoFinanciero->precio/30)*30)+100)/100)*((((($totalProduccion3+$totalDefi2+$totalPreImpresion)*0.085)+(($totalProduccion3+$totalDefi2+$totalPreImpresion)*0.085)+($totalProduccion3+$totalDefi2+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad3),0,'','.') ?>
                                <?php  number_format($cf3,0,'','.') ?>
                                </td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">
                                <?php //echo number_format((((($vcostoFinanciero->precio/30)*30)+100)/100)*((((($totalProduccion4+$totalDefi3+$totalPreImpresion)*0.085)+(($totalProduccion4+$totalDefi3+$totalPreImpresion)*0.085)+($totalProduccion4+$totalDefi3+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad4),0,'','.') ?>
                                <?php  number_format($cf4,0,'','.') ?>
                                </td>
                            </tr><input type="hidden" name="vf4" id="vf4" value="<?php echo $valorFinanciado4; ?>"/>
                            <?php
                            $vfinanciero2=number_format((((($vcostoFinanciero->precio/30)*30)+100)/100)*((((($totalProduccion2+$totalDefi1+$totalPreImpresion)*0.085)+(($totalProduccion2+$totalDefi1+$totalPreImpresion)*0.085)+($totalProduccion2+$totalDefi1+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad4),0,'','.');
                            $vfinanciero3=number_format((((($vcostoFinanciero->precio/30)*30)+100)/100)*((((($totalProduccion3+$totalDefi2+$totalPreImpresion)*0.085)+(($totalProduccion3+$totalDefi2+$totalPreImpresion)*0.085)+($totalProduccion3+$totalDefi2+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad3),0,'','.');
                            $vfinanciero4=number_format((((($vcostoFinanciero->precio/30)*30)+100)/100)*((((($totalProduccion4+$totalDefi3+$totalPreImpresion)*0.085)+(($totalProduccion4+$totalDefi3+$totalPreImpresion)*0.085)+($totalProduccion4+$totalDefi3+$totalPreImpresion))/((100-$margen)/100))/$datoscantidad4),0,'','.');
                            
                            ?>
                            <tr>
                                <td class="celda_3"><h5>VALOR EMPRESA 4</h5></td>
                                <!--<td class="celda_3"><?php //if(sizeof($hoja)==0){if($datoscantidad4 == 1){echo 0;}else{if( $valorEmpresa2 == 0){echo number_format($valorFinanciado2,0,'','.');}else{echo $vfinanciero2;}}}else{echo number_format($hoja->valor_empresa_4,0,'','.');}?> <a href="<?php //echo base_url()?>hoja/valor_empresa_4/<?php //echo $id?>/2" class="fancybox fancybox.ajax"><img src="<?php //echo base_url()?>public/frontend/images/edit.png" class="img_16" /></a></td>-->
                                 <td class="celda_3"><h5><?php
                                    if (sizeof($hoja) == 0) {
                                        if ($valorEmpresa == 0) {
                                            echo number_format($valorFinanciado4, 0, '', '.');
                                            $valorEmpresa = $valorFinanciado4;
                                        } else {
                                            echo number_format($valorEmpresa, 0, '', '.');
                                        }
                                    } else {
                                        echo number_format($hoja->valor_empresa_4, 0, '', '.');
                                        $valorEmpresa = $hoja->valor_empresa_4;
                                    }
                                    ?>
                                    <!--<a href="<?php //echo base_url() ?>hoja/valor_empresa_4/<?php //echo $id ?>/<?php //echo $pagina ?>/<?php //echo $valorFinanciado; ?>" class="fancybox fancybox.ajax"><img src="<?php //echo base_url() ?>public/frontend/images/edit.png" class="img_16" /></a>-->
                                    <?php if($hoja->impreso!=1){echo "<a href='".base_url()."hoja/valor_empresa_4/".$id."/".$pagina."/".$valorFinanciado."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";}else{echo "<a href='".base_url()."hoja2/valor_empresa_4/".$id."/".$pagina."/".$valorFinanciado."' class='fancybox fancybox.ajax'><img src='".base_url()."public/frontend/images/edit.png' class='img_16' /></a>";} ?>
                                     <input type="hidden" name="valor_empresa_4" value="<?php
                                    if (sizeof($hoja) == 0) {
                                        if ($valorEmpresa == 0 || $valorEmpresa == null){
                                            echo number_format($valorFinanciado, 0, '', '.');
                                            $valorEmpresa = $valorFinanciado;
                                        } else {
                                            echo number_format($valorEmpresa, 0, '', '.');
                                        }
                                    } else {
                                        echo $hoja->valor_empresa_4;
                                        $valorEmpresa = $hoja->valor_empresa_4;
                                    }
                                    ?>" /></h5></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"><?php if(sizeof($hoja)==0){if($datoscantidad3 == 1){echo 0;}else{if( $valorEmpresa3 == 0){ number_format($valorFinanciado3,0,'','.');}else{ $vfinanciero3;}}}else{ number_format($hoja->valor_empresa_3,0,'','.');}?></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"><?php if(sizeof($hoja)==0){if($datoscantidad4 == 1){echo 0;}else{if( $valorEmpresa4 == 0){ number_format($valorFinanciado4,0,'','.');}else{ $vfinanciero4;}}}else{ number_format($hoja->valor_empresa_4,0,'','.');}?> </td>
								 
                            </tr><input type="hidden" name="ve4" id="ve4" value="<?php echo $valorEmpresa;?>"/>
                            <input type="hidden" name="valor_empresa_4" value="<?php if($datoscantidad4 == 1){
                                echo 0;
                            }
                            else{
                                    if( $valorEmpresa2 == 0){
                                        echo str_replace ( ".", "",$valorFinanciado2);
                                    }else{
                                        //echo str_replace ( ".", "",$vfinanciero2);
                                        echo str_replace ( ".", "",$valorEmpresa2);
                                    }
                                }?>" />
                            <input type="hidden" name="valor_empresa_3" value="<?php if($datoscantidad3 == 1){
                                echo 0;
                            }
                            else{
                                    if( $valorEmpresa3 == 0){
                                        echo str_replace ( ".", "",$valorFinanciado3);
                                    }else{
                                        //echo str_replace ( ".", "",$vfinanciero3);
                                        echo str_replace ( ".", "",$valorEmpresa3);
                                    }
                                }?>" />
                            <input type="hidden" name="valor_empresa_4" value="<?php if($datoscantidad4 == 1){
                                echo 0;
                            }
                            else{
                                    if( $valorEmpresa4 == 0){
                                        echo str_replace ( ".", "",$valorFinanciado4);
                                    }else{
                                        //echo str_replace ( ".", "",$vfinanciero4);
                                        echo str_replace ( ".", "",$valorEmpresa4);
                                    }
                                }?>" />
<!--                            <input type="hidden" name="valor_empresa_4" value="<?php// echo str_replace ( '.', '', $valorEmpresa2);?>" />
                            <input type="hidden" name="valor_empresa_3" value="<?php// echo str_replace ( '.', '', $valorEmpresa3);?>" />
                            <input type="hidden" name="valor_empresa_4" value="<?php// echo str_replace ( '.', '', $valorEmpresa4);?>" />-->
                        </table>
                        <div class="separador_10">&nbsp;</div>
                        <table id="tabla_detalle">
						
                            <tr>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3">MATERIAL</td>
                                <td class="celda_3">GRAMAJE</td>
                                <td class="celda_3">TOTAL PLIEGOS</td>
                                <td class="celda_3"></td>
                                <td class="celda_3">TOTAL KILOS</td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3"><?php echo $fotomecanica->materialidad_datos_tecnicos;?></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"></td>
                                <td class="celda_3"></td>
                                <td class="celda_3"></td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
							<?php 
                            if($fotomecanica->materialidad_datos_tecnicos == 'Cartulina-cartulina')
                                    {
							?>				
											
							<tr>
                                <td class="celda_3">TAPA</td>
                                <td class="celda_3"><?php echo $tapaNombre?> (<?php echo number_format($tapaPrecio,0,'','.')?>)</td>
                                <td class="celda_3"><?php echo number_format($costoPlacaKilo,0,'','.') ?></td>
                                <td class="celda_3"></td>
                                <td class="celda_3"><?php echo number_format($valorPlacaKilo,0,'','.');?></td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3">Tapa (Respaldo)</td>
                                <td class="celda_3"><?php echo $tapaNombre2?> (<?php echo number_format($tapaPrecio2,0,'','.')?>)</td>
                                <td class="celda_3"><?php echo number_format($costoPlacaKilo2,0,'','.') ?></td>
                                <td class="celda_3"></td>
                                <td class="celda_3"><?php echo number_format($valorPlacaKilo2,0,'','.');?></td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3"></td>
                                <td class="celda_3"></td>
                                <td class="celda_3"></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"></td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>				
											
							<?php				
				}else{

                                    if($fotomecanica->materialidad_datos_tecnicos == 'Corrugado')
                                    {

                                        $variable_cotizador=$this->variables_cotizador_model->getVariablesCotizadorPorId(25);
                                    }
                                    if($fotomecanica->materialidad_datos_tecnicos == 'Microcorrugado'){
                                    
                                        $variable_cotizador=$this->variables_cotizador_model->getVariablesCotizadorPorId(24);	
                                    }			
                                    if($fotomecanica->materialidad_datos_tecnicos == 'Indefinido'){

                                        $variable_cotizador=$this->variables_cotizador_model->getVariablesCotizadorPorId(24);	
                                    }	                                    
//                                    exit($fotomecanica->materialidad_datos_tecnicos."aquiii");       
                                    if (($datoscantidad4>0) and ($ing->unidades_por_pliego>0))
                                        $cantidad_cajas = ($datoscantidad4 / $ing->unidades_por_pliego) + 104;                                    
                                    else $cantidad_cajas = 104;                                    
                                   

                                    $kilosOnda =  ($tamano1 * $tamano2 * $ondaGramaje * $cantidad_cajas * (($variable_cotizador->precio * 10 + 1000)/1000)) / 10000000;
                                    
                                    $kilosLiner =  ($tamano1 * $tamano2 * $linerGramaje * $cantidad_cajas ) / 10000000;				
//                                    echo $kilosLiner ."=  (".$tamano1." * ".$tamano2." * ".$linerGramaje." * ".$cantidad_cajas." ) / 10000000";
    
                                    if(sizeof($hoja)>=1)
                                    {
                                        $arreglokilo2=array
                                        (
                                            "kilos_onda"=>$kilosOnda,
                                        );
                               
                                        $this->db->where('id', $hoja->id);
                                        $this->db->update("hoja_de_costos_datos",$arreglokilo2);
                                 
                                      

                                        $arreglokilo3=array
                                        (
                                            "kilos_liner"=>$kilosLiner,
                                        );
                                        $this->db->where('id', $hoja->id);
                                        $this->db->update("hoja_de_costos_datos",$arreglokilo3);
//                                        echo $hoja->id."---jaime----";
//                                        exit(print_r($arreglokilo2));                                           
                                    }
                                    ?>				
										
										
										
							<tr>
                                <td class="celda_3">TAPA</td>
                                <td class="celda_3"><?php echo $tapaNombre?> (<?php echo number_format($tapaPrecio,0,'','.')?>)</td>
                                <td class="celda_3">pliego_tapa</td>
                                <td class="celda_3"></td>
                                <td class="celda_3"><?php echo number_format($valorPlacaKilo,0,'','.');?></td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3">ONDA</td>
                                <td class="celda_3"><?php echo $ondaNombre?> (<?php echo number_format($ondaPrecio,0,'','.')?>)</td>
                                <td class="celda_3">pliego_ondas</td>
                                <td class="celda_3"></td>
                                <td class="celda_3"><?php echo number_format($kilosOnda,0,'','.');?></td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3">LINER</td>
                                <td class="celda_3"><?php echo $linerNombre?> (<?php echo number_format($linerPrecio,0,'','.')?>)</td>
                                <td class="celda_3">pliego_liner</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"><?php echo number_format($kilosLiner,0,'','.');?></td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>	
							<?php				
										}
							?>
                          
							<?php
									if($fotomecanica->materialidad_datos_tecnicos == 'Cartulina-cartulina')
										{
							?>	
							<tr>
                                <td class="celda_3">FECHA TAPA: <?php echo fecha_con_slash($tapaFecha)?></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3">FECHA Tapa (Respaldo): <?php echo fecha_con_slash($tapaFecha2)?></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3"></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3"></td>
                                <td class="celda_3"></td>
                            </tr>

							<?php
										}else{
							?>											
                            <tr>
                                <td class="celda_3">FECHA TAPA: <?php echo fecha_con_slash($tapaFecha)?></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3">FECHA ONDA: <?php echo fecha_con_slash($ondaFecha)?></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_3">FECHA LINER: <?php echo fecha_con_slash($linerFecha)?></td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">&nbsp;</td>
                                <td class="celda_3">240</td>
                                <td class="celda_3">449.71</td>
                            </tr>
							
						<?php
						}
                                                
                                                //***************ehndz********************
                                                
                                                 if($totalTrabajosInternos=='No'){$totalTrabajosInternos=0;}else{$totalTrabajosInternos=$totalTrabajosInternos*50;}
                                                 if($totalTrabajosExternos=='No'){$totalTrabajosExternos="No";}else{$cantidadTrabajosExternos=$totalTrabajosExternos/50;}
                                                 //***************ehndz********************
                                                 //echo "<h1>".$totalTrabajosExternos."</h1>";exit();
						?>		
                        </table>    
                        <div class="separador_20"></div>
                        <table id="tabla_detalle">
                            <tr>
                                <td class="celda_2">

                                </td>
                                <td class="celda_1">&nbsp;</td>
                                <td class="celda_60 valign_top" rowspan="5">
                                    <!--mermas-->                          
                                    <table id="tabla_produccion">
                                        <tr>
                                            <td colspan="4">Tabla de Patrón de MERMAS Microonda TIPO E + Tapa por <?php echo $datoscantidad4; ?> = <?php echo ($datoscantidad4 / $ing->unidades_por_pliego); ?> Pliegos -- Total Colores <?php echo ($fotomecanica->colores); ?> Barniz: <?php echo ($fotomecanica->fot_lleva_barniz); ?>
                                            Trabajos Externos: <?php echo $cantidadTrabajosExternos; ?></td>
                                        </tr>
                                        <tr>
                                            <td>Imprenta</td>
                                            <!--<td>Ultra</td>-->
                                            <td>Roland:800</td>
                                            <td>Roland:800</td>
                                            <td>&nbsp;</td>
                                            <td>&nbsp;</td>
                                        </tr>
                                        <tr>
                                            <td>Color 1-2-3</td>
                                            <td>400</td>
                                            <td>400</td>
                                            <td>&nbsp;</td>
                                            <td><?php echo $color1?></td>
                                        </tr>
                                        <tr>
                                            <td>Color &gt; 3</td>
                                            <td><?php if($datos->vb_maquina == 'SI' or $datos->acepta_excedentes == 'NO'){echo '150';}else{echo '100';}?></td>
                                            <td><?php if($datos->vb_maquina == 'SI' or $datos->acepta_excedentes == 'NO'){echo '150';}else{echo '100';}?></td>
                                            <td>* Color</td>
                                            <td><?php echo $color2?></td>
                                        </tr>
                                        <tr>
                                            <td>Cantidad</td>
                                            <td>30</td>
                                            <td>30</td>
                                            <td>Cantidad &gt; 5.000 * c/5.000</td>
                                            <td><?php echo $can1?></td>
                                        </tr>
<!--                                        <tr>
                                            <td>&nbsp;</td>
                                            <td>050</td>
                                            <td>050</td>
                                            <td>Cantidad &gt; 5.000 * c/5.000</td>
                                            <td><?php// echo $can2?></td>
                                        </tr>-->
                                        <tr>
                                            <td>Barniz</td>
                                            <td>100</td>
                                            <td>100</td>
                                            <td>Primeros 1.000</td>
                                            <td><?php echo $bar1 ?></td>
                                        </tr>
                                        <tr>
                                            <td>&nbsp;</td>
                                            <td>01</td>
                                            <td>01</td>
                                            <td>por cada 1.000 extra</td>
                                            <td><?php echo $bar2?></td>
                                        </tr>
                                        <tr>
                                            <td>Trabajo externo</td>
                                            <td>050</td>
                                            <td>050</td>
                                            <td>una sola vez</td>					
                                            <td><?php echo $externo?></td>
                                        </tr>
                                        <tr>
                                            <td>Micro/Micro</td>
                                            <td>030</td>
                                            <td>030</td>
                                            <td>una sola vez</td>
                                            <td><?php echo $micromicro?></td>
                                        </tr>
                                        <tr>
                                            <td>Cart/Cart</td>
                                            <td>030</td>
                                            <td>030</td>
                                            <td>una sola vez</td>
                                            <td><?php echo $cartulina?></td>
                                        </tr>
                                        <tr>
                                            <td>Tamaños Normales</td>
                                            <td>&nbsp;</td>
                                            <td>&nbsp;</td>
                                            <td>&nbsp;</td>
                                            <td>&nbsp;</td>
                                        </tr>
                                        <tr>
                                            <td>Emplacado</td>
                                            <td>50</td>
                                            <td>50</td>
                                            <td>primeros 1.000</td>
                                            <td><?php echo $emplacado_fijo?></td>
                                        </tr>
                                        <tr>
                                            <td></td>
                                            <td><?php echo $emplacado_merma?></td>
                                            <td><?php echo $emplacado_merma?></td>
                                            <td>por cada 1000</td>
                                            <td><?php echo $emplacado?></td>
                                        </tr>
                                        <tr>
                                            <td>Troquelado</td>
                                            <td>40</td>
                                            <td>40</td>
                                            <td>Los primeros 1.000</td>
                                            <td><?php echo $troquelado_fijo ?></td>
                                        </tr>
                                        <tr>
                                            <td></td>
                                            <td><?php echo $troquelado_merma ?></td>
                                            <td><?php echo $troquelado_merma ?></td>
                                            <td>por cada 1.000</td>
                                            <td><?php echo $troquelado?></td>
                                        </tr>
                                        <tr>
                                            <td colspan="5"><hr class="hr_punteada_corto" /></td>
                                        </tr>
                                        <tr>
                                            <td>&nbsp;</td>
                                            <td>&nbsp;</td>
                                            <td>&nbsp;</td>
                                            <td>&nbsp;</td>
                                            <td><?php echo number_format($sum,0,'','.')?></td>
                                        </tr>
                                    </table>
                                    <!--/mermas-->
                                </td>
                            </tr>
                            <tr>
                                <td class="celda_2">&nbsp;</td>
                                <td class="celda_1">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_2">&nbsp;</td>
                                <td class="celda_1">&nbsp;</td>
                            </tr>
                            <tr>
                                <td class="celda_2"></td>
                                <td class="celda_1">&nbsp;</td>
                            </tr>
                        </table>
                        <div class="separador_20"></div>

                    </div>
                
            
<!----------------elvis hernandez---------------->
<style>
    /* Clase que tendra el tooltip */
.cssToolTip {
    position: relative; /* Esta clase tiene que tener posicion relativa */
    color: #ff8c00; /* Color del texto */    
}

/* El tooltip */
.cssToolTip span {
    background: rgba(20,20,20,0.9) url('img/info.gif') center left 5px no-repeat; 
    border: 2px solid #87cefa;
    border-radius: 5px;
    box-shadow: 5px 5px 5px #333;
    color: #87cefa;
    display: none; /* El tooltip por defecto estara oculto */
    font-size: 16px;
    padding: 10px 10px 10px 10px;
    width: 120px;
    min-height: 120px;
    position: absolute; /* El tooltip se posiciona de forma absoluta para no modificar el aspezto del resto de la pagina */
    top: -60px; /* Posicion apartir de la parte superior del primer elemento padre con posicion relativa */
    left: -120px; /* Posicion apartir de la parte izquierda del primer elemento padre con posicion relativa */
    z-index: 100; /* Poner un z-index alto para que aparezca por encima del resto de elementos */
    text-align: center;
}

/* El tooltip cuando se muestra */
.cssToolTip:hover span {
    display: inline; /* Para mostrarlo simplemente usamos display block por ejemplo */
}
</style>
            <nav class="derecha">
                <div style="width: 300px;font-size: 14px">
                    <table style="width: 300px;font-size: 14px;text-align: center;border: 1px solid; background-color: #339900; color:white;">
                        <?php if ($hoja->impreso == 1){
                         
                           echo "<tr><td style='padding:5px'>Esta hoja de costos no puede ser modificada debido a que ya fue impresa.</td></tr>";
                         
                        } ?>
                    </table><br />
                    <table style="width: 300px;font-size: 14px;text-align: center;border: 1px solid;">
                        <tr>
                            <td><b>Grabada el <?php echo fecha($hoja->fecha); ?></b></td>
                        </tr>
                        <?php if (sizeof($copias)>0){
                         foreach ($copias as $value) {
                           echo "<tr><td><br /><a href='".base_url()."cotizaciones/hoja_de_costos/".$value->id_cotizacion."'>".$value->id_cotizacion."-".$value->codigo_duplicado."</a></td></tr>";
                         }
                        }else{
                            echo "<tr><td><br />No Hay Copias Recientes</td></tr>";
                        } ?>
                    </table>
                </div>
                <span class="ir-arriba icon-arrow-up">↑</span>
                <ul id="menuhorizontal">
                    <?php 
					$hoja=$this->cotizaciones_model->getHojaDeCostosPorIdCotizacion($id);
					if(sizeof($hoja) >= 1){
					?>
                     <li><a href="<?php echo base_url();?>cotizaciones/pdf/<?php echo $id?>" target="_blank" title="Exportar a PDF"><img src="<?php echo base_url();?>public/frontend/images/pdf.png" />
					<?php }?> 
                     <li><a href="<?php echo base_url();?>hoja/cambios/<?php echo $id?>" class="fancybox fancybox.ajax" title="Registro de cambios"><img src="<?php echo base_url();?>public/frontend/images/cambios.png" /> 
                     <li><a href="<?php echo base_url();?>cotizaciones/cotizacion_de_cliente/<?php echo $id?>" target="_blank" title="Cotización Cliente"><img src="<?php echo base_url();?>public/frontend/images/document.png" /> 
                     <?php if($hoja->impreso == "" || $hoja->impreso == 0){?>
                             <li><a href="javascript:void(0);" onclick="guardarHC();" title="Solo Guardar"><img src="<?php echo base_url();?>public/frontend/images/save.png" /><input type="hidden" name="id" value="<?php echo $id?>" /><input type="hidden" name="url" value="<?php echo base_url()?><?php echo $this->uri->uri_string();?>" /> 
                     <?php } ?>
                     <li><a href="<?php echo base_url()?>cotizaciones/index/<?php echo $pagina?>"  title="Volver a Cotización"><img src="<?php echo base_url();?>public/frontend/images/back.png" />                      
                     <li><a href="javascript:void(0);"  onclick="guardarHCI()" title="Guardar e Imprimir Cotización"><img  width="120px" src="<?php echo base_url();?>public/frontend/images/print.png" /> 
                     <input type="hidden" id="imprimir" value="0" name="imprimir" />
                     <input type="hidden" id="copia" value="0" name="copia" />
                     <input type="hidden" id="numerocopia" value="<?php echo $id ?>" name="numerocopia" />
                     <?php //if(sizeof($hoja) >= 1){?>
                             <!--<li><a href="javascript:void(0);" onclick="alert('Preparandose para copiar la hoja de costo: '+<?php //echo $id;?>);" title="Hacer Copia de Cotización"><img width="120px" src="<?php echo base_url();?>public/frontend/images/duplicar.png" /></a>-->                                 
                     <?php //} ?>
                
                <?php if($hoja->impreso == 1){?>
                <span class="cssToolTip">
                    <li><a href="javascript:void(0);" onclick="copiarHC(); verificarCosto();" title="Hacer Copia de Cotización"><img width="120px" src="<?php echo base_url();?>public/frontend/images/duplicar.png" /></a></li>
                    <!--<img width="120px" onclick="copiarHC()" src="<?php //echo base_url();?>public/frontend/images/duplicar.png"/>-->
                    <span title="Cotizaciones Copia"> 
                        <?php //echo $id; ?>
                    </span>
                <?php } ?>
                </ul>
            </nav>	
	
		
		
        <script type="text/javascript" src="<?php echo base_url()?>public/frontend/js/chosen.jquery.js"></script>
<script type="text/javascript" src="<?php echo base_url()?>public/frontend/js/prism.js"></script>
<script type="text/javascript">
    var config = {
      '.chosen-select'           : {},
      '.chosen-select-deselect'  : {allow_single_deselect:true},
      '.chosen-select-no-single' : {disable_search_threshold:10},
      '.chosen-select-no-results': {no_results_text:'Oops, nothing found!'},
      '.chosen-select-width'     : {width:"95%"}
    }
    for (var selector in config) {
      $(selector).chosen(config[selector]);
    }
$(document).ready(function(){
 
	$('.ir-arriba').click(function(){
		$('body, html').animate({
			scrollTop: '0px'
		}, 300);
	});
 
	$(window).scroll(function(){
//		if( $(this).scrollTop() > 0 ){
//			$('.ir-arriba').slideDown(300);
//		} else {
//			$('.ir-arriba').slideUp(300);
//		}
	});
        
	$('.ir-arriba2').click(function(){
		$('body, html').animate({
			scrollTop: '3700px'
		}, 300);
	});
 
	$(window).scroll(function(){
//		if( $(this).scrollTop() > 0 ){
//			$('.ir-arriba2').slideUp(300);
//		} else {
//			$('.ir-arriba2').slideDown(300);
//		}
	});
 
});  
</script>
  
</form>
        <!--</page>-->
    </body>
</html>  